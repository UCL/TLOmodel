

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.epi &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.epi</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.epi</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># TODO Vitamin A</span>
<div class="viewcode-block" id="Epi"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi">[docs]</a><span class="k">class</span> <span class="nc">Epi</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the expanded programme on immunisation module</span>
<span class="sd">    it sets up the vaccination schedule for all children from birth</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;baseline_coverage&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATA_FRAME</span><span class="p">,</span> <span class="s2">&quot;baseline vaccination coverage (all vaccines)&quot;</span><span class="p">),</span>
        <span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">SERIES</span><span class="p">,</span> <span class="s2">&quot;vaccination schedule applicable from 2018 onwards&quot;</span><span class="p">),</span>
        <span class="s2">&quot;district_vaccine_coverage&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATA_FRAME</span><span class="p">,</span> <span class="s2">&quot;coverage of each vaccine type by year and district&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;va_bcg&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;received bcg vaccination&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_opv&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of OPV vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_dtp&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of DTP vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hib&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of Hib vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hep&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of HepB vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_pneumo&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of pneumococcal vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rota&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of rotavirus vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_measles&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of measles vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rubella&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of rubella vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hpv&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of hpv vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_td&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of tetanus/diphtheria vaccine received by pregnant women&quot;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Epi.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># NB. Parameters passed to the module can be inserted in the __init__ definition.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span></div>

<div class="viewcode-block" id="Epi.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">workbook</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_EPI_WHO_estimates.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;baseline_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;WHO_estimates&quot;</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;vaccine&#39;</span><span class="p">)[</span><span class="s1">&#39;date_administration_days&#39;</span><span class="p">]</span>

        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;district_vaccine_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;ResourceFile_EPI_vaccine_coverage.csv&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Epi.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Set default for properties</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_pneumo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_rubella&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_hpv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;va_td&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># BCG</span>
        <span class="c1"># from 1981-2009 average bcg coverage is 92% (WHO estimates)</span>
        <span class="c1"># use vaccine coverage estimates for each year prior to 2010</span>
        <span class="c1"># assuming only &lt;1 yr olds were vaccinated each year</span>
        <span class="c1"># match up vaccine coverage for each person based on their age</span>
        <span class="c1"># anyone over age 29 will not have matching vaccine coverage estimates</span>
        <span class="c1"># therefore no vaccinations for them</span>
        <span class="n">df_vaccine_baseline</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;baseline_coverage&quot;</span><span class="p">],</span>
            <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age_years&quot;</span><span class="p">],</span>
            <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;AgeOn01Jan2010&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">)</span>

        <span class="c1"># use same random draw value for all vaccines - will induce correlations (good)</span>
        <span class="c1"># there are individuals who have high probability of getting all vaccines</span>
        <span class="c1"># some individuals will have consistently poor coverage</span>
        <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_vaccine_baseline</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;BCG&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Polio OPV</span>
        <span class="c1"># from 1980-2009 average opv3 coverage is 79.5% (WHO estimates): all 3 doses OPV</span>
        <span class="c1"># assume no partial protection if &lt; 3 doses (all-or-nothing response)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;Pol3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># DTP3</span>
        <span class="c1"># available since 1980</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;DTP3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Hep3</span>
        <span class="c1"># available since 2002</span>
        <span class="c1"># by Jan 2010, anyone &lt;9 years has 87.5% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;HepB3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Hib3</span>
        <span class="c1"># available since 2002</span>
        <span class="c1"># by Jan 2010, anyone &lt;9 years has 87.5% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;Hib3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Measles</span>
        <span class="c1"># available since 1980</span>
        <span class="c1"># second dose only started in 2015</span>
        <span class="c1"># by Jan 2010, anyone &lt;=30 years has 77.2% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;MCV1&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span></div>

<div class="viewcode-block" id="Epi.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># add an event to log to screen</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EpiLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># HPV vaccine given from 2018 onwards</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">HpvScheduleEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2018/01/01&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># Update paramerer &quot;district_vaccine_coverage&quot; to use district_num rather than the name of the district;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;district_vaccine_coverage&quot;</span><span class="p">][</span><span class="s2">&quot;District&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;district_vaccine_coverage&quot;</span><span class="p">][</span><span class="s2">&quot;District&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;district_num_to_district_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Epi.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise our properties for a newborn individual</span>

<span class="sd">        birth doses occur within 24 hours of delivery</span>

<span class="sd">        from 2010-2018 data on vaccine coverage are used to determine probability of receiving vaccine</span>
<span class="sd">        vaccinations are scheduled to occur with a probability dependent on the year and district</span>
<span class="sd">        from 2019 onwards, probability will be determined by personnel and vaccine availability</span>

<span class="sd">        2012 data is patchy, no record of Hep vaccine but it was used before 2012</span>
<span class="sd">        assume hepB3 coverage in 2012 same as 2011</span>
<span class="sd">        same with Hib</span>

<span class="sd">        for births up to end 2018 schedule the vaccine as individual event (not HSI)</span>
<span class="sd">        schedule the dates as the exact due date</span>
<span class="sd">        then from 2019 use the HSI events - only need the current vaccines in use that way</span>

<span class="sd">        :param mother_id: the ID for the mother for this child</span>
<span class="sd">        :param child_id: the ID for the new child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the population props dataframe</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span>

        <span class="c1"># look up coverage of every vaccine</span>
        <span class="c1"># anything delivered after 12months needs the estimate from the following year</span>
        <span class="n">district</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;district_num_of_residence&#39;</span><span class="p">]</span>

        <span class="c1"># Initialise all the properties that this module looks after:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_pneumo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_rubella&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_hpv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s2">&quot;va_td&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ----------------------------------- 2010-2018 -----------------------------------</span>
        <span class="n">vax_date</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span>

        <span class="c1"># from 2010-2018 use the reported vaccine coverage values and schedule individual events (not HSI)</span>
        <span class="c1"># no consumables will be tracked up to end-2018</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2018</span><span class="p">:</span>

            <span class="c1"># lookup the correct table of vaccine estimates for this child</span>
            <span class="n">vax_coverage</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;district_vaccine_coverage&quot;</span><span class="p">]</span>
            <span class="n">ind_vax_coverage</span> <span class="o">=</span> <span class="n">vax_coverage</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">vax_coverage</span><span class="o">.</span><span class="n">District</span> <span class="o">==</span> <span class="n">district</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vax_coverage</span><span class="o">.</span><span class="n">Year</span> <span class="o">==</span> <span class="n">year</span><span class="p">)]</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">ind_vax_coverage</span><span class="o">.</span><span class="n">empty</span>

            <span class="c1"># schedule bcg birth dose according to current coverage</span>
            <span class="c1"># some values are &gt;1</span>
            <span class="c1"># each entry is (coverage prob key, event class, [days_to_1_administration, days_to_2_administration, etc])</span>
            <span class="n">pre_2018_vax_schedule</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;BCG&#39;</span><span class="p">,</span> <span class="n">BcgVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bcg&#39;</span><span class="p">]),</span>
                <span class="c1"># assign OPV first dose according to current coverage</span>
                <span class="c1"># OPV doses 2-4 are given during the week 6, 10, 14 penta, pneumo, rota appts</span>
                <span class="c1"># coverage estimates for 3 doses reported, use these for doses 2-4</span>
                <span class="p">(</span><span class="s1">&#39;OPV3&#39;</span><span class="p">,</span> <span class="n">OpvEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;opv1&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">&#39;OPV3&#39;</span><span class="p">,</span> <span class="n">OpvEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;opv2&#39;</span><span class="p">,</span> <span class="s1">&#39;opv3&#39;</span><span class="p">,</span> <span class="s1">&#39;opvIpv4&#39;</span><span class="p">]),</span>

                <span class="c1"># DTP1_HepB - up to and including 2012, then replaced by pentavalent vaccine</span>
                <span class="p">(</span><span class="s1">&#39;DTP1&#39;</span><span class="p">,</span> <span class="n">DtpHepVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep1&#39;</span><span class="p">]),</span>

                <span class="c1"># DTP2_HepB - up to and including 2012</span>
                <span class="c1"># second doses not reported - same coverage for second and third doses</span>
                <span class="p">(</span><span class="s1">&#39;DTP3&#39;</span><span class="p">,</span> <span class="n">DtpHepVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep3&#39;</span><span class="p">]),</span>

                <span class="p">(</span><span class="s1">&#39;Hib3&#39;</span><span class="p">,</span> <span class="n">HibVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep1&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep3&#39;</span><span class="p">]),</span>

                <span class="c1"># PNEUMO - all three doses reported separately</span>
                <span class="p">(</span><span class="s1">&#39;Pneumo1&#39;</span><span class="p">,</span> <span class="n">PneumococcalVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pneumo1&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">&#39;Pneumo2&#39;</span><span class="p">,</span> <span class="n">PneumococcalVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pneumo2&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">&#39;Pneumo3&#39;</span><span class="p">,</span> <span class="n">PneumococcalVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pneumo3&#39;</span><span class="p">]),</span>

                <span class="c1"># ROTA - doses 1 and 2 reported separately</span>
                <span class="p">(</span><span class="s1">&#39;Rotavirus1&#39;</span><span class="p">,</span> <span class="n">RotavirusVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rota1&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">&#39;Rotavirus2&#39;</span><span class="p">,</span> <span class="n">RotavirusVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rota2&#39;</span><span class="p">]),</span>

                <span class="c1"># PENTA1</span>
                <span class="p">(</span><span class="s1">&#39;DTPHepHib1&#39;</span><span class="p">,</span> <span class="n">DtpHibHepVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep1&#39;</span><span class="p">]),</span>
                <span class="c1"># PENTA2 - second dose not reported so use 3 dose coverage</span>
                <span class="p">(</span><span class="s1">&#39;DTPHepHib3&#39;</span><span class="p">,</span> <span class="n">DtpHibHepVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep3&#39;</span><span class="p">]),</span>

                <span class="c1"># Measles, rubella - first dose, 2018 onwards</span>
                <span class="p">(</span><span class="s1">&#39;MCV1_MR1&#39;</span><span class="p">,</span> <span class="n">MeaslesRubellaVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MR1&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s1">&#39;MCV2_MR2&#39;</span><span class="p">,</span> <span class="n">MeaslesRubellaVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MR2&#39;</span><span class="p">]),</span>

                <span class="c1"># Measles - first dose, only one dose pre-2017 and no rubella</span>
                <span class="p">(</span><span class="s1">&#39;MCV1&#39;</span><span class="p">,</span> <span class="n">MeaslesVaccineEvent</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MR1&#39;</span><span class="p">])</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">each_vax</span> <span class="ow">in</span> <span class="n">pre_2018_vax_schedule</span><span class="p">:</span>
                <span class="n">coverage_key</span><span class="p">,</span> <span class="n">vax_event</span><span class="p">,</span> <span class="n">admin_schedule</span> <span class="o">=</span> <span class="n">each_vax</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">ind_vax_coverage</span><span class="p">[</span><span class="n">coverage_key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="n">vax_event_instance</span> <span class="o">=</span> <span class="n">vax_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">admin_key</span> <span class="ow">in</span> <span class="n">admin_schedule</span><span class="p">:</span>
                        <span class="n">days_to_admin</span> <span class="o">=</span> <span class="n">vax_date</span><span class="p">[</span><span class="n">admin_key</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">vax_event_instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_to_admin</span><span class="p">))</span>

        <span class="c1"># ----------------------------------- 2019 onwards -----------------------------------</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># after 2018</span>
            <span class="c1"># each entry is (hsi event class, [days to administration key 1, days to administration key 2, ...]</span>
            <span class="n">post_2018_vax_schedule</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># schedule bcg - now dependent on health system capacity / stocks</span>
                <span class="p">(</span><span class="n">HSI_BcgVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bcg&#39;</span><span class="p">]),</span>
                <span class="c1"># OPV doses 2-4 are given during the week 6, 10, 14 penta, pneumo, rota appts</span>
                <span class="p">(</span><span class="n">HSI_opv</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;opv1&#39;</span><span class="p">,</span> <span class="s1">&#39;opv2&#39;</span><span class="p">,</span> <span class="s1">&#39;opv3&#39;</span><span class="p">,</span> <span class="s1">&#39;opvIpv4&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">HSI_PneumoVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pneumo1&#39;</span><span class="p">,</span> <span class="s1">&#39;pneumo2&#39;</span><span class="p">,</span> <span class="s1">&#39;pneumo3&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">HSI_RotaVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rota1&#39;</span><span class="p">,</span> <span class="s1">&#39;rota2&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">HSI_DtpHibHepVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep1&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep3&#39;</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">HSI_MeaslesRubellaVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MR1&#39;</span><span class="p">,</span> <span class="s1">&#39;MR2&#39;</span><span class="p">])</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">each_vax</span> <span class="ow">in</span> <span class="n">post_2018_vax_schedule</span><span class="p">:</span>
                <span class="n">vax_hsi_event</span><span class="p">,</span> <span class="n">admin_schedule</span> <span class="o">=</span> <span class="n">each_vax</span>
                <span class="k">for</span> <span class="n">admin_key</span> <span class="ow">in</span> <span class="n">admin_schedule</span><span class="p">:</span>
                    <span class="n">vax_event_instance</span> <span class="o">=</span> <span class="n">vax_hsi_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">)</span>
                    <span class="n">scheduled_date</span> <span class="o">=</span> <span class="n">vax_date</span><span class="p">[</span><span class="n">admin_key</span><span class="p">]</span>
                    <span class="c1"># Request the health system to have this vaccination appointment</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                        <span class="n">vax_event_instance</span><span class="p">,</span>
                        <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">scheduled_date</span><span class="p">),</span>
                        <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="Epi.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called whenever there is an HSI event commissioned by one of the other disease modules.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="c1"># TODO: consider here how early interventions are bundled</span>
        <span class="c1"># TODO: routine infant check-ups may occur alongside vaccinations</span>

<div class="viewcode-block" id="Epi.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; epi module returns dalys=0 for all persons alive &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;This is epi reporting my health values&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to population properties dataframe</span>

        <span class="n">health_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">health_values</span>  <span class="c1"># returns the series</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># Individually Scheduled Vaccine Events</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>

<span class="c1"># BCG</span>
<div class="viewcode-block" id="BcgVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.BcgVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">BcgVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give BCG vaccine at birth &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BcgVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.BcgVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="OpvEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.OpvEvent">[docs]</a><span class="k">class</span> <span class="nc">OpvEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give oral poliovirus vaccine (OPV) &quot;&quot;&quot;</span>
<div class="viewcode-block" id="OpvEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.OpvEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="DtpHepVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.DtpHepVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">DtpHepVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give DTP_Hep vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DtpHepVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.DtpHepVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="DtpHibHepVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.DtpHibHepVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">DtpHibHepVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give DTP_Hib_Hep vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DtpHibHepVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.DtpHibHepVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="RotavirusVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.RotavirusVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">RotavirusVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give Rotavirus vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RotavirusVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.RotavirusVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="PneumococcalVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.PneumococcalVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">PneumococcalVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give Pneumococcal vaccine (PCV) &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PneumococcalVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.PneumococcalVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_pneumo&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="HibVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HibVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">HibVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give Haemophilus influenza B vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HibVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HibVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="MeaslesVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.MeaslesVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">MeaslesVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give measles vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MeaslesVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.MeaslesVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="MeaslesRubellaVaccineEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.MeaslesRubellaVaccineEvent">[docs]</a><span class="k">class</span> <span class="nc">MeaslesRubellaVaccineEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give measles/rubella vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MeaslesRubellaVaccineEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.MeaslesRubellaVaccineEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rubella&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="HpvScheduleEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent">[docs]</a><span class="k">class</span> <span class="nc">HpvScheduleEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; HPV vaccine event - each year sample from 9 year old girls and schedule vaccine</span>
<span class="sd">    stagger vaccine administration across the year</span>
<span class="sd">    coverage estimates dependent on health system capacity</span>
<span class="sd">    average around 85% for 2018</span>
<span class="sd">    WHO recommends 2 doses</span>
<span class="sd">    schedule doses 1 month apart</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HpvScheduleEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span></div>

<div class="viewcode-block" id="HpvScheduleEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;HpvScheduleEvent selecting eligible 9-yr olds for HPV vaccine&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1">#  sample using the prob_inf scaled by relative susceptibility</span>
        <span class="n">hpv_vax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">)]</span>

        <span class="c1"># scatter vaccination days across the year</span>
        <span class="c1"># todo: HPV vaccine may be offered on scheduled clinic days / weeks - check</span>
        <span class="n">random_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">hpv_vax</span><span class="p">))</span>

        <span class="n">scheduled_vax_dates</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">random_day</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hpv_vax</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HpvScheduleEvent scheduling HPV vaccine for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># find the index in hpv_vax</span>
            <span class="c1"># then select that value from the scheduled_vax_date</span>
            <span class="n">vax_date</span> <span class="o">=</span> <span class="n">scheduled_vax_dates</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="c1"># first dose</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_HpvVaccine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">event</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="n">vax_date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># second dose</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">event</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">tclose</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># Health System Interaction Events</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># TODO: note syringe disposal units will accommodate ~100 syringes</span>
<span class="c1"># request a box with each vaccine but don&#39;t need to condition HSI on availability</span>
<span class="c1"># likely always safety boxes available</span>
<span class="c1"># could request 1/100 of a box with each vaccine</span>

<div class="viewcode-block" id="HsiBaseVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine">[docs]</a><span class="k">class</span> <span class="nc">HsiBaseVaccine</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a base class for all vaccination HSI_Events. Handles initialisation and requesting consumables needed</span>
<span class="sd">    for the vaccination. For custom behaviour, you can override __init__ in subclasses and implemented your own</span>
<span class="sd">    constructors (or inherit directly from HSI_Event)&quot;&quot;&quot;</span>
<div class="viewcode-block" id="HsiBaseVaccine.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Epi</span><span class="p">)</span>

        <span class="c1"># Define the necessary information for an HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s2">&quot;ConWithDCSA&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Can occur at this facility level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HsiBaseVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;subclasses should implement this method to return the TREATMENT_ID&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="HsiBaseVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;must be implemented by subclasses&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="HsiBaseVaccine.request_vax_consumables"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.request_vax_consumables">[docs]</a>    <span class="k">def</span> <span class="nf">request_vax_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">packages</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;pull together the construction of consumables (items &amp; packages) needed and returns the outcome after</span>
<span class="sd">        requesting them from the health system module</span>

<span class="sd">        The following must be passed as keyword arguments:</span>
<span class="sd">        :param items - a list of tuples, where first element of tuple is item name and second element is number req.</span>
<span class="sd">        :param packages - a list of tuples, where first element of tuple is package name and second element is number</span>
<span class="sd">            required&quot;&quot;&quot;</span>
        <span class="n">health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="n">health_system</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># collect the consumable items needed</span>
        <span class="n">items_found</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">item_count</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">item_code</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s2">&quot;Items&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_name</span><span class="p">,</span>
                                                      <span class="s2">&quot;Item_Code&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">items_found</span><span class="p">[</span><span class="n">item_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_count</span>

        <span class="c1"># collect the consumable packages needed</span>
        <span class="n">packages_found</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">packages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">package_count</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
                <span class="n">package_code</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s2">&quot;Intervention_Pkg&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">package_name</span><span class="p">,</span>
                                                         <span class="s2">&quot;Intervention_Pkg_Code&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">packages_found</span><span class="p">[</span><span class="n">package_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">package_count</span>

        <span class="c1"># put together the items and packages need for this vax</span>
        <span class="n">consumables_needed</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Intervention_Package_Code&quot;</span><span class="p">:</span> <span class="n">packages_found</span><span class="p">,</span>
                              <span class="s2">&quot;Item_Code&quot;</span><span class="p">:</span> <span class="n">items_found</span><span class="p">}</span>

        <span class="c1"># make request to the health system for consumables</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="n">health_system</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_needed</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">outcome_of_request_for_consumables</span></div>

<div class="viewcode-block" id="HsiBaseVaccine.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: did not run&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_BcgVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_BcgVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;gives bcg vaccine 24 hours after birth or as soon as possible afterwards&quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_BcgVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_bcg&quot;</span></div>

<div class="viewcode-block" id="HSI_BcgVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_bcg: giving bcg to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;BCG vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;Syringe, autodisposable, BCG, 0.1 ml, with needle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;Safety box for used syringes/needles, 5 liter&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># check if BCG and syringes available</span>
            <span class="n">bcg_vax</span><span class="p">,</span> <span class="n">syringe</span><span class="p">,</span> <span class="n">safety_box</span> <span class="o">=</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">bcg_vax</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">syringe</span><span class="p">]:</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="HSI_opv"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv">[docs]</a><span class="k">class</span> <span class="nc">HSI_opv</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;gives poliovirus vaccine 24 hours after birth, plus weeks 6, 10, 14 or as soon as possible afterwards&quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_opv.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_opv&quot;</span></div>

<div class="viewcode-block" id="HSI_opv.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_opv: giving opv to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Polio vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="HSI_DtpHibHepVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_DtpHibHepVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gives DTP-Hib_HepB vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_DtpHibHepVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_DtpHibHep&quot;</span></div>

<div class="viewcode-block" id="HSI_DtpHibHepVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_DtpHibHepVaccine: requesting vaccines for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span>
            <span class="n">items</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Pentavalent vaccine (DPT, Hep B, Hib)&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Syringe, needle + swab&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Safety box for used syringes/needles, 5 liter&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># check if Penta and syringes available</span>
        <span class="n">penta_vax</span><span class="p">,</span> <span class="n">syringe</span><span class="p">,</span> <span class="n">safety_box</span> <span class="o">=</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">penta_vax</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">syringe</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Penta vax is available, so administer to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Penta vax is not available for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RotaVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_RotaVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gives Rotavirus vaccine 6 and 10 weeks after birth &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_RotaVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Rota&quot;</span></div>

<div class="viewcode-block" id="HSI_RotaVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_RotaVaccine: requesting vaccines for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># rotavirus - oral vaccine</span>
        <span class="c1"># only 2 doses rotavirus given (week 6 and 10)</span>
        <span class="c1"># available from 2012 onwards</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Rotavirus vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">]):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rotavirus vaccine is available, so administer to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rotavirus vaccine is not available for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PneumoVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_PneumoVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gives Pneumococcal vaccine 6, 10 and 14 weeks after birth &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_PneumoVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Pneumo&quot;</span></div>

<div class="viewcode-block" id="HSI_PneumoVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span>
            <span class="n">items</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Pneumococcal vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Syringe, needle + swab&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Safety box for used syringes/needles, 5 liter&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># check if pneumo vax and syringes available</span>
        <span class="n">pneumo_vax</span><span class="p">,</span> <span class="n">syringe</span><span class="p">,</span> <span class="n">safety_box</span> <span class="o">=</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="c1"># check if pneumococcal vaccine available and current year 2012 onwards</span>
        <span class="k">if</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">pneumo_vax</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Item_Code&quot;</span><span class="p">][</span><span class="n">syringe</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pneumococcal vaccine is available, so administer to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_pneumo&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pneumococcal vaccine is NOT available for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_MeaslesRubellaVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; administers measles+rubella vaccine &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_MeaslesRubella&quot;</span></div>

<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span>
           <span class="n">packages</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Measles rubella vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="c1"># this package includes a syringe disposal box</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Intervention_Package_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_MeaslesRubellaVaccine: measles+rubella vaccine is available for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rubella&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_MeaslesRubellaVaccine: measles+rubella vaccine is NOT available for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_HpvVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_HpvVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gives HPV vaccine to 9 year old girls; recommended 2 doses (WHO) &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_HpvVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_hpv&quot;</span></div>

<div class="viewcode-block" id="HSI_HpvVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_HpvVaccine: giving hpv vaccine to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hpv&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># this package includes syringe disposal box</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;HPV vaccine&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Intervention_Package_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hpv&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<span class="c1"># TODO this will be called by the antenatal care module as part of routine care</span>
<span class="c1"># currently not implemented</span>
<div class="viewcode-block" id="HSI_TdVaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_TdVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; gives tetanus/diphtheria vaccine to pregnant women as part of routine antenatal care</span>
<span class="sd">    recommended 2+ doses (WHO)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_TdVaccine.treatment_id"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine.treatment_id">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Td&quot;</span></div>

<div class="viewcode-block" id="HSI_TdVaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_TdVaccine: giving Td vaccine to </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># this package DOES NOT include syringe disposal box</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_vax_consumables</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Tetanus toxoid (pregnant women)&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="s2">&quot;Intervention_Package_Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_td&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># LOGGING</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="EpiLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">EpiLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<div class="viewcode-block" id="EpiLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; output vaccine coverage every year &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Epi</span><span class="p">)</span></div>

<div class="viewcode-block" id="EpiLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">def</span> <span class="nf">get_coverage</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">subset</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
            <span class="n">has_condition</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">condition</span> <span class="o">&amp;</span> <span class="n">subset</span><span class="p">)</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">has_condition</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">coverage</span> <span class="o">&lt;=</span> <span class="mi">100</span>
            <span class="k">return</span> <span class="n">coverage</span>

        <span class="n">under_ones</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bcg_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_bcg</span><span class="p">,</span> <span class="n">under_ones</span><span class="p">)</span>

        <span class="c1"># the eligible group for coverage estimates will be those from 14 weeks and older</span>
        <span class="c1"># younger infants won&#39;t have had the three-dose course yet</span>
        <span class="n">from_14_weeks_to_one</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mf">0.27</span><span class="p">)</span>
        <span class="n">dtp3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_dtp</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">opv3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_opv</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">hib3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hib</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">hep3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hep</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">pneumo3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_pneumo</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">rota_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_rota</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>

        <span class="c1"># measles vaccination coverage in &lt;2 year old children - 1 dose</span>
        <span class="c1"># first dose is at 9 months, second dose is 15 months</span>
        <span class="c1"># so check coverage in 15 month -2 year olds</span>
        <span class="n">from_15_months_to_two</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mf">1.25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">measles_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_measles</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from_15_months_to_two</span><span class="p">)</span>

        <span class="c1"># rubella vaccination coverage in &lt;2 year old children - 1 dose</span>
        <span class="c1"># first dose is at 9 months, second dose is 15 months</span>
        <span class="n">rubella_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_rubella</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from_15_months_to_two</span><span class="p">)</span>

        <span class="c1"># HPV vaccination coverage in adolescent girls - 1 dose</span>
        <span class="c1"># first dose is at 9 years</span>
        <span class="n">girls_from_ten_to_twelve</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">hpv_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hpv</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">girls_from_ten_to_twelve</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ep_vaccine_coverage&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;epNumInfantsUnder1&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">from_14_weeks_to_one</span><span class="p">),</span>
                <span class="s2">&quot;epBcgCoverage&quot;</span><span class="p">:</span> <span class="n">bcg_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epDtp3Coverage&quot;</span><span class="p">:</span> <span class="n">dtp3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epOpv3Coverage&quot;</span><span class="p">:</span> <span class="n">opv3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHib3Coverage&quot;</span><span class="p">:</span> <span class="n">hib3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHep3Coverage&quot;</span><span class="p">:</span> <span class="n">hep3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epPneumo3Coverage&quot;</span><span class="p">:</span> <span class="n">pneumo3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epRota2Coverage&quot;</span><span class="p">:</span> <span class="n">rota_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epMeaslesCoverage&quot;</span><span class="p">:</span> <span class="n">measles_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epRubellaCoverage&quot;</span><span class="p">:</span> <span class="n">rubella_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHpvCoverage&quot;</span><span class="p">:</span> <span class="n">hpv_coverage</span>
            <span class="p">}</span>
        <span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 08, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>