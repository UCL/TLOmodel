

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tlo.methods.epi &mdash; TLOmodel 0.1.dev2456+g2221089.d20241007 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=6ea10ece" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=363ca9bd"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TLOmodel
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/index.html">Resource files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../learning.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../methods.html">tlo.methods</a></li>
      <li class="breadcrumb-item active">tlo.methods.epi</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tlo.methods.epi</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">Date</span><span class="p">,</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hsi_event</span> <span class="kn">import</span> <span class="n">HSI_Event</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># TODO Vitamin A</span>
<div class="viewcode-block" id="Epi">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi">[docs]</a>
<span class="k">class</span> <span class="nc">Epi</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the expanded programme on immunisation module</span>
<span class="sd">    it sets up the vaccination schedule for all children from birth</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">,</span> <span class="s1">&#39;HealthSystem&#39;</span><span class="p">}</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;baseline_coverage&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATA_FRAME</span><span class="p">,</span> <span class="s2">&quot;baseline vaccination coverage (all vaccines)&quot;</span><span class="p">),</span>
        <span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">SERIES</span><span class="p">,</span> <span class="s2">&quot;vaccination schedule applicable from 2018 onwards&quot;</span><span class="p">),</span>
        <span class="s2">&quot;prob_facility_level_for_vaccine&quot;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                                                     <span class="s2">&quot;The probability of going to each facility-level (0 / 1a / 1b / 2)&quot;</span>
                                                     <span class="s2">&quot; for child having vaccines given through childhood immunisation &quot;</span>
                                                     <span class="s2">&quot;schedule. The probabilities must sum to 1.0 &quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># -- Properties for the number of doses received of each vaccine --</span>
        <span class="s2">&quot;va_bcg&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of BCG vaccination&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_opv&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of OPV vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_dtp&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of DTP vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hib&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of Hib vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hep&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of HepB vaccine received (infant series)&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_pneumo&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of pneumococcal vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rota&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of rotavirus vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_measles&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of measles vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rubella&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of rubella vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hpv&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of hpv vaccine received&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_td&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s2">&quot;number of doses of tetanus/diphtheria vaccine received by pregnant women&quot;</span><span class="p">),</span>

        <span class="c1"># -- Properties to inidcate whether the full number of doses have been received --</span>
        <span class="s2">&quot;va_bcg_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the vaccine bcg&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_opv_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the OPV vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_dtp_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the DTP vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hib_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the Hib vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hep_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                                     <span class="s2">&quot;whether all doses have been received of the HepB vaccine (infant series)&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_pneumo_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the pneumococcal vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rota_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the rotavirus vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_measles_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the measles vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_rubella_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the rubella vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_hpv_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s2">&quot;whether all doses have been received of the HPV vaccine&quot;</span><span class="p">),</span>
        <span class="s2">&quot;va_td_all_doses&quot;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                                    <span class="s2">&quot;whether all doses have been received of the tetanus/diphtheria vaccine&quot;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Epi.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># NB. Parameters passed to the module can be inserted in the __init__ definition.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_doses</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># (will store dict giving item_codes for each vaccine)</span></div>


<div class="viewcode-block" id="Epi.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">workbook</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_EPI_WHO_estimates.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">])</span>

        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;baseline_coverage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;WHO_estimates&quot;</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;vaccine&#39;</span><span class="p">)[</span><span class="s1">&#39;date_administration_days&#39;</span><span class="p">]</span>

        <span class="c1"># Declare definitions of how many doses is labelled as &quot;all doses&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_doses</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;bcg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;opv&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;dtp&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;hib&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;hep&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;pneumo&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;rota&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;measles&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;rubella&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;hpv&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;td&#39;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="Epi.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Set default for properties</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="p">[</span>
            <span class="s2">&quot;va_bcg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_opv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_dtp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_pneumo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rota&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_measles&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rubella&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hpv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_td&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="p">[</span>
            <span class="s2">&quot;va_bcg_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_opv_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_dtp_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hib_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hep_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_pneumo_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rota_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_measles_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rubella_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hpv_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_td_all_doses&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># BCG</span>
        <span class="c1"># from 1981-2009 average bcg coverage is 92% (WHO estimates)</span>
        <span class="c1"># use vaccine coverage estimates for each year prior to 2010</span>
        <span class="c1"># assuming only &lt;1 yr olds were vaccinated each year</span>
        <span class="c1"># match up vaccine coverage for each person based on their age</span>
        <span class="c1"># anyone over age 29 will not have matching vaccine coverage estimates</span>
        <span class="c1"># therefore no vaccinations for them</span>
        <span class="n">df_vaccine_baseline</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;baseline_coverage&quot;</span><span class="p">],</span>
            <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age_years&quot;</span><span class="p">],</span>
            <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;AgeOn01Jan2010&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">)</span>

        <span class="c1"># use same random draw value for all vaccines - will induce correlations (good)</span>
        <span class="c1"># there are individuals who have high probability of getting all vaccines</span>
        <span class="c1"># some individuals will have consistently poor coverage</span>
        <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_vaccine_baseline</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;BCG&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Polio OPV</span>
        <span class="c1"># from 1980-2009 average opv3 coverage is 79.5% (WHO estimates): all 3 doses OPV</span>
        <span class="c1"># assume no partial protection if &lt; 3 doses (all-or-nothing response)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;Pol3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_opv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># DTP3</span>
        <span class="c1"># available since 1980</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;DTP3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_dtp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Hep3</span>
        <span class="c1"># available since 2002</span>
        <span class="c1"># by Jan 2010, anyone &lt;9 years has 87.5% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;HepB3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_hep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Hib3</span>
        <span class="c1"># available since 2002</span>
        <span class="c1"># by Jan 2010, anyone &lt;9 years has 87.5% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;Hib3&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_hib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Measles</span>
        <span class="c1"># available since 1980</span>
        <span class="c1"># second dose only started in 2015</span>
        <span class="c1"># by Jan 2010, anyone &lt;=30 years has 77.2% prob of having vaccine</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">df_vaccine_baseline</span><span class="p">[</span><span class="s2">&quot;MCV1&quot;</span><span class="p">]),</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># update the &#39;all_doses&#39; properties for initial population</span>
        <span class="k">for</span> <span class="n">vaccine</span><span class="p">,</span> <span class="n">max_dose</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_doses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;va_</span><span class="si">{</span><span class="n">vaccine</span><span class="si">}</span><span class="s2">_all_doses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;va_</span><span class="si">{</span><span class="n">vaccine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_dose</span></div>


<div class="viewcode-block" id="Epi.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># add an event to log to screen</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EpiLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># HPV vaccine given from 2018 onwards</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">HpvScheduleEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">Date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Look up item codes for consumables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_item_codes</span><span class="p">()</span>

        <span class="c1"># Check that the values enetered for &#39;prob_facility_level_for_vaccine&#39; sum to 1.0</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_facility_level_for_vaccine&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">probs</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Epi.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise our properties for a newborn individual</span>

<span class="sd">        birth doses occur within 24 hours of delivery</span>

<span class="sd">        2012 data is patchy, no record of Hep vaccine but it was used before 2012</span>
<span class="sd">        assume hepB3 coverage in 2012 same as 2011</span>
<span class="sd">        same with Hib</span>

<span class="sd">        Measles - first dose, only one dose pre-2016 and no rubella</span>
<span class="sd">        Measles, rubella - first dose, 2018 onwards</span>

<span class="sd">        :param mother_id: the ID for the mother for this child</span>
<span class="sd">        :param child_id: the ID for the new child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the population props dataframe</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Initialise all the properties that this module looks after:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="p">[</span>
            <span class="s2">&quot;va_bcg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_opv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_dtp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hib&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_pneumo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rota&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_measles&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rubella&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hpv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_td&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="p">[</span>
            <span class="s2">&quot;va_bcg_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_opv_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_dtp_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hib_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hep_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_pneumo_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rota_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_measles_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_rubella_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_hpv_all_doses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;va_td_all_doses&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ----------------------------------- 2010-2018 -----------------------------------</span>
        <span class="n">vax_date</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;vaccine_schedule&quot;</span><span class="p">]</span>

        <span class="c1"># each entry is (hsi event class, [days to administration key 1, days to administration key 2, ...]</span>
        <span class="n">vax_schedule</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># schedule bcg - now dependent on health system capacity / stocks</span>
            <span class="p">(</span><span class="n">HSI_BcgVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bcg&#39;</span><span class="p">]),</span>
            <span class="c1"># OPV doses 2-4 are given during the week 6, 10, 14 penta, pneumo, rota appts</span>
            <span class="p">(</span><span class="n">HSI_opv</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;opv1&#39;</span><span class="p">,</span> <span class="s1">&#39;opv2&#39;</span><span class="p">,</span> <span class="s1">&#39;opv3&#39;</span><span class="p">,</span> <span class="s1">&#39;opvIpv4&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">HSI_PneumoVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pneumo1&#39;</span><span class="p">,</span> <span class="s1">&#39;pneumo2&#39;</span><span class="p">,</span> <span class="s1">&#39;pneumo3&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">HSI_RotaVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rota1&#39;</span><span class="p">,</span> <span class="s1">&#39;rota2&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">HSI_DtpHibHepVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dtpHibHep1&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtpHibHep3&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">HSI_MeaslesRubellaVaccine</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MR1&#39;</span><span class="p">,</span> <span class="s1">&#39;MR2&#39;</span><span class="p">])</span>
        <span class="p">]</span>

        <span class="c1"># choose facility level where child will receive all their childhood vaccinations</span>
        <span class="c1"># Determine the level at which care is sought</span>
        <span class="n">facility_levels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1a&#39;</span><span class="p">,</span> <span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="n">facility_level_for_vaccines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">facility_levels</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_facility_level_for_vaccine&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">each_vax</span> <span class="ow">in</span> <span class="n">vax_schedule</span><span class="p">:</span>
            <span class="n">vax_hsi_event</span><span class="p">,</span> <span class="n">admin_schedule</span> <span class="o">=</span> <span class="n">each_vax</span>
            <span class="k">for</span> <span class="n">admin_key</span> <span class="ow">in</span> <span class="n">admin_schedule</span><span class="p">:</span>
                <span class="n">vax_event_instance</span> <span class="o">=</span> <span class="n">vax_hsi_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span>
                                                   <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level_for_vaccines</span><span class="p">)</span>
                <span class="n">scheduled_date</span> <span class="o">=</span> <span class="n">vax_date</span><span class="p">[</span><span class="n">admin_key</span><span class="p">]</span>
                <span class="c1"># Request the health system to have this vaccination appointment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">vax_event_instance</span><span class="p">,</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">scheduled_date</span><span class="p">),</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="Epi.report_daly_values">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.report_daly_values">[docs]</a>
    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; epi module returns dalys=0 for all persons alive &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;This is epi reporting my health values&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to population properties dataframe</span>

        <span class="n">health_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">health_values</span>  <span class="c1"># returns the series</span></div>


<div class="viewcode-block" id="Epi.increment_dose">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.increment_dose">[docs]</a>
    <span class="k">def</span> <span class="nf">increment_dose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">vaccine</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;va_</span><span class="si">{</span><span class="n">vaccine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;va_</span><span class="si">{</span><span class="n">vaccine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_doses</span><span class="p">[</span><span class="n">vaccine</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;va_</span><span class="si">{</span><span class="n">vaccine</span><span class="si">}</span><span class="s2">_all_doses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Epi.get_item_codes">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.Epi.get_item_codes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_item_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look-up the item-codes for each vaccine and update `self.cons_item_codes`&quot;&quot;&quot;</span>
        <span class="n">get_item_code_from_item_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;bcg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Syringe, autodisposable, BCG, 0.1 ml, with needle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;opv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Polio vaccine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;pentavalent_vaccine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span>
            <span class="s2">&quot;Pentavalent vaccine (DPT, Hep B, Hib)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;rota&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Rotavirus vaccine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;pneumo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Pneumococcal vaccine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;measles_and_rubella&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Measles vaccine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;hpv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;HPV vaccine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;td&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Tetanus toxoid, injection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;syringes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Syringe, Autodisable SoloShot IX &quot;</span><span class="p">),</span>
            <span class="n">get_item_code_from_item_name</span><span class="p">(</span><span class="s2">&quot;Safety box for used syringes/needles, 5 liter&quot;</span><span class="p">)]</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># Schedule vaccines outside EPI</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HpvScheduleEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent">[docs]</a>
<span class="k">class</span> <span class="nc">HpvScheduleEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; HPV vaccine event - each year sample from 9 year old girls and schedule vaccine</span>
<span class="sd">    stagger vaccine administration across the year</span>
<span class="sd">    coverage estimates dependent on health system capacity</span>
<span class="sd">    average around 85% for 2018</span>
<span class="sd">    WHO recommends 2 doses</span>
<span class="sd">    schedule doses 1 month apart</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HpvScheduleEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span></div>


<div class="viewcode-block" id="HpvScheduleEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HpvScheduleEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;HpvScheduleEvent selecting eligible 9-yr olds for HPV vaccine&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1">#  sample using the prob_inf scaled by relative susceptibility</span>
        <span class="n">hpv_vax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">)]</span>

        <span class="c1"># scatter vaccination days across the year</span>
        <span class="c1"># todo: HPV vaccine may be offered on scheduled clinic days / weeks - check</span>
        <span class="n">random_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">hpv_vax</span><span class="p">))</span>

        <span class="n">scheduled_vax_dates</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">random_day</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hpv_vax</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HpvScheduleEvent scheduling HPV vaccine for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># find the index in hpv_vax</span>
            <span class="c1"># then select that value from the scheduled_vax_date</span>
            <span class="n">vax_date</span> <span class="o">=</span> <span class="n">scheduled_vax_dates</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="n">facility_levels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1a&#39;</span><span class="p">,</span> <span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
            <span class="n">facility_level_for_vaccines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                <span class="n">facility_levels</span><span class="p">,</span>
                <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_facility_level_for_vaccine&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># first dose</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_HpvVaccine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                   <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level_for_vaccines</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">event</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="n">vax_date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># second dose</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">event</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">tclose</span><span class="o">=</span><span class="n">vax_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
            <span class="p">)</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># Health System Interaction Events</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="HsiBaseVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HsiBaseVaccine</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a base class for all vaccination HSI_Events. Handles initialisation and requesting consumables needed</span>
<span class="sd">    for the vaccination. For custom behaviour, you can override __init__ in subclasses and implemented your own</span>
<span class="sd">    constructors (or inherit directly from HSI_Event)</span>
<span class="sd">    unless specified, default facility level is 1a</span>
<span class="sd">    unless specified, footprint returned in 1 EPI appt</span>
<span class="sd">    if vaccine occurs as part of a treatment package within another appointment, use suppress_footprint=True</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HsiBaseVaccine.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="s2">&quot;1a&quot;</span><span class="p">,</span> <span class="n">suppress_footprint</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Epi</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">suppress_footprint</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppress_footprint</span> <span class="o">=</span> <span class="n">suppress_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span></div>


<div class="viewcode-block" id="HsiBaseVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;subclasses should implement this method to return the TREATMENT_ID&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="HsiBaseVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HsiBaseVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;must be implemented by subclasses&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">EXPECTED_APPT_FOOTPRINT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the EPI appointment footprint for this person according to the vaccine:</span>
<span class="sd">        * tetanus/diphtheria for pregnant women uses 1 EPI appt</span>
<span class="sd">        * childhood vaccines can occur in bundles at birth, weeks 6, 10 and 14</span>
<span class="sd">        * measles/rubella always given in one appt (`HSI_MeaslesRubellaVaccine`) in months 9, 15</span>
<span class="sd">        * hpv given for adolescents uses 1 EPI appt</span>
<span class="sd">        * if a vaccine is given at the same time as other vaccines, decrease the EPI footprint to 0.5</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_footprint</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>

        <span class="c1"># these vaccines are always given jointly with other childhood vaccines.</span>
        <span class="c1"># NB. If p[&quot;vaccine_schedule&quot;] changes, this would need to be updated.</span>
        <span class="n">vaccine_bundle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Epi_Childhood_Bcg&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi_Childhood_Opv&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi_Childhood_DtpHibHep&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi_Childhood_Rota&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Epi_Childhood_Pneumo&#39;</span><span class="p">]</span>

        <span class="c1"># determine whether this HSI gives a vaccine as part of a vaccine bundle</span>
        <span class="c1"># if vaccine is in list of vaccine bundles, return EPI footprint 0.5</span>
        <span class="c1"># all other vaccines use 1 full EPI appt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">vaccine_bundle</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s2">&quot;EPI&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s2">&quot;EPI&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>



<div class="viewcode-block" id="HSI_BcgVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_BcgVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;gives bcg vaccine 24 hours after birth or as soon as possible afterwards&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_BcgVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_Bcg&quot;</span></div>


<div class="viewcode-block" id="HSI_BcgVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_BcgVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_bcg&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_doses</span><span class="p">[</span><span class="s2">&quot;bcg&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;bcg&quot;</span><span class="p">],</span>
                                    <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;bcg&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_opv">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_opv</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;gives poliovirus vaccine 24 hours after birth, plus weeks 6, 10, 14 or as soon as possible afterwards&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_opv.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_Opv&quot;</span></div>


<div class="viewcode-block" id="HSI_opv.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_opv.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;opv&quot;</span><span class="p">],</span>
                                <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;opv&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_DtpHibHepVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_DtpHibHepVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; gives DTP-Hib_HepB vaccine &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_DtpHibHepVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_DtpHibHep&quot;</span></div>


<div class="viewcode-block" id="HSI_DtpHibHepVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_DtpHibHepVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;pentavalent_vaccine&#39;</span><span class="p">],</span>
                                <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;dtp&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;hib&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;hep&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_RotaVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_RotaVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; gives Rotavirus vaccine 6 and 10 weeks after birth &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RotaVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_Rota&quot;</span></div>


<div class="viewcode-block" id="HSI_RotaVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_RotaVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;HSI_RotaVaccine: requesting vaccines for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># rotavirus - oral vaccine</span>
        <span class="c1"># only 2 doses rotavirus given (week 6 and 10)</span>
        <span class="c1"># available from 2012 onwards</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_rota&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_doses</span><span class="p">[</span><span class="s2">&quot;rota&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;rota&quot;</span><span class="p">],</span>
                                    <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;rota&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_PneumoVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_PneumoVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; gives Pneumococcal vaccine 6, 10 and 14 weeks after birth &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_PneumoVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_Pneumo&quot;</span></div>


<div class="viewcode-block" id="HSI_PneumoVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_PneumoVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;pneumo&quot;</span><span class="p">],</span>
                                <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;pneumo&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_MeaslesRubellaVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; administers measles+rubella vaccine &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Childhood_MeaslesRubella&quot;</span></div>


<div class="viewcode-block" id="HSI_MeaslesRubellaVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_MeaslesRubellaVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># give vaccine if first dose or if second dose and after 2016</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_measles&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2016</span><span class="p">)):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;measles_and_rubella&quot;</span><span class="p">],</span>
                                    <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;measles&quot;</span><span class="p">)</span>

                <span class="c1"># rubella contained in vaccine from 2018</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2018</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;rubella&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_HpvVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_HpvVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; gives HPV vaccine to 9 year old girls; recommended 2 doses (WHO) &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_HpvVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Adolescent_Hpv&quot;</span></div>


<div class="viewcode-block" id="HSI_HpvVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_HpvVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;va_hpv&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_doses</span><span class="p">[</span><span class="s2">&quot;hpv&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;hpv&quot;</span><span class="p">],</span>
                                    <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;hpv&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_TdVaccine">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_TdVaccine</span><span class="p">(</span><span class="n">HsiBaseVaccine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; gives tetanus/diphtheria vaccine to pregnant women as part of routine antenatal care</span>
<span class="sd">    recommended 2+ doses (WHO)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_TdVaccine.treatment_id">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine.treatment_id">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Epi_Pregnancy_Td&quot;</span></div>


<div class="viewcode-block" id="HSI_TdVaccine.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.HSI_TdVaccine.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;td&quot;</span><span class="p">],</span>
                                <span class="n">optional_item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s2">&quot;syringes&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">increment_dose</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">)</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------</span>
<span class="c1"># LOGGING</span>
<span class="c1"># ---------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="EpiLoggingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">EpiLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<div class="viewcode-block" id="EpiLoggingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; output vaccine coverage every year &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Epi</span><span class="p">)</span></div>


<div class="viewcode-block" id="EpiLoggingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.epi.html#tlo.methods.epi.EpiLoggingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">def</span> <span class="nf">get_coverage</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">subset</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
            <span class="n">has_condition</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">condition</span> <span class="o">&amp;</span> <span class="n">subset</span><span class="p">)</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">has_condition</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">coverage</span> <span class="o">&lt;=</span> <span class="mi">100</span>
            <span class="k">return</span> <span class="n">coverage</span>

        <span class="n">under_ones</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bcg_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_bcg</span><span class="p">,</span> <span class="n">under_ones</span><span class="p">)</span>

        <span class="c1"># the eligible group for coverage estimates will be those from 14 weeks and older</span>
        <span class="c1"># younger infants won&#39;t have had the three-dose course yet</span>
        <span class="n">from_14_weeks_to_one</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mf">0.27</span><span class="p">)</span>
        <span class="n">dtp3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_dtp</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">opv3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_opv</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">hib3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hib</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">hep3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hep</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">pneumo3_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_pneumo</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>
        <span class="n">rota_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_rota</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">from_14_weeks_to_one</span><span class="p">)</span>

        <span class="c1"># measles vaccination coverage in &lt;2 year old children - 1 dose</span>
        <span class="c1"># first dose is at 9 months, second dose is 15 months</span>
        <span class="c1"># so check coverage in 15 month -2 year olds</span>
        <span class="n">from_15_months_to_two</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mf">1.25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">measles_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_measles</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from_15_months_to_two</span><span class="p">)</span>
        <span class="n">measles2_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_measles</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">from_15_months_to_two</span><span class="p">)</span>

        <span class="c1"># rubella vaccination coverage in &lt;2 year old children - 1 dose</span>
        <span class="c1"># first dose is at 9 months, second dose is 15 months</span>
        <span class="n">rubella_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_rubella</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from_15_months_to_two</span><span class="p">)</span>

        <span class="c1"># HPV vaccination coverage in adolescent girls - 1 dose</span>
        <span class="c1"># first dose is at 9 years</span>
        <span class="n">girls_from_ten_to_twelve</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">hpv_coverage</span> <span class="o">=</span> <span class="n">get_coverage</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">va_hpv</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">girls_from_ten_to_twelve</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ep_vaccine_coverage&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;epNumInfantsUnder1&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">from_14_weeks_to_one</span><span class="p">),</span>
                <span class="s2">&quot;epBcgCoverage&quot;</span><span class="p">:</span> <span class="n">bcg_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epDtp3Coverage&quot;</span><span class="p">:</span> <span class="n">dtp3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epOpv3Coverage&quot;</span><span class="p">:</span> <span class="n">opv3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHib3Coverage&quot;</span><span class="p">:</span> <span class="n">hib3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHep3Coverage&quot;</span><span class="p">:</span> <span class="n">hep3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epPneumo3Coverage&quot;</span><span class="p">:</span> <span class="n">pneumo3_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epRota2Coverage&quot;</span><span class="p">:</span> <span class="n">rota_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epMeaslesCoverage&quot;</span><span class="p">:</span> <span class="n">measles_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epMeasles2Coverage&quot;</span><span class="p">:</span> <span class="n">measles2_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epRubellaCoverage&quot;</span><span class="p">:</span> <span class="n">rubella_coverage</span><span class="p">,</span>
                <span class="s2">&quot;epHpvCoverage&quot;</span><span class="p">:</span> <span class="n">hpv_coverage</span>
            <span class="p">}</span>
        <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 07, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>