

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.diarrhoea &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.diarrhoea</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.diarrhoea</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Childhood Diarrhoea Module</span>

<span class="sd">Overview</span>
<span class="sd">=======</span>
<span class="sd">Individuals are exposed to the risk of onset of diarrhoea. They can have diarrhoea caused by one pathogen at a time.</span>
<span class="sd"> During an episode (prior to recovery- either natural or cured), the symptom of diarrhoea is present in addition to</span>
<span class="sd"> other possible symptoms. Diarrhoea may cause dehydration and this may progress to become &#39;severe&#39; during an episode.</span>
<span class="sd"> The individual may recovery naturally or die.</span>

<span class="sd">Health care seeking is prompted by the onset of the symptom diarrhoea. The individual can be treated; if successful the</span>
<span class="sd"> risk of death is removed and they are cured (symptom resolved) some days later.</span>

<span class="sd"> Outstanding Issues</span>
<span class="sd"> * To include rotavirus vaccine</span>
<span class="sd"> * See todo</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">random_date</span><span class="p">,</span> <span class="n">sample_outcome</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   MODULE DEFINITIONS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Diarrhoea"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea">[docs]</a><span class="k">class</span> <span class="nc">Diarrhoea</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># Declare the pathogens that this module will simulate:</span>
    <span class="n">pathogens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;rotavirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shigella&#39;</span><span class="p">,</span>
        <span class="s1">&#39;adenovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cryptosporidium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;campylobacter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ETEC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sapovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;norovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;astrovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tEPEC&#39;</span>
    <span class="p">]</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Demography&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Hiv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SymptomManager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Wasting&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Alri&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi&#39;</span><span class="p">,</span> <span class="s1">&#39;Stunting&#39;</span><span class="p">}</span>

    <span class="n">OPTIONAL_INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">}</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_SYMPTOMMANAGER</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">f</span><span class="s1">&#39;Diarrhoea_</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Diarrheal diseases&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Childhood Diarrhoea&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathogens</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death and Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Diarrhoea&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Diarrheal diseases&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Childhood Diarrhoea&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathogens</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Parameters governing the incidence of infection with a pathogen that causes diarrhoea</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year)&#39;</span>
                      <span class="s1">&#39; of diarrhoea caused by rotavirus in age groups 0-11, 12-23, 24-59 months &#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by shigella spp in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by adenovirus 40/41 in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by cryptosporidium in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by campylobacter spp in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by ETEC in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by sapovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by norovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by astrovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by tEPEC in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_HHhandwashing&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea with household handwashing with soap&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_improved_sanitation&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for improved sanitation&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_clean_water&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for access to clean drinking water&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_exclusive_vs_partial_breastfeeding_&lt;6mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for partial breastfeeding in &lt;6 months old, &#39;</span>
                                  <span class="s1">&#39;compared to exclusive breastfeeding&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_exclusive_vs_no_breastfeeding_&lt;6mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for no breastfeeding in &lt;6 months old, &#39;</span>
                                  <span class="s1">&#39;compared to exclusive breastfeeding&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_any_vs_no_breastfeeding_6_11mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for no breastfeeding in 6 months old to 1 years old, &#39;</span>
                                  <span class="s1">&#39;compared to any breastfeeding at this age group&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_untreated_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for HIV positive status&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for severe malnutrition&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the type of diarrhoea (Watery [AWD: Acute Watery Diarrhoea ]or bloody)</span>
        <span class="s1">&#39;proportion_AWD_in_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in rotavirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in shigella-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in adenovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in cryptosporidium-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in campylobacter-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in ETEC-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in sapovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in norovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused in astrovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_in_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type in tEPEC-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the extent of dehydration</span>
        <span class="s1">&#39;prob_dehydration_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dehydration_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of any dehydration caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;probability_of_severe_dehydration_if_some_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that someone with diarrhoea and some dehydration develops severe &#39;</span>
                                  <span class="s1">&#39;dehydration&#39;</span><span class="p">),</span>

        <span class="c1"># Parameters governing the duration of the episode</span>
        <span class="s1">&#39;prob_prolonged_diarr_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode in rotavirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by shigella-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by adenovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by cryptosporidium-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by campylobacter-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by ETEC-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by sapovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by norovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by norovirus-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_diarr_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged episode by tEPEC-attributed diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_to_persistent_diarr&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged diarrhoea becoming persistent diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_age&gt;6mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for children over 6 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for HIV positive&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for severely acute malnutrition&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_stunted&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for stunted children&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;min_dur_acute&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                      <span class="s1">&#39;The minimum duration (in days) for an episode that is classified as an acute episode&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;min_dur_prolonged&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                      <span class="s1">&#39;The minimum duration (in days) for an episode that is classified as a prolonged episode&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;min_dur_persistent&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                      <span class="s1">&#39;The minimum duration (in days) for an episode that is classified as a persistent episode&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;max_dur_persistent&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                      <span class="s1">&#39;The maximum duration (in days) for an episode that is classified as a persistent episode&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the occurence of other symptoms during the episode (fever, vomiting)</span>
        <span class="s1">&#39;prob_fever_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_fever_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of fever caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_vomiting_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of vomiting caused by tEPEC&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the risk of death due to Diarrhoea</span>
        <span class="s1">&#39;adjustment_factor_on_cfr&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;Factor by which fatality probabilities are multiplied (to be used in calibration)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for acute watery diarrhoea cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_bloody&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death (compared to `case_fatality_rate_AWD` if the &#39;</span>
                                  <span class="s1">&#39;diarrhoea is of type &quot;bloody&quot; (i.e. dyssentry).&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of diarrhoea death for ages 24 to 59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of diarrhoea death if the duration episode is 13 days or longer&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_severe_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for cases with severe dehyadration&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_untreated_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for untreated HIV&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for severe acute malnutrition&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death if concurrent lower respiratory infection&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death if caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death if caused by shigella&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the care provided to those that present with Diarrhoea</span>
        <span class="s1">&#39;sensitivity_severe_dehydration_visual_inspection&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;sensitivity of IMCI severe dehydration algorithm for dehydration &gt;9</span><span class="si">% lo</span><span class="s1">ss of body weight&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;specificity_severe_dehydration_visual_inspection&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;specificity of IMCI severe dehydration algorithm for dehydration &gt;9</span><span class="si">% lo</span><span class="s1">ss of body weight&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_hospitalization_on_danger_signs&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of hospitalisation when danger signs are detected in an initial consultation&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the efficacy of treatments</span>
        <span class="s1">&#39;prob_WHOPlanC_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability that severe dehydration is cured by Treatment Plan C&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_ORS_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability that severe dehydration is cured by ORS&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_ORS_cures_dehydration_if_non_severe_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability that non-severe dehydration is cured by ORS&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antibiotic_cures_dysentery&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability that blood-in-stool is removed by the use of antibiotics&#39;</span><span class="p">),</span>
        <span class="s1">&#39;number_of_days_reduced_duration_with_zinc&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;number of days reduced duration with zinc&#39;</span><span class="p">),</span>
        <span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;number of days between any treatment being given in an HSI and the cure occurring.&#39;</span><span class="p">),</span>

        <span class="c1"># Parameters describing efficacy of the monovalent rotavirus vaccine (R1)</span>
        <span class="s1">&#39;rr_severe_dehydration_due_to_rotavirus_with_R1_under1yo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of severe dehydration with rotavirus vaccine, for under 1 years old.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_severe_dehydration_due_to_rotavirus_with_R1_over1yo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of severe dehydration with rotavirus vaccine, for those aged 1 year and older.&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># ---- Core Properties of Actual Status and Intrinsic Properties of A Current Episode  ----</span>
        <span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                                     <span class="s1">&#39;Whether or not the person currently has an episode of diarrhoea.&#39;</span>
                                     <span class="p">),</span>
        <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                <span class="s1">&#39;The attributable pathogen for the current episode of diarrhoea &#39;</span>
                                <span class="s1">&#39;(np.nan if the person does not currently have diarrhoea).&#39;</span><span class="p">,</span>
                                <span class="n">categories</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">pathogens</span><span class="p">)),</span>
        <span class="s1">&#39;gi_type&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                            <span class="s1">&#39;Type (watery or blood) of the current episode of diarrhoea &#39;</span>
                            <span class="s1">&#39;(np.nan if the person does not currently have diarrhoea).&#39;</span><span class="p">,</span>
                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;watery&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;bloody&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                   <span class="s1">&#39;Severity of dehydration for the current episode of diarrhoea &#39;</span>
                                   <span class="s1">&#39;(np.nan if the person does not currently have diarrhoea).&#39;</span><span class="p">,</span>
                                   <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;some&#39;</span><span class="p">,</span>  <span class="c1"># &lt;-- this level is not used currently.</span>
                                               <span class="s1">&#39;severe&#39;</span>
                                               <span class="p">]),</span>
        <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                                                   <span class="s1">&#39;Whether the duration of the current episode would last longer than &#39;</span>
                                                   <span class="s1">&#39;13 days if untreated. (False if does not have current episode)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
                                          <span class="s2">&quot;Number of episodes of diarrhoea caused by a pathogen&quot;</span><span class="p">),</span>

        <span class="c1"># ---- Internal variables storing dates of scheduled events  ----</span>
        <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Date of onset of current episode of diarrhoea (pd.NaT if does not &#39;</span>
                                                 <span class="s1">&#39;have current episode of diarrhoea).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                               <span class="s1">&#39;Scheduled date of recovery from current episode of diarrhoea &#39;</span>
                                               <span class="s1">&#39;(pd.NaT if does not have current episode or current episode &#39;</span>
                                               <span class="s1">&#39;is scheduled to result in death). This is scheduled when the &#39;</span>
                                               <span class="s1">&#39;episode is onset and may be revised subsequently if the episode &#39;</span>
                                               <span class="s1">&#39;is cured by a treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Scheduled date of death caused by current episode of diarrhoea&#39;</span>
                                                        <span class="s1">&#39; (pd.NaT if does not have current episode or if current &#39;</span>
                                                        <span class="s1">&#39;episode will not result in death). This is scheduled when the &#39;</span>
                                                        <span class="s1">&#39;episode is onset and may be revised subsequently if the &#39;</span>
                                                        <span class="s1">&#39;episode is cured by a treatment.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_date_end_of_last_episode&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                                <span class="s1">&#39;The date on which the last episode of diarrhoea is fully resolved, &#39;</span>
                                                <span class="s1">&#39;including allowing for the possibility of HSI events (pd.NaT if has &#39;</span>
                                                <span class="s1">&#39;never had an episode). This is used to determine when a new episode &#39;</span>
                                                <span class="s1">&#39;can begin and stops successive episodes interfering with one another.&#39;</span>
                                                <span class="s1">&#39;This is notnull when the person has ever had an episode of diarrhoea.&#39;</span>
                                                <span class="p">),</span>
        <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                      <span class="s1">&#39;The actual date on which treatment is first administered for the current episode&#39;</span>
                                      <span class="s1">&#39; (pd.NaT if does not have current episode or if no treatment has yet been &#39;</span>
                                      <span class="s1">&#39;provided in the current episode).&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Diarrhoea.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unreported_dalys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_checks</span> <span class="o">=</span> <span class="n">do_checks</span></div>

<div class="viewcode-block" id="Diarrhoea.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup parameters values used by the module&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Read parameters from the resourcefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_Diarrhoea.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Parameter_values&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Check that every value has been read-in successfully</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">p</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">param_name</span><span class="p">],</span>
                              <span class="n">param_type</span><span class="o">.</span><span class="n">python_type</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the &#39;</span> \
                                                       <span class="sa">f</span><span class="s1">&#39;resourcefile.&#39;</span></div>

<div class="viewcode-block" id="Diarrhoea.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets that there is no one with diarrhoea at initiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># a shortcut to the data-frame storing data for individuals</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_date_end_of_last_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Diarrhoea.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepares for simulation:</span>
<span class="sd">        * Schedules the main polling event</span>
<span class="sd">        * Schedules the main logging event</span>
<span class="sd">        * Schedule the check properties event (if needed)</span>
<span class="sd">        * Establishes the linear models and other data structures using the parameters that have been read-in</span>
<span class="sd">        * Store the consumables that are required in each of the HSI</span>
<span class="sd">        * Register test for the determination of &#39;danger signs&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Schedule the main polling event (to first occur immediately)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaPollingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_checks</span><span class="p">:</span>
            <span class="c1"># Schedule the event that does checking every day (with time-offset to ensure it&#39;s the last event done):</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaCheckPropertiesEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                               <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">59</span><span class="p">))</span>

        <span class="c1"># Create and store the models needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Get DALY weights</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">get_daly_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;dehydration=none&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;dehydration=some&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;dehydration=severe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">34</span><span class="p">)</span>

        <span class="c1"># Look-up and store the consumables that are required for each HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">look_up_consumables</span><span class="p">()</span>

        <span class="c1"># Define test to determine danger signs</span>
        <span class="c1"># The danger signs are classified collectively and are based on the result of a DxTest representing the ability</span>
        <span class="c1"># of the clinician to correctly determine the true value of the property &#39;gi_dehydration&#39; being &#39;severe&#39;.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>
            <span class="n">imci_severe_dehydration_visual_inspection</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;gi_dehydration&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_severe_dehydration_visual_inspection&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;specificity_severe_dehydration_visual_inspection&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Diarrhoea.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On birth, all children will have no diarrhoea</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_date_end_of_last_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Diarrhoea.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called whenever there is an HSI event commissioned by one of the other disease modules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Diarrhoea.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This returns person-time live with disability values to the HealthBurden module.</span>
<span class="sd">        At the end of each episode, a record is made in a list, `self.unreported_dalys`, of the form</span>
<span class="sd">        (person_id, duration_in_days_of_episode * average_daly_weight). This record is used to create the pd.Series</span>
<span class="sd">        that is returned (index: person_id for all those alive, value: the average disability weight during the</span>
<span class="sd">        preceding month). The list is then cleared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unreported_dalys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Count number of days last month (knowing that this function is called on the first day of the month).</span>
        <span class="n">days_last_month</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">days</span>

        <span class="c1"># Get the person_id and the values from the list, and clear the list.</span>
        <span class="n">idx</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">unreported_dalys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unreported_dalys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># &lt;-- clear list</span>

        <span class="n">average_daly_weight_in_last_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">/</span> <span class="n">days_last_month</span>
        <span class="k">return</span> <span class="n">average_daly_weight_in_last_month</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Diarrhoea.look_up_consumables"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.look_up_consumables">[docs]</a>    <span class="k">def</span> <span class="nf">look_up_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up and store the consumables item codes used in each of the HSI.&quot;&quot;&quot;</span>
        <span class="n">get_item_codes_from_package_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_codes_from_package_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;ORS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes_from_package_name</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;ORS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Treatment_Severe_Dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes_from_package_name</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;Treatment of severe diarrhea&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Zinc_Under6mo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes_from_package_name</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;Zinc for Children 0-6 months&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Zinc_Over6mo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes_from_package_name</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;Zinc for Children 6-59 months&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Antibiotics_for_Dysentery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes_from_package_name</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;Antibiotics for treatment of dysentery&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Diarrhoea.do_when_presentation_with_diarrhoea"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.do_when_presentation_with_diarrhoea">[docs]</a>    <span class="k">def</span> <span class="nf">do_when_presentation_with_diarrhoea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This routine is called when Diarrhoea is a symptom for a child attending a Generic HSI Appointment. It</span>
<span class="sd">        checks for danger signs and schedules HSI Events appropriately.&quot;&quot;&quot;</span>

        <span class="c1"># 1) Assessment of danger signs</span>
        <span class="n">danger_signs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
            <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s2">&quot;imci_severe_dehydration_visual_inspection&quot;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="c1"># 2) Determine which HSI to use:</span>
        <span class="k">if</span> <span class="n">danger_signs</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_hospitalization_on_danger_signs&#39;</span><span class="p">]):</span>
            <span class="c1"># Danger signs and hospitalized --&gt; In-patient</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">HSI_Diarrhoea_Treatment_Inpatient</span><span class="p">(</span>
                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No danger signs or otherwise not hospitalized --&gt; Out-patient</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">HSI_Diarrhoea_Treatment_Outpatient</span><span class="p">(</span>
                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Diarrhoea.do_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.do_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">do_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method called by the HSI that enacts decisions about a treatment and its effect for diarrhoea caused by a</span>
<span class="sd">        pathogen. (It will do nothing if the diarrhoea is caused by another module.)</span>
<span class="sd">        Actions:</span>
<span class="sd">        * If the episode will cause death: if the treatment is successful, prevents this episode of diarrhoea from</span>
<span class="sd">         causing a death and schedules Cure Event</span>
<span class="sd">        * If the episode will not cause death: if treatment is succesful, schedules a CureEvent that will occur earlier</span>
<span class="sd">         than the `NaturalRecovery` event.</span>
<span class="sd">        * Records that treatment is provided.</span>

<span class="sd">        NB. Provisions for cholera are not included</span>
<span class="sd">        See this report:</span>
<span class="sd">          https://apps.who.int/iris/bitstream/handle/10665/104772/9789241506823_Chartbook_eng.pdf (page 3).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the diarrhoea has not been caused by a pathogen</span>
        <span class="k">if</span> <span class="s1">&#39;Diarrhoea&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">causes_of</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;diarrhoea&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the episode is not on-going</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Check the child&#39;s condition</span>
        <span class="n">type_of_diarrhoea_is_bloody</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_type</span> <span class="o">==</span> <span class="s1">&#39;bloody&#39;</span>
        <span class="n">dehydration_is_severe</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_dehydration</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span>
        <span class="c1"># days_elapsed_with_diarrhoea = (self.sim.date - person.gi_date_of_onset).days</span>
        <span class="n">will_die</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_death</span><span class="p">)</span>
        <span class="n">is_in_patient</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hsi_event</span><span class="p">,</span> <span class="n">HSI_Diarrhoea_Treatment_Inpatient</span><span class="p">)</span>

        <span class="c1"># ** Implement the procedure for treatment **</span>
        <span class="c1"># STEP ZERO: Get the Zinc consumable (happens irrespective of whether child will die or not)</span>
        <span class="n">gets_zinc</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span>
                <span class="s1">&#39;Zinc_Under6mo&#39;</span> <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s1">&#39;Zinc_Over6mo&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># STEP ONE: Aim to alleviate dehydration:</span>
        <span class="n">prob_remove_dehydration</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">is_in_patient</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Treatment_Severe_Dehydration&#39;</span><span class="p">]):</span>
                <span class="c1"># In-patient receiving IV fluids (WHO Plan C)</span>
                <span class="n">prob_remove_dehydration</span> <span class="o">=</span> \
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_WHOPlanC_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">dehydration_is_severe</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_ORS_cures_dehydration_if_non_severe_dehydration&#39;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;ORS&#39;</span><span class="p">]):</span>
                <span class="c1"># Out-patient receving ORS</span>
                <span class="n">prob_remove_dehydration</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_ORS_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">dehydration_is_severe</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_ORS_cures_dehydration_if_non_severe_dehydration&#39;</span><span class="p">]</span>

        <span class="c1"># Determine dehydration after treatment</span>
        <span class="n">dehydration_after_treatment</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_remove_dehydration</span> <span class="k">else</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_dehydration</span>

        <span class="c1"># STEP TWO: If has bloody diarrhoea (i.e., dysentry), then aim to clear bacterial infection</span>
        <span class="k">if</span> <span class="n">type_of_diarrhoea_is_bloody</span> <span class="ow">and</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;Antibiotics_for_Dysentery&#39;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">prob_clear_bacterial_infection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_antibiotic_cures_dysentery&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prob_clear_bacterial_infection</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Determine type after treatment</span>
        <span class="n">type_after_treatment</span> <span class="o">=</span> <span class="s1">&#39;watery&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_clear_bacterial_infection</span> <span class="k">else</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_type</span>

        <span class="c1"># Determine if the changes in dehydration or type (if any) will cause the treatment to block the death:</span>
        <span class="k">if</span> <span class="n">will_die</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">does_treatment_prevent_death</span><span class="p">(</span>
                <span class="n">pathogen</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">gi_pathogen</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_type</span><span class="p">,</span> <span class="n">type_after_treatment</span><span class="p">),</span>  <span class="c1"># &lt;-- type may have changed</span>
                <span class="n">duration_longer_than_13days</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">gi_duration_longer_than_13days</span><span class="p">,</span>
                <span class="n">dehydration</span><span class="o">=</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_dehydration</span><span class="p">,</span> <span class="n">dehydration_after_treatment</span><span class="p">),</span>  <span class="c1"># &lt;-- dehydration may have changed</span>
                <span class="n">age_exact_years</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_exact_years</span><span class="p">,</span>
                <span class="n">ri_current_infection_status</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">ri_current_infection_status</span><span class="p">,</span>
                <span class="n">untreated_hiv</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">hv_inf</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">hv_art</span> <span class="o">!=</span> <span class="s2">&quot;on_VL_suppressed&quot;</span><span class="p">),</span>
                <span class="n">un_clinical_acute_malnutrition</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">un_clinical_acute_malnutrition</span>
            <span class="p">):</span>
                <span class="c1"># Treatment is successful: cancel death and schedule cure event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cancel_death_date</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                    <span class="n">DiarrhoeaCureEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span>
                        <span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span>
                            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;number_of_days_reduced_duration_with_zinc&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">gets_zinc</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The child would not die without treatment, but treatment can lead to an earlier end to the episode if they</span>
            <span class="c1"># get zinc.</span>
            <span class="k">if</span> <span class="n">gets_zinc</span><span class="p">:</span>
                <span class="c1"># Schedule the Cure Event to happen earlier that the scheduled recovery event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                    <span class="n">DiarrhoeaCureEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                    <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_recovery</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span>
                            <span class="n">days</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;number_of_days_reduced_duration_with_zinc&#39;</span><span class="p">])</span>
                        <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># -------------------------------------</span>
        <span class="c1"># Log that the treatment is provided:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div>

<div class="viewcode-block" id="Diarrhoea.cancel_death_date"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.cancel_death_date">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_death_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels a scheduled date of death due to diarrhoea for a person. This is called prior to the scheduling the</span>
<span class="sd">        CureEvent to prevent deaths happening in the time between a treatment being given and the cure event occurring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Diarrhoea.end_episode"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.end_episode">[docs]</a>    <span class="k">def</span> <span class="nf">end_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that enacts the end of the episode of diarrhoea (either by natural recovery, death or  cure)</span>
<span class="sd">        * Logs that the episode has ended</span>
<span class="sd">        * Stores the total time-lived-with-disability during the episode</span>
<span class="sd">        * Enacts the death (if the outcome==&#39;death&#39;); Otherwise, removes symptoms and resets properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;recovery&#39;</span><span class="p">,</span> <span class="s1">&#39;cure&#39;</span><span class="p">,</span> <span class="s1">&#39;death&#39;</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Log that the episode has ended</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;end_of_case&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                <span class="s1">&#39;date_of_onset&#39;</span><span class="p">:</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span><span class="p">,</span>
                <span class="s1">&#39;outcome&#39;</span><span class="p">:</span> <span class="n">outcome</span>
            <span class="p">},</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;information when a case is ended by recovery, cure or death.&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Store the totals of days * daly_weight incurred during the episode</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">days_duration</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="n">daly_wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dehydration=</span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">gi_dehydration</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unreported_dalys</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">person_id</span><span class="p">,</span> <span class="n">daly_wt</span> <span class="o">*</span> <span class="n">days_duration</span><span class="p">))</span>

        <span class="c1"># Enacts the death (if the outcome is &#39;death&#39;); Otherwise, removes symptoms and resets properties</span>
        <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="s1">&#39;death&#39;</span><span class="p">:</span>
            <span class="c1"># If outcome is death, implement the death immidiately:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span>
                <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;Diarrhoea_&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">],</span>
                <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If outcome is not death, then remove all symptoms and reset properties:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear_symptoms</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                              <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_type&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="p">)</span></div>
            <span class="c1"># NB. `gi_date_end_of_last_episode` is not reset at the end of the episode.</span>

<div class="viewcode-block" id="Diarrhoea.check_properties"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.check_properties">[docs]</a>    <span class="k">def</span> <span class="nf">check_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that the properties are ok: for use in testing only&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Those that do not currently have diarrhoea, should have not_applicable/null values for all the other</span>
        <span class="c1"># properties:</span>
        <span class="n">not_in_current_episode</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span>
        <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_in_current_episode</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">]</span>
                         <span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_in_current_episode</span><span class="p">,</span> <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_in_current_episode</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">]</span>
                         <span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># Those that do currently have diarrhoea, should have a pathogen</span>
        <span class="n">in_current_episode</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_current_episode</span><span class="p">,</span> <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># Those that do currently have diarrhoea, should have a non-zero value for the total number of episodes</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_current_episode</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># Those that currently have diarrhoea and have not had a treatment, should have either a recovery date or</span>
        <span class="c1"># a death_date (but not both)</span>
        <span class="n">has_recovery_date</span> <span class="o">=</span> <span class="o">~</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_current_episode</span> <span class="o">&amp;</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_treatment_date</span><span class="p">),</span>
                                              <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">])</span>
        <span class="n">has_death_date</span> <span class="o">=</span> <span class="o">~</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_current_episode</span> <span class="o">&amp;</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_treatment_date</span><span class="p">),</span>
                                           <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">])</span>
        <span class="n">has_recovery_date_or_death_date</span> <span class="o">=</span> <span class="n">has_recovery_date</span> <span class="o">|</span> <span class="n">has_death_date</span>
        <span class="n">has_both_recovery_date_and_death_date</span> <span class="o">=</span> <span class="n">has_recovery_date</span> <span class="o">&amp;</span> <span class="n">has_death_date</span>
        <span class="k">assert</span> <span class="n">has_recovery_date_or_death_date</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">has_both_recovery_date_and_death_date</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># Those for whom the death date has past should be dead</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># Check that those in a current episode have symptoms of diarrhoea [caused by the diarrhoea module]</span>
        <span class="c1">#  but not others (among those who are alive)</span>
        <span class="n">has_symptoms_of_diar</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;diarrhoea&#39;</span><span class="p">))</span>
        <span class="n">has_symptoms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">has_symptoms_of_diar</span>
            <span class="k">if</span> <span class="s1">&#39;Diarrhoea&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">causes_of</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;diarrhoea&#39;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">in_current_episode_before_recovery</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">gi_scheduled_date_recovery</span><span class="p">)</span>
        <span class="n">set_of_person_id_in_current_episode_before_recovery</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">in_current_episode_before_recovery</span><span class="p">[</span><span class="n">in_current_episode_before_recovery</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>

        <span class="n">in_current_episode_before_death</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">gi_scheduled_date_death</span><span class="p">)</span>
        <span class="n">set_of_person_id_in_current_episode_before_death</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">in_current_episode_before_death</span><span class="p">[</span><span class="n">in_current_episode_before_death</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>

        <span class="n">in_current_episode_before_cure</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_treatment_date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_scheduled_date_recovery</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_scheduled_date_death</span><span class="p">)</span>
        <span class="n">set_of_person_id_in_current_episode_before_cure</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">in_current_episode_before_cure</span><span class="p">[</span><span class="n">in_current_episode_before_cure</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">set</span><span class="p">()</span> <span class="o">==</span> <span class="n">set_of_person_id_in_current_episode_before_recovery</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="n">set_of_person_id_in_current_episode_before_death</span>
        <span class="p">)</span>

        <span class="n">set_of_person_id_in_current_episode</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="n">set_of_person_id_in_current_episode_before_recovery</span><span class="p">,</span>
            <span class="n">set_of_person_id_in_current_episode_before_death</span><span class="p">,</span>
            <span class="n">set_of_person_id_in_current_episode_before_cure</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">set_of_person_id_in_current_episode</span> <span class="o">==</span> <span class="n">has_symptoms</span></div></div>


<span class="k">class</span> <span class="nc">Models</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper-class to store all the models that specify the natural history of the Alri disease&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rng</span>

        <span class="c1"># Write model for incidence of each pathogen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_model_for_incidence_by_pathogen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_linear_model_for_incidence_of_pathogens</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_linear_model_for_incidence_of_pathogens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a dict to hold the equations that govern the probability that a person acquires diarrhoea that is</span>
<span class="sd">        caused (primarily) by a pathogen&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">make_scaled_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Makes the unscaled linear model with default intercept of 1. Calculates the mean incidents rate for</span>
<span class="sd">            0-year-olds and then creates a new linear model with adjusted intercept so incidents in 0-year-olds</span>
<span class="sd">            matches the specified value in the model when averaged across the population</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">base_inc_rate</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">return</span> <span class="n">LinearModel</span><span class="p">(</span>
                    <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                    <span class="n">intercept</span><span class="p">,</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;age_years&#39;</span><span class="p">,</span>
                              <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="p">)</span> <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(2, 4)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                                <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt; 4&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_no_access_handwashing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_HHhandwashing&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_no_clean_drinking_water&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_clean_water&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_unimproved_sanitation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_improved_sanitation&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(hv_inf == True) &amp; (hv_art == &quot;not&quot;)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_untreated_HIV&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;SAM&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_breastfeeding_status == &quot;none&quot;) &amp; (age_exact_years &lt; 0.5)&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_exclusive_vs_no_breastfeeding_&lt;6mo&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_breastfeeding_status == &quot;non_exclusive&quot;) &amp; (age_exact_years &lt; 0.5)&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_exclusive_vs_partial_breastfeeding_&lt;6mo&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_breastfeeding_status == &quot;none&quot;) &amp; (0.5 &lt; age_exact_years &lt; 1)&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_any_vs_no_breastfeeding_6_11mo&#39;</span><span class="p">]),</span>

                <span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
            <span class="n">unscaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">)</span>
            <span class="n">target_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">actual_mean</span> <span class="o">=</span> <span class="n">unscaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">scaled_intercept</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">/</span> <span class="n">actual_mean</span><span class="p">)</span> \
                <span class="k">if</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">actual_mean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">actual_mean</span><span class="p">))</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="n">scaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="n">scaled_intercept</span><span class="p">)</span>
            <span class="c1"># check by applying the model to mean incidence of 0-year-olds</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">-</span> <span class="n">scaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>
            <span class="k">return</span> <span class="n">scaled_lm</span>

        <span class="n">_incidence_equations_by_pathogen</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
            <span class="n">_incidence_equations_by_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_scaled_linear_model</span><span class="p">(</span><span class="n">pathogen</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_incidence_equations_by_pathogen</span>

    <span class="k">def</span> <span class="nf">get_prob_persisent_if_prolonged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">age_exact_years</span><span class="p">,</span>
                                        <span class="n">un_HAZ_category</span><span class="p">,</span>
                                        <span class="n">un_clinical_acute_malnutrition</span><span class="p">,</span>
                                        <span class="n">untreated_hiv</span><span class="p">,</span>
                                        <span class="p">):</span>
        <span class="c1"># Baseline prob:</span>
        <span class="n">prob_persistent_if_prolonged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_prolonged_to_persistent_diarr&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">age_exact_years</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">prob_persistent_if_prolonged</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_bec_persistent_age&gt;6mo&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">un_HAZ_category</span> <span class="o">==</span> <span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">:</span>
            <span class="n">prob_persistent_if_prolonged</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_bec_persistent_stunted&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">un_clinical_acute_malnutrition</span> <span class="o">==</span> <span class="s1">&#39;SAM&#39;</span><span class="p">:</span>
            <span class="n">prob_persistent_if_prolonged</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_bec_persistent_SAM&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">untreated_hiv</span><span class="p">:</span>
            <span class="n">prob_persistent_if_prolonged</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_bec_persistent_HIV&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">prob_persistent_if_prolonged</span>

    <span class="k">def</span> <span class="nf">get_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">pathogen</span><span class="p">,</span>
                     <span class="n">age_exact_years</span><span class="p">,</span>
                     <span class="n">un_HAZ_category</span><span class="p">,</span>
                     <span class="n">un_clinical_acute_malnutrition</span><span class="p">,</span>
                     <span class="n">untreated_hiv</span><span class="p">,</span>
                     <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For new incident case of diarrhoea, determine its duration.</span>
<span class="sd">        1) Determine if this will be acute or prolonged; and if prolonged, will it be persistent.</span>
<span class="sd">        2) Randomly select a duration from with a range defined for each classification.&quot;&quot;&quot;</span>

        <span class="c1"># Get probability of this episode being &quot;prolonged&quot;</span>
        <span class="n">prob_prolonged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;prob_prolonged_diarr_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Get probability of this episode being &quot;persistent&quot; if it is &quot;prolonged&quot;</span>
        <span class="n">prob_persistent_if_prolonged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prob_persisent_if_prolonged</span><span class="p">(</span>
            <span class="n">age_exact_years</span><span class="o">=</span><span class="n">age_exact_years</span><span class="p">,</span>
            <span class="n">un_HAZ_category</span><span class="o">=</span><span class="n">un_HAZ_category</span><span class="p">,</span>
            <span class="n">un_clinical_acute_malnutrition</span><span class="o">=</span><span class="n">un_clinical_acute_malnutrition</span><span class="p">,</span>
            <span class="n">untreated_hiv</span><span class="o">=</span><span class="n">untreated_hiv</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_prolonged</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_persistent_if_prolonged</span><span class="p">:</span>
                <span class="c1"># &quot;Persistent&quot; diarrhoea</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_dur_persistent&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;max_dur_persistent&#39;</span><span class="p">])</span>
            <span class="c1"># &quot;Prolonged&quot; but not &quot;persistent&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_dur_prolonged&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_dur_persistent&#39;</span><span class="p">])</span>
        <span class="c1"># If not prolonged, the episode is acute: duration of 4 days</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_dur_acute&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_dur_prolonged&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For new incident case of diarrhoea, determine the type - &#39;watery&#39; or &#39;bloody&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;watery&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proportion_AWD_in_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bloody&#39;</span>

    <span class="k">def</span> <span class="nf">get_dehydration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">,</span> <span class="n">va_rota_all_doses</span><span class="p">,</span> <span class="n">age_years</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For new incident case of diarrhoea, determine the degree of dehydration - &#39;none&#39;, &#39;some&#39; or &#39;severe&#39;.</span>
<span class="sd">        The effect of the R1 vaccine is to reduce the probability of severe dehydration.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pathogen</span> <span class="o">==</span> <span class="s2">&quot;rotavirus&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">va_rota_all_doses</span><span class="p">:</span>
            <span class="n">relative_prob_severe_dehydration_due_to_vaccine</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_severe_dehydration_due_to_rotavirus_with_R1_under1yo&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">1</span> \
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_severe_dehydration_due_to_rotavirus_with_R1_over1yo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relative_prob_severe_dehydration_due_to_vaccine</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_dehydration_by_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;probability_of_severe_dehydration_if_some_dehydration&#39;</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">relative_prob_severe_dehydration_due_to_vaccine</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;severe&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;some&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;none&#39;</span>

    <span class="k">def</span> <span class="nf">prob_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">pathogen</span><span class="p">,</span>
                   <span class="nb">type</span><span class="p">,</span>
                   <span class="n">duration_longer_than_13days</span><span class="p">,</span>
                   <span class="n">dehydration</span><span class="p">,</span>
                   <span class="n">age_exact_years</span><span class="p">,</span>
                   <span class="n">ri_current_infection_status</span><span class="p">,</span>
                   <span class="n">untreated_hiv</span><span class="p">,</span>
                   <span class="n">un_clinical_acute_malnutrition</span>
                   <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute probability will die given a set of conditions&quot;&quot;&quot;</span>

        <span class="c1"># Baseline risks for diarrhoea of type &#39;watery&#39;, including &#39;adjustment factor&#39;</span>
        <span class="n">risk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;adjustment_factor_on_cfr&#39;</span><span class="p">]</span>

        <span class="c1"># Factors that adjust risk up or down:</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;bloody&#39;</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_bloody&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">pathogen</span> <span class="o">==</span> <span class="s1">&#39;cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_cryptosporidium&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pathogen</span> <span class="o">==</span> <span class="s1">&#39;shigella&#39;</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_shigella&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">duration_longer_than_13days</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">dehydration</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_severe_dehydration&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">&lt;=</span> <span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">):</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="n">ri_current_infection_status</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_alri&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">untreated_hiv</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_untreated_HIV&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">un_clinical_acute_malnutrition</span> <span class="o">==</span> <span class="s1">&#39;SAM&#39;</span><span class="p">:</span>
            <span class="n">risk</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_SAM&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">risk</span>

    <span class="k">def</span> <span class="nf">will_die</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">pathogen</span><span class="p">,</span>
                 <span class="nb">type</span><span class="p">,</span>
                 <span class="n">duration_longer_than_13days</span><span class="p">,</span>
                 <span class="n">dehydration</span><span class="p">,</span>
                 <span class="n">age_exact_years</span><span class="p">,</span>
                 <span class="n">ri_current_infection_status</span><span class="p">,</span>
                 <span class="n">untreated_hiv</span><span class="p">,</span>
                 <span class="n">un_clinical_acute_malnutrition</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For new incident case of dirarrhoea, determine whether death will result.</span>
<span class="sd">        This gets the probability of death and determines outcome probabilistically. &quot;&quot;&quot;</span>

        <span class="n">prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death</span><span class="p">(</span>
            <span class="n">pathogen</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">,</span>
            <span class="n">duration_longer_than_13days</span><span class="p">,</span>
            <span class="n">dehydration</span><span class="p">,</span>
            <span class="n">age_exact_years</span><span class="p">,</span>
            <span class="n">ri_current_infection_status</span><span class="p">,</span>
            <span class="n">untreated_hiv</span><span class="p">,</span>
            <span class="n">un_clinical_acute_malnutrition</span>
        <span class="p">)</span>

        <span class="c1"># Return bool following coin-flip to determine outcome</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob</span>

    <span class="k">def</span> <span class="nf">does_treatment_prevent_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For a case of diarrhoea that will cause death if untreated, that is now being treated, determine if the</span>
<span class="sd">        treatment will prevent a death from occuring.</span>
<span class="sd">        Each parameter can be provided as a single value or as an itterable representing the status as that</span>
<span class="sd">        (&quot;before_treatment&quot;, &quot;after_treatment&quot;).</span>
<span class="sd">        This method is called for a person for whom a death is scheduled and is receiving treatment. If the outcome is</span>
<span class="sd">        True then the death should be cancalled as the change in circumstances (treatment of diarrhoea type or</span>
<span class="sd">        dehydration) have reduced the probabilty of death such that there it will not occur.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">is_iterable_and_not_string</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

        <span class="n">prob_death</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;before_treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;after_treatment&#39;</span><span class="p">]):</span>
            <span class="n">prob_death</span><span class="p">[</span><span class="n">case</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prob_death</span><span class="p">(</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_iterable_and_not_string</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Probability that treatment &quot;blocks&quot; the death for someone that would have died.</span>
        <span class="n">prob_treatment_blocks_death</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">prob_death</span><span class="p">[</span><span class="s1">&#39;after_treatment&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">prob_death</span><span class="p">[</span><span class="s1">&#39;before_treatment&#39;</span><span class="p">]</span>

        <span class="c1"># Return outcome, determine probabilstically</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_treatment_blocks_death</span>

    <span class="k">def</span> <span class="nf">get_symptoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For new incident case of diarrhoea, determine the symptoms that onset.&quot;&quot;&quot;</span>

        <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fever&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_fever_by_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
            <span class="s1">&#39;vomiting&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_vomiting_by_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">symptoms_that_onset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;diarrhoea&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symptom</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">probs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob</span><span class="p">:</span>
                <span class="n">symptoms_that_onset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symptom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">symptoms_that_onset</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   DISEASE MODULE EVENTS</span>
<span class="c1">#</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="DiarrhoeaPollingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaPollingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main event that runs the acquisition of pathogens that cause Diarrhoea.</span>
<span class="sd">    It determines who is infected and schedules individual IncidentCase events to represent onset.</span>

<span class="sd">    A known issue is that diarrhoea events are scheduled based on the risk of current age but occur a short time</span>
<span class="sd">     later when the children will be slightly older. This means that when comparing the model output with data, the</span>
<span class="sd">     model slightly under-represents incidence among younger age-groups and over-represents incidence among older</span>
<span class="sd">     age-groups. This is a small effect when the frequency of the polling event is high.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaPollingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1"># NB. The frequency of the occurrences of this event can be edited safely.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_a_year_until_next_polling_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fraction_of_year_between_polling_event</span><span class="p">()</span></div>

<div class="viewcode-block" id="DiarrhoeaPollingEvent.compute_fraction_of_year_between_polling_event"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent.compute_fraction_of_year_between_polling_event">[docs]</a>    <span class="k">def</span> <span class="nf">compute_fraction_of_year_between_polling_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute fraction of a year that elapses between polling event. This is used to adjust the risk of</span>
<span class="sd">        infection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaPollingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span>

        <span class="c1"># Define who is at risk of onset of a episode of Diarrhoea.</span>
        <span class="c1"># Those susceptible are children that do not currently have an episode (never had an episode or last episode</span>
        <span class="c1"># resolved) and who do not have diarrhoea as a &#39;spurious symptom&#39; of diarrhoea already.</span>
        <span class="n">mask_could_get_new_diarrhoea_episode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
            <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span><span class="p">))</span> <span class="o">&amp;</span>
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;diarrhoea&#39;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Compute the incidence rate for each person getting diarrhoea</span>
        <span class="n">inc_of_acquiring_pathogen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_diarrhoea_episode</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
            <span class="n">inc_of_acquiring_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">linear_model_for_incidence_by_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> \
                <span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_diarrhoea_episode</span><span class="p">])</span>

        <span class="c1"># Convert the incidence rates into risk of an event occurring before the next polling event</span>
        <span class="n">probs_of_aquiring_pathogen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="n">inc_of_acquiring_pathogen</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_a_year_until_next_polling_event</span>
        <span class="p">)</span>

        <span class="c1"># Sample to find outcomes (which pathogen, if any, caused Diarrhoea among persons at-risk):</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="n">sample_outcome</span><span class="p">(</span><span class="n">probs</span><span class="o">=</span><span class="n">probs_of_aquiring_pathogen</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">outcome</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Create and schedule the event for the onset of infection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                <span class="n">event</span><span class="o">=</span><span class="n">DiarrhoeaIncidentCase</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">random_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="DiarrhoeaIncidentCase"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaIncidentCase</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Event is for the onset of the infection that causes diarrhoea.</span>
<span class="sd">     * Refreshes all the properties so that they pertain to this current episode of diarrhoea</span>
<span class="sd">     * Imposes the symptoms</span>
<span class="sd">     * Schedules relevant natural history event {(DiarrhoeaSevereDehydrationEvent) and</span>
<span class="sd">       (either DiarrhoeaNaturalRecoveryEvent or DiarrhoeaDeathEvent)}</span>
<span class="sd">     * Updates a counter for incident cases</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaIncidentCase.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span> <span class="o">=</span> <span class="n">pathogen</span></div>

<div class="viewcode-block" id="DiarrhoeaIncidentCase.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">untreated_hiv</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">hv_inf</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">hv_art</span> <span class="o">!=</span> <span class="s2">&quot;on_VL_suppressed&quot;</span><span class="p">)</span>

        <span class="c1"># The event will not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># The event will not run if the child is now older than five year-olds</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Determine the duration of the dirarrhoea, the date of outcome and the end of episode (the date when this</span>
        <span class="c1"># episode ends. It is the last possible data that any HSI could affect this episode.)</span>
        <span class="n">duration_in_days</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_duration</span><span class="p">(</span><span class="n">pathogen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
                                                 <span class="n">age_exact_years</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_exact_years</span><span class="p">,</span>
                                                 <span class="n">un_HAZ_category</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">un_HAZ_category</span><span class="p">,</span>
                                                 <span class="n">un_clinical_acute_malnutrition</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">un_clinical_acute_malnutrition</span><span class="p">,</span>
                                                 <span class="n">untreated_hiv</span><span class="o">=</span><span class="n">untreated_hiv</span><span class="p">,</span>
                                                 <span class="p">)</span>
        <span class="n">date_of_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">duration_in_days</span><span class="p">)</span>

        <span class="c1"># Collected updated properties of this person</span>
        <span class="n">props_new</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;gi_has_diarrhoea&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gi_pathogen&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
            <span class="s1">&#39;gi_type&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">),</span>
            <span class="s1">&#39;gi_dehydration&#39;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_dehydration</span><span class="p">(</span><span class="n">pathogen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
                                                       <span class="n">va_rota_all_doses</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">va_rota_all_doses</span><span class="p">,</span>
                                                       <span class="n">age_years</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">),</span>
            <span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">:</span> <span class="n">duration_in_days</span> <span class="o">&gt;=</span> <span class="mi">13</span><span class="p">,</span>
            <span class="s1">&#39;gi_date_of_onset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="s1">&#39;gi_date_end_of_last_episode&#39;</span><span class="p">:</span> <span class="n">date_of_outcome</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>   <span class="c1"># &lt;-- determined below</span>
            <span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>      <span class="c1"># &lt;-- determined below</span>
            <span class="s1">&#39;gi_treatment_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>            <span class="c1"># &lt;-- pd.NaT until treatment is provided.</span>
        <span class="p">}</span>

        <span class="c1"># Determine outcome (recovery or death) of this episode</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">will_die</span><span class="p">(</span>
            <span class="n">pathogen</span><span class="o">=</span><span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_pathogen&#39;</span><span class="p">],</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_type&#39;</span><span class="p">],</span>
            <span class="n">duration_longer_than_13days</span><span class="o">=</span><span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">],</span>
            <span class="n">dehydration</span><span class="o">=</span><span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_dehydration&#39;</span><span class="p">],</span>
            <span class="n">age_exact_years</span><span class="o">=</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">],</span>
            <span class="n">ri_current_infection_status</span><span class="o">=</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">],</span>
            <span class="n">untreated_hiv</span><span class="o">=</span><span class="n">untreated_hiv</span><span class="p">,</span>
            <span class="n">un_clinical_acute_malnutrition</span><span class="o">=</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="c1"># person will die (unless treated)</span>
            <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_scheduled_date_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_of_outcome</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaDeathEvent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># person will recover</span>
            <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_of_outcome</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaNaturalRecoveryEvent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>

        <span class="c1"># Update the entry in the population dataframe</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">props_new</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">props_new</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># Apply symptoms for this episode (these do not affect the course of disease)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
            <span class="n">symptom_string</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_symptoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">),</span>
            <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="p">)</span>

        <span class="c1"># Log this incident case:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;incident_case&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                <span class="s1">&#39;age_years&#39;</span><span class="p">:</span> <span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span>
                <span class="s1">&#39;pathogen&#39;</span><span class="p">:</span> <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_pathogen&#39;</span><span class="p">],</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_type&#39;</span><span class="p">],</span>
                <span class="s1">&#39;dehydration&#39;</span><span class="p">:</span> <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_dehydration&#39;</span><span class="p">],</span>
                <span class="s1">&#39;duration_longer_than_13days&#39;</span><span class="p">:</span> <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_duration_longer_than_13days&#39;</span><span class="p">],</span>
                <span class="s1">&#39;date_of_outcome&#39;</span><span class="p">:</span> <span class="n">date_of_outcome</span><span class="p">,</span>
                <span class="s1">&#39;will_die&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_scheduled_date_recovery&#39;</span><span class="p">])</span>
            <span class="p">},</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;each incicdent case of diarrhoea&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Increment the counter for the number of cases of diarrhoea had</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaNaturalRecoveryEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the Natural Recovery event. It is part of the natural history and represents the end of an episode of</span>
<span class="sd">    Diarrhoea.</span>
<span class="sd">    It does the following:</span>
<span class="sd">        * resolves all symptoms caused by diarrhoea</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the recovery is not expected for today</span>
        <span class="c1"># (Because the person has already recovered, through being cured).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_recovery</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span>

        <span class="c1"># Check that the person is not scheduled to die in this episode</span>
        <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_death</span><span class="p">)</span>

        <span class="c1"># Resolve all the symptoms and reset the properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">end_episode</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">outcome</span><span class="o">=</span><span class="s1">&#39;recovery&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DiarrhoeaDeathEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Event is for the death of someone that is caused by the infection with a pathogen that causes diarrhoea.</span>
<span class="sd">    The person dies if the &#39;diarrhoea_death_date&#39; that was set at onset of the episode is equal to the current date.</span>
<span class="sd">    (It will have been reset to pd.NaT if there has been a treatment in the intervening time).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaDeathEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaDeathEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the death is not scheduled for today (i.e. if it has been cancalled)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_death</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_scheduled_date_recovery</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span>

        <span class="c1"># End the episode with a death:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">end_episode</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">outcome</span><span class="o">=</span><span class="s1">&#39;death&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DiarrhoeaCureEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaCureEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the cure event. It is scheduled by an HSI treatment event.</span>
<span class="sd">    It enacts the actual &quot;cure&quot; of the person that is caused (after some delay) by the treatment administered.</span>
<span class="sd">    It does the following:</span>
<span class="sd">        * Sets the date of recovery to today&#39;s date</span>
<span class="sd">        * Resolves all symptoms caused by diarrhoea</span>

<span class="sd">    NB. This is the event that would be called if another module has caused the symptom of diarrhoea and care is sought.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaCureEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaCureEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if this is the person is not in a current episode of diarrhoea</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">gi_has_diarrhoea</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_date_end_of_last_episode</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the episode of diarrhoea is not caused by this module (e.g., spurious symptoms)</span>
        <span class="k">if</span> <span class="s1">&#39;Diarrhoea&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">causes_of</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;diarrhoea&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Resolve all the symptoms and reset the properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">end_episode</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">outcome</span><span class="o">=</span><span class="s1">&#39;cure&#39;</span><span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   HEALTH SYSTEM INTERACTION EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Outpatient"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Outpatient">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Treatment_Outpatient</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for diarrhoea administered at outpatient.</span>
<span class="sd">    NB. This can be called when a child presents with Diarrhoea that is caused by another module/Symptom Manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Outpatient.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Outpatient.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Treatment_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Outpatient.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Outpatient.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run `do_treatment` for this person from an out-potient setting.&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Inpatient"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Inpatient">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Treatment_Inpatient</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for acute diarrhoea with severe dehydration administered at inpatient when danger_signs have</span>
<span class="sd">    been diagnosed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Inpatient.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Inpatient.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Treatment_Inpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_Inpatient.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_Inpatient.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run `do_treatment` for this person from an in-potient setting.&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   HELPER MODULES AND METHODS FOR USE IN TESTING</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaPropertiesOfOtherModules</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For the purpose of the testing, this module generates the properties upon which the Alri module relies&quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">}</span>

    <span class="c1"># Though this module provides some properties from NewbornOutcomes we do not list</span>
    <span class="c1"># NewbornOutcomes in the ALTERNATIVE_TO set to allow using in conjunction with</span>
    <span class="c1"># SimplifiedBirths which can also be used as an alternative to NewbornOutcomes</span>
    <span class="n">ALTERNATIVE_TO</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Alri&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiv&#39;</span><span class="p">,</span> <span class="s1">&#39;Stunting&#39;</span><span class="p">,</span> <span class="s1">&#39;Wasting&#39;</span><span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;hv_inf&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property for HIV infection status&#39;</span><span class="p">),</span>
        <span class="s1">&#39;hv_art&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property for ART status&#39;</span><span class="p">,</span>
                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;not&quot;</span><span class="p">,</span> <span class="s2">&quot;on_VL_suppressed&quot;</span><span class="p">,</span> <span class="s2">&quot;on_not_VL_suppressed&quot;</span><span class="p">]),</span>
        <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                                   <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MAM&#39;</span><span class="p">,</span> <span class="s1">&#39;SAM&#39;</span><span class="p">,</span> <span class="s1">&#39;well&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">,</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;va_rota_all_doses&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;non_exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;well&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;va_rota_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="DiarrhoeaPropertiesOfOtherModules.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPropertiesOfOtherModules.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;non_exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;well&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;va_rota_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="DiarrhoeaCheckPropertiesEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCheckPropertiesEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaCheckPropertiesEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This event runs daily and checks properties are in the right configuration. Only use whilst debugging!</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaCheckPropertiesEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCheckPropertiesEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="DiarrhoeaCheckPropertiesEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCheckPropertiesEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_properties</span><span class="p">()</span></div></div>


<span class="k">def</span> <span class="nf">increase_incidence_of_pathogens</span><span class="p">(</span><span class="n">diarrhoea_module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to increase the incidence of pathogens and symptoms onset with Diarrhoea.&quot;&quot;&quot;</span>

    <span class="c1"># Increase incidence of pathogens (such that almost certain to get at least one pathogen each year)</span>
    <span class="n">pathogens</span> <span class="o">=</span> <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">pathogens</span>
    <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">pathogens</span><span class="p">:</span>
        <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">[</span><span class="mf">0.95</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span>

    <span class="n">probs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[</span><span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">pathogens</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># Increase symptoms so that everyone gets symptoms:</span>
    <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;proportion_AWD_by_&#39;</span><span class="p">):</span>
            <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;fever_by_&#39;</span><span class="p">):</span>
            <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;vomiting_by_&#39;</span><span class="p">):</span>
            <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">param_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;dehydration_by_&#39;</span><span class="p">):</span>
            <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="k">def</span> <span class="nf">increase_risk_of_death</span><span class="p">(</span><span class="n">diarrhoea_module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to increase death and make it dependent on dehydration and blood-in-diarrhoea that are cured by</span>
<span class="sd">     treatment&quot;&quot;&quot;</span>

    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_bloody&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_severe_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_untreated_HIV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_SAM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_alri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_cryptosporidium&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_shigella&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="k">def</span> <span class="nf">make_treatment_perfect</span><span class="p">(</span><span class="n">diarrhoea_module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply perfect efficacy for treatments&quot;&quot;&quot;</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_WHOPlanC_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_ORS_cures_dehydration_if_severe_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_ORS_cures_dehydration_if_non_severe_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_antibiotic_cures_dysentery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Apply perfect assessment and referral</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_hospitalization_referral_for_severe_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_severe_dehydration_visual_inspection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">diarrhoea_module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;specificity_severe_dehydration_visual_inspection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on May 31, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>