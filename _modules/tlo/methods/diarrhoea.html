

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.diarrhoea &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.diarrhoea</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.diarrhoea</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Childhood Diarrhoea Module</span>

<span class="sd">Overview</span>
<span class="sd">=======</span>
<span class="sd">Individuals are exposed to the risk of onset of diarrhoea. They can have diarrhoea caused by one pathogen at a time.</span>
<span class="sd"> During an episode (prior to recovery- either natural or cured), the symptom of diarrhoea is present in addition to</span>
<span class="sd"> other possible symptoms. Diarrhoea may cause dehydration and this may progress to become &#39;severe&#39; during an episode.</span>
<span class="sd"> The individual may recovery naturally or die.</span>

<span class="sd">Health care seeking is prompted by the onset of the symptom diarrhoea. The individual can be treated; if successful the</span>
<span class="sd"> risk of death is removed and they are cured (symptom resolved) some days later.</span>

<span class="sd">Outstanding issues:</span>
<span class="sd">==================</span>
<span class="sd">* Onset of severe dehydration has no relationship to the risk of death (only the treatment that is provided)</span>
<span class="sd">* Risk of death is linked to duration of episode - but this is assigned randomly, so stricly  is not necessary.</span>
<span class="sd">* Follow-up appointments for initial HSI events.</span>
<span class="sd">* Double check parameters and consumables codes for the HSI events.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">demography</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.symptommanager</span> <span class="kn">import</span> <span class="n">Symptom</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   MODULE DEFINITIONS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Diarrhoea"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea">[docs]</a><span class="k">class</span> <span class="nc">Diarrhoea</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="c1"># Declare the pathogens that this module will simulate:</span>
    <span class="n">pathogens</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;rotavirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shigella&#39;</span><span class="p">,</span>
        <span class="s1">&#39;adenovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cryptosporidium&#39;</span><span class="p">,</span>
        <span class="s1">&#39;campylobacter&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ST-ETEC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sapovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;norovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;astrovirus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tEPEC&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_SYMPTOMMANAGER</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year)&#39;</span>
                      <span class="s1">&#39; of diarrhoea caused by rotavirus in age groups 0-11, 12-23, 24-59 months &#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by shigella spp in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by adenovirus 40/41 in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by cryptosporidium in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by campylobacter spp in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by ST-ETEC in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by sapovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by norovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by astrovirus in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_diarrhoea_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;incidence rate (per person-year) &#39;</span>
                      <span class="s1">&#39;of diarrhoea caused by tEPEC in age groups 0-11, 12-23, 24-59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_HHhandwashing&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea with household handwashing with soap&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_improved_sanitation&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for improved sanitation&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_clean_water&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for access to clean drinking water&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for HIV positive status&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for severe malnutrition&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_excl_breast&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for exclusive breastfeeding upto 6 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_cont_breast&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for continued breastfeeding 6 months to 2 years&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarrhoea_rotavirus_vaccination&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative rate of diarrhoea for rotavirus vaccine&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by ST-ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_AWD_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;acute diarrhoea type caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by ST-ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;fever_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;fever caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by ST-ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;vomiting_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;vomiting caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by ST-ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by astrovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;dehydration_by_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;any dehydration caused by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by rotavirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by shigella&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by adenovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by cryptosporidium&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by campylobacter&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by ST-ETEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by sapovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by norovirus&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prolonged_diarr_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;prolonged episode by tEPEC&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_prolonged_to_persistent_diarr&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of prolonged diarrhoea becoming persistent diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_dysentery_become_persistent&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of dysentery becoming persistent diarrhoea&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_watery_diarr_become_persistent&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of acute watery diarrhoea becoming persistent diarrhoea, &#39;</span>
                                  <span class="s1">&#39;for children under 11 months, no SAM, no HIV&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_age12to23&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for age 12 to 23 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_age24to59&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for age 24 to 59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for HIV positive&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for severely acute malnutrition&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_excl_breast&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for exclusive breastfeeding&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_bec_persistent_cont_breast&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acute diarrhoea becoming persistent diarrhoea for continued breastfeeding&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for acute watery diarrhoea cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;case_fatality_rate_dysentery&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for dysentery cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;case_fatality_rate_persistent&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for persistent diarrhoea cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_age12to23mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of diarrhoea death for ages 12 to 23 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of diarrhoea death for ages 24 to 59 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative risk of diarrhoea death if the duration episode is 13 days or longer&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for cases with (some) dehyadration&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_HIV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for HIV&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_diarr_death_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of diarrhoea death for severe acute malnutrition&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;days_onset_severe_dehydration_before_death&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;number of days before a death (in the untreated case) that dehydration would be &#39;</span>
                                 <span class="s1">&#39;classified as severe and child ought to be classified as positive for the danger&#39;</span>
                                 <span class="s1">&#39;signs&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_rotavirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by rotavirus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_shigella&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by shigella&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_adenovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by adenovirus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_cryptosporidium&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by cryptosporidium&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_campylobacter&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by campylobacter&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_ST-ETEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by ST-ETEC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_sapovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by sapovirus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_norovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by norovirus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_astrovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by astrovirus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_days_duration_with_tEPEC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;mean number of days duration with diarrhoea caused by tEPEC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_given_Treatment_PlanA&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of the person being cured if is provided with Treatment Plan A&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_given_Treatment_PlanB&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of the person being cured if is provided with Treatment Plan B&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_given_Treatment_PlanC&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of the person being cured if is provided with Treatment Plan C&#39;</span><span class="p">),</span>
        <span class="s1">&#39;max_number_of_days_for_onset_of_severe_dehydration_before_end_of_episode&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;if severe dehydration occurs, it onsets a number of days before the end of the &#39;</span>
                                 <span class="s1">&#39;episode of diarrhoea; that number of days is chosen from a uniform distribution &#39;</span>
                                 <span class="s1">&#39;between 0 and this number&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probability_of_severe_dehydration_if_some_dehydration&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that someone with diarrhoea and some dehydration develops severe &#39;</span>
                                  <span class="s1">&#39;dehydration&#39;</span><span class="p">),</span>
        <span class="s1">&#39;min_days_duration_of_episode&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;the shortest duration of any episode of diarrhoea&#39;</span><span class="p">),</span>
        <span class="s1">&#39;range_in_days_duration_of_episode&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;the duration of an episode of diarrhoea is a uniform distribution around the mean &#39;</span>
                                 <span class="s1">&#39;with a range equal by this number.&#39;</span><span class="p">),</span>

        <span class="c1"># TODO check the below parmaeters for those HSI are relevant</span>
        <span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Severe_Persistent_Diarrhoea&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of the person being cured if is provided with &#39;</span>
                      <span class="s1">&#39;HSI_Diarrhoea_Severe_Persistent_Diarrhoea.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of the person being cured if is provided with &#39;</span>
                      <span class="s1">&#39;HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Dysentery&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of the person being cured if is provided with HSI_Diarrhoea_Dysentery.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;number of days between any treatment being given in an HSI and the cure occurring.&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># ---- The pathogen which is caused the diarrhoea  ----</span>
        <span class="s1">&#39;gi_ever_had_diarrhoea&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                                          <span class="s1">&#39;Whether or not the person has ever had an episode of diarrhoea.&#39;</span>
                                          <span class="p">),</span>

        <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                               <span class="s1">&#39;Attributable pathogen for the last episode of diarrhoea.&#39;</span>
                                               <span class="s1">&#39;not_applicable is used if the person has never had an episode of &#39;</span>
                                               <span class="s1">&#39;diarrhoea&#39;</span><span class="p">,</span>
                                               <span class="n">categories</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">pathogens</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;not_applicable&#39;</span><span class="p">]),</span>

        <span class="c1"># ---- Classification of the type of diarrhoea that is caused  ----</span>
        <span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                           <span class="s1">&#39;Type of the last episode of diarrhoea: either watery or bloody.&#39;</span>
                                           <span class="s1">&#39;not_applicable is used if the person has never had an episode of &#39;</span>
                                           <span class="s1">&#39;diarrhoea.&#39;</span><span class="p">,</span>
                                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;not_applicable&#39;</span><span class="p">,</span>  <span class="c1"># (never has had diarrhoea)</span>
                                                       <span class="s1">&#39;watery&#39;</span><span class="p">,</span>
                                                       <span class="s1">&#39;bloody&#39;</span><span class="p">]),</span>

        <span class="c1"># ---- Classification of severity of the dehydration caused ----</span>
        <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                                  <span class="s1">&#39;Severity of dehydration of last episode of diarrhoea.&#39;</span>
                                                  <span class="s1">&#39;not_applicable is used if the person has never had an episode of &#39;</span>
                                                  <span class="s1">&#39;diarrhoea&#39;</span><span class="p">,</span>
                                                  <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;not_applicable&#39;</span><span class="p">,</span>  <span class="c1"># (never has had diarrhoea)</span>
                                                              <span class="s1">&#39;none&#39;</span><span class="p">,</span>       <span class="c1"># &lt;-- this can be assigned at onset</span>
                                                              <span class="s1">&#39;some&#39;</span><span class="p">,</span>       <span class="c1"># &lt;-- this can be assigned at onset</span>
                                                              <span class="s1">&#39;severe&#39;</span>      <span class="c1"># &lt;-- this may develop during the episode</span>
                                                              <span class="p">]),</span>

        <span class="c1"># ---- Internal variables to schedule onset and deaths due to diarrhoea  ----</span>
        <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of onset of last episode of diarrhoea. &#39;</span>
                                                                <span class="s1">&#39;pd.NaT if never had diarrhoea&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_last_diarrhoea_duration&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;number of days of last episode of diarrhoea. &#39;</span>
                                                           <span class="s1">&#39;pd.nan if never had diarrhoea&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                                     <span class="s1">&#39;date of recovery from last episode of diarrhoea. &#39;</span>
                                                     <span class="s1">&#39;pd.NaT if never had an episode or if the last episode caused&#39;</span>
                                                     <span class="s1">&#39;death.&#39;</span>
                                                     <span class="s1">&#39;This is scheduled when the episode is onset and may be revised&#39;</span>
                                                     <span class="s1">&#39;subsequently if a cure is enacted by a treatment.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of death caused by last episode of diarrhoea.&#39;</span>
                                                             <span class="s1">&#39;pd.NaT if never had an episode or if the last episode did&#39;</span>
                                                             <span class="s1">&#39; not cause death.&#39;</span>
                                                             <span class="s1">&#39;This is scheduled when the episode is onset and may be &#39;</span>
                                                             <span class="s1">&#39;revised to pd.NaT if a cure is enacted.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_last_diarrhoea_treatment_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                                     <span class="s1">&#39;date of first treatment on the last episode of diarrhoea.&#39;</span>
                                                     <span class="s1">&#39;pd.NaT is never had an episode or if the last episode did not &#39;</span>
                                                     <span class="s1">&#39;receive treatment.&#39;</span>
                                                     <span class="s1">&#39;It is set to pd.NaT at onset of the episode and may be revised if&#39;</span>
                                                     <span class="s1">&#39;treatment is received.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                           <span class="s1">&#39;date on which the last episode of diarrhoea is resolved, (including &#39;</span>
                                           <span class="s1">&#39;allowing for the possibility that a cure is scheduled following onset). &#39;</span>
                                           <span class="s1">&#39;This is used to determine when a new episode can begin. &#39;</span>
                                           <span class="s1">&#39;This stops successive episodes interfering with one another.&#39;</span><span class="p">),</span>

        <span class="c1"># ---- Temporary Variables: To be replaced with the properties of other modules ----</span>
        <span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property - malnutrition status&#39;</span><span class="p">),</span>
        <span class="s1">&#39;tmp_exclusive_breastfeeding&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property - exclusive breastfeeding upto 6 mo&#39;</span><span class="p">),</span>
        <span class="s1">&#39;tmp_continued_breastfeeding&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property - continued breastfeeding 6mo-2years&#39;</span><span class="p">),</span>
        <span class="s1">&#39;tmp_hv_inf&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Temporary property - current HIV infection&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Diarrhoea.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># dict to hold equations in for the incidence of pathogens:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># dict to hold the probability of onset of different types of symptom given a pathgoen:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_symptoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># dict to hold the DALY weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># dict to hold counters for the number of episodes of diarrhoea by pathogen-type and age-group</span>
        <span class="c1"># (0yrs, 1yrs, 2-4yrs)</span>
        <span class="n">blank_counter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incident_case_tracker_blank</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;0y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">blank_counter</span><span class="p">),</span>
            <span class="s1">&#39;1y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">blank_counter</span><span class="p">),</span>
            <span class="s1">&#39;2-4y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">blank_counter</span><span class="p">),</span>
            <span class="s1">&#39;5+y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">blank_counter</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incident_case_tracker</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incident_case_tracker_blank</span><span class="p">)</span>

        <span class="n">zeros_counter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incident_case_tracker_zeros</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;0y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">zeros_counter</span><span class="p">),</span>
            <span class="s1">&#39;1y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">zeros_counter</span><span class="p">),</span>
            <span class="s1">&#39;2-4y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">zeros_counter</span><span class="p">),</span>
            <span class="s1">&#39;5+y&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">zeros_counter</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">risk_of_death_diarrhoea</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_duration_in_days_of_diarrhoea</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_duration_in_days_of_diarrhoea_lookup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_diarrhoea_is_watery</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Store the symptoms that this module will use:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symptoms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;diarrhoea&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bloody_stool&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fever&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vomiting&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dehydration&#39;</span>  <span class="c1"># NB. This is non-severe dehydration</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="Diarrhoea.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup parameters values used by the module &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Read parameters from the resourcefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_Diarrhoea.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Parameter_values&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Check that every value has been read-in successfully</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">p</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">param_name</span><span class="p">],</span>
                              <span class="n">param_type</span><span class="o">.</span><span class="n">python_type</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the &#39;</span> \
                                                       <span class="sa">f</span><span class="s1">&#39;resourcefile.&#39;</span>

        <span class="c1"># Declare symptoms that this module will cause and which are not included in the generic symptoms:</span>
        <span class="n">generic_symptoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">generic_symptoms</span>
        <span class="k">for</span> <span class="n">symptom_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symptoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">symptom_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">generic_symptoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">register_symptom</span><span class="p">(</span>
                    <span class="n">Symptom</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">symptom_name</span><span class="p">)</span>  <span class="c1"># (give non-generic symptom &#39;average&#39; healthcare seeking)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="Diarrhoea.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets that there is no one with diarrhoea at initiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># a shortcut to the data-frame storing data for individuals</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_ever_had_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># ---- Temporary values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;tmp_exclusive_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;tmp_continued_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Diarrhoea.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepares for simulation:</span>
<span class="sd">        * Schedules the main polling event</span>
<span class="sd">        * Schedules the main logging event</span>
<span class="sd">        * Establishes the linear models and other data structures using the parameters that have been read-in</span>
<span class="sd">        * Store the consumables that are required in each of the HSI</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Schedule the main polling event (to first occur immediately)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaPollingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Schedule the main logging event (to first occur in one year)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Get DALY weights</span>
        <span class="n">get_daly_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;mild_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;moderate_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;severe_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">34</span><span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Make a dict to hold the equations that govern the probability that a person acquires diarrhoea</span>
        <span class="c1"># that is caused (primarily) by a pathogen</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">def</span> <span class="nf">make_scaled_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Makes the unscaled linear model with default intercept of 1. Calculates the mean incidents rate for</span>
<span class="sd">            0-year-olds and then creates a new linear model with adjusted intercept so incidents in 0-year-olds</span>
<span class="sd">            matches the specified value in the model when averaged across the population</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="nf">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">base_inc_rate</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">return</span> <span class="n">LinearModel</span><span class="p">(</span>
                    <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                    <span class="n">intercept</span><span class="p">,</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;age_years&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(0,0)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(1,1)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(2,4)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">base_inc_rate</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_no_access_handwashing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_HHhandwashing&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_no_clean_drinking_water&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_clean_water&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_unimproved_sanitation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_improved_sanitation&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;tmp_hv_inf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_HIV&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;tmp_exclusive_breastfeeding&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_excl_breast&#39;</span><span class="p">])</span>
                <span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
            <span class="n">unscaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">)</span>
            <span class="n">target_mean</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;base_inc_rate_diarrhoea_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">actual_mean</span> <span class="o">=</span> <span class="n">unscaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">scaled_intercept</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">/</span> <span class="n">actual_mean</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">actual_mean</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="n">scaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model</span><span class="p">(</span><span class="n">patho</span><span class="p">,</span> <span class="n">intercept</span><span class="o">=</span><span class="n">scaled_intercept</span><span class="p">)</span>
            <span class="c1"># check by applying the model to mean incidence of 0-year-olds</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">target_mean</span> <span class="o">-</span> <span class="n">scaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>
            <span class="k">return</span> <span class="n">scaled_lm</span>

        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">Diarrhoea</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_scaled_linear_model</span><span class="p">(</span><span class="n">pathogen</span><span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Make a dict containing the probability of symptoms onset given acquisition of diarrhoea caused</span>
        <span class="c1"># by a particular pathogen.</span>
        <span class="c1"># Note that the type</span>
        <span class="k">def</span> <span class="nf">make_symptom_probs</span><span class="p">(</span><span class="n">patho</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;diarrhoea&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="s1">&#39;bloody_stool&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proportion_AWD_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
                <span class="s1">&#39;fever&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fever_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
                <span class="s1">&#39;vomiting&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;vomiting_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
                <span class="s1">&#39;dehydration&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dehydration_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">Diarrhoea</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prob_symptoms</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_symptom_probs</span><span class="p">(</span><span class="n">pathogen</span><span class="p">)</span>

        <span class="c1"># Check that each pathogen has a risk of developing each symptom</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_symptoms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symptoms</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_symptoms</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_symptoms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Create the linear model for the risk of dying due to diarrhoea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risk_of_death_diarrhoea</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span>
            <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;watery&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">])</span>
                                               <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;bloody&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_dysentery&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_last_diarrhoea_duration&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt;13&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;some&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_dehydration&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(1,1.9999)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age12to23mo&#39;</span><span class="p">])</span>
                                        <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(2,3.9999)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">])</span>
                                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;tmp_hv_inf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_HIV&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Create the linear model for the duration of the episode of diarrhoea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_duration_in_days_of_diarrhoea</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span>
            <span class="n">LinearModelType</span><span class="o">.</span><span class="n">ADDITIVE</span><span class="p">,</span>
            <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;rotavirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_rotavirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;shigella&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_shigella&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;adenovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_adenovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;cryptosporidium&#39;</span><span class="p">,</span>
                                                         <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_cryptosporidium&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;campylobacter&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_campylobacter&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;ST-ETEC&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_ST-ETEC&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;sapovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_sapovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;norovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_norovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;astrovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_astrovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;tEPEC&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_tEPEC&#39;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mean_duration_in_days_of_diarrhoea_lookup</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;rotavirus&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_rotavirus&#39;</span><span class="p">],</span>
            <span class="s1">&#39;shigella&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_shigella&#39;</span><span class="p">],</span>
            <span class="s1">&#39;adenovirus&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_adenovirus&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cryptosporidium&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_cryptosporidium&#39;</span><span class="p">],</span>
            <span class="s1">&#39;campylobacter&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_campylobacter&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ST-ETEC&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_ST-ETEC&#39;</span><span class="p">],</span>
            <span class="s1">&#39;sapovirus&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_sapovirus&#39;</span><span class="p">],</span>
            <span class="s1">&#39;norovirus&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_norovirus&#39;</span><span class="p">],</span>
            <span class="s1">&#39;astrovirus&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_astrovirus&#39;</span><span class="p">],</span>
            <span class="s1">&#39;tEPEC&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_days_duration_with_tEPEC&#39;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Create the linear model for the probability that the diarrhoea is &#39;watery&#39; (rather than &#39;bloody&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_diarrhoea_is_watery</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span>
            <span class="n">LinearModelType</span><span class="o">.</span><span class="n">ADDITIVE</span><span class="p">,</span>
            <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;rotavirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_rotavirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;shigella&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_shigella&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;adenovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_adenovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;cryptosporidium&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_cryptosporidium&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;campylobacter&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_campylobacter&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;ST-ETEC&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_ST-ETEC&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;sapovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_sapovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;norovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_norovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;astrovirus&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_astrovirus&#39;</span><span class="p">])</span>
                                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;tEPEC&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_AWD_by_tEPEC&#39;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------------</span>
        <span class="c1"># Look-up and store the consumables that are required for each HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">look_up_consumables</span><span class="p">()</span></div>

<div class="viewcode-block" id="Diarrhoea.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On birth, all children will have no diarrhoea</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_ever_had_diarrhoea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_applicable&#39;</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># ---- Temporary values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;tmp_exclusive_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;tmp_continued_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Diarrhoea.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called whenever there is an HSI event commissioned by one of the other disease modules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Diarrhoea.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This returns DALYS values relating to the current status of persons.</span>
<span class="sd">        Assumes that the current DALY loading is linked to currently having the symptom of diarrhoea and the status of</span>
<span class="sd">        dehyrdration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">who_has_symptoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span>

        <span class="n">total_daly_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>

        <span class="n">total_daly_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">who_has_symptoms</span><span class="p">(</span><span class="s1">&#39;diarrhoea&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;mild_diarrhoea&#39;</span><span class="p">]</span>
        <span class="n">total_daly_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">who_has_symptoms</span><span class="p">([</span><span class="s1">&#39;diarrhoea&#39;</span><span class="p">,</span> <span class="s1">&#39;dehydration&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;moderate_diarrhoea&#39;</span><span class="p">]</span>
        <span class="n">total_daly_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_last_diarrhoea_dehydration</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;severe_diarrhoea&#39;</span><span class="p">]</span>

        <span class="c1"># Split out by pathogen that causes the diarrhoea</span>
        <span class="n">dummies_for_pathogen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_daly_values</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">],</span>
                                              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;not_applicable&#39;</span><span class="p">)</span>
        <span class="n">daly_values_by_pathogen</span> <span class="o">=</span> <span class="n">dummies_for_pathogen</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">total_daly_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">daly_values_by_pathogen</span></div>

<div class="viewcode-block" id="Diarrhoea.look_up_consumables"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.look_up_consumables">[docs]</a>    <span class="k">def</span> <span class="nf">look_up_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up and store the consumables used in each of the HSI.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">package</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">package</span>
                <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;Intervention_Pkg_Code&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span>
                <span class="n">column</span> <span class="o">=</span> <span class="s1">&#39;Item_Code&#39;</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition</span><span class="p">,</span> <span class="n">column</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">add_consumable</span><span class="p">(</span><span class="n">_event</span><span class="p">,</span> <span class="n">_package</span><span class="p">,</span> <span class="n">_item</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="n">_event</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">_package</span><span class="p">,</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">_item</span>
            <span class="p">}</span>

        <span class="n">ors_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;ORS&#39;</span><span class="p">)</span>
        <span class="n">severe_diarrhoea_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;Treatment of severe diarrhea&#39;</span><span class="p">)</span>
        <span class="n">zinc_tablet_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="s1">&#39;Zinc, tablet, 20 mg&#39;</span><span class="p">)</span>
        <span class="n">zinc_under_6m_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;Zinc for Children 0-6 months&#39;</span><span class="p">)</span>
        <span class="n">zinc_over_6m_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;Zinc for Children 6-59 months&#39;</span><span class="p">)</span>
        <span class="n">antibiotics_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="s1">&#39;Antibiotics for treatment of dysentery&#39;</span><span class="p">)</span>
        <span class="n">cipro_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="s1">&#39;Ciprofloxacin 250mg_100_CMST&#39;</span><span class="p">)</span>

        <span class="c1"># -- Assemble the footprints for each HSI:</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanA&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">ors_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanB&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">ors_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanC&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">severe_diarrhoea_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Severe_Persistent_Diarrhoea&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">ors_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea_Under6mo&#39;</span><span class="p">,</span>
                       <span class="p">{</span><span class="n">zinc_under_6m_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                       <span class="p">{</span><span class="n">zinc_tablet_code</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea_6moPlus&#39;</span><span class="p">,</span>
                       <span class="p">{</span><span class="n">zinc_over_6m_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                       <span class="p">{</span><span class="n">zinc_tablet_code</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
        <span class="n">add_consumable</span><span class="p">(</span><span class="s1">&#39;HSI_Diarrhoea_Dysentery&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">antibiotics_code</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">cipro_code</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span></div>

<div class="viewcode-block" id="Diarrhoea.do_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.do_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">do_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">prob_of_cure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that enacts the effects of a treatment to diarrhoea caused by a pathogen.</span>
<span class="sd">        It will only do something if the diarrhoea is caused by a pathogen (this module). It will not allow any effect</span>
<span class="sd">         if the diarrhoea is caused by another module.</span>

<span class="sd">        * Log the treatment date</span>
<span class="sd">        * Prevents this episode of diarrhoea from causing a death</span>
<span class="sd">        * Schedules the cure event, at which symptoms are alleviated.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the diarrhoea has not been caused by a pathogen</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_pathogen</span> <span class="o">!=</span> <span class="s1">&#39;not_applicable&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Log that the treatment is provided:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_treatment_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1"># Determine if the treatment is effective</span>
        <span class="k">if</span> <span class="n">prob_of_cure</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
            <span class="c1"># If treatment is successful: cancel death and schedule cure event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_death_date</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaCureEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span>
                                        <span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">]</span>
                                    <span class="p">))</span></div>

<div class="viewcode-block" id="Diarrhoea.cancel_death_date"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.Diarrhoea.cancel_death_date">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_death_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels a scheduled date of death due to diarrhoea for a person. This is called prior to the scheduling the</span>
<span class="sd">        CureEvent to prevent deaths happening in the time between a treatment being given and the cure event occurring.</span>

<span class="sd">        :param person_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div></div>

<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   DISEASE MODULE EVENTS</span>
<span class="c1">#</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="DiarrhoeaPollingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaPollingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main event that runs the acquisition of pathogens that cause Diarrhoea.</span>
<span class="sd">    It determines who is infected and schedules individual IncidentCase events to represent onset.</span>

<span class="sd">    A known issue is that diarrhoea events are scheduled based on the risk of current age but occur a short time</span>
<span class="sd">     later when the children will be slightly older. This means that when comparing the model output with data, the</span>
<span class="sd">     model slightly under-represents incidence among younger age-groups and over-represents incidence among older</span>
<span class="sd">     age-groups. This is a small effect when the frequency of the polling event is high.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaPollingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span></div>
        <span class="c1"># NB. The frequency of the occurrences of this event can be edited safely.</span>

<div class="viewcode-block" id="DiarrhoeaPollingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaPollingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>

        <span class="c1"># Those susceptible are children that do not currently have an episode (never had an episode or last episode</span>
        <span class="c1"># resolved)</span>
        <span class="n">mask_could_get_new_diarrhoea_episode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Compute the incidence rate for each person getting diarrhoea</span>
        <span class="n">inc_of_acquiring_pathogen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_diarrhoea_episode</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
            <span class="n">inc_of_acquiring_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> \
                <span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_diarrhoea_episode</span><span class="p">])</span>

        <span class="c1"># Convert the incidence rates into risk of an event occurring before the next polling event</span>
        <span class="n">fraction_of_a_year_until_next_polling_event</span> <span class="o">=</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">days_until_next_polling_event</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
        <span class="n">probs_of_aquiring_pathogen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="n">inc_of_acquiring_pathogen</span> <span class="o">*</span> <span class="n">fraction_of_a_year_until_next_polling_event</span>
        <span class="p">)</span>

        <span class="c1"># Compute the probability of getting &#39;any&#39; pathogen:</span>
        <span class="c1"># (Assumes that pathogens are mutually exclusive. Prevents probability being greater than 1.0.</span>
        <span class="n">prob_of_acquiring_any_pathogen</span> <span class="o">=</span> <span class="n">probs_of_aquiring_pathogen</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">prob_of_acquiring_any_pathogen</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Determine which persons will acquire any pathogen:</span>
        <span class="n">person_id_that_acquire_pathogen</span> <span class="o">=</span> <span class="n">prob_of_acquiring_any_pathogen</span><span class="o">.</span><span class="n">index</span><span class="p">[</span>
            <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob_of_acquiring_any_pathogen</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">prob_of_acquiring_any_pathogen</span>
            <span class="p">]</span>

        <span class="c1"># Determine which pathogen each person will acquire (among those who will get a pathogen)</span>
        <span class="c1"># and create the event for the onset of new infection:</span>
        <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_id_that_acquire_pathogen</span><span class="p">:</span>
            <span class="c1"># Allocate a pathogen to the person</span>
            <span class="n">p_by_pathogen</span> <span class="o">=</span> <span class="n">probs_of_aquiring_pathogen</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">normalised_p_by_pathogen</span> <span class="o">=</span> <span class="n">p_by_pathogen</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p_by_pathogen</span><span class="p">)</span>  <span class="c1"># don&#39;t understand this normalised</span>
            <span class="n">pathogen</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">probs_of_aquiring_pathogen</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                  <span class="n">p</span><span class="o">=</span><span class="n">normalised_p_by_pathogen</span><span class="p">)</span>

            <span class="c1"># Allocate a date of onset diarrhoea</span>
            <span class="n">date_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">days_until_next_polling_event</span><span class="p">))</span>

            <span class="c1"># Create the event for the onset of infection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                <span class="n">event</span><span class="o">=</span><span class="n">DiarrhoeaIncidentCase</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date_onset</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="DiarrhoeaIncidentCase"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaIncidentCase</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Event is for the onset of the infection that causes diarrhoea.</span>
<span class="sd">     * Refreshes all the properties so that they pertain to this current episode of diarrhoea</span>
<span class="sd">     * Imposes the symptoms</span>
<span class="sd">     * Schedules relevant natural history event {(DiarrhoeaSevereDehydrationEvent) and</span>
<span class="sd">       (either DiarrhoeaNaturalRecoveryEvent or DiarrhoeaDeathEvent)}</span>
<span class="sd">     * Updates a counter for incident cases</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">AGE_GROUPS</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;0y&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;1y&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;2-4y&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;2-4y&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;2-4y&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="DiarrhoeaIncidentCase.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span> <span class="o">=</span> <span class="n">pathogen</span></div>

<div class="viewcode-block" id="DiarrhoeaIncidentCase.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaIncidentCase.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rng</span>

        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># ----------------------- Determine duration for this episode ----------------------</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mean_duration_in_days_of_diarrhoea_lookup</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">]</span>
        <span class="n">half_range</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;range_in_days_duration_of_episode&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">actual_duration</span> <span class="o">=</span> <span class="n">mean_duration</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">half_range</span><span class="p">)</span>
        <span class="n">duration_in_days_of_episode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;min_days_duration_of_episode&#39;</span><span class="p">],</span> <span class="n">actual_duration</span><span class="p">))</span>

        <span class="n">date_of_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">duration_in_days_of_episode</span><span class="p">)</span>

        <span class="c1"># Collect the updated properties of this person</span>
        <span class="n">props_new</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;gi_ever_had_diarrhoea&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_duration&#39;</span><span class="p">:</span> <span class="n">duration_in_days_of_episode</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_treatment_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">:</span> <span class="s1">&#39;watery&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="p">}</span>

        <span class="c1"># ----------------------- Determine symptoms for this episode ----------------------</span>
        <span class="n">possible_symptoms_for_this_pathogen</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">prob_symptoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symptom</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">possible_symptoms_for_this_pathogen</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">symptom_string</span><span class="o">=</span><span class="n">symptom</span><span class="p">,</span>
                    <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                    <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">symptom</span> <span class="o">==</span> <span class="s1">&#39;bloody_stool&#39;</span><span class="p">:</span>
                    <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bloody&#39;</span>
                <span class="k">elif</span> <span class="n">symptom</span> <span class="o">==</span> <span class="s1">&#39;dehydration&#39;</span><span class="p">:</span>
                    <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;some&#39;</span>

        <span class="c1"># ----------------------- Determine the progress to severe dehydration for this episode ----------------------</span>
        <span class="c1"># Progress to severe dehydration may or may not happen. If it does, it occurs some number of days before</span>
        <span class="c1"># the resolution of the episode. It does not affect the risk of death or anything else in the natural history -</span>
        <span class="c1"># - it can just be considered to be a marker of the how close the individual is to the episode ending (which may</span>
        <span class="c1"># or may not result in death).</span>
        <span class="k">if</span> <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;some&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;probability_of_severe_dehydration_if_some_dehydration&#39;</span><span class="p">]:</span>
                <span class="c1"># schedule the onset of severe dehydration:</span>
                <span class="n">days</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;max_number_of_days_for_onset_of_severe_dehydration_before_end_of_episode&#39;</span><span class="p">])</span>
                <span class="n">date_of_onset_severe_dehydration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">date_of_outcome</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                    <span class="n">event</span><span class="o">=</span><span class="n">DiarrhoeaSevereDehydrationEvent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                    <span class="n">date</span><span class="o">=</span><span class="n">date_of_onset_severe_dehydration</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># ----------------------- Determine outcome (recovery or death) of this episode ----------------------</span>
        <span class="c1"># Determine if episode will result in death</span>
        <span class="n">prob_death</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">prob_death</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;watery&#39;</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_AWD&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bloody&#39;</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;case_fatality_rate_dysentery&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_duration&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_if_duration_longer_than_13_days&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;some&#39;</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_dehydration&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age12to23mo&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarr_death_age24to59mo&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;tmp_hv_inf&#39;</span><span class="p">]:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_HIV&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;tmp_malnutrition&#39;</span><span class="p">]:</span>
                <span class="n">prob_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_diarrhoea_SAM&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_death</span><span class="p">:</span>
            <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_of_outcome</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaDeathEvent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_of_outcome</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">DiarrhoeaNaturalRecoveryEvent</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>

        <span class="c1"># Record &#39;episode end&#39; data. This the date when this episode ends. It is the last possible data that any HSI</span>
        <span class="c1"># could affect this episode.</span>
        <span class="n">props_new</span><span class="p">[</span><span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_of_outcome</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">])</span>

        <span class="c1"># -------------------------------------------------------------------------------------------</span>
        <span class="c1"># Add this incident case to the tracker</span>
        <span class="n">age_group</span> <span class="o">=</span> <span class="n">DiarrhoeaIncidentCase</span><span class="o">.</span><span class="n">AGE_GROUPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span> <span class="s1">&#39;5+y&#39;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">incident_case_tracker</span><span class="p">[</span><span class="n">age_group</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="c1"># -------------------------------------------------------------------------------------------</span>

        <span class="c1"># Update the entry in the population dataframe</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">props_new</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">props_new</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaNaturalRecoveryEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #This is the Natural Recovery event. It is part of the natural history and represents the end of an episode of</span>
<span class="sd">    Diarrhoea.</span>
<span class="sd">    It does the following:</span>
<span class="sd">        * resolves all symptoms caused by diarrhoea</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaNaturalRecoveryEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaNaturalRecoveryEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the recovery is not expected for today</span>
        <span class="c1"># (Because the person has already recovered, through being cured).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_recovered_date</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span>

        <span class="c1"># Check that the person is not scheduled to die in this episode</span>
        <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_death_date</span><span class="p">)</span>

        <span class="c1"># Resolve all the symptoms immediately</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear_symptoms</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                          <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Diarrhoea&#39;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="DiarrhoeaSevereDehydrationEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaSevereDehydrationEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaSevereDehydrationEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #This is the Severe Dehydration. It is part of the natural history and represents a change in the status of the</span>
<span class="sd">    person&#39;s level of dehydration.</span>
<span class="sd">    It does the following:</span>
<span class="sd">        * changes the property &#39;gi_last_diarrhoea_dehydration&#39; to severe</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaSevereDehydrationEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaSevereDehydrationEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaSevereDehydrationEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaSevereDehydrationEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">])</span> <span class="o">&lt;=</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Do nothing if the person has recovered already (after having been cured)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Change the status:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe&#39;</span></div></div>


<div class="viewcode-block" id="DiarrhoeaDeathEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Event is for the death of someone that is caused by the infection with a pathogen that causes diarrhoea.</span>
<span class="sd">    The person dies if the &#39;diarrhoea_death_date&#39; that was set at onset of the episode is equal to the current date.</span>
<span class="sd">    (It will have been reset to pd.NaT if there has been a treatment in the intervening time).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaDeathEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaDeathEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaDeathEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_date_of_onset&#39;</span><span class="p">])</span> <span class="o">&lt;=</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_end_of_last_episode&#39;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Check if person should still die of diarrhoea:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_death_date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="c1"># Implement the death:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                <span class="n">demography</span><span class="o">.</span><span class="n">InstantaneousDeath</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                    <span class="n">person_id</span><span class="p">,</span>
                    <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;Diarrhoea_&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_pathogen&#39;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DiarrhoeaCureEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaCureEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the cure event. It is scheduled by an HSI treatment event.</span>
<span class="sd">    It enacts the actual &quot;cure&quot; of the person that is caused (after some delay) by the treatment administered.</span>
<span class="sd">    It does the following:</span>
<span class="sd">        * Sets the date of recovery to today&#39;s date</span>
<span class="sd">        * Resolves all symptoms caused by diarrhoea</span>

<span class="sd">    NB. This is the event that would be called if another module has caused the symptom of diarrhoea and care is sought.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaCureEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiarrhoeaCureEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaCureEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Confirm that this is event is occurring during a current episode of diarrhoea</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_date_of_onset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span><span class="p">):</span>
            <span class="c1"># If not, then the event has been caused by another cause of diarrhoea (which may has resolved by now)</span>
            <span class="k">return</span>

        <span class="c1"># Cure should not happen if the person has already recovered</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_recovered_date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># If cure should go ahead, check that it is after when the person has received a treatment during this episode</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_date_of_onset</span> <span class="o">&lt;=</span>
            <span class="n">person</span><span class="o">.</span><span class="n">gi_last_diarrhoea_treatment_date</span> <span class="o">&lt;=</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span>
            <span class="n">person</span><span class="o">.</span><span class="n">gi_end_of_last_episode</span>
        <span class="p">)</span>

        <span class="c1"># Stop the person from dying of Diarrhoea (if they were going to die) and record date of recovery</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_recovered_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1"># Resolve all the symptoms immediately</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gi_last_diarrhoea_dehydration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear_symptoms</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                          <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Diarrhoea&#39;</span><span class="p">])</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   LOGGING EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="DiarrhoeaLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">DiarrhoeaLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Event logs the number of incident cases that have occurred since the previous logging event.</span>
<span class="sd">    Analysis scripts expect that the frequency of this logging event is once per year.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DiarrhoeaLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="c1"># This event to occur every year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_last_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div>

<div class="viewcode-block" id="DiarrhoeaLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.DiarrhoeaLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="c1"># Convert the list of timestamps into a number of timestamps</span>
        <span class="c1"># and check that all the dates have occurred since self.date_last_run</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">incident_case_tracker_zeros</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">age_grp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">incident_case_tracker</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">:</span>
                <span class="n">list_of_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">incident_case_tracker</span><span class="p">[</span><span class="n">age_grp</span><span class="p">][</span><span class="n">pathogen</span><span class="p">]</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">age_grp</span><span class="p">][</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_times</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">list_of_times</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_last_run</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;incidence_count_by_pathogen&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">counts</span><span class="p">)</span>

        <span class="c1"># Reset the counters and the date_last_run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">incident_case_tracker</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">incident_case_tracker_blank</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_last_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   HEALTH SYSTEM INTERACTION EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanA"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanA">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Treatment_PlanA</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for uncomplicated diarrhoea administered at outpatient setting through IMCI.</span>
<span class="sd">    &quot;PLAN A&quot;: for children no dehydration</span>

<span class="sd">    NB. This will be called when a child presents with Diarrhoea that is caused by another module/Symptom Manager.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanA.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanA.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Treatment_PlanA&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanA.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanA.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide Treatment Plan A for uncomplicated Diarrhoea&#39;</span><span class="p">)</span>

        <span class="c1"># Stop the person from dying of Diarrhoea (if they were going to die)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Get consumables required</span>
        <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanA&#39;</span><span class="p">]</span>
        <span class="c1"># give the mother 2 packets of ORS</span>
        <span class="c1"># give zinc (2 mo up to 5 years) - &lt;6 mo 1/2 tablet (10mg) for 10 days, &gt;6 mo 1 tab (20mg) for 10 days</span>
        <span class="c1"># follow up in 5 days if not improving</span>
        <span class="c1"># continue feeding</span>

        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_Treatment_PlanA&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanB"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanB">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Treatment_PlanB</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for diarrhoea with some dehydration at outpatient setting through IMCI</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># some dehydration with no other severe classification - PLAN B</span>
    <span class="c1"># if child has a severe classification -</span>
    <span class="c1"># refer urgently to hospital and gic=ving ORS on the way, advise on breastfeeding</span>
    <span class="c1"># advise on follow up in 5 days</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanB.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanB.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Treatment_PlanB&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanB.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanB.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide Treatment Plan B for Diarrhoea with some non-severe dehydration&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Get consumables required</span>
        <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanB&#39;</span><span class="p">]</span>
        <span class="c1"># Give ORS for the first 4 hours and reassess. todo - this is not happening curently</span>

        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_Treatment_PlanB&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanC"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanC">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Treatment_PlanC</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for diarrhoea with severe dehydration administered at outpatient setting through IMCI</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># if child has no other severe classification: PLAN C</span>
    <span class="c1"># Or if child has another severe classification:</span>
    <span class="c1"># refer urgently to hospital with mother giving frequent ORS on the way, advise on breastfeeding</span>
    <span class="c1"># if cholera is in your area, give antibiotic for cholera</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanC.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanC.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Treatment_PlanC&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Treatment_PlanC.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Treatment_PlanC.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide Treatment Plan C for Diarrhoea with severe dehydration&#39;</span><span class="p">)</span>

        <span class="c1"># Stop the person from dying of Diarrhoea (if they were going to die)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;HSI_Diarrhoea_Treatment_PlanC&#39;</span><span class="p">]</span>

        <span class="c1"># Request the treatment</span>
        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_Treatment_PlanC&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Severe_Persistent_Diarrhoea"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Severe_Persistent_Diarrhoea">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Severe_Persistent_Diarrhoea</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for Severe_Dehydration administered at FacilityLevel=1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># treat the dehydration and refer to the hospital</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Severe_Persistent_Diarrhoea.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Severe_Persistent_Diarrhoea.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Severe_Persistent_Diarrhoea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Severe_Persistent_Diarrhoea.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Severe_Persistent_Diarrhoea.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide the treatment for Diarrhoea&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Get consumables</span>
        <span class="c1"># if bloody stool and fever in persistent diarroea - give Nalidixic Acid 50mg/kg divided in 4 doses per day for</span>
        <span class="c1"># 5 days if malnourished give cotrimoxazole 24mg/kg every 12 hours for 5 days and supplemental feeding and</span>
        <span class="c1"># supplements</span>
        <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;HSI_Diarrhoea_Severe_Persistent_Diarrhoea&#39;</span><span class="p">]</span>

        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Severe_Persistent_Diarrhoea&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for Severe_Dehydration administered at FacilityLevel=1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># give multivitamins for 14 days</span>
    <span class="c1"># give zinc for 10 days</span>
    <span class="c1"># follow up in 5 days</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Non_Severe_Persistent_Diarrhoea&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide the treatment for Diarrhoea&#39;</span><span class="p">)</span>

        <span class="n">person</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span>
                <span class="s1">&#39;HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea_Under6mo&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span>
                <span class="s1">&#39;HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea_6moPlus&#39;</span><span class="p">]</span>

        <span class="c1"># Request the treatment</span>
        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Non_Severe_Persistent_Diarrhoea&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Diarrhoea_Dysentery"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Dysentery">[docs]</a><span class="k">class</span> <span class="nc">HSI_Diarrhoea_Dysentery</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a treatment for Severe_Dehydration administered at FacilityLevel=1</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Diarrhoea_Dysentery.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Dysentery.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires one out patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Diarrhoea_Dysentery&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Diarrhoea_Dysentery.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.diarrhoea.html#tlo.methods.diarrhoea.HSI_Diarrhoea_Dysentery.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Provide the treatment for Diarrhoea&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">cons_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">consumables_used_in_hsi</span><span class="p">[</span><span class="s1">&#39;HSI_Diarrhoea_Dysentery&#39;</span><span class="p">]</span>

        <span class="c1"># Get consumables required</span>
        <span class="c1"># &lt;6 mo - 250mg 1/2 tab x2 daily for 3 days</span>
        <span class="c1"># &gt;6 mo upto 5 yo - 250mg 1 tab x2 daily for 3 days</span>
        <span class="c1"># follow up in 3 days # todo - there are not follow-up events currently</span>

        <span class="n">rtn_from_health_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_footprint</span><span class="p">)</span>
        <span class="n">cons_available</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">rtn_from_health_system</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># todo use self.get_all_consumables when this is updated in master</span>

        <span class="k">if</span> <span class="n">cons_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">prob_of_cure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_of_cure_given_HSI_Diarrhoea_Dysentery&#39;</span><span class="p">]</span>
            <span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on May 27, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>