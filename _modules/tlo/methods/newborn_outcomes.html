

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.newborn_outcomes &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.newborn_outcomes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.newborn_outcomes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">demography</span><span class="p">,</span> <span class="n">newborn_outcomes_lm</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hiv</span> <span class="kn">import</span> <span class="n">HSI_Hiv_TestAndRefer</span>
<span class="kn">from</span> <span class="nn">tlo.methods.postnatal_supervisor</span> <span class="kn">import</span> <span class="n">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="NewbornOutcomes"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes">[docs]</a><span class="k">class</span> <span class="nc">NewbornOutcomes</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module is responsible for simulating the key conditions/complications experienced by a neonate immediately</span>
<span class="sd">    following birth (either at home or in a health facility). Important predictors of newborn health also generated by</span>
<span class="sd">    this model include low birth weight and small for gestational age. Complications modelled include early-onset</span>
<span class="sd">    neonatal sepsis, neonatal encephalopathy, congenital birth anomalies, failure to breathe at birth and complications</span>
<span class="sd">    of prematurity (respiratory distress syndrome and retinopathy) The focus of this module is day 0-1 of a newborns</span>
<span class="sd">     life and any complications experienced by neonates in the later neonatal period (defined here as day 2- day 28)</span>
<span class="sd">     are managed via the PostnatalSupervisorModule. This module also manages any interventions that are delivered by</span>
<span class="sd">     skilled birth   attendants to newborns following a facility delivery (or for mothers who seek care for newborns</span>
<span class="sd">     immediately following birth) including essential newborn care, assistance with breastfeeding,</span>
<span class="sd">      case-management of sepsis, neonatal resuscitation and kangaroo mother care for low birth weight babies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NewbornOutcomes.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># This dictionary will store information related to the neonates delivery that does not need to be stored in</span>
        <span class="c1"># the main data frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># This dictionary is used to count each occurrence of an &#39;event&#39; of interest. These stored counts are used</span>
        <span class="c1"># in the LoggingEvent to calculate key outcomes (i.e. incidence rates, neonatal mortality rate etc)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;intrapartum stillbirth&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;neonatal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Retinopathy of Prematurity&#39;</span><span class="p">:</span>
            <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Neonatal Encephalopathy&#39;</span><span class="p">:</span>
            <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Neonatal Sepsis Long term Disability&#39;</span><span class="p">:</span>
            <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Preterm Birth Disability&#39;</span><span class="p">:</span>
            <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of mean birth weights from gestational age at birth 24-41 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;standard_deviation_birth_weights&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of standard deviations associated with mean birth weights from gestational age at &#39;</span>
                        <span class="s1">&#39;birth 24-41 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_disability_&lt;28wks&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence of levels of disability for neonates born at less than 28 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_disability_28_32wks&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence of levels of disability for neonates born between 28 and 32 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_disability_33_36wks&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence of levels of disability for neonates born between 33 and 36 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_congenital_ba&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of a neonate being born with a congenital anomaly&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_types_of_ca&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence of each type of congenial anomaly&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_early_onset_neonatal_sepsis_day_0&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of a neonate developing early onset sepsis between birth and 24hrs&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_disabilities&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence of levels of disability for neonates who experience early onset sepsis &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_failure_to_transition&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of a neonate developing intrapartum related complications &#39;</span>
                        <span class="s1">&#39;(previously birth asphyxia) following delivery &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_respiratory_distress_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a preterm infant will experience respiratory distress at birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_encephalopathy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline odds of a neonate developing encephalopathy of any severity following birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_enceph_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio of neonatal encephalopathy if the neonate is also septic&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_enceph_males&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for encephalopathy if the neonate is male&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_enceph_obstructed_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for encephalopathy if the mothers labour was obstructed&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_enceph_hypertension&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for encephalopathy if the mothers suffered from hypertension in pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_enceph_acute_event&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for encephalopathy if the mothers experience an acute event in labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_enceph_no_resus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability of a newborn who was not breathing at birth, and didnt receive resuscitation, &#39;</span>
                        <span class="s1">&#39;developing encephalopathy &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_enceph_severity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of the severity of encephalopathy in a newborn who is encephalopathic&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mild_enceph_disabilities&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence levels of disability for neonates with mild encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mod_enceph_disabilities&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence levels of disability for neonates with moderate encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_severe_enceph_disabilities&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of prevalence levels of disability for neonates with severe encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_retinopathy_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of a preterm neonate developing retinopathy of prematurity &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_retinopathy_severity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities of severity of retinopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_early_breastfeeding_hb&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a neonate will be breastfed within the first hour following birth when &#39;</span>
                        <span class="s1">&#39;delivered at home&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_breastfeeding_type&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman is 1.) not breastfeeding 2.) non-exclusively breastfeeding &#39;</span>
                        <span class="s1">&#39;3.)exclusively breastfeeding at birth (until 6 months)&#39;</span><span class="p">),</span>

        <span class="c1"># ===================================== TREATMENT PARAMETERS ==================================================</span>
        <span class="s1">&#39;prob_early_breastfeeding_hf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a neonate will be breastfed within the first hour following birth when &#39;</span>
                        <span class="s1">&#39;delivered at a health facility&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_inj_abx_sep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of injectable antibiotics treatment on reducing mortality from sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_supp_care_sep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of full supportive care treatment on reducing mortality from sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_cord_care&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of full supportive care treatment on reducing incidence of sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_clean_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of clean birth practices on reducing incidence of sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_early_init_bf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of early initiation of breastfeeding on reducing incidence of sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_resuscitation&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of resuscitation on newborn mortality associated with encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_resuscitation_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of delayed resuscitation on newborn mortality associated with prematurity&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_abx_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of antibiotics given to mothers experience PROM on risk of newborn sepsis &#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate due to neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_mild_enceph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate due to mild encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_moderate_enceph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate due to moderate encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_severe_enceph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate due to severe encephalopathy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_failed_to_transition&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate following failure to transition&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_preterm_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for a neonate born prematurely&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_death_early_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of preterm death in early preterm neonates &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_preterm_death_by_day&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of death due to preterm complications occuring on days 0-14&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_steroid_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of death for preterm neonates following administration of antenatal &#39;</span>
                        <span class="s1">&#39;corticosteroids&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_kmc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effect of kangaroo mother care on preterm mortality&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_congenital_anomaly&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for congenital anomalies&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_rds_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for respiratory distress syndrome of prematurity&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_care_seeking_for_complication&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability that a mother will seek care for an unwell neonate following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_neonatal_sepsis_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of neonatal sepsis in level 1 health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_neonatal_sepsis_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of neonatal sepsis in level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_ftt_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of failure to transition in level 1 health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_ftt_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of failure to transition in level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_lbw_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of low birth weight in level 1 health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_lbw_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment of low birth weight in level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_essential_newborn_care&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which essential newborn care can be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_kmc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which essential kangaroo mother care can be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_assist_with_breast_feeding&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which assistance with breastfeeding can be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_neonatal_resus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which neonatal resuscitation can be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_sepsis_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which sepsis treatment can be given&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this is part of a twin pair&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;id number of this twins sibling&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate has been born early preterm (24-33 weeks &#39;</span>
                                                 <span class="s1">&#39;gestation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate has been born late preterm (34-36 weeks &#39;</span>
                                                <span class="s1">&#39;gestation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Disability associated with preterm delivery&#39;</span><span class="p">,</span>
                                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span>
                                                       <span class="s1">&#39;severe_motor&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_congenital_anomaly&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Types of congenital anomaly of the newborn&#39;</span><span class="p">,</span>
                                          <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;musculoskeletal&#39;</span><span class="p">,</span> <span class="s1">&#39;neural_tube&#39;</span><span class="p">,</span> <span class="s1">&#39;cardiovascular&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;gastrointestinal&#39;</span><span class="p">,</span> <span class="s1">&#39;oro_facial&#39;</span><span class="p">,</span> <span class="s1">&#39;uro_genital&#39;</span><span class="p">,</span>
                                                      <span class="s1">&#39;down_syndrome&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate has developed neonatal sepsis&#39;</span>
                                                               <span class="s1">&#39; following birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_inj_abx_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;If this neonate has injectable antibiotics as treatment &#39;</span>
                                                           <span class="s1">&#39;for neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_supp_care_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;If this neonate has received full supportive care for &#39;</span>
                                                             <span class="s1">&#39;neonatal sepsis (in hospital)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_neonatal_sepsis_disab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Disability associated neonatal sepsis&#39;</span><span class="p">,</span>
                                             <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_motor&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_preterm_respiratory_distress&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this preterm newborn has respiratory &#39;</span>
                                                                <span class="s1">&#39;distress syndrome (RDS)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate has failed to transition to breathing &#39;</span>
                                                          <span class="s1">&#39;on their own following birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_received_neonatal_resus&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;If this neonate has received resuscitation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;None, mild encephalopathy, moderate encephalopathy, &#39;</span>
                                                         <span class="s1">&#39;severe encephalopathy&#39;</span><span class="p">,</span>
                                      <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_enceph&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_enceph&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_enceph&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Disability associated neonatal sepsis&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_motor&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_retinopathy_prem&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Level of visual disturbance due to retinopathy of&#39;</span>
                                                           <span class="s1">&#39; prematurity: None, mild, moderate, severe, blindness&#39;</span><span class="p">,</span>
                                        <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">,</span> <span class="s1">&#39;blindness&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;extremely low birth weight (&lt;1000g), &#39;</span>
                                                                  <span class="s1">&#39; very low birth weight (&lt;1500g), &#39;</span>
                                                                  <span class="s1">&#39;low birth weight (&lt;2500g),&#39;</span>
                                                                  <span class="s1">&#39;normal birth weight (&gt;2500g)&#39;</span><span class="p">,</span>
                                               <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;extremely_low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;very_low_birth_weight&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;normal_birth_weight&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;size for gestational age categories&#39;</span><span class="p">,</span>
                                                <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;small_for_gestational_age&#39;</span><span class="p">,</span> <span class="s1">&#39;average_for_gestational_age&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;large_for_gestational_age&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate initiated breastfeeding &#39;</span>
                                                            <span class="s1">&#39;within 1 hour of birth &#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;How this neonate is being breastfed&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_kangaroo_mother_care&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate received kangaroo mother care following &#39;</span>
                                                        <span class="s1">&#39;birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_clean_birth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate received clean birth practices at delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_received_cord_care&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this neonate received chlorhexidine cord care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this child has died following complications after birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_death_after_birth_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date on which the child died after birth&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="NewbornOutcomes.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>

        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_NewbornOutcomes.xlsx&#39;</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Here we map &#39;disability&#39; parameters to associated DALY weights to be passed to the health burden module</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_daly_weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;mild_motor_cognitive_preterm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">357</span><span class="p">),</span>
                <span class="s1">&#39;mild_motor_preterm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">371</span><span class="p">),</span>
                <span class="s1">&#39;moderate_motor_preterm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">378</span><span class="p">),</span>
                <span class="s1">&#39;severe_motor_preterm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">383</span><span class="p">),</span>
                <span class="c1"># n.b. DALY weight for prematurity are separated by disability and gestation (&lt;28wks, 28-32wks etc) but</span>
                <span class="c1"># the weight doesnt differ by gestation, only severity- so has been condensed here</span>

                <span class="s1">&#39;mild_vision_rptb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">404</span><span class="p">),</span>
                <span class="s1">&#39;moderate_vision_rptb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">405</span><span class="p">),</span>
                <span class="s1">&#39;severe_vision_rptb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">402</span><span class="p">),</span>
                <span class="s1">&#39;blindness_rptb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">386</span><span class="p">),</span>

                <span class="s1">&#39;mild_motor_cognitive_enceph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">419</span><span class="p">),</span>
                <span class="s1">&#39;mild_motor_enceph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">416</span><span class="p">),</span>
                <span class="s1">&#39;moderate_motor_enceph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">411</span><span class="p">),</span>
                <span class="s1">&#39;severe_motor_enceph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">410</span><span class="p">),</span>

                <span class="s1">&#39;mild_motor_sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">431</span><span class="p">),</span>
                <span class="s1">&#39;moderate_motor_sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">438</span><span class="p">),</span>
                <span class="s1">&#39;severe_motor_sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">435</span><span class="p">),</span>
                <span class="s1">&#39;mild_motor_cognitive_sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">441</span><span class="p">)}</span></div>

<div class="viewcode-block" id="NewbornOutcomes.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_congenital_anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_inj_abx_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_supp_care_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_respiratory_distress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_received_neonatal_resus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_retinopathy_prem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_kangaroo_mother_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_clean_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_received_cord_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="NewbornOutcomes.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># Register logging event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">NewbornOutcomesLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Set the values of the complication tracker used by the logging event (and described above)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;early_init_bf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;early_onset_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mild_enceph&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;mild_enceph_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;moderate_enceph&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;moderate_enceph_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;severe_enceph&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;severe_enceph_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;preterm_rds&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;respiratory_distress_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;congenital_anomaly_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;not_breathing_at_birth_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;preterm_birth_other_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;t_e_d&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;resus&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sep_treatment&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vit_k&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># =======================Register dx_tests for complications during labour/postpartum=======================</span>
        <span class="c1"># As with the labour module these dx_tests represent a probability that one of the following clinical outcomes</span>
        <span class="c1"># will be detected by the health care worker and treatment will be initiated</span>

        <span class="c1"># The sensitivity parameter varies by facility type, with &#39;hc&#39; meaning health centre and &#39;hp&#39; meaning hospital</span>

        <span class="n">dx_manager</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span>

        <span class="c1"># Neonatal sepsis...</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_neonatal_sepsis_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">,</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_neonatal_sepsis_hc&#39;</span><span class="p">]))</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_neonatal_sepsis_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">,</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_neonatal_sepsis_hp&#39;</span><span class="p">]))</span>

        <span class="c1"># Not breathing at birth ...</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_not_breathing_at_birth_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">,</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_ftt_hc&#39;</span><span class="p">]))</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_not_breathing_at_birth_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">,</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_ftt_hp&#39;</span><span class="p">]))</span>

        <span class="c1"># Low birth weight...</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_low_birth_weight_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;extremely_low_birth_weight&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;very_low_birth_weight&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">],</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_lbw_hc&#39;</span><span class="p">])),</span>
        <span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span><span class="n">assess_low_birth_weight_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
            <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;extremely_low_birth_weight&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;very_low_birth_weight&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">],</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_lbw_hp&#39;</span><span class="p">]))</span>

        <span class="c1"># ======================================= LINEAR MODEL EQUATIONS ==============================================</span>
        <span class="c1"># All linear equations used in this module are stored within the nb_newborn_equations</span>
        <span class="c1"># parameter below</span>

        <span class="c1"># TODO: process of &#39;selection&#39; of important predictors in linear equations is ongoing, a linear model that</span>
        <span class="c1">#  is empty of predictors at the end of this process will be converted to a set probability</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation is used to determine a newborns risk of early onset neonatal sepsis. Risk of early onset</span>
            <span class="c1"># sepsis is mitigated by a number of interventions</span>
            <span class="s1">&#39;early_onset_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_early_onset_neonatal_sepsis</span><span class="p">,</span>
                                                              <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a newborns risk of encephalopathy</span>
            <span class="s1">&#39;encephalopathy&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_encephalopathy</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a preterm newborns risk of respiratory distress syndrome</span>
            <span class="c1"># (secondary to incomplete lung development)</span>
            <span class="s1">&#39;rds_preterm&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_rds_preterm</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a newborns risk of not breathing after delivery,</span>
            <span class="c1"># triggering resuscitation</span>
            <span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_not_breathing_at_birth</span><span class="p">,</span>
                                                         <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a premature newborns risk of retinopathy</span>
            <span class="s1">&#39;retinopathy&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_retinopathy</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine the probability that a the mother of a newborn, who has been delivered</span>
            <span class="c1"># at home, will seek care in the event that a newborn experiences complications after birth</span>
            <span class="s1">&#39;care_seeking_for_complication&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_care_seeking_for_complication</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a preterm newborns risk of death due to &#39;complications of prematurity&#39;</span>
            <span class="c1">#  not explicitly modelled here (therefore excluding sepsis, encephalopathy and RDS)</span>
            <span class="s1">&#39;preterm_birth_other_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_preterm_birth_other_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a the risk of death for a newborn who doesnt breathe at birth.</span>
            <span class="s1">&#39;not_breathing_at_birth_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_not_breathing_at_birth_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># Theses equations are used to determine the risk of death for encephalopathic newborns.</span>
            <span class="s1">&#39;mild_enceph_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_mild_enceph_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>
            <span class="s1">&#39;moderate_enceph_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_moderate_enceph_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>
            <span class="s1">&#39;severe_enceph_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_severe_enceph_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a newborns risk of death from sepsis</span>
            <span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_neonatal_sepsis_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a newborns risk of death due to congenital anomaly. It will need to be</span>
            <span class="c1"># amended to ensure only potentially fatal anomalies lead to death</span>
            <span class="s1">&#39;congenital_anomaly_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_congenital_anomaly_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a preterm newborns risk of death due to respiratory distress syndrome</span>
            <span class="s1">&#39;respiratory_distress_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">newborn_outcomes_lm</span><span class="o">.</span><span class="n">predict_respiratory_distress_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)}</span>

        <span class="c1"># Finally we add this warning note to document that HIV testing will not occur if the correct module isnt</span>
        <span class="c1"># registered</span>
        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HIV module is not registered in this simulation run and therefore HIV &#39;</span>
                                               <span class="s1">&#39;testing will not happen in newborn care&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.eval"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function compares the result of a specific linear equation with a random draw providing</span>
<span class="sd">        a boolean for the outcome under examination. For equations that require external variables,</span>
<span class="sd">        they are also defined here</span>
<span class="sd">        :param eq: The linear model equation being evaluated</span>
<span class="sd">        :param person_id: person_id</span>
<span class="sd">        :return: BOOL outcome</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">]]</span>

        <span class="c1"># Here we define all the possible external variables used in the linear model</span>
        <span class="n">steroid_status</span> <span class="o">=</span> <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">]</span>
        <span class="n">abx_for_prom</span> <span class="o">=</span> <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span>

        <span class="c1"># We return a BOOLEAN</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">person</span><span class="p">,</span>
                                                           <span class="n">received_corticosteroids</span><span class="o">=</span><span class="n">steroid_status</span><span class="p">,</span>
                                                           <span class="n">received_abx_for_prom</span><span class="o">=</span><span class="n">abx_for_prom</span>
                                                           <span class="p">)[</span><span class="n">person_id</span><span class="p">]</span></div>

    <span class="c1"># ========================================= OUTCOME FUNCTIONS  ===================================================</span>
    <span class="c1"># These functions are called within the on_birth function or</span>
    <span class="c1"># HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant depending on location of delivery. Generally they</span>
    <span class="c1"># output an individuals probability of an outcome (complication, disability, death) and make the relevant changes</span>
    <span class="c1"># to the data frame</span>

<div class="viewcode-block" id="NewbornOutcomes.set_birth_weight"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.set_birth_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_birth_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">,</span> <span class="n">gestation_at_birth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function generates a birth weight for each newborn, drawn randomly from a normal</span>
<span class="sd">        distribution around a mean birth weight for each gestational age in weeks. Babies below the</span>
<span class="sd">        10th percentile for their gestational age are classified as small for gestational age. Other cut offs for birth</span>
<span class="sd">        weight status are evident from the code below</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        :param gestation_at_birth: The gestational age, in weeks, of this newborn at birth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Mean birth weights for each gestational age are listed in a parameter starting at 24 weeks</span>
        <span class="c1"># We select the correct mean birth weight from the parameter</span>
        <span class="k">if</span> <span class="n">gestation_at_birth</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">mean_birth_weight_list_location</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mean_birth_weight_list_location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="n">gestation_at_birth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">24</span><span class="p">)</span>

        <span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;standard_deviation_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">]</span>

        <span class="c1"># We randomly draw this newborns weight from a normal distribution around the mean for their gestation</span>
        <span class="n">birth_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span>
                                       <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

        <span class="c1"># Then we calculate the 10th and 90th percentile, these are the case definition for &#39;small for gestational age&#39;</span>
        <span class="c1"># and &#39;large for gestational age&#39;</span>
        <span class="n">small_for_gestational_age_cutoff</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
            <span class="mf">0.1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

        <span class="n">large_for_gestational_age_cutoff</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
            <span class="mf">0.9</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

        <span class="c1"># Make the appropriate changes to the data frame</span>
        <span class="k">if</span> <span class="n">birth_weight</span> <span class="o">&gt;=</span> <span class="mi">2500</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born normal birth weight&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="mi">1500</span> <span class="o">&lt;=</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">2500</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;low_birth_weight&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born low birth weight&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="mi">1000</span> <span class="o">&lt;=</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;very_low_birth_weight&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born very low birth weight&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;extremely_low_birth_weight&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born extremely low birth weight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="n">small_for_gestational_age_cutoff</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;small_for_gestational_age&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born small for gestational age&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">birth_weight</span> <span class="o">&gt;</span> <span class="n">large_for_gestational_age_cutoff</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;large_for_gestational_age&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born large for gestational age&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has been born average for gestational age&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.apply_risk_of_neonatal_infection_and_sepsis"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.apply_risk_of_neonatal_infection_and_sepsis">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_neonatal_infection_and_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function uses the linear model to determines if a neonate will develop early onset neonatal sepsis.</span>
<span class="sd">        It is called during the on_birth function or during HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span>
<span class="sd">        dependent on delivery setting.</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># The linear model calculates the individuals probability of early_onset_neonatal_sepsis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;early_onset_neonatal_sepsis&#39;</span><span class="p">],</span> <span class="n">child_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;early_onset_sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has developed early onset sepsis following delivery&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.apply_risk_of_encephalopathy"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.apply_risk_of_encephalopathy">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">,</span> <span class="n">timing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines if a neonate will develop neonatal encephalopathy on birth or after birth</span>
<span class="sd">        (if they were not breathing), at what severity, and makes the appropriate changes to the data frame.</span>
<span class="sd">         It is called during the on_birth function or  during HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span>
<span class="sd">         dependent on delivery setting.</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        :param timing: on_birth or after_birth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># We use a linear model equation to determine risk of encephalopathy on birth</span>
        <span class="k">if</span> <span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;on_birth&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;encephalopathy&#39;</span><span class="p">],</span> <span class="n">child_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Or, if we are applying risk to a non-encephalopathic newborn who was not breathing at birth</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_enceph_no_resus&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># For a newborn who is encephalopathic we then set the severity using a weighted probability derived from</span>
            <span class="c1"># the prevalence of severity of encephalopathy in the encephalopathic population</span>
            <span class="n">severity_enceph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_enceph_severity&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">severity_enceph</span> <span class="o">==</span> <span class="s1">&#39;mild&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild_enceph&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;mild_enceph&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">severity_enceph</span> <span class="o">==</span> <span class="s1">&#39;moderate&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;moderate_enceph&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;moderate_enceph&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_enceph&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;severe_enceph&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Check all encephalopathy cases receive a grade</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="NewbornOutcomes.apply_risk_of_preterm_respiratory_distress_syndrome"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.apply_risk_of_preterm_respiratory_distress_syndrome">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_preterm_respiratory_distress_syndrome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function uses the linear model to determine if a preterm neonate will develop respiratory distress</span>
<span class="sd">        syndrome. It is called during the on_birth function or during</span>
<span class="sd">        HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span>
<span class="sd">        dependent on delivery setting.</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span>

        <span class="c1"># Ensure only preterm infants have risk of RDS applied</span>
        <span class="k">assert</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_early_preterm</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_late_preterm</span>

        <span class="c1"># Use the linear model to calculate individual risk and make changes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;rds_preterm&#39;</span><span class="p">],</span> <span class="n">child_id</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_respiratory_distress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;preterm_rds&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> who was delivered preterm is experiencing &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;respiratory distress syndrome &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.apply_risk_of_not_breathing_at_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.apply_risk_of_not_breathing_at_birth">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_not_breathing_at_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function uses the linear model to determines if a neonate will not sufficiently initiate breathing at birth</span>
<span class="sd">         and makes the appropriate changes to the data frame. It is called during the on_birth function or</span>
<span class="sd">        during HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant dependent on delivery setting.</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># We assume all newborns with encephalopathy and respiratory distress syndrome will require some form of</span>
        <span class="c1"># resuscitation and will not be effectively breathing at birth</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_respiratory_distress&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> is not breathing following delivery&#39;</span><span class="p">)</span>

        <span class="c1"># Otherwise we use the linear model to calculate risk of inadequate breathing due to other causes not</span>
        <span class="c1"># explicitly modelled</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">],</span> <span class="n">child_id</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> is not breathing following delivery&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.apply_risk_of_death_from_complication"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.apply_risk_of_death_from_complication">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function  is called for neonates that have experienced a complication after birth and</span>
<span class="sd">        determines if this complication will cause their death. Properties in the data frame are set</span>
<span class="sd">        accordingly, and the result of the equation is tracked. It is called during the on_birth function or during</span>
<span class="sd">        HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant dependent on delivery setting.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param complication: complication that has put this newborn at risk of death. This complication has an</span>
<span class="sd">        associated linear model equation determining risk of death</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">):</span>

            <span class="c1"># If this newborn will die due to this complication we do not immediately schedule the</span>
            <span class="c1"># InstantaneousDeathEvent in this function as newborns with multiple complications may &#39;die&#39; from more than</span>
            <span class="c1"># one complication (hence using this property)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># The death is counted by the tracker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># And we store this &#39;cause&#39; of death in the nci dictionary</span>
            <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;cause_of_death_after_birth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">complication</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is NewbornOutcomes scheduling a death for person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;on who died due to </span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1"> complications following birth&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.set_death_and_disability_status"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.set_death_and_disability_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_death_and_disability_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function cycles through each complication of which a newborn may die, if the newborn has experienced this</span>
<span class="sd">        complication it calls the apply_risk_of_death_from_complication function which uses the linear model to</span>
<span class="sd">        determine individual risk of death from the relevant complication. If the newborn &#39;dies&#39; due to one or more</span>
<span class="sd">        complication then the InstantaneousDeathEvent is scheduled. For surviving newborns, probability of disability</span>
<span class="sd">        associated with complications is applied and PostnatalWeekOneEvent is scheduled. It is called during the</span>
<span class="sd">        on_birth function or during HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant dependent on delivery</span>
<span class="sd">        setting.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Using the set_neonatal_death_status function, defined above, it is determined if newborns who have experienced</span>
        <span class="c1"># complications will die because of them.</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_early_onset_neonatal_sepsis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;neonatal_sepsis&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;mild_enceph&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;mild_enceph&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;moderate_enceph&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;moderate_enceph&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;severe_enceph&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;severe_enceph&#39;</span><span class="p">)</span>

        <span class="c1"># As well as being at risk of death from sepsis or encephalopathy, preterm neonates are at risk of death from</span>
        <span class="c1"># respiratory distress syndrome and &#39;other&#39; non-modelled causes</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_early_preterm</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_late_preterm</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_preterm_respiratory_distress</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;respiratory_distress&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;preterm_birth_other&#39;</span><span class="p">)</span>

        <span class="c1"># Death due to breathing difficulties is implicitly captured in the CFR for encephalopathy and pretmaturity/RDS,</span>
        <span class="c1"># therefore only neonates without those complications face a separate CFR for &#39;not breathing at birth&#39;</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_not_breathing_at_birth</span> <span class="ow">and</span> \
            <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">nb_preterm_respiratory_distress</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_congenital_anomaly</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_death_from_complication</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;congenital_anomaly&#39;</span><span class="p">)</span>

        <span class="c1"># If a newborn has died, the death is scheduled and tracked</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;cause_of_death_after_birth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;preterm_birth_other&#39;</span><span class="p">:</span>
                <span class="c1"># If the death is associated with prematurity we scatter those deaths across the first 2 weeks</span>
                <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                                              <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_preterm_death_by_day&#39;</span><span class="p">])</span>
                <span class="n">death_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_draw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">death_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">demography</span><span class="o">.</span><span class="n">InstantaneousDeath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                  <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;neonatal&#39;</span><span class="p">),</span> <span class="n">death_date</span><span class="p">)</span>

        <span class="c1"># If the newborn has survived and did not develop any complications during this period, they do not accrue any</span>
        <span class="c1"># DALYs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">nb_early_preterm</span> <span class="ow">and</span> <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">nb_late_preterm</span> <span class="ow">and</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> \
              <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">nb_early_onset_neonatal_sepsis</span> <span class="ow">and</span> <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">nb_not_breathing_at_birth</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has not accrued any DALYs following &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Otherwise, we now will calculate the newborns disability</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Child </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will have now their DALYs calculated following complications&#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;after birth&#39;</span><span class="p">)</span>

                <span class="c1"># DALY weights for each newborn condition can be categorised as follows</span>
                <span class="n">disability_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span>  <span class="c1"># Mild motor plus cognitive impairments due to...</span>
                                         <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span>  <span class="c1"># Mild motor impairment due to...</span>
                                         <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span>  <span class="c1"># Moderate motor impairment due to...</span>
                                         <span class="s1">&#39;severe_motor&#39;</span><span class="p">]</span>  <span class="c1"># Severe motor impairment due to...</span>

                <span class="c1"># We use a probability weighted random choice to determine which disability &#39;category&#39; each newborn</span>
                <span class="c1"># will develop due to their complication - probability of more severe disability will correspond with</span>
                <span class="c1"># more &#39;severe&#39; conditions (i.e. very early preterm, severe encephalopathy)</span>

                <span class="c1"># Probability of preterm neonates developing long-lasting disability is organised by gestational age</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span>
                <span class="k">if</span> <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;ga_at_birth&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                            <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_disability_&lt;28wks&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="mi">27</span> <span class="o">&lt;=</span> <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;ga_at_birth&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                            <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_disability_28_32wks&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="mi">33</span> <span class="o">&lt;=</span> <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;ga_at_birth&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                            <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_disability_33_36wks&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_early_onset_neonatal_sepsis</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                              <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_sepsis_disabilities&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;mild_enceph&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                             <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mild_enceph_disabilities&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;moderate_enceph&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                             <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mod_enceph_disabilities&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_encephalopathy</span> <span class="o">==</span> <span class="s1">&#39;severe_enceph&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                             <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span>
                                                                                 <span class="s1">&#39;prob_severe_enceph_disabilities&#39;</span><span class="p">])</span>

                <span class="c1"># TODO: congenital anomaly disability</span>

        <span class="c1"># We now delete the MNI dictionary for mothers who have died in labour but their children have survived, this</span>
        <span class="c1"># is done here as we use variables from the mni as predictors in some of the above equations</span>
        <span class="n">mother_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;mother_id&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                                              <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">mother_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]</span>

        <span class="k">del</span> <span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span></div>

    <span class="c1"># ======================================== HSI INTERVENTION FUNCTIONS =============================================</span>
    <span class="c1"># These functions are called by HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant and broadly represent</span>
    <span class="c1"># interventions/packages of interventions to manage the main complications in the module</span>

<div class="viewcode-block" id="NewbornOutcomes.essential_newborn_care"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.essential_newborn_care">[docs]</a>    <span class="k">def</span> <span class="nf">essential_newborn_care</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains interventions delivered as part of &#39;essential newborn care&#39;. These include clean birth</span>
<span class="sd">        practices, cord care, vitamin k and eye care</span>
<span class="sd">        :param hsi_event:  The HSI event in which this function is called</span>
<span class="sd">        (HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="c1"># -------------------------------------- CHLORHEXIDINE CORD CARE ----------------------------------------------</span>
        <span class="c1"># Next we determine if cord care with chlorhexidine is applied (consumables are counted during labour)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_received_cord_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ---------------------------------- VITAMIN D AND EYE CARE -----------------------------------------------</span>
        <span class="c1"># We define the consumables</span>
        <span class="n">item_code_tetracycline</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tetracycline eye ointment 1%_3.5_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_vit_k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vitamin K1  (phytomenadione) 1 mg/ml, 1 ml, inj._100_IDA&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_vit_k_syringe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe,  disposable 2ml,  hypoluer with 23g needle_each_&#39;</span>
                                                    <span class="s1">&#39;CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">consumables_vit_k_and_eye_care</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_tetracycline</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_vit_k</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_vit_k_syringe</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span> <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_vit_k_and_eye_care</span><span class="p">)</span>

        <span class="c1"># If they are available the intervention is delivered, there is limited evidence of the effect of these</span>
        <span class="c1"># interventions so currently we are just mapping the consumables</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_tetracycline</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received tetracycline eye drops following a &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;facility delivery&#39;</span><span class="p">)</span>

            <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;tetra_eye_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;t_e_d&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This facility has no tetracycline and therefore was not given&#39;</span><span class="p">)</span>

        <span class="c1"># This process is repeated for vitamin K</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_vit_k</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_vit_k_syringe</span><span class="p">]):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received vitamin k prophylaxis following&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; a facility delivery&#39;</span><span class="p">)</span>

            <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;vit_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;vit_k&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This facility has no vitamin K and therefore was not given&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.breast_feeding"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.breast_feeding">[docs]</a>    <span class="k">def</span> <span class="nf">breast_feeding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">birth_setting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is used to set breastfeeding status for newborns. It schedules the BreastfeedingStatusUpdateEvent</span>
<span class="sd">        for breastfed newborns. It is called during the</span>
<span class="sd">        on_birth function or during HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant dependent on delivery</span>
<span class="sd">        setting.</span>
<span class="sd">        :param person_id: person_id</span>
<span class="sd">        :param birth_setting: hf (health facility) or hb (home birth)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">mother_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;mother_id&#39;</span><span class="p">]</span>

        <span class="c1"># We determine breastfeeding for non-twins or first born twins (second born twins will match first born for</span>
        <span class="c1"># breastfeeding type)</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                               <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>

            <span class="c1"># First we determine the &#39;type&#39; of breastfeeding this newborn will receive</span>
            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_breastfeeding_type&#39;</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>
            <span class="c1"># Log that information for debugging</span>
            <span class="k">if</span> <span class="n">random_draw</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will not be breastfed&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be </span><span class="si">{</span><span class="n">random_draw</span><span class="si">}</span><span class="s1">ly breastfed up to 6 &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;months&#39;</span><span class="p">)</span>

            <span class="c1"># For newborns that are breastfed, we apply a probability that breastfeeding was initiated within one hour.</span>
            <span class="c1"># This varies between home births and facility deliveries</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_early_breastfeeding_</span><span class="si">{</span><span class="n">birth_setting</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;early_init_bf&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has started breastfeeding within 1 hour of &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;birth&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not start breastfeeding within 1 hour &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;of birth&#39;</span><span class="p">)</span>
            <span class="c1"># We store the breastfeeding information of the first twin in a twin pair to ensure twins have the same</span>
            <span class="c1"># breastfeeding status</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;bf_status_twin_one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;eibf_status_twin_one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">]</span>

        <span class="c1"># Here we set the breastfeeding status of any second born twins</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;bf_status_twin_one&#39;</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;eibf_status_twin_one&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="c1"># For breastfed neonates we schedule a future event where breastfeeding status is updated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">BreastfeedingStatusUpdateEventSixMonths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span></div>

<div class="viewcode-block" id="NewbornOutcomes.kangaroo_mother_care"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.kangaroo_mother_care">[docs]</a>    <span class="k">def</span> <span class="nf">kangaroo_mother_care</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages the diagnosis and treatment of low birth weight neonates who have</span>
<span class="sd">        delivered in a facility. It is called by the HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.</span>
<span class="sd">        The intervention delivered is Kangaroo Mother Care (KMC) which includes skin-to-skin nursing and encouragement</span>
<span class="sd">        of frequent and exclusive breastfeeding</span>
<span class="sd">        :param hsi_event: The HSI event in which this function is called</span>
<span class="sd">        (HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant)</span>
<span class="sd">        :param facility_type: health centre (hc) or hospital (hp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># We use the dx_manager to determine if a newborn who is low birth weight is correctly identified and treated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_low_birth_weight_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

            <span class="c1"># Store treatment as a property of the newborn used to apply treatment effect</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_kangaroo_mother_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># todo: should have longer inpatient stays (there are specific KMC beds)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been correctly identified as being low birth &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;weight, and kangaroo mother care has been initiated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.immunisations"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.immunisations">[docs]</a>    <span class="k">def</span> <span class="nf">immunisations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a placeholder. Will house/call immunisation events for newborns</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="NewbornOutcomes.hiv_screening_for_at_risk_newborns"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.hiv_screening_for_at_risk_newborns">[docs]</a>    <span class="k">def</span> <span class="nf">hiv_screening_for_at_risk_newborns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function schedules immediate HIV screening for newborns of mothers who are HIV positive. Additional</span>
<span class="sd">         treatment is managed within the HIV module</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>
        <span class="c1"># mother_id = df.at[child_id, &#39;mother_id&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;hv_diagnosed&#39;</span><span class="p">]:</span>  <span class="c1"># and df.at[mother_id, &#39;hv_diagnosed&#39;]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">HSI_Hiv_TestAndRefer</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]),</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> is receiving HIV screening after birth&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.assessment_and_initiation_of_neonatal_resus"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.assessment_and_initiation_of_neonatal_resus">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_initiation_of_neonatal_resus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages the diagnosis of failure to transition/encephalopathy and the administration of neonatal</span>
<span class="sd">        resuscitation for neonates delivered in a facility. It is called by the HSI_NewbornOutcomes_CareOfTheNewborn</span>
<span class="sd">        BySkilledAttendant.</span>
<span class="sd">        :param hsi_event: The HSI event in which this function is called</span>
<span class="sd">        (HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant)</span>
<span class="sd">        :param facility_type: health centre (hc) or hospital (hp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="c1"># Required consumables are defined</span>
        <span class="n">pkg_code_resus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                       <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Neonatal resuscitation (institutional)&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">all_available</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
            <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_resus</span><span class="p">])</span>

        <span class="c1"># Use the dx_manager to determine if staff will correctly identify this neonate will require resuscitation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
           <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_not_breathing_at_birth_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

            <span class="c1"># Then, if the consumables are available,resuscitation is started. We assume this is delayed in</span>
            <span class="c1"># deliveries that are not attended</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_received_neonatal_resus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;resus&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;after_birth&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.assessment_and_treatment_newborn_sepsis"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.assessment_and_treatment_newborn_sepsis">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_newborn_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages the treatment of early onset neonatal sepsis for neonates delivered in a facility.</span>
<span class="sd">         It is called by the</span>
<span class="sd">        HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant. Treatment for sepsis includes either injectable</span>
<span class="sd">         antibiotics or full supportive care (antibiotics, fluids, oxygen etc) and varies between facility level.</span>
<span class="sd">        :param hsi_event: The HSI event in which this function is called</span>
<span class="sd">        (HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant)</span>
<span class="sd">        :param facility_type: health centre (hc) or hospital (hp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="c1"># We assume that only hospitals are able to deliver full supportive care for neonatal sepsis, full supportive</span>
        <span class="c1"># care evokes a stronger treatment effect than injectable antibiotics alone</span>

        <span class="k">if</span> <span class="n">facility_type</span> <span class="o">==</span> <span class="s1">&#39;hp&#39;</span><span class="p">:</span>
            <span class="c1"># Define the consumables</span>
            <span class="n">pkg_code_sep</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                     <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Newborn sepsis - full supportive care&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">all_available</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_sep</span><span class="p">])</span>

            <span class="c1"># Use the dx_manager to determine if staff will correctly identify this neonate will treatment for sepsis</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                 <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_neonatal_sepsis_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># Then, if the consumables are available, treatment for sepsis is delivered</span>
                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_supp_care_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;sep_treatment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># The same pattern is then followed for health centre care</span>
        <span class="k">elif</span> <span class="n">facility_type</span> <span class="o">==</span> <span class="s1">&#39;hc&#39;</span><span class="p">:</span>
            <span class="n">item_code_iv_penicillin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Benzylpenicillin 1g (1MU), PFR_Each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_iv_gentamicin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentamicin 40mg/ml, 2ml_each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_giving_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;IV giving/infusion set, with &#39;</span>
                                                                                     <span class="s1">&#39;needle&#39;</span><span class="p">,</span>
                                                                                     <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">consumables_inj_abx_sepsis</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_iv_penicillin</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_iv_gentamicin</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="n">item_code_giving_set</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span> <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_inj_abx_sepsis</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
               <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_neonatal_sepsis_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_iv_penicillin</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_iv_gentamicin</span><span class="p">])</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_giving_set</span><span class="p">]):</span>

                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_inj_abx_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;sep_treatment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="NewbornOutcomes.hsi_cannot_run"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.hsi_cannot_run">[docs]</a>    <span class="k">def</span> <span class="nf">hsi_cannot_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines what happens to neonates if HSI_NewbornOutcomes_</span>
<span class="sd">        ReceivesSkilledAttendanceFollowingBirth cannot run with the current service configuration</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># We apply risk of complication onset and death within HSI_NewbornOutcomes_ ReceivesSkilledAttendanceFollowing</span>
        <span class="c1"># Birth for those who are born in facility (this allows risk to be modified to prophylaxis administered in</span>
        <span class="c1"># facility)</span>

        <span class="c1"># Therefore if this event cannot run we need to apply risk of complication developing, as done below</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">nci</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_preterm_respiratory_distress_syndrome</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_infection_and_sepsis</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_not_breathing_at_birth</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_death_and_disability_status</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_infection_and_sepsis</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;on_birth&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_not_breathing_at_birth</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;after_birth&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_death_and_disability_status</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.link_twins"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.link_twins">[docs]</a>    <span class="k">def</span> <span class="nf">link_twins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_one</span><span class="p">,</span> <span class="n">child_two</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function links twin pairs via sibling IDs and is called by the BirthEvent in the Labour module</span>
<span class="sd">        :param child_one: individual_id of the first born child in a twin pair</span>
<span class="sd">        :param child_two: individual_id of the second born child in a twin pair</span>
<span class="sd">        :param mother_id: individual_id of the mother of the twin pair</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_one</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_two</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_one</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># and log the twin pair</span>
        <span class="n">twin_birth</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;twin_1_id&#39;</span><span class="p">:</span> <span class="n">child_one</span><span class="p">,</span>
                      <span class="s1">&#39;twin_2_id&#39;</span><span class="p">:</span> <span class="n">child_two</span><span class="p">,</span>
                      <span class="s1">&#39;mother_id&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                      <span class="s1">&#39;date_of_delivery&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;twin_birth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">twin_birth</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A record of each birth of twin pairs&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The on_birth function of this module sets key properties of all newborns, including prematurity</span>
<span class="sd">        status and schedules functions to set weight and size. For newborns delivered at home it determines if they will</span>
<span class="sd">        experience complications following birth (early onset sepsis, encephalopathy, failure to transition) and if</span>
<span class="sd">        these complications will lead to death or disability .For newborns delivered in facility it schedules</span>
<span class="sd">        HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant which represents the care newborns should receive</span>
<span class="sd">        after being delivered in a facility.</span>
<span class="sd">        :param mother_id: mother_id</span>
<span class="sd">        :param child_id: child_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newborn_care_info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_labour</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">)</span>

        <span class="c1"># We check that the baby has survived labour and has been delivered (even if the mother did not survive)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">])</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]</span> <span class="ow">and</span>
           <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]):</span>
            <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="c1"># If the mother has lost a baby who was part of a twin pair during labour, we schedule the death here (</span>
            <span class="c1"># to monitor stillbirths)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;intrapartum stillbirth&#39;</span><span class="p">,</span>
                                                        <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">])</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_congenital_anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_inj_abx_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_supp_care_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_respiratory_distress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_received_neonatal_resus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_retinopathy_prem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_init_breastfeeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_kangaroo_mother_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_clean_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_received_cord_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span>

        <span class="c1"># &#39;Category&#39; of prematurity (early/late) is stored as a temporary property of the mother via the MNI dictionary</span>
        <span class="c1"># generated in labour (this is because some interventions delivered to the mother are based on prematurity)</span>

        <span class="c1"># We now store a newborns &#39;category of prematurity&#39; within the main data frame</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;early_preterm_labour&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;late_preterm_labour&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check no children born at term or postterm women are incorrectly categorised as preterm</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;term_labour&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;postterm_labour&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>

            <span class="c1">#  Next we populate the newborn info dictionary with relevant parameters</span>
            <span class="n">nci</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ga_at_birth&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]),</span>
                             <span class="s1">&#39;vit_k&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="s1">&#39;tetra_eye_d&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="s1">&#39;proph_abx&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;delivery_setting&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="s1">&#39;cause_of_death_after_birth&#39;</span><span class="p">:</span> <span class="p">[]}</span>

            <span class="c1"># Check these variables are not unassigned</span>
            <span class="k">assert</span> <span class="n">nci</span><span class="p">[</span><span class="n">child_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
            <span class="c1"># TODO: AT - this crashes when ga_at_birth doesnt equal 0 and I cant work out why...</span>
            <span class="c1"># assert nci[child_id][&#39;ga_at_birth&#39;] != 0</span>

            <span class="c1"># ====================================== COMPLICATIONS ====================================================</span>
            <span class="c1"># Next we determine if this child has been born with a congenital anomaly. We apply an overall risk of</span>
            <span class="c1"># congenital anomaly and then use a probability weighted draw to select the type of anomaly</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_congenital_ba&#39;</span><span class="p">]:</span>
                <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;musculoskeletal&#39;</span><span class="p">,</span> <span class="s1">&#39;neural_tube&#39;</span><span class="p">,</span> <span class="s1">&#39;cardiovascular&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;gastrointestinal&#39;</span><span class="p">,</span> <span class="s1">&#39;oro_facial&#39;</span><span class="p">,</span> <span class="s1">&#39;uro_genital&#39;</span><span class="p">,</span> <span class="s1">&#39;down_syndrome&#39;</span><span class="p">),</span>
                                              <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prev_types_of_ca&#39;</span><span class="p">])</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_congenital_anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>

            <span class="c1"># The set birth weight function is then used to determine this newborns birth weight and size for</span>
            <span class="c1"># gestational age</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_birth_weight</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">nci</span><span class="p">[</span><span class="n">child_id</span><span class="p">][</span><span class="s1">&#39;ga_at_birth&#39;</span><span class="p">])</span>

            <span class="c1"># For all preterm newborns we apply a risk of retinopathy of prematurity</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
              <span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;retinopathy&#39;</span><span class="p">],</span> <span class="n">child_id</span><span class="p">):</span>

                <span class="c1"># For newborns with retinopathy we then use a weighted random draw to determine the severity of the</span>
                <span class="c1"># retinopathy to map to DALY weights</span>
                <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">,</span> <span class="s1">&#39;blindness&#39;</span><span class="p">),</span>
                                              <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_retinopathy_severity&#39;</span><span class="p">])</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_retinopathy_prem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has developed </span><span class="si">{</span><span class="n">random_draw</span><span class="si">}</span><span class="s1"> retinopathy of &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;prematurity&#39;</span><span class="p">)</span>

            <span class="c1"># If the child&#39;s mother has delivered at home, we immediately apply the risk of complications and make</span>
            <span class="c1"># changes to the data frame. Otherwise this is done during the HSI</span>
            <span class="k">if</span> <span class="n">nci</span><span class="p">[</span><span class="n">child_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_infection_and_sepsis</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;on_birth&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_preterm_respiratory_distress_syndrome</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

                <span class="c1"># Following the application of the above complications, we determine if this newborn will or will not</span>
                <span class="c1"># breathe at birth</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_not_breathing_at_birth</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

                <span class="c1"># And we see if this newborn will start breastfeeding</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">breast_feeding</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">birth_setting</span><span class="o">=</span><span class="s1">&#39;hb&#39;</span><span class="p">)</span>  <span class="c1"># hb = home birth</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">breast_feeding</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">birth_setting</span><span class="o">=</span><span class="s1">&#39;hf&#39;</span><span class="p">)</span>  <span class="c1"># hf = &#39;health facility&#39;</span>

            <span class="c1"># Neonates who were delivered in a facility are automatically scheduled to receive care after birth at the</span>
            <span class="c1"># same level of facility that they were delivered in</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is NewbornOutcomesEvent scheduling HSI_NewbornOutcomes_&#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;ReceivesSkilledAttendanceFollowingBirth for child &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> following a facility delivery&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is NewbornOutcomesEvent scheduling &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant&#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;for child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> following a facility delivery&#39;</span><span class="p">)</span>

            <span class="c1"># ========================================== CARE SEEKING  ================================================</span>
            <span class="c1"># For newborns who have been delivered at home, but have immediately developed a complication, we apply a</span>
            <span class="c1"># probability that their mother will seek care and bring them to</span>
            <span class="c1"># HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>

                <span class="c1"># TODO: AT- this is really messy r.e. twins and care seeking (and some of the twins stuff overall)</span>
                <span class="c1">#  It would be really helpful for the twins to be linked (via sibling ids) before the birth functions</span>
                <span class="c1">#  run for both twins - probably not possible</span>

                <span class="c1"># Store if the first twin in a twin pair had complications</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_one_comps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># If, when this function ran for the firs twin in a twin pair, they experienced complications and the</span>
                <span class="c1"># mother sought care AND now the second twin has complications- we assume careseeking will happen</span>
                <span class="c1"># automatically</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_one_comps&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                        <span class="n">m</span><span class="p">[</span><span class="s1">&#39;sought_care_for_twin_one&#39;</span><span class="p">]:</span>
                    <span class="n">will_seek_care</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Similarly, if the mother didnt seek care for twin one, and twin two also has complications, she will</span>
                <span class="c1"># not seek care</span>
                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_one_comps&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                        <span class="ow">not</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;sought_care_for_twin_one&#39;</span><span class="p">]:</span>
                    <span class="n">will_seek_care</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">will_seek_care</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nb_newborn_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_for_complication&#39;</span><span class="p">],</span>
                                               <span class="n">child_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">will_seek_care</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">m</span><span class="p">[</span><span class="s1">&#39;sought_care_for_twin_one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">nci</span><span class="p">[</span><span class="n">child_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                        <span class="n">event</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is NewbornOutcomesEvent scheduling &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;FacilityLevel1 for child </span><span class="si">{</span><span class="n">child_id</span> <span class="si">}</span><span class="s1">whose mother has sought care&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;after a complication has developed following a home_birth&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="ow">and</span>\
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                                                              <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;after_birth&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                                                                    <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]):</span>

                        <span class="c1"># If care will not be sought for this newborn we immediately apply risk of death and make</span>
                        <span class="c1"># changes to the data frame accordingly</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_death_and_disability_status</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

        <span class="c1"># Finally we call the further_on_birth... functions from the other maternal health modules. They are only called</span>
        <span class="c1"># once per pregnancy (hence why conditioned on single pregnancies or first birth of a twin set)</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                                          <span class="n">m</span><span class="p">[</span><span class="s1">&#39;twin_count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_pregnancy_supervisor</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_postnatal_supervisor</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_care_of_women_in_pregnancy</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is NewbornOutcomes, being alerted about a health system interaction &#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NewbornOutcomes.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomes.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function reports the DALY weights for this module generated in the previous month</span>
<span class="sd">        :return: data frame containing the DALY weights</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is Newborn Outcomes reporting my health values&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;nb_daly_weights&#39;</span><span class="p">]</span>

        <span class="c1"># TODO: AT- currently this works as all these disabilities are life long, so mapping to the property</span>
        <span class="c1">#  (which doesnt get reset) is perfect - however, on the month that someone is born they will only need to</span>
        <span class="c1">#  accrue disability for the days theyve been alive- can we discuss</span>

        <span class="c1"># Disability properties are mapped to DALY weights and stored for the health burden module</span>
        <span class="n">health_values_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_retinopathy_prem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_vision_rptb&#39;</span><span class="p">],</span> <span class="s1">&#39;moderate&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;moderate_vision_rptb&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;severe&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;severe_vision_rptb&#39;</span><span class="p">],</span> <span class="s1">&#39;blindness&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;blindness_rptb&#39;</span><span class="p">]})</span>
        <span class="n">health_values_1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Retinopathy of Prematurity&#39;</span>
        <span class="n">health_values_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">health_values_1</span><span class="p">)</span>

        <span class="n">health_values_2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy_disab&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_enceph&#39;</span><span class="p">],</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_cognitive_enceph&#39;</span><span class="p">],</span>
             <span class="s1">&#39;moderate_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;moderate_motor_enceph&#39;</span><span class="p">],</span> <span class="s1">&#39;severe_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;severe_motor_enceph&#39;</span><span class="p">]})</span>
        <span class="n">health_values_2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Neonatal Encephalopathy&#39;</span>
        <span class="n">health_values_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">health_values_2</span><span class="p">)</span>

        <span class="n">health_values_3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_neonatal_sepsis_disab&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_sepsis&#39;</span><span class="p">],</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_cognitive_sepsis&#39;</span><span class="p">],</span>
             <span class="s1">&#39;moderate_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;moderate_motor_sepsis&#39;</span><span class="p">],</span> <span class="s1">&#39;severe_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;severe_motor_sepsis&#39;</span><span class="p">]})</span>
        <span class="n">health_values_3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Neonatal Sepsis Long term Disability&#39;</span>
        <span class="n">health_values_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">health_values_3</span><span class="p">)</span>

        <span class="n">health_values_4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_preterm_birth_disab&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;mild_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_preterm&#39;</span><span class="p">],</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mild_motor_cognitive_preterm&#39;</span><span class="p">],</span>
             <span class="s1">&#39;moderate_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;moderate_motor_preterm&#39;</span><span class="p">],</span> <span class="s1">&#39;severe_motor&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;severe_motor_preterm&#39;</span><span class="p">]})</span>
        <span class="n">health_values_4</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Preterm Birth Disability&#39;</span>
        <span class="n">health_values_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">health_values_4</span><span class="p">)</span>

        <span class="n">health_values_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">health_values_1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">],</span> <span class="n">health_values_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">],</span>
                                     <span class="n">health_values_3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">],</span> <span class="n">health_values_4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">scaling_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">health_values_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span>
                          <span class="n">health_values_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="n">health_values_df</span> <span class="o">=</span> <span class="n">health_values_df</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scaling_factor</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">health_values_df</span></div></div>


<div class="viewcode-block" id="HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant">[docs]</a><span class="k">class</span> <span class="nc">HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant. This event is scheduled by</span>
<span class="sd">    the on_birth function of this module, automatically for neonates who delivered in facility and via a care seeking</span>
<span class="sd">    equation for those delivered at home. This event represents the care newborns should receive immediately following</span>
<span class="sd">    their delivery in a facility with a skilled birth attendant. This event also</span>
<span class="sd">    houses assessment and treatment of complications following delivery (sepsis and failure</span>
<span class="sd">    to transition). Eventually it will scheduled additional treatment for those who need it.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">NewbornOutcomes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;NewbornOutcomes_CareOfTheNewbornBySkilledAttendant&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">nci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_care_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant:&#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39; child </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> is receiving care following delivery in a health facility&#39;</span><span class="p">)</span>

        <span class="c1"># We create a variable representing where this newborn is being care for, used when calling functions</span>
        <span class="k">if</span> <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hc&#39;</span>
        <span class="k">elif</span> <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hp&#39;</span>

        <span class="c1"># For home births we try and map the facility level to a facility type</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hp&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">facility_type_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;hc&#39;</span><span class="p">,</span> <span class="s1">&#39;hp&#39;</span><span class="p">])</span>

        <span class="c1"># ========================  PREVENTATIVE INTERVENTIONS DELIVERED AT/NEAR BIRTH ===============================</span>
        <span class="c1"># First we determine if this newborn will receive preventative interventions delivered as part of skilled birth</span>
        <span class="c1"># attendance</span>

        <span class="c1"># The effect of clean birth practices are stored as a property of the newborn as they reduce risk of sepsis into</span>
        <span class="c1"># the postnatal period</span>
        <span class="k">if</span> <span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_clean_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># As with labour we use a squeeze factor threshold to determine if events will run</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_essential_newborn_care&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">essential_newborn_care</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_kmc&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">kangaroo_mother_care</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="c1"># =================================  COMPLICATION RISKS ======================================================</span>
        <span class="c1"># Next we determine which, if any, complications this newborn will experience immediately following, or very</span>
        <span class="c1"># soon after birth</span>

        <span class="k">if</span> <span class="o">~</span><span class="n">nci</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_infection_and_sepsis</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;on_birth&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_preterm_respiratory_distress_syndrome</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_not_breathing_at_birth</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># =================================  CURATIVE INTERVENTIONS ===================================================</span>
        <span class="c1"># This function manages initiation of neonatal resuscitation</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_neonatal_resus&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_initiation_of_neonatal_resus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_encephalopathy</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;after_birth&#39;</span><span class="p">)</span>

        <span class="c1"># This function manages the assessment and treatment of neonatal sepsis, and follows the same structure as</span>
        <span class="c1"># resuscitation</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_sepsis_treatment&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_newborn_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="c1"># =======================================  RISK OF DEATH ======================================================</span>
        <span class="c1"># For newborns that have experience any complications following delivery in a facility we now determine if</span>
        <span class="c1"># they will die following treatment</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_not_breathing_at_birth&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_death_and_disability_status</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_death_after_birth&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">immunisations</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hiv_screening_for_at_risk_newborns</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="c1"># Surviving neonates with complications on day 1 are admitted to the inpatient event which lives in the</span>
            <span class="c1"># Postnatal Supervisor module</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_onset_neonatal_sepsis&#39;</span><span class="p">]</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_encephalopathy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> \
               <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]:</span>

                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive care after birth as the squeeze factor &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;was too high&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hsi_cannot_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.HSI_NewbornOutcomes_CareOfTheNewbornBySkilledAttendant.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive care after birth as this HSI is not &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;allowed in current configuration&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hsi_cannot_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="BreastfeedingStatusUpdateEventSixMonths"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventSixMonths">[docs]</a><span class="k">class</span> <span class="nc">BreastfeedingStatusUpdateEventSixMonths</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is BreastfeedingStatusUpdateEventSixMonths. It is scheduled via the breastfeeding function.</span>
<span class="sd">    Children who are alive and still breastfeeding by six months have their breastfeeding status updated. Those who will</span>
<span class="sd">    continue to breastfeed are scheduled BreastfeedingStatusUpdateEventTwoYears</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BreastfeedingStatusUpdateEventSixMonths.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventSixMonths.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="BreastfeedingStatusUpdateEventSixMonths.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventSixMonths.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># For infants who are exclusively breastfeeding at 6 months, we determine if they will change to non-exclusive</span>
        <span class="c1"># feeding or no breastfeeding</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_breastfeeding_status</span> <span class="o">==</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">:</span>
            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>

        <span class="c1"># Similarly, for infants who are non-exclusively breastfeeding at 6 months we determine if they will continue</span>
        <span class="c1"># non-exclusively breastfeeding or stop breastfeeding all together</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_breastfeeding_status</span> <span class="o">==</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">:</span>
            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_draw</span>

        <span class="c1"># We then schedule these breastfed newborns to return at 2 years to update breastfeeding status again</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_breastfeeding_status</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">BreastfeedingStatusUpdateEventTwoYears</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">18</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="BreastfeedingStatusUpdateEventTwoYears"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventTwoYears">[docs]</a><span class="k">class</span> <span class="nc">BreastfeedingStatusUpdateEventTwoYears</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is BreastfeedingStatusUpdateEventTwoYears. It is scheduled via the breastfeeding function.</span>
<span class="sd">    Children who are alive and still breastfeeding by two years months have their breastfeeding status updated.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BreastfeedingStatusUpdateEventTwoYears.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventTwoYears.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="BreastfeedingStatusUpdateEventTwoYears.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.BreastfeedingStatusUpdateEventTwoYears.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div></div>


<div class="viewcode-block" id="NewbornOutcomesLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomesLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">NewbornOutcomesLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is NewbornOutcomesLoggingEvent. The event runs every year and calculates yearly</span>
<span class="sd">    incidence of key outcomes following birth, and logs them in a dataframe to be used by analysis</span>
<span class="sd">    files &quot;&quot;&quot;</span>
<div class="viewcode-block" id="NewbornOutcomesLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomesLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>

<div class="viewcode-block" id="NewbornOutcomesLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.newborn_outcomes.html#tlo.methods.newborn_outcomes.NewbornOutcomesLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Previous Year...</span>
        <span class="n">one_year_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="n">newborn_deaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">nb_death_after_birth</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nb_death_after_birth_date</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span>
                                      <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nb_death_after_birth_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="n">early_preterm_births</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">nb_early_preterm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span>
                                            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="n">late_preterm_births</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">nb_late_preterm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span>
                                           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="n">total_preterm_births</span> <span class="o">=</span> <span class="n">early_preterm_births</span> <span class="o">+</span> <span class="n">late_preterm_births</span>

        <span class="n">low_birth_weight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">nb_low_birth_weight_status</span> <span class="o">!=</span> <span class="s1">&#39;normal_birth_weight&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span>
                                                                                                    <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span>
                                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="n">small_for_gestational_age</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">nb_size_for_gestational_age</span> <span class="o">==</span> <span class="s1">&#39;small_for_gestational_age&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span>
                                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">newborn_deaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newborn_deaths</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">total_births_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># yearly number of complications</span>
        <span class="n">sepsis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;early_onset_sepsis&#39;</span><span class="p">]</span>
        <span class="n">mild_enceph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;mild_enceph&#39;</span><span class="p">]</span>
        <span class="n">mod_enceph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;moderate_enceph&#39;</span><span class="p">]</span>
        <span class="n">severe_enceph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;severe_enceph&#39;</span><span class="p">]</span>
        <span class="n">all_enceph</span> <span class="o">=</span> <span class="n">mild_enceph</span> <span class="o">+</span> <span class="n">mod_enceph</span> <span class="o">+</span> <span class="n">severe_enceph</span>
        <span class="n">ftt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;not_breathing_at_birth&#39;</span><span class="p">]</span>
        <span class="n">death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span>
        <span class="n">sepsis_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">]</span>
        <span class="n">ftt_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;not_breathing_at_birth_death&#39;</span><span class="p">]</span>
        <span class="n">mild_enceph_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;mild_enceph_death&#39;</span><span class="p">]</span>
        <span class="n">moderate_enceph_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;moderate_enceph_death&#39;</span><span class="p">]</span>
        <span class="n">severe_enceph_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;severe_enceph_death&#39;</span><span class="p">]</span>
        <span class="n">preterm_birth_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;preterm_birth_other_death&#39;</span><span class="p">]</span>

        <span class="n">sepsis_treatment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;sep_treatment&#39;</span><span class="p">]</span>
        <span class="n">resus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="s1">&#39;resus&#39;</span><span class="p">]</span>
    <span class="c1">#    tetra_cycline = self.module.newborn_complication_tracker[&#39;t_e_d&#39;]</span>

        <span class="n">dict_for_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;births&#39;</span><span class="p">:</span> <span class="n">total_births_last_year</span><span class="p">,</span>
                           <span class="s1">&#39;neonatal_deaths&#39;</span><span class="p">:</span> <span class="n">newborn_deaths</span><span class="p">,</span>
                           <span class="s1">&#39;checker_deaths&#39;</span><span class="p">:</span> <span class="n">death</span><span class="p">,</span>
                           <span class="s1">&#39;nmr_early&#39;</span><span class="p">:</span> <span class="n">newborn_deaths</span><span class="o">/</span><span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;early_preterm_births&#39;</span><span class="p">:</span> <span class="n">early_preterm_births</span><span class="p">,</span>
                           <span class="s1">&#39;late_preterm_births&#39;</span><span class="p">:</span> <span class="n">late_preterm_births</span><span class="p">,</span>
                           <span class="s1">&#39;total_preterm_births&#39;</span><span class="p">:</span> <span class="n">total_preterm_births</span><span class="p">,</span>
                           <span class="s1">&#39;tptb_incidence&#39;</span><span class="p">:</span> <span class="n">total_preterm_births</span><span class="o">/</span><span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;preterm_birth_death&#39;</span><span class="p">:</span> <span class="n">preterm_birth_death</span><span class="p">,</span>
                           <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">:</span> <span class="n">low_birth_weight</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;small_for_gestational_age&#39;</span><span class="p">:</span> <span class="n">small_for_gestational_age</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;sepsis_crude&#39;</span><span class="p">:</span> <span class="n">sepsis</span><span class="p">,</span>
                           <span class="s1">&#39;sepsis_incidence&#39;</span><span class="p">:</span> <span class="n">sepsis</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;sepsis_treatment_crude&#39;</span><span class="p">:</span> <span class="n">sepsis_treatment</span><span class="p">,</span>
                           <span class="s1">&#39;sepsis_deaths&#39;</span><span class="p">:</span> <span class="n">sepsis_death</span><span class="p">,</span>
                           <span class="s1">&#39;mild_enceph_incidence&#39;</span><span class="p">:</span> <span class="n">mild_enceph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;mild_enceph_death&#39;</span><span class="p">:</span> <span class="n">mild_enceph_death</span><span class="p">,</span>
                           <span class="s1">&#39;mod_enceph_incidence&#39;</span><span class="p">:</span> <span class="n">mod_enceph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;mod_enceph_death&#39;</span><span class="p">:</span> <span class="n">moderate_enceph_death</span><span class="p">,</span>
                           <span class="s1">&#39;severe_enceph_incidence&#39;</span><span class="p">:</span> <span class="n">severe_enceph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;severe_enceph_death&#39;</span><span class="p">:</span> <span class="n">severe_enceph_death</span><span class="p">,</span>
                           <span class="s1">&#39;total_enceph_incidence&#39;</span><span class="p">:</span> <span class="n">all_enceph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;total_enceph_death&#39;</span><span class="p">:</span> <span class="n">mild_enceph_death</span> <span class="o">+</span> <span class="n">moderate_enceph_death</span> <span class="o">+</span> <span class="n">severe_enceph_death</span><span class="p">,</span>
                           <span class="s1">&#39;ftt_crude&#39;</span><span class="p">:</span> <span class="n">ftt</span><span class="p">,</span>
                           <span class="s1">&#39;ftt_incidence&#39;</span><span class="p">:</span> <span class="n">ftt</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;ftt_death&#39;</span><span class="p">:</span> <span class="n">ftt_death</span><span class="p">,</span>
                           <span class="s1">&#39;resus_crude&#39;</span><span class="p">:</span> <span class="n">resus</span><span class="p">,</span>
                           <span class="c1"># &#39;resus_rate&#39;: resus / ftt * 100,</span>
                           <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;neonatal_summary_stats&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dict_for_output</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly summary statistics output &#39;</span>
                                                                                    <span class="s1">&#39;from the neonatal outcome module&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">newborn_complication_tracker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jun 23, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>