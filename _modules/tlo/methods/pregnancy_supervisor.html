<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tlo.methods.pregnancy_supervisor &mdash; TLOmodel 0.1.dev2407+gde94ffa documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=6ea10ece" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8142288c"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TLOmodel
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/index.html">Resource files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../learning.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../methods.html">tlo.methods</a></li>
      <li class="breadcrumb-item active">tlo.methods.pregnancy_supervisor</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tlo.methods.pregnancy_supervisor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DAYS_IN_MONTH</span><span class="p">,</span>
    <span class="n">DAYS_IN_YEAR</span><span class="p">,</span>
    <span class="n">Date</span><span class="p">,</span>
    <span class="n">DateOffset</span><span class="p">,</span>
    <span class="n">Module</span><span class="p">,</span>
    <span class="n">Parameter</span><span class="p">,</span>
    <span class="n">Property</span><span class="p">,</span>
    <span class="n">Types</span><span class="p">,</span>
    <span class="n">logging</span><span class="p">,</span>
    <span class="n">util</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tlo.core</span> <span class="kn">import</span> <span class="n">IndividualPropertyUpdates</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">labour</span><span class="p">,</span> <span class="n">pregnancy_helper_functions</span><span class="p">,</span> <span class="n">pregnancy_supervisor_lm</span>
<span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement</span><span class="p">,</span>
    <span class="n">HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tlo.population</span> <span class="kn">import</span> <span class="n">PatientDetails</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="PregnancySupervisor">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor">[docs]</a>
<span class="k">class</span> <span class="nc">PregnancySupervisor</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This module is responsible for simulating the antenatal period of pregnancy (the period from conception until</span>
<span class="sd">     the termination of pregnancy). A number of outcomes are managed by this module including early pregnancy loss</span>
<span class="sd">     (induced/spontaneous abortion, ectopic pregnancy and antenatal stillbirth) and pregnancy complications of the</span>
<span class="sd">     antenatal period (nutritional deficiencies , anaemia, placental praevia/abruption,</span>
<span class="sd">     premature rupture of membranes (PROM), chorioamnionitis, hypertensive disorders (gestational hypertension,</span>
<span class="sd">     pre-eclampsia, eclampsia), gestational diabetes, maternal death). This module calculates likelihood of care seeking</span>
<span class="sd">     for routine antenatal care and emergency obstetric care in the event of severe complications.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PregnancySupervisor.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># First we define dictionaries which will store the current parameters of interest (to allow parameters to</span>
        <span class="c1"># change between 2010 and 2020) and the linear models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Here we define the mother and newborn information dictionary which stored surplus information about women</span>
        <span class="c1"># across the length of pregnancy and the postnatal period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># This variable will store a Bitset handler for the property ps_abortion_complications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">}</span>

    <span class="n">OPTIONAL_INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">,</span> <span class="s1">&#39;Malaria&#39;</span><span class="p">,</span> <span class="s1">&#39;CardioMetabolicDisorders&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiv&#39;</span><span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
         <span class="s1">&#39;Contraception&#39;</span><span class="p">,</span> <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span> <span class="s1">&#39;Labour&#39;</span><span class="p">,</span> <span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">,</span> <span class="s1">&#39;Lifestyle&#39;</span><span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
                <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;antepartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severe_gestational_hypertension&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;antenatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">)}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># n.b. Parameters are stored as LIST variables due to containing values to match both 2010 and 2015 data.</span>

        <span class="c1"># ECTOPIC PREGNANCY...</span>
        <span class="s1">&#39;prob_ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of ectopic pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_care_seeking_ectopic_pre_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will seek care for ectopic pregnancy prior to rupture&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_ectopic_pregnancy_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman dying from a ruptured ectopic pregnancy&#39;</span><span class="p">),</span>

        <span class="c1"># TWINS...</span>
        <span class="s1">&#39;prob_multiples&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that a woman is currently carrying more than one pregnancy&#39;</span><span class="p">),</span>

        <span class="c1"># PLACENTA PRAEVIA</span>
        <span class="s1">&#39;prob_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that this womans pregnancy will be complicated by placenta praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_placenta_praevia_previous_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of placenta praevia in a woman who has previously delivered via caesarean &#39;</span>
                        <span class="s1">&#39;section&#39;</span><span class="p">),</span>

        <span class="c1"># SYPHILIS</span>
        <span class="s1">&#39;prob_syphilis_during_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that this womans will develop syphilis during her pregnancy&#39;</span><span class="p">),</span>

        <span class="c1"># SPONTANEOUS AND INDUCED ABORTION</span>
        <span class="s1">&#39;prob_previous_miscarriage_at_baseline&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a woman at baseline will have previously experienced a miscarriage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_spontaneous_abortion_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of spontaneous abortion per month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_age_35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women aged 35 years or older&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_age_31_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women aged 31-34 years old&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_prev_sa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women who have previously experiences spontaneous &#39;</span>
                        <span class="s1">&#39;abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_complicated_sa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that a woman who experiences spontaneous abortion with experience any &#39;</span>
                        <span class="s1">&#39;complications&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_induced_abortion_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of induced abortion per month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_complicated_ia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that a woman who experiences induced abortion with experience any &#39;</span>
                        <span class="s1">&#39;complications&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_haemorrhage_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of haemorrhage following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of sepsis following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_injury_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of injury following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_induced_abortion_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of death following an induced abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_spontaneous_abortion_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of death following an spontaneous abortion&#39;</span><span class="p">),</span>


        <span class="c1"># ANAEMIA...</span>
        <span class="s1">&#39;baseline_prob_anaemia_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;baseline risk of a woman developing anaemia secondary only to pregnant&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_maternal_malaria&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of anaemia secondary to malaria infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_hiv_no_art&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of anaemia for a woman with HIV not on ART&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mild_mod_sev_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a womans anaemia will be mild, moderate or severe&#39;</span><span class="p">),</span>

        <span class="c1"># GESTATIONAL DIABETES...</span>
        <span class="s1">&#39;prob_gest_diab_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of gestational diabetes per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_gest_diab_obesity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of gestational diabetes for women who are obese&#39;</span><span class="p">),</span>

        <span class="c1"># HYPERTENSIVE DISORDERS...</span>
        <span class="s1">&#39;prob_gest_htn_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of gestational hypertension per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_gest_htn_obesity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of gestational hypertension for women who are obese&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pre_eclampsia_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of pre-eclampsia per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pre_eclampsia_obesity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of pre-eclampsia for women who are obese&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pre_eclampsia_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of pre-eclampsia for women who are pregnant with twins&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pre_eclampsia_chronic_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of pre-eclampsia in women who are chronically hypertensive&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pre_eclampsia_diabetes_mellitus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of pre-eclampsia in women who have diabetes mellitus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_sgh_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mpe_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild pre-eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_spe_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe pre-eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_ec_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_severe_pre_eclampsia_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman experiencing acute severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_eclampsia_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman experiencing eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_monthly_death_severe_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;monthly risk of death for a woman with severe hypertension&#39;</span><span class="p">),</span>

        <span class="c1"># PLACENTAL ABRUPTION...</span>
        <span class="s1">&#39;prob_placental_abruption_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;monthly probability that a woman will develop placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_placental_abruption_hypertension&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of placental abruption in women with hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_placental_abruption_previous_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of placental abruption in women who delivered previously via caesarean section&#39;</span><span class="p">),</span>

        <span class="c1"># ANTEPARTUM HAEMORRHAGE...</span>
        <span class="s1">&#39;prob_aph_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of antepartum haemorrhage due to ongoing placenta praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of antepartum haemorrhage due to placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mod_sev_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that APH is mild/moderate or severe&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antepartum_haemorrhage_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman suffering acute antepartum haemorrhage&#39;</span><span class="p">),</span>

        <span class="c1"># PROM...</span>
        <span class="s1">&#39;prob_prom_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;monthly probability that a woman will experience premature rupture of membranes&#39;</span><span class="p">),</span>

        <span class="c1"># CHORIOAMNIONITIS...</span>
        <span class="s1">&#39;prob_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;monthly probability of a women developing chorioamnionitis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antenatal_sepsis_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for chorioamnionitis&#39;</span><span class="p">),</span>

        <span class="c1"># PRETERM LABOUR...</span>
        <span class="s1">&#39;baseline_prob_early_labour_onset&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;monthly baseline risk of labour onsetting before term&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_labour_post_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset following PROM&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_labour_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset in women with anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_labour_malaria&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset in women with malaria&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_labour_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset in women pregnant with twins&#39;</span><span class="p">),</span>

        <span class="c1"># ANTENATAL STILLBIRTH...</span>
        <span class="s1">&#39;prob_still_birth_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;underlying risk of stillbirth per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ga_41&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with gestational age 41 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ga_42&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with gestational age 42 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ga_&gt;42&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with gestational age &gt; 42 weeks&#39;</span><span class="p">),</span>

        <span class="s1">&#39;rr_still_birth_gest_diab&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with gestational diabetes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_diab_mellitus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with diabetes mellitus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_maternal_malaria&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with malaria&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_maternal_syphilis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with syphilis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with mild gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_chronic_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with chronic hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_chorio&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with chorioamnionitis&#39;</span><span class="p">),</span>


        <span class="c1"># CARE SEEKING (NOT ANC)...</span>
        <span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who is pregnant will seek care in the event of a complication&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_care_pregnancy_loss&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who has developed complications post pregnancy loss will seek care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_care_induction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who is post term will seek care for induction of labour&#39;</span><span class="p">),</span>

        <span class="c1"># CARE SEEKING (ANC)...</span>
        <span class="s1">&#39;prob_anc1_months_2_to_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of probabilities that a woman will attend her first ANC visit at either month 2, 3 or&#39;</span>
                        <span class="s1">&#39; 4 of pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_anc1_months_5_to_9&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of probabilities that a woman will attend her first ANC visit on months 5-10&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_early_init_anc4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman undergoing 4 or more basic ANC visits with the first visit occurring &#39;</span>
                        <span class="s1">&#39;prior or during month 4 of pregnancy (EANC4+)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_20_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 20-24&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_25_29&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 25-29&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_30_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 30-34&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_35_39&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 35-39&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_40_44&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 40-44&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_45_49&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women aged 45-49&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in 2010&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_2015&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in 2015&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_parity_2_3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women with a parity of 2-3&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_parity_4_5&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women with a parity of 4-5&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_parity_6+&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women with a parity of 6+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_secondary_edu&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women with secondary education&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_tertiary_edu&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women with tertiary education&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_early_anc4_richest_wealth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;adjusted odds ratio of EANC4+ in women in the richest wealth quintile&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_initiation_anc4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will undertake 4 or more ANC visits with the first being after 4 months&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_early_initiation_anc_below4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities a woman will attend fewer than 4 ANC visits but the first visit will occur &#39;</span>
                        <span class="s1">&#39;before month 4&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_early_anc_at_facility_level_1_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities a woman will attend ANC 1 at facility levels 1 or 2&#39;</span><span class="p">),</span>

        <span class="c1"># TREATMENT EFFECTS...</span>
        <span class="s1">&#39;treatment_effect_ectopic_pregnancy_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of ectopic pregnancy case management&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_post_abortion_care&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of post abortion care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_iron_folic_acid_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative effect of daily iron and folic acid treatment on risk of maternal anaemia &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_calcium_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk reduction of pre-eclampsia for women taking daily calcium supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_gest_htn_calcium&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Effect of calcium supplementation on risk of developing gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_anti_htns_progression&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Effect of anti hypertensive medication in reducing the risk of progression from mild to severe&#39;</span>
                        <span class="s1">&#39; hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_glycaemic_control_diet_exercise&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a womans GDM is controlled by diet and exercise during the first month of &#39;</span>
                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_glycaemic_control_orals&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a womans GDM is controlled by oral anti-diabetics during the first month of &#39;</span>
                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_gdm_case_management&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of GDM case management on mothers risk of stillbirth &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_still_birth_food_sups&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk reduction of still birth for women receiving nutritional supplements&#39;</span><span class="p">),</span>

        <span class="c1"># ANALYSIS PARAMETERS...</span>
        <span class="s1">&#39;anc_service_structure&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;stores type of ANC service being delivered in the model (anc4 or anc8) and is used in analysis&#39;</span>
                       <span class="s1">&#39;scripts to change ANC structure&#39;</span><span class="p">),</span>
        <span class="s1">&#39;analysis_year&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Year on which the pregnancy analysis event is scheduled to update any relevant parameters for &#39;</span>
                       <span class="s1">&#39;analysis (1st day 1st month)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_analysis_in_progress&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Used within the pregnancy_helper_function to signify that analysis is currently being &#39;</span>
                        <span class="s1">&#39;conducted&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_anc_coverage&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event that an alternative level of ANC coverage has been &#39;</span>
                        <span class="s1">&#39;determined following the events run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_anc_quality&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event that an alternative level of ANC quality has been &#39;</span>
                        <span class="s1">&#39;determined following the events run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;anc_availability_odds&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Target odds of early initiation of ANC4+ when analysis is being conducted - only applied if&#39;</span>
                        <span class="s1">&#39;alternative_anc_coverage is true &#39;</span><span class="p">),</span>
        <span class="s1">&#39;anc_availability_probability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Target probability of quality/consumables when analysis is being conducted - only applied if &#39;</span>
                        <span class="s1">&#39;alternative_anc_quality is true&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_ip_anc_quality&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event that an alternative level of inpatient ANC quality has been &#39;</span>
                        <span class="s1">&#39;determined following the events run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ip_anc_availability_probability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Target probability of quality/consumables when analysis is being conducted - only applied if &#39;</span>
                        <span class="s1">&#39;alternative_ip_anc_quality is true&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sens_analysis_min&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event and code that sensitivity analysis is being undertaken in &#39;</span>
                        <span class="s1">&#39;which ANC is blocked from occurring&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sens_analysis_max&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event and code that sensitivity analysis is being undertaken in &#39;</span>
                        <span class="s1">&#39;which the maximum coverage of ANC is enforced&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;current gestational age, in weeks, of a woman &#39;</span>
                                                            <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Date first ANC visit is scheduled for&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is experiencing ectopic pregnancy and&#39;</span>
                                                            <span class="s1">&#39; its current state&#39;</span><span class="p">,</span>
                                         <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">,</span> <span class="s1">&#39;ruptured&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is pregnant with multiple fetuses&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman pregnancy will be complicated by placenta&#39;</span>
                                                    <span class="s1">&#39;praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman has syphilis during pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman has anaemia in pregnancy and its &#39;</span>
                                                               <span class="s1">&#39;severity&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>

        <span class="s1">&#39;ps_anc4&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is predicted to attend 4 or more antenatal care visits &#39;</span>
                                        <span class="s1">&#39;during her pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BITSET</span><span class="p">,</span> <span class="s1">&#39;Bitset column holding types of abortion complication&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has had any previous pregnancies end in &#39;</span>
                                                       <span class="s1">&#39;spontaneous abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has had any previous pregnancies end in &#39;</span>
                                                   <span class="s1">&#39;still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;if this woman suffers from a hypertensive disorder of &#39;</span>
                                                        <span class="s1">&#39;pregnancy&#39;</span><span class="p">,</span>
                                     <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has experienced pre-eclampsia in a previous &#39;</span>
                                                   <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is experiencing gestational diabetes&#39;</span><span class="p">,</span>
                                 <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">,</span> <span class="s1">&#39;controlled&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has ever suffered from gestational diabetes &#39;</span>
                                                  <span class="s1">&#39;during a previous pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;severity of this womans antepartum haemorrhage&#39;</span><span class="p">,</span>
                                              <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has experience rupture of &#39;</span>
                                                                  <span class="s1">&#39;membranes before the onset of labour. If this is &#39;</span>
                                                                  <span class="s1">&#39;&lt;37 weeks from gestation the woman has preterm &#39;</span>
                                                                  <span class="s1">&#39;premature rupture of membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is experiencing chorioamnionitis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;signifies a woman in undergoing an acute emergency event in her &#39;</span>
                                                   <span class="s1">&#39;pregnancy- used to consolidated care seeking in the instance of &#39;</span>
                                                   <span class="s1">&#39;multiple complications&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="PregnancySupervisor.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="c1"># load parameters from the resource file</span>
        <span class="n">parameter_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_PregnancySupervisor.xlsx&#39;</span><span class="p">,</span>
                                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">parameter_dataframe</span><span class="p">)</span>

        <span class="c1"># Here we map &#39;disability&#39; parameters to associated DALY weights to be passed to the health burden module.</span>
        <span class="c1"># Currently this module calculates and reports all DALY weights from all maternal modules</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ps_daly_weights&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">{</span><span class="s1">&#39;abortion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">352</span><span class="p">),</span>
                 <span class="s1">&#39;abortion_haem&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;abortion_sep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;ectopic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">351</span><span class="p">),</span>
                 <span class="s1">&#39;ectopic_rupture&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;mild_mod_aph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;severe_aph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;chorio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;mild_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">476</span><span class="p">),</span>
                 <span class="s1">&#39;mild_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">476</span><span class="p">),</span>
                 <span class="s1">&#39;moderate_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
                 <span class="s1">&#39;moderate_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;severe_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;severe_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">861</span><span class="p">),</span>
                 <span class="s1">&#39;hypertension&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">343</span><span class="p">),</span>
                 <span class="s1">&#39;gest_diab&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">971</span><span class="p">),</span>
                 <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">348</span><span class="p">),</span>
                 <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;mild_mod_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;severe_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;secondary_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;vesicovaginal_fistula&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">349</span><span class="p">),</span>
                 <span class="s1">&#39;rectovaginal_fistula&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">350</span><span class="p">),</span>
                 <span class="p">}</span></div>


<div class="viewcode-block" id="PregnancySupervisor.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># This bitset property stores &#39;types&#39; of complication that can occur after an abortion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">,</span>
                                                    <span class="p">[</span><span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">])</span>

        <span class="c1"># Finally, for women of reproductive age at baseline, we determine if they have ever previous experience a</span>
        <span class="c1"># miscarriage. This impacts future likelihood of miscarriage.</span>
        <span class="n">reproductive_age_women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">previous_miscarriage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reproductive_age_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reproductive_age_women</span><span class="p">]))</span> <span class="o">&lt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_previous_miscarriage_at_baseline&#39;</span><span class="p">],</span>
            <span class="n">index</span><span class="o">=</span><span class="n">reproductive_age_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reproductive_age_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">previous_miscarriage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">previous_miscarriage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="PregnancySupervisor.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># self.current_parameters is used to store the module level parameters for this time period</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_current_parameter_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Next we register and schedule the PregnancySupervisorEvent</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PregnancySupervisorEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># ..and register and schedule logging event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PregnancyLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># ...and register and schedule the parameter update event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">ParameterUpdateEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">Date</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># ... and finally register and schedule the parameter override event. This is used in analysis scripts to change</span>
        <span class="c1"># key parameters after the simulation &#39;burn in&#39; period. The event is schedule to run even when analysis is not</span>
        <span class="c1"># conducted but no changes to parameters can be made.</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PregnancyAnalysisEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">Date</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;analysis_year&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># ==================================== LINEAR MODEL EQUATIONS =================================================</span>
        <span class="c1"># Next we scale linear models according to distribution of predictors in the dataframe at baseline</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># First we create all of the custom linear models used within this module and store them in</span>
        <span class="c1"># pregnancy_supervisor_lm.py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation predicts women&#39;s probability of attending four ANC visits with the first visit occurring</span>
            <span class="c1"># during or prior to the fourth month of pregnancy</span>
            <span class="s1">&#39;early_initiation_anc4&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">early_initiation_anc4</span><span class="p">,</span>
                                                        <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the probability of death following en ectopic pregnancy</span>
            <span class="s1">&#39;ectopic_pregnancy_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">ectopic_pregnancy_death</span><span class="p">,</span>
                                                          <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman experiencing a miscarriage prior to 28 weeks</span>
            <span class="c1"># gestation</span>
            <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">spontaneous_abortion</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the probability of death following a complicated miscarriage</span>
            <span class="s1">&#39;spontaneous_abortion_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">spontaneous_abortion_death</span><span class="p">,</span>
                                                             <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the probability of death following an induced abortion</span>
            <span class="s1">&#39;induced_abortion_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">induced_abortion_death</span><span class="p">,</span>
                                                         <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman determining anaemia during her pregnancy</span>
            <span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">maternal_anaemia</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman going into labour before reaching term</span>
            <span class="c1"># gestation (i.e. 37 weeks or more)</span>
            <span class="s1">&#39;early_onset_labour&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">preterm_labour</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation determines the per-pregnancy probability of a woman developing placenta praevia, where her</span>
            <span class="c1"># placenta is either fully or partially covering the cervix. Praevia is a predictor or antenatal bleeding</span>
            <span class="s1">&#39;placenta_praevia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">placenta_praevia</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equations determines the monthly probability of a woman developing placental abruption during</span>
            <span class="c1"># pregnancy which is a strong predictor of antenatal bleeding</span>
            <span class="s1">&#39;placental_abruption&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">placental_abruption</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman developing antepartum haemorrhage. Haemorrhage</span>
            <span class="c1"># may only occur in the presence of either praevia or abruption</span>
            <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">antepartum_haem</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman developing gestational diabetes</span>
            <span class="s1">&#39;gest_diab&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">gest_diab</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman developing gestational hypertension</span>
            <span class="s1">&#39;gest_htn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">gest_htn</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman developing mild pre-eclampsia</span>
            <span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">pre_eclampsia</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation determines the monthly probability of a woman experiencing an antenatal stillbirth,</span>
            <span class="c1"># pregnancy loss following 28 weeks gestation</span>
            <span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">pregnancy_supervisor_lm</span><span class="o">.</span><span class="n">antenatal_stillbirth</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Next we create a dict with all the models to be scaled and the &#39;target&#39; rate parameter</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span>
        <span class="n">models_to_be_scaled</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_placenta_praevia&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">],</span> <span class="s1">&#39;baseline_prob_anaemia_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;gest_diab&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_gest_diab_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_gest_htn_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_pre_eclampsia_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_placental_abruption_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_still_birth_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;early_initiation_anc4&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_early_init_anc4&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_spontaneous_abortion_per_month&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;early_onset_labour&#39;</span><span class="p">],</span> <span class="s1">&#39;baseline_prob_early_labour_onset&#39;</span><span class="p">]]</span>

        <span class="c1"># Scale all models updating the parameter used as the intercept of the linear models</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_to_be_scaled</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">scale_linear_model_at_initialisation</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_key</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="PregnancySupervisor.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PregnancySupervisor.further_on_birth_pregnancy_supervisor">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.further_on_birth_pregnancy_supervisor">[docs]</a>
    <span class="k">def</span> <span class="nf">further_on_birth_pregnancy_supervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module or following an intrapartum</span>
<span class="sd">        stillbirth in the Labour Module. This function contains additional code related to the pregnancy supervisor</span>
<span class="sd">        module that should be ran on_birth. These additional on_birth functions ensure each modules</span>
<span class="sd">        (pregnancy,antenatal care, labour, newborn, postnatal) on_birth code is ran in the correct sequence</span>
<span class="sd">        (as this can vary depending on how modules are registered)</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>

            <span class="c1"># We reset all women gestational age when they deliver as they are no longer pregnant</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

            <span class="c1"># And store her anaemia status to calculate the prevalence of anaemia on birth</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;conditions_on_birth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                                         <span class="s1">&#39;anaemia_status&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">],</span>
                                                         <span class="s1">&#39;gdm_status&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">],</span>
                                                         <span class="s1">&#39;htn_status&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]})</span>

            <span class="c1"># We currently assume that hyperglycemia due to gestational diabetes resolves following birth</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="c1"># We store the date of resolution for women who were aware of their diabetes (as the DALY weight only</span>
                <span class="c1"># occurs after diagnosis)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;gest_diab_onset&#39;</span><span class="p">]):</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;gest_diab_resolution&#39;</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.on_hsi_alert">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.on_hsi_alert">[docs]</a>
    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is PregnancySupervisor, being alerted about a health system interaction &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.report_daly_values">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.report_daly_values">[docs]</a>
    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates and reports the monthly daly weight values accumulated from Maternal Disorders. For</span>
<span class="sd">        simplicity all daly weights from Maternal Disorders are reported in this module (though may be attributable to</span>
<span class="sd">        conditions occurring antenatally, intrapartum or postnatally). Individual level monthly-daly weights are</span>
<span class="sd">        calculated using the mni dictionary where date of complication onset/resolution is stored.</span>
<span class="sd">        :return: daly_series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ps_daly_weights&#39;</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is PregnancySupervisor reporting my health values&#39;</span><span class="p">)</span>
        <span class="n">monthly_daly</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># First we define a function that calculates disability associated with &#39;acute&#39; complications of pregnancy</span>
        <span class="k">def</span> <span class="nf">acute_daly_calculation</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
            <span class="c1"># If the woman has not experienced the complication of interest in the past month she does not accrue dalys</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]):</span>
                <span class="k">return</span>

            <span class="c1"># If the complication has onset within the last month...</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>

                <span class="c1"># We assume that any woman who experiences an acute event receives the whole weight for that daly</span>
                <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

                <span class="c1"># Ensure some weight is assigned</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Daly wt not correctly assigned for person </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># Reset the variable within the mni dictionary to prevent double counting</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Next we define a function that calculates disability associated with &#39;chronic&#39; complications of pregnancy</span>
        <span class="k">def</span> <span class="nf">chronic_daly_calculations</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
            <span class="c1"># If the complication hasn&#39;t occurred, the function ends</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]):</span>
                <span class="k">return</span>

            <span class="c1"># If the complication has not yet resolved, and started more than a month ago, the woman gets a</span>
            <span class="c1"># months disability</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">DAYS_IN_YEAR</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">DAYS_IN_YEAR</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span>

                <span class="c1"># Otherwise, if the complication started this month she gets a daly weight relative to the number of</span>
                <span class="c1"># days she has experience the complication</span>
                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span>
                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                    <span class="n">days_since_onset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]),</span>
                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                    <span class="n">daly_weight</span> <span class="o">=</span> <span class="n">days_since_onset</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">DAYS_IN_YEAR</span><span class="p">)</span>

                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daly_weight</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Daly wt not correctly assigned for person </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Its possible for a condition to resolve (via treatment) and onset within the same month</span>
                <span class="c1"># (i.e. anaemia). If so, here we calculate how many days this month an individual has suffered</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span> <span class="ow">and</span> \
                      <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                        <span class="k">return</span>

                    <span class="c1"># Calculate daily weight and how many days this woman hasnt had the complication</span>
                    <span class="n">daily_weight</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">DAYS_IN_YEAR</span>
                    <span class="n">days_without_complication</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]),</span>
                        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>

                    <span class="c1"># Use the average days in a month to calculate how many days shes had the complication this</span>
                    <span class="c1"># month</span>
                    <span class="n">days_with_comp</span> <span class="o">=</span> <span class="n">DAYS_IN_MONTH</span> <span class="o">-</span> <span class="n">days_without_complication</span><span class="o">.</span><span class="n">days</span>

                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daily_weight</span> <span class="o">*</span> <span class="n">days_with_comp</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Daly wt not correctly assigned for person </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the complication has truly resolved, check the dates make sense</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Complication resolution has occurred before onset in&#39;</span>
                                                      <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1"># We calculate how many days she has been free of the complication this month to determine how</span>
                    <span class="c1"># many days she has suffered from the complication this month</span>
                    <span class="n">days_free_of_comp_this_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                                                             <span class="sa">f</span><span class="s1">&#39;resolution&#39;</span><span class="p">]),</span>
                                                                <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                    <span class="n">mid_way_calc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">days_free_of_comp_this_month</span>
                    <span class="n">days_with_comp_this_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mid_way_calc</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                    <span class="n">daly_weight</span> <span class="o">=</span> <span class="n">days_with_comp_this_month</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">DAYS_IN_YEAR</span><span class="p">)</span>
                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daly_weight</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Daly wt not correctly assigned for person </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="c1"># Reset the dates to stop additional disability being applied</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Then for each alive person in the MNI we cycle through all the complications that can lead to disability and</span>
        <span class="c1"># calculate their individual daly weight for the month</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mni</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;abortion&#39;</span><span class="p">,</span> <span class="s1">&#39;abortion_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;abortion_sep&#39;</span><span class="p">,</span> <span class="s1">&#39;ectopic&#39;</span><span class="p">,</span> <span class="s1">&#39;ectopic_rupture&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;mild_mod_aph&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_aph&#39;</span><span class="p">,</span> <span class="s1">&#39;chorio&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">,</span>  <span class="s1">&#39;mild_mod_pph&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pph&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_pph&#39;</span><span class="p">]:</span>
                    <span class="n">acute_daly_calculation</span><span class="p">(</span><span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span> <span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hypertension&#39;</span><span class="p">,</span> <span class="s1">&#39;gest_diab&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_anaemia&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_anaemia&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;severe_anaemia&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_anaemia_pp&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_anaemia_pp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_anaemia_pp&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;vesicovaginal_fistula&#39;</span><span class="p">,</span> <span class="s1">&#39;rectovaginal_fistula&#39;</span><span class="p">]:</span>
                    <span class="n">chronic_daly_calculations</span><span class="p">(</span><span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span> <span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

                <span class="c1"># ensure value doesnt exceed one</span>
                <span class="k">if</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># delete_mni is used to signify that pregnancy has ended. We delete the mni variable for women whose</span>
                <span class="c1"># pregnancy has ended prematurely via this monthly function to allow for daly weights to be calculated</span>
                <span class="c1"># for women who are no long pregnant -this check ensures women who are still pregnant do not have the</span>
                <span class="c1"># entry in the mni deleted</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                  <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                  <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># otherwise the entry can be deleted</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="ow">and</span>
                      <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">and</span>
                      <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="ow">and</span>
                      <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>
                    <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>

        <span class="n">daly_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>
        <span class="n">daly_series</span><span class="p">[</span><span class="n">monthly_daly</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">monthly_daly</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">daly_series</span></div>


<div class="viewcode-block" id="PregnancySupervisor.pregnancy_supervisor_property_reset">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.pregnancy_supervisor_property_reset">[docs]</a>
    <span class="k">def</span> <span class="nf">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called when all properties housed in the PregnancySupervisorModule should be reset. For example</span>
<span class="sd">        following pregnancy loss</span>
<span class="sd">        :param id_or_index: pass the function either an individual ID (INT) or index of subset of data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_linear_model">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_linear_model">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_linear_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lm</span><span class="p">,</span> <span class="n">df_slice</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function will apply the linear model (lm) on the dataframe (df) to get a probability of some event</span>
<span class="sd">        happening to each individual. It then returns a series with same index with bools indicating the outcome based</span>
<span class="sd">        on the toss of the biased coin.</span>
<span class="sd">        :param lm: The linear model</span>
<span class="sd">        :param df_slice: The dataframe</span>
<span class="sd">        :return: Series with same index containing outcomes (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_slice</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_slice</span><span class="p">,</span>
                                                                  <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.schedule_anc_one">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.schedule_anc_one">[docs]</a>
    <span class="k">def</span> <span class="nf">schedule_anc_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">anc_month</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This functions calculates the correct date each woman will attend her first ANC contact and schedules the visit</span>
<span class="sd">         for newly pregnant women depending on their predicted month of attendance</span>
<span class="sd">        :param anc_month: month of pregnancy that woman will attend ANC 1</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Define the weeks of each month of pregnancy</span>
        <span class="n">months_min_max</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">],</span> <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="mi">6</span><span class="p">:</span> <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span> <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span> <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span>
                          <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">40</span><span class="p">]}</span>

        <span class="c1"># As care seeking is applied at week 8 gestational age, women who seek care within month two must attend within</span>
        <span class="c1"># the next week</span>
        <span class="k">if</span> <span class="n">anc_month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">days_until_anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise we draw a week between the min max weeks for predicted month of visit, and then a random day</span>
            <span class="n">weeks_of_visit</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">months_min_max</span><span class="p">[</span><span class="n">anc_month</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">months_min_max</span><span class="p">[</span><span class="n">anc_month</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">days_until_anc</span> <span class="o">=</span> <span class="p">(</span><span class="n">weeks_of_visit</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="n">first_anc_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_anc</span><span class="p">)</span>

        <span class="c1"># We store that date as a property which is used by the HSI to ensure the event only runs when it should</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_anc_date</span>

        <span class="c1"># We allow for two possible structure of ANC service delivery, focused ANC (4 visits recommended) or 8 contact</span>
        <span class="c1"># scheduled (8 visits recommended). This is to perform comparative analysis.</span>

        <span class="c1"># Import the HSIs</span>
        <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">,</span>
            <span class="n">HSI_CareOfWomenDuringPregnancy_FocusedANCVisit</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Now the correct ANC HSI is scheduled depending on the ANC contact schedule that has been provided via</span>
        <span class="c1"># params[&#39;anc_service_structure&#39;] - This functionality allows for comparative analysis of the 4 and 8 visit</span>
        <span class="c1"># structure</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;anc_service_structure&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">first_anc_appt</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;anc_service_structure&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">first_anc_appt</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FocusedANCVisit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">visit_number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">first_anc_appt</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                            <span class="n">topen</span><span class="o">=</span><span class="n">first_anc_date</span><span class="p">,</span>
                                                            <span class="n">tclose</span><span class="o">=</span><span class="n">first_anc_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_spontaneous_abortion">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_spontaneous_abortion">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_spontaneous_abortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of spontaneous abortion to a slice of data frame and is called by</span>
<span class="sd">        PregnancySupervisorEvent. It calls the do_after_abortion function for women who loose their</span>
<span class="sd">        pregnancy.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># We use the apply_linear_model to determine if any women will experience spontaneous miscarriage</span>
        <span class="n">spont_abortion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># The do_after_abortion function is called for women who lose their pregnancy. It resets properties, set</span>
        <span class="c1"># potential complications and care seeking</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">spont_abortion</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spont_abortion</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_after_abortion</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_induced_abortion">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_induced_abortion">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_induced_abortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of induced abortion to a slice of data frame and is called by</span>
<span class="sd">        PregnancySupervisorEvent. It calls the do_after_abortion for women who loose their pregnancy.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># This function follows the same pattern as apply_risk_of_spontaneous_abortion (only women with unintended</span>
        <span class="c1"># pregnancy may seek induced abortion)</span>
        <span class="n">at_risk</span> <span class="o">=</span>\
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">abortion</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]))</span> <span class="o">&lt;</span>
                             <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_induced_abortion_per_month&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">abortion</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">abortion</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_after_abortion</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.do_after_abortion">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.do_after_abortion">[docs]</a>
    <span class="k">def</span> <span class="nf">do_after_abortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">type_abortion</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called for all women who experience a spontaneous or induced abortion. The function logs the</span>
<span class="sd">        pregnancy loss, resets key variables and determines risk of complication.</span>
<span class="sd">        :param individual_id: individual id</span>
<span class="sd">        :param type_abortion: STR &quot;induced&quot; or &quot;spontaneous&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Log the pregnancy loss</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                       <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">type_abortion</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                       <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1"># This function officially ends a pregnancy through the contraception module (updates &#39;is_pregnant&#39; and</span>
        <span class="c1"># determines post pregnancy contraception)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Set the delete_mni variable true so after daly weights are calculated the woman is removed from the mni</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Reset key pregnancy variables across modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Now determine if this pregnancy loss will lead to any complications, log the complicated pregnancy loss and</span>
        <span class="c1"># call the function which applies risk of each complication</span>
        <span class="k">if</span> <span class="n">type_abortion</span> <span class="o">==</span> <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">risk_of_complications</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_complicated_sa&#39;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">risk_of_complications</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_complicated_ia&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_complications</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;complicated_</span><span class="si">{</span><span class="n">type_abortion</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_abortion_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">type_abortion</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_abortion_complications">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_abortion_complications">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_abortion_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function makes stores the type of complication experience by a woman following abortion.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param cause: &#39;type&#39; of abortion (spontaneous abortion OR induced abortion) (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># We apply a risk of developing specific complications associated with abortion type and store using a bitset</span>
        <span class="c1"># property</span>
        <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_injury_post_abortion&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;injury&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_injury&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_haemorrhage_post_abortion&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">)</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;abortion_haem_onset&#39;</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_haemorrhage&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_sepsis_post_abortion&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">)</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;abortion_sep_onset&#39;</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_sepsis&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;other&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_other_comp&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1"># We assume only women with complicated abortions will experience disability</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;abortion_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Determine if those women will seek care</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;abortion&#39;</span><span class="p">)</span>

        <span class="c1"># Schedule possible death</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_anaemia">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_anaemia">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_anaemia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of anaemia to a slice of the data frame. It is called by PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># We determine if a subset of pregnant women will become anaemic using a linear model, in which the</span>
        <span class="c1"># preceding deficiencies act as predictors</span>
        <span class="n">anaemia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># We use a weight random draw to determine the severity of the anaemia</span>
        <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                           <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mild_mod_sev_anaemia&#39;</span><span class="p">],</span>
                                                           <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">])),</span>
                                           <span class="n">index</span><span class="o">=</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice_severity</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c1"># We store onset date of anaemia according to severity, as weights vary</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span>
                <span class="n">person</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_anaemia_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_gestational_diabetes">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_gestational_diabetes">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_gestational_diabetes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of gestational diabetes to a slice of the data frame. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">gest_diab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;gest_diab&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                                                       <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                                                       <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                                       <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># Gestational diabetes, at onset, is defined as uncontrolled prior to treatment</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uncontrolled&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;gest_diab&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_hypertensive_disorders">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_hypertensive_disorders">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_hypertensive_disorders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of mild pre-eclampsia and mild gestational diabetes to a slice of the data frame. It</span>
<span class="sd">        is called by PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1">#  ----------------------------------- RISK OF PRE-ECLAMPSIA ----------------------------------------------</span>
        <span class="c1"># We assume all women must develop mild pre-eclampsia/gestational hypertension before progressing to a more</span>
        <span class="c1"># severe disease</span>
        <span class="n">pre_eclampsia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1">#  -------------------------------- RISK OF GESTATIONAL HYPERTENSION --------------------------------------</span>
        <span class="c1"># For women who dont develop pre-eclampsia during this month, we apply a risk of gestational hypertension</span>
        <span class="n">gest_hypertension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mild_gest_htn&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_progression_of_hypertension">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_progression_of_hypertension">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_progression_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies a risk of progression of hypertensive disorders to women who are experiencing one of the</span>
<span class="sd">        hypertensive disorders. It is called by PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">def</span> <span class="nf">apply_risk</span><span class="p">(</span><span class="n">selected</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">):</span>

            <span class="c1"># Define the possible states that can be moved between</span>
            <span class="n">disease_states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">disease_states</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_states</span><span class="p">)</span>

            <span class="c1"># Probability of moving between states is stored in a matrix. Risk of progression from mild gestational</span>
            <span class="c1"># hypertension to severe gestational hypertension is modified by treatment effect</span>

            <span class="n">risk_ghtn_remains_mild</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">risk_of_gest_htn_progression</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

            <span class="c1"># We reset the parameter here to allow for testing with the original parameter</span>

            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">risk_ghtn_remains_mild</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">,</span>
                                       <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_sgh_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mpe_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_spe_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_ec_matrix&#39;</span><span class="p">]</span>

            <span class="c1"># We update the data frame with transitioned states (which may not have changed)</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;ps_htn_disorders&quot;</span><span class="p">]</span>
            <span class="n">new_status</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transition_states</span><span class="p">(</span><span class="n">current_status</span><span class="p">,</span> <span class="n">prob_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;ps_htn_disorders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_status</span>

            <span class="c1"># ... and then log new progressed cases</span>
            <span class="k">def</span> <span class="nf">log_new_progressed_cases</span><span class="p">(</span><span class="n">disease</span><span class="p">):</span>
                <span class="c1"># Find those women who have experience progression</span>
                <span class="n">assess_status_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="n">disease</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="n">disease</span><span class="p">)</span>
                <span class="n">new_onset_disease</span> <span class="o">=</span> <span class="n">assess_status_change</span><span class="p">[</span><span class="n">assess_status_change</span><span class="p">]</span>

                <span class="c1"># Set the emergency variable for those who need to seek care, and update the mni dict is appropriate</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_disease</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">disease</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_onset_disease</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">disease</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_onset_disease</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">new_onset_disease</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span>
                                                                  <span class="n">mni</span><span class="o">=</span><span class="n">mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;eclampsia_onset&#39;</span><span class="p">,</span>
                                                                  <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                    <span class="c1"># And log all of the new onset cases of any hypertensive disease</span>
                    <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">new_onset_disease</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                                       <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">disease</span><span class="p">,</span>
                                                                       <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>
                        <span class="k">if</span> <span class="n">disease</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">for</span> <span class="n">disease</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">]:</span>
                <span class="n">log_new_progressed_cases</span><span class="p">(</span><span class="n">disease</span><span class="p">)</span>

        <span class="c1"># Here we select the women in the data frame who are at risk of progression.</span>
        <span class="n">women_not_on_anti_htns</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_htn_disorders</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|mild_pre_eclamp|severe_gest_htn|severe_pre_eclamp&#39;</span><span class="p">))</span> \
            <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span>

        <span class="n">women_on_anti_htns</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_htn_disorders</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|mild_pre_eclamp|severe_gest_htn|severe_pre_eclamp&#39;</span><span class="p">))</span>\
            <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span>

        <span class="c1"># Check theres no accidental cross over between these subsets</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">women_not_on_anti_htns</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">women_not_on_anti_htns</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">women_on_anti_htns</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">women_on_anti_htns</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Risk of progression of HTN disorder is being applied to some women &#39;</span>
                                              <span class="s1">&#39;twice&#39;</span><span class="p">)</span>

        <span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_not_on_anti_htns</span><span class="p">,</span> <span class="n">risk_progression_mild_to_severe_htn</span><span class="p">)</span>
        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_on_anti_htns</span><span class="p">,</span> <span class="p">(</span><span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">*</span>
                                        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_anti_htns_progression&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_death_from_hypertension">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_death_from_hypertension">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_death_from_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of death to women with severe hypertensive disease (severe gestational hypertension/</span>
<span class="sd">        severe pre-eclampsia). For women who die this function schedules InstantaneousDeathEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Risk of death is applied to women with severe hypertensive disease</span>
        <span class="n">at_risk</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">)</span>

        <span class="n">at_risk_of_death_htn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]))</span> <span class="o">&lt;</span>
                                         <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_monthly_death_severe_htn&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Those women who die have InstantaneousDeath scheduled</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;severe_gestational_hypertension&#39;</span><span class="p">,</span>
                                                        <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>

                <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">]</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_placental_abruption">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_placental_abruption">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_placental_abruption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of placental abruption to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">placenta_abruption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_antepartum_haemorrhage">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_antepartum_haemorrhage">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of antepartum haemorrhage to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">antepartum_haemorrhage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># Weighted random draw is used to determine severity (for DALY weight mapping)</span>
        <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mod_sev_aph&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
                <span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">])),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># We store the severity of the bleed and signify this woman is experiencing an emergency event</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">random_choice_severity</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Store onset to calculate daly weights</span>
        <span class="n">severe_women</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span>
                        <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>

        <span class="c1"># Store complication onset and log each new case of APH</span>
        <span class="n">severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni</span><span class="o">=</span><span class="n">mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;severe_aph_onset&#39;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;severe_antepartum_haemorrhage&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="n">non_severe_women</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                   <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>

        <span class="n">non_severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">non_severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni</span><span class="o">=</span><span class="n">mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;mild_mod_aph_onset&#39;</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">non_severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">non_severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mild_mod_antepartum_haemorrhage&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_premature_rupture_of_membranes_and_chorioamnionitis">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_premature_rupture_of_membranes_and_chorioamnionitis">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_premature_rupture_of_membranes_and_chorioamnionitis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of premature rupture of membranes to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># select at risk population and apply risk</span>
        <span class="n">at_risk</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span>

        <span class="n">prom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_prom_per_month&#39;</span><span class="p">],</span>
                         <span class="n">index</span><span class="o">=</span><span class="n">at_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># We allow women to seek care for PROM</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;PROM&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1"># Determine if those with PROM will develop infection prior to care seeking</span>
        <span class="n">infection</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_chorioamnionitis&#39;</span><span class="p">],</span>
                              <span class="n">index</span><span class="o">=</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">infection</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">infection</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">infection</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">infection</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni</span><span class="o">=</span><span class="n">mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;chorio_onset&#39;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">infection</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">infection</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;chorio_in_preg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;clinical_chorioamnionitis&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_preterm_labour">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_preterm_labour">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_preterm_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of preterm labour to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">preterm_labour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;early_onset_labour&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="c1"># To prevent clustering of labour onset we scatter women to go into labour on a random day before their</span>
        <span class="c1"># next month gestation</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">preterm_labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">preterm_labour</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">27</span> <span class="o">-</span> <span class="mi">22</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="c1"># We only allow labour to onset from 24 weeks (to match with our definition of preterm labour)</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">27</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">35</span> <span class="o">-</span> <span class="mi">31</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">37</span> <span class="o">-</span> <span class="mi">35</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If any other gestational ages are pass, the function should end</span>
                <span class="k">return</span>

            <span class="c1"># Due date is updated</span>
            <span class="n">new_due_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">onset_day</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">new_due_date</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> will go into preterm labour on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">new_due_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># And the labour onset event is scheduled for the new due date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">labour</span><span class="o">.</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person</span><span class="p">),</span>
                                    <span class="n">new_due_date</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.update_variables_post_still_birth_for_data_frame">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.update_variables_post_still_birth_for_data_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">women</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function updates variables for a slice of the dataframe who have experience antepartum stillbirth</span>
<span class="sd">        :param women: women who are experiencing stillbirth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># We reset the relevant pregnancy variables</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># We turn the &#39;delete_mni&#39; key to true- so after the next daly poll this womans entry is deleted, and reset</span>
        <span class="c1"># pregnancy status and update contraceptive status</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">})</span>

        <span class="c1"># Call functions across the modules to ensure properties are rest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.update_variables_post_still_birth_for_individual">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.update_variables_post_still_birth_for_individual">[docs]</a>
    <span class="k">def</span> <span class="nf">update_variables_post_still_birth_for_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called to reset all the relevant pregnancy and treatment variables for a woman who undergoes</span>
<span class="sd">        stillbirth outside of the PregnancySupervisor polling event.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">})</span>

        <span class="c1"># Reset pregnancy and schedule possible update of contraception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span>
            <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_still_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_still_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_still_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of still birth to a slice of the data frame. It is called by PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: INT used to select women from the data frame at certain gestation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">still_birth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="n">still_birth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_birth</span><span class="p">])</span></div>


<div class="viewcode-block" id="PregnancySupervisor.induction_care_seeking_and_still_birth_risk">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.induction_care_seeking_and_still_birth_risk">[docs]</a>
    <span class="k">def</span> <span class="nf">induction_care_seeking_and_still_birth_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called for post term women and applies a probability that they will seek care for induction</span>
<span class="sd">        and if not will experience risk of antenatal stillbirth</span>
<span class="sd">        :param gestation_of_interest: INT used to select women from the data frame at certain gestation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># We select the appropriate women</span>
        <span class="n">post_term_women</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ac_admitted_for_immediate_delivery</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ps_emergency_event</span>

        <span class="c1"># Apply a probability they will seek care for induction</span>
        <span class="n">care_seekers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_term_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">post_term_women</span><span class="p">]))</span>
                                 <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_induction&#39;</span><span class="p">],</span>
                                 <span class="n">index</span><span class="o">=</span><span class="n">post_term_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">post_term_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># If they do, we scheduled them to preset to a health facility immediately (this HSI schedules the correct</span>
        <span class="c1"># labour modules)</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seekers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">induction</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">induction</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># For those who dont seek care we a apply a weekly risk of stillbirth (this function is called weekly for women</span>
        <span class="c1"># who are post term)</span>
        <span class="n">non_care_seekers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seekers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">still_birth_risk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">non_care_seekers</span><span class="p">)</span>
        <span class="n">weeks_per_month</span> <span class="o">=</span> <span class="p">(</span><span class="n">DAYS_IN_YEAR</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span>
        <span class="n">weekly_risk</span> <span class="o">=</span> <span class="n">still_birth_risk</span> <span class="o">/</span> <span class="n">weeks_per_month</span>
        <span class="n">still_birth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weekly_risk</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">weekly_risk</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="n">still_birth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_birth</span><span class="p">])</span></div>


<div class="viewcode-block" id="PregnancySupervisor.care_seeking_pregnancy_loss_complications">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.care_seeking_pregnancy_loss_complications">[docs]</a>
    <span class="k">def</span> <span class="nf">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages care seeking for women experiencing ectopic pregnancy or complications following</span>
<span class="sd">        spontaneous/induced abortion.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param cause: &#39;abortion&#39;, &#39;ectopic_pre_rupture&#39;, &#39;ectopic_ruptured&#39;</span>
<span class="sd">        :return: Returns True/False value to signify care seeking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Care seeking probability varies according to complication</span>
        <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;ectopic_pre_rupture&#39;</span><span class="p">:</span>
            <span class="n">care_seeking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_care_seeking_ectopic_pre_rupture&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">care_seeking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_loss&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">care_seeking</span><span class="p">:</span>
            <span class="c1"># We assume women will seek care via HSI_GenericEmergencyFirstApptAtFacilityLevel1 and will be admitted for</span>
            <span class="c1"># care in CareOfWomenDuringPregnancy module</span>
            <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="n">HSI_GenericEmergencyFirstAppt</span>

            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_GenericEmergencyFirstAppt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span>
                                                  <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_death_from_monthly_complications">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_death_from_monthly_complications">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_death_from_monthly_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the risk of death for women who have developed complications but have not received</span>
<span class="sd">        treatment.  It is called by the PregnancySupervisor Event and HSI_CareOfWomenDuringPregnancy_Maternal</span>
<span class="sd">        EmergencyAssessment if care cant be delivered .</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># Function checks df for any potential cause of death, uses CFR parameters to determine risk of death</span>
        <span class="c1"># (either from one or multiple causes) and if death occurs returns the cause</span>
        <span class="n">potential_cause_of_death</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_for_risk_of_death_from_cause_maternal</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;antenatal&#39;</span><span class="p">)</span>

        <span class="c1"># If a cause is returned death is scheduled</span>
        <span class="k">if</span> <span class="n">potential_cause_of_death</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_mni_for_maternal_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="n">potential_cause_of_death</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If not we reset variables and the woman survives</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="PregnancySupervisor.schedule_first_anc_contact_for_new_pregnancy">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.schedule_first_anc_contact_for_new_pregnancy">[docs]</a>
    <span class="k">def</span> <span class="nf">schedule_first_anc_contact_for_new_pregnancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the PregnancySupervisorEvent for all pregnant women at 8 weeks gestational age to</span>
<span class="sd">         determine if/when they will attend their first ANC visit.</span>
<span class="sd">        :param gestation_of_interest: INT used to select women from the data frame at certain gestation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># In analysis is occuring where ANC4+ should occur for all women this is set here</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_analysis_in_progress&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_max&#39;</span><span class="p">]:</span>
            <span class="n">df_slice</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">schedule_anc_one</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">anc_month</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># First we identify all the women predicted to attend ANC, with the first visit occurring before 4 months</span>
            <span class="n">early_initiation_anc4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;early_initiation_anc4&#39;</span><span class="p">],</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

            <span class="c1"># Of the women who will not attend ANC4 early, we determine who will attend ANC4 later in pregnancy</span>
            <span class="n">late_initiation_anc4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">early_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">early_initiation_anc4</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_late_initiation_anc4&#39;</span><span class="p">],</span>
                                            <span class="n">index</span><span class="o">=</span><span class="n">early_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">early_initiation_anc4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># Check there are no duplicates</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">late_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">late_initiation_anc4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">early_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">early_initiation_anc4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Probability of ANC4 is being applied to some women twice&#39;</span><span class="p">)</span>

            <span class="c1"># Update this variable used in the ANC HSIs for scheduling the next visits</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">early_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">early_initiation_anc4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">late_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">late_initiation_anc4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Select any women who are not predicted to attend ANC4</span>
            <span class="n">anc_below_4</span> <span class="o">=</span> \
                <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>\
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ps_anc4</span>

            <span class="c1"># See if any of the women who wont attend ANC4 will still attend their first visit early in pregnancy</span>
            <span class="n">early_initiation_anc_below_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">anc_below_4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anc_below_4</span><span class="p">]))</span>
                                                     <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_early_initiation_anc_below4&#39;</span><span class="p">],</span>
                                                     <span class="n">index</span><span class="o">=</span><span class="n">anc_below_4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anc_below_4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># Call the functions that schedule the HSIs according to the predicted month of gestation at which each</span>
            <span class="c1"># woman will attend her first visit</span>
            <span class="k">def</span> <span class="nf">schedule_early_visit</span><span class="p">(</span><span class="n">df_slice</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">random_draw_gest_at_anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_anc1_months_2_to_4&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">schedule_anc_one</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">anc_month</span><span class="o">=</span><span class="n">random_draw_gest_at_anc</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">early_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">early_initiation_anc4</span><span class="p">],</span>
                      <span class="n">early_initiation_anc_below_4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">early_initiation_anc_below_4</span><span class="p">]]:</span>
                <span class="n">schedule_early_visit</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">schedule_late_visit</span><span class="p">(</span><span class="n">df_slice</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">random_draw_gest_at_anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_anc1_months_5_to_9&#39;</span><span class="p">])</span>

                    <span class="c1"># We use month ten to capture women who will never attend ANC during their pregnancy</span>
                    <span class="k">if</span> <span class="n">random_draw_gest_at_anc</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">schedule_anc_one</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">anc_month</span><span class="o">=</span><span class="n">random_draw_gest_at_anc</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">late_initiation_anc4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">late_initiation_anc4</span><span class="p">],</span>
                      <span class="n">early_initiation_anc_below_4</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">early_initiation_anc_below_4</span><span class="p">]]:</span>
                <span class="n">schedule_late_visit</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancySupervisor.do_at_generic_first_appt_emergency">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.do_at_generic_first_appt_emergency">[docs]</a>
    <span class="k">def</span> <span class="nf">do_at_generic_first_appt_emergency</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">patient_details</span><span class="p">:</span> <span class="n">PatientDetails</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndividualPropertyUpdates</span><span class="p">:</span>
        <span class="n">scheduling_options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;topen&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="s2">&quot;tclose&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="c1"># -----  ECTOPIC PREGNANCY  -----</span>
        <span class="k">if</span> <span class="n">patient_details</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy</span><span class="p">(</span>
                <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;CareOfWomenDuringPregnancy&quot;</span><span class="p">],</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">patient_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">healthsystem</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">**</span><span class="n">scheduling_options</span><span class="p">)</span>

        <span class="c1"># -----  COMPLICATIONS OF ABORTION  -----</span>
        <span class="n">abortion_complications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span>
            <span class="s2">&quot;PregnancySupervisor&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">abortion_complications</span>
        <span class="k">if</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">patient_id</span><span class="p">],</span> <span class="s2">&quot;sepsis&quot;</span><span class="p">,</span> <span class="s2">&quot;injury&quot;</span><span class="p">,</span> <span class="s2">&quot;haemorrhage&quot;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement</span><span class="p">(</span>
                <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;CareOfWomenDuringPregnancy&quot;</span><span class="p">],</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">patient_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">healthsystem</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">**</span><span class="n">scheduling_options</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="PregnancySupervisorEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent">[docs]</a>
<span class="k">class</span> <span class="nc">PregnancySupervisorEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This is the PregnancySupervisorEvent, it is a weekly event which has four primary functions.</span>
<span class="sd">    1.) It updates the gestational age (in weeks) of all women who are pregnant</span>
<span class="sd">    2.) It applies monthly risk of key complications associated with pregnancy</span>
<span class="sd">    3.) It determines if women who experience life seeking complications associated with pregnancy will seek care</span>
<span class="sd">    4.) It applies risk of death and stillbirth to women who do not seek care following complications&quot;&quot;&quot;</span>
<div class="viewcode-block" id="PregnancySupervisorEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="PregnancySupervisorEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># =================================== UPDATING LENGTH OF PREGNANCY ============================================</span>
        <span class="c1"># Length of pregnancy is commonly measured as gestational age which commences on the first day of a womans last</span>
        <span class="c1"># menstrual period (therefore including around 2 weeks in which a woman isnt pregnant)</span>

        <span class="c1"># We calculate a womans gestational age by first calculating the foetal age (measured from conception) and then</span>
        <span class="c1"># adding 2 weeks. The literature describing the epidemiology of maternal conditions almost exclusively uses</span>
        <span class="c1"># gestational age</span>

        <span class="n">alive_and_preg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span>
        <span class="n">foetal_age_in_days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span>
        <span class="n">foetal_age_in_weeks</span> <span class="o">=</span> <span class="n">foetal_age_in_days</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">rounded_weeks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">foetal_age_in_weeks</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rounded_weeks</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Gestational age was incorrectly calculated for some women&#39;</span><span class="p">)</span>

        <span class="c1"># Here we begin to populate the mni dictionary for each newly pregnant woman. Within this module this dictionary</span>
        <span class="c1"># contains information about the onset of complications in order to calculate monthly DALYs</span>
        <span class="n">newly_pregnant</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">newly_pregnant</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_mni_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

        <span class="c1"># =========================== APPLYING RISK OF ADVERSE PREGNANCY OUTCOMES =====================================</span>
        <span class="c1"># The aim of this event is to apply risk of certain outcomes of pregnancy at relevant points in a womans</span>
        <span class="c1"># gestation. Risk of complications that occur only once during pregnancy (below) are applied within the event,</span>
        <span class="c1"># otherwise code applying risk is stored in functions (above)</span>

        <span class="c1"># At the beginning of pregnancy (3 weeks GA (and therefore the first week a woman is pregnant) we determine if</span>
        <span class="c1"># a woman will develop ectopic pregnancy, multiple pregnancy, placenta praevia and if/when she will seek care</span>
        <span class="c1"># for her first antenatal visit</span>

        <span class="c1">#  ------------------------------APPLYING RISK OF ECTOPIC PREGNANCY -------------------------------------------</span>
        <span class="c1"># We use the apply_linear_model function to determine which women will develop ectopic pregnancy - this format</span>
        <span class="c1"># is similar to the functions which apply risk of complication</span>
        <span class="n">new_pregnancy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ectopic_risk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_pregnancy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span><span class="p">]))</span> <span class="o">&lt;</span>
                                 <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_ectopic_pregnancy&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">new_pregnancy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Make the appropriate changes to the data frame and log the number of ectopic pregnancies</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_ruptured&#39;</span>

        <span class="c1"># For women whose pregnancy is ectopic we scheduled them to the EctopicPregnancyEvent in between 3-5 weeks</span>
        <span class="c1"># (this simulates time period prior to which symptoms onset- and may trigger care seeking)</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ectopic_unruptured&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person</span><span class="p">),</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))</span>

        <span class="c1">#  ---------------------------- APPLYING RISK OF MULTIPLE PREGNANCY -------------------------------------------</span>
        <span class="c1"># For the women who aren&#39;t having an ectopic, we determine if they may be carrying multiple pregnancies and make</span>
        <span class="c1"># changes accordingly</span>
        <span class="n">multiple_risk</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">multiples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiple_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiple_risk</span><span class="p">]))</span>
                              <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_multiples&#39;</span><span class="p">],</span>  <span class="n">index</span><span class="o">=</span><span class="n">multiple_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiple_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;multiple_pregnancy&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1">#  -----------------------------APPLYING RISK OF PLACENTA PRAEVIA  -------------------------------------------</span>
        <span class="c1"># Next,we apply a one off risk of placenta praevia (placenta will grow to cover the cervix either partially or</span>
        <span class="c1"># completely) which will increase likelihood of bleeding later in pregnancy</span>
        <span class="n">placenta_praevia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;placenta_praevia&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1">#  ------------------------- APPLYING RISK OF SYPHILIS INFECTION DURING PREGNANCY  ---------------------------</span>
        <span class="c1"># Finally apply risk that syphilis will develop during pregnancy</span>
        <span class="n">at_risk_women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span>
                                                                                                <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">syphilis_risk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">at_risk_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_women</span><span class="p">]))</span>
                                  <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_syphilis_during_pregnancy&#39;</span><span class="p">],</span>
                                  <span class="n">index</span><span class="o">=</span><span class="n">at_risk_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Schedule point of onset randomly during possible length of pregnancy</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">syphilis_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">syphilis_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">280</span><span class="p">)</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;pred_syph_infect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">onset_day</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">SyphilisInPregnancyEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person</span><span class="p">),</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">onset_day</span><span class="p">)))</span>

        <span class="c1"># ------------------------ APPLY RISK OF ADDITIONAL PREGNANCY COMPLICATIONS -----------------------------------</span>
        <span class="c1"># The following functions apply risk of key complications/outcomes of pregnancy at specific time points of a</span>
        <span class="c1"># mothers gestation in weeks. These &#39;gestation_of_interest&#39; parameters roughly represent the last week in each</span>
        <span class="c1"># month of pregnancy. These time  points at which risk is applied, vary between complications according to their</span>
        <span class="c1"># epidemiology</span>

        <span class="c1"># The application of these risk is intentionally ordered as described below...</span>

        <span class="c1"># Women in the first five months of pregnancy are at risk of spontaneous abortion (miscarriage)</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_spontaneous_abortion</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># From the second month of pregnancy until month 5 women who do not experience spontaneous abortion may undergo</span>
        <span class="c1"># induced abortion</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_induced_abortion</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># Next, at 8 weeks gestation, we determine if/when women will seek antenatal care</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_analysis_in_progress&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_analysis_in_progress&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                                     <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_min&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_first_anc_contact_for_new_pregnancy</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="c1"># Every month a risk of maternal anaemia is applied</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_anaemia</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># For women whose pregnancy will continue will apply a risk of developing a number of acute and chronic</span>
        <span class="c1"># (length of pregnancy) complications</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_hypertensive_disorders</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_gestational_diabetes</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_placental_abruption</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_antepartum_haemorrhage</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_premature_rupture_of_membranes_and_chorioamnionitis</span><span class="p">(</span>
                <span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="c1"># Women with hypertension are at risk of there condition progression, this risk is applied months 6-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_progression_of_hypertension</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="c1"># And of death...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_death_from_hypertension</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># From month 5-8 we apply risk of a woman going into early labour</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_preterm_labour</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># ------------------------------- CARE SEEKING FOR PREGNANCY EMERGENCIES --------------------------------------</span>
        <span class="c1"># Every week when the event runs we determine if any women who have experience an emergency event in pregnancy</span>
        <span class="c1"># will seek care</span>

        <span class="k">def</span> <span class="nf">apply_death_risk</span><span class="p">(</span><span class="n">person_id</span><span class="p">):</span>
            <span class="c1"># We reset this variable to prevent additional unnecessary care seeking next month</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># As women may have experience more than one complication during the moth we determine here which of the</span>
            <span class="c1"># complication will be the primary cause of death</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_death_from_monthly_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># Any women for whom ps_emergency_event == True may chose to seek care for one or more severe complications</span>
        <span class="c1"># (antepartum haemorrhage, severe pre-eclampsia, eclampsia or premature rupture of membranes) - this is distinct</span>
        <span class="c1"># from care seeking following abortion/ectopic</span>
        <span class="n">potential_care_seekers</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">ps_emergency_event</span> <span class="o">&amp;</span> \
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="n">care_seeking</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">potential_care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">potential_care_seekers</span><span class="p">]))</span>
                                 <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">],</span>
                                 <span class="n">index</span><span class="o">=</span><span class="n">potential_care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">potential_care_seekers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># We assume women who seek care will present to a form of Maternal Assessment Unit- not through normal A&amp;E</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>

                <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">inpatient_pregnancy_hsi</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">inpatient_pregnancy_hsi</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Women who cant seek care as they are admitted for another reason have a risk of death applied</span>
                <span class="n">apply_death_risk</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="c1"># -------- APPLYING RISK OF DEATH/STILL BIRTH FOR NON-CARE SEEKERS FOLLOWING PREGNANCY EMERGENCIES --------</span>
        <span class="c1"># We select the women who have chosen not to seek care following pregnancy emergency- and we now apply risk of</span>
        <span class="c1"># death</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">apply_death_risk</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="c1"># ============================ RISK OF STILLBIRTH ========================================================</span>
        <span class="c1"># Next we apply a background risk of antenatal stillbirth...</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_still_birth</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># ============================ POST TERM RISK OF STILLBIRTH ==================================================</span>
        <span class="c1"># Finally we determine if women who are post term will seek care for induction/experience stillbirth</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">induction_care_seeking_and_still_birth_risk</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># Finally reset the emergency event property for care seeking women (used to ensure risk of stillbirth is</span>
        <span class="c1"># applied to women who arent seeking care that month)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>
</div>



<div class="viewcode-block" id="EctopicPregnancyEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent">[docs]</a>
<span class="k">class</span> <span class="nc">EctopicPregnancyEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is EctopicPregnancyEvent. It is scheduled by the set_pregnancy_complications function within</span>
<span class="sd">     PregnancySupervisorEvent for women who have experienced ectopic pregnancy. This event makes changes to the data</span>
<span class="sd">     frame for women with ectopic pregnancies, applies a probability of care seeking and schedules the</span>
<span class="sd">     EctopicRuptureEvent.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EctopicPregnancyEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="EctopicPregnancyEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Reset pregnancy variables and store onset for daly calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">,</span>
                                                      <span class="s1">&#39;ectopic_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Determine if women will seek care at this stage</span>
        <span class="n">care_seeking_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                    <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;ectopic_pre_rupture&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">care_seeking_result</span><span class="p">:</span>

            <span class="c1"># For women who dont seek care (and get treatment) we schedule EctopicPregnancyRuptureEvent (simulating</span>
            <span class="c1"># fallopian tube rupture) in an additional 2-4 weeks from this event (if care seeking is unsuccessful</span>
            <span class="c1"># then this event is scheduled by the HSI (did_not_run)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyRuptureEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))</span></div>
</div>



<div class="viewcode-block" id="EctopicPregnancyRuptureEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent">[docs]</a>
<span class="k">class</span> <span class="nc">EctopicPregnancyRuptureEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is EctopicPregnancyRuptureEvent. It is scheduled by the EctopicPregnancyEvent for women who have</span>
<span class="sd">    experienced an ectopic pregnancy which has ruptured due to lack of treatment. This event manages care seeking post</span>
<span class="sd">    rupture and schedules EarlyPregnancyLossDeathEvent&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EctopicPregnancyRuptureEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="EctopicPregnancyRuptureEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                       <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ectopic_ruptured&#39;</span><span class="p">,</span>
                                                       <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span>

        <span class="c1"># Set the variable</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ruptured&#39;</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">,</span>
                                                      <span class="s1">&#39;ectopic_rupture_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># We see if this woman will now seek care following rupture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;ectopic_ruptured&#39;</span><span class="p">)</span>

        <span class="c1"># We delayed the death event by three days to allow any treatment effects to mitigate risk of death</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent">[docs]</a>
<span class="k">class</span> <span class="nc">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is EarlyPregnancyLossDeathEvent. It is scheduled by the EctopicPregnancyRuptureEvent &amp; abortion for</span>
<span class="sd">    women who are at risk of death following a loss of their pregnancy&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cause</span> <span class="o">=</span> <span class="n">cause</span></div>


<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Individual risk of death is calculated through the linear model</span>
        <span class="n">risk_of_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If the death occurs we record it here</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_mni_for_maternal_death</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">)</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise we reset any variables</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent">[docs]</a>
<span class="k">class</span> <span class="nc">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is GestationalDiabetesGlycaemicControlEvent. It is scheduled by CareOfWomenDuringPregnancy module after a</span>
<span class="sd">    woman is started on treatment for gestational diabetes. This event determines if the treatment a woman has been</span>
<span class="sd">    started on for GDM will effectively control her blood sugars</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="ow">or</span>
           <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">))):</span>
            <span class="k">return</span>

        <span class="c1"># We apply a probability that the treatment this woman is receiving for her GDM (diet and exercise/</span>
        <span class="c1"># oral anti-diabetics) will not control this womans hyperglycaemia</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_glycaemic_control_</span><span class="si">{</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span><span class="w"> </span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>
            <span class="c1"># If so we reset her diabetes status as uncontrolled, her treatment is ineffective at reducing</span>
            <span class="c1"># risk of still birth, and when she returns for follow up she should be started on the next</span>
            <span class="c1"># treatment available</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uncontrolled&#39;</span></div>
</div>



<div class="viewcode-block" id="SyphilisInPregnancyEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.SyphilisInPregnancyEvent">[docs]</a>
<span class="k">class</span> <span class="nc">SyphilisInPregnancyEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is SyphilisInPregnancyEvent. It is scheduled by PregnancySupervisorEvent module after a</span>
<span class="sd">    woman becomes pregnant and is predicted to experience syphilis during their pregnancy. This event onsets Syphilis</span>
<span class="sd">    in those women &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SyphilisInPregnancyEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.SyphilisInPregnancyEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyphilisInPregnancyEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.SyphilisInPregnancyEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">)</span> <span class="ow">or</span>
           <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;pred_syph_infect&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">))):</span>
            <span class="k">return</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                       <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;syphilis&#39;</span><span class="p">,</span>
                                                       <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;antenatal&#39;</span><span class="p">})</span></div>
</div>



<div class="viewcode-block" id="ParameterUpdateEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.ParameterUpdateEvent">[docs]</a>
<span class="k">class</span> <span class="nc">ParameterUpdateEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is ParameterUpdateEvent. It is scheduled to occur once on 2015 to update parameters being used by the</span>
<span class="sd">    maternal and newborn health model&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ParameterUpdateEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.ParameterUpdateEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">)</span></div>


<div class="viewcode-block" id="ParameterUpdateEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.ParameterUpdateEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Now updating parameters in the maternal and perinatal health modules...&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">]]:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_current_parameter_dictionary</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">list_position</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Scale the linear models again according to the distribution of the population</span>
        <span class="n">mod_ps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ps_linear_models</span>
        <span class="n">mod_la</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">la_linear_models</span>

        <span class="n">ps_models_to_be_scaled</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_placenta_praevia&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">],</span> <span class="s1">&#39;baseline_prob_anaemia_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;gest_diab&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_gest_diab_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_gest_htn_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_pre_eclampsia_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_placental_abruption_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_still_birth_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;early_initiation_anc4&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_early_init_anc4&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_spontaneous_abortion_per_month&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_ps</span><span class="p">[</span><span class="s1">&#39;early_onset_labour&#39;</span><span class="p">],</span> <span class="s1">&#39;baseline_prob_early_labour_onset&#39;</span><span class="p">]]</span>

        <span class="n">la_models_to_be_scaled</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mod_la</span><span class="p">[</span><span class="s1">&#39;uterine_rupture_ip&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_uterine_rupture&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_la</span><span class="p">[</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_will_attend_pnc&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_la</span><span class="p">[</span><span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_deliver_at_home&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="n">mod_la</span><span class="p">[</span><span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_deliver_in_health_centre&#39;</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">ps_models_to_be_scaled</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">scale_linear_model_at_initialisation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_key</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">la_models_to_be_scaled</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">scale_linear_model_at_initialisation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_key</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="PregnancyAnalysisEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyAnalysisEvent">[docs]</a>
<span class="k">class</span> <span class="nc">PregnancyAnalysisEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is PregnancyAnalysisEvent. This event is scheduled in initialise_simulation. When this event runs, and if</span>
<span class="sd">    either of the module parameters the signify analysis is being conducted are set to True, then key parameters</span>
<span class="sd">    are overridden to alter the coverage and/or quality of routine antenatal care delivery.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PregnancyAnalysisEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyAnalysisEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">)</span></div>


<div class="viewcode-block" id="PregnancyAnalysisEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyAnalysisEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Check if either of the analysis parameters are set to True</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_anc_coverage&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_anc_quality&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_ip_anc_quality&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_max&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_min&#39;</span><span class="p">]:</span>

            <span class="c1"># Update this parameter which is a signal used in the pregnancy_helper_function_file to ensure that</span>
            <span class="c1"># alternative functionality for determining availability of interventions only occurs when analysis is</span>
            <span class="c1"># occurring</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_analysis_in_progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># When this parameter is set as True, the following parameters are overridden when the event is called.</span>
            <span class="c1"># Otherwise no parameters are updated.</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_anc_coverage&#39;</span><span class="p">]:</span>

                <span class="c1"># Reset the intercept parameter of the equation determining care seeking for ANC4+ and scale the model</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;anc_availability_odds&#39;</span><span class="p">]</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;odds_early_init_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ps_linear_models</span><span class="p">[</span><span class="s1">&#39;early_initiation_anc4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)],</span>
                    <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span>
                <span class="n">scaled_intercept</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">target</span> <span class="o">/</span> <span class="n">mean</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">target</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">mean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean</span><span class="p">))</span> <span class="k">else</span> <span class="mf">1.0</span>

                <span class="c1"># Update parameters that also control when women will initiate visits</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;odds_early_init_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_intercept</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_anc1_months_2_to_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_late_initiation_anc4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Finally, remove squeeze factor threshold for ANC attendance to ensure that higher levels of ANC</span>
                <span class="c1"># coverage can  be reached with current logic</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;squeeze_factor_threshold_anc&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="mi">10_000</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_anc_quality&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_max&#39;</span><span class="p">]:</span>

                <span class="c1"># Override the availability of IPTp consumables with the set level of coverage</span>
                <span class="k">if</span> <span class="s1">&#39;Malaria&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                    <span class="n">iptp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Malaria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;malaria_iptp&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">override_availability_of_consumables</span><span class="p">(</span>
                        <span class="p">{</span><span class="n">iptp</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;anc_availability_probability&#39;</span><span class="p">]})</span>

                <span class="c1"># And then override the quality parameters in the model</span>
                <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_urine_ds&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_intervention_delivered_bp&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;prob_intervention_delivered_syph_test&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_intervention_delivered_gdm_test&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;anc_availability_probability&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_ip_anc_quality&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;squeeze_factor_threshold_an&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="mi">10_000</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_max&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;prob_seek_anc5&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_seek_anc6&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_seek_anc7&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_seek_anc8&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;squeeze_factor_threshold_anc&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="mi">10_000</span>

                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;prob_adherent_ifa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sens_analysis_min&#39;</span><span class="p">]:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>
</div>



<div class="viewcode-block" id="PregnancyLoggingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">PregnancyLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is PregnancyLoggingEvent. It runs yearly to produce summary statistics around pregnancy.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PregnancyLoggingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>


<div class="viewcode-block" id="PregnancyLoggingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">women_reproductive_age</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span>
                                               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">))])</span>
        <span class="n">pregnant_at_year_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">])</span>
        <span class="n">women_with_previous_sa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span>
                                               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">ps_prev_spont_abortion</span><span class="p">)])</span>
        <span class="n">women_with_previous_pe</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span>
                                               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">ps_prev_pre_eclamp</span><span class="p">)])</span>
        <span class="n">women_with_hysterectomy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span>
                                               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_has_had_hysterectomy</span><span class="p">)])</span>

        <span class="n">yearly_prev_sa</span> <span class="o">=</span> <span class="p">(</span><span class="n">women_with_previous_sa</span> <span class="o">/</span> <span class="n">women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">yearly_prev_pe</span> <span class="o">=</span> <span class="p">(</span><span class="n">women_with_previous_pe</span> <span class="o">/</span> <span class="n">women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">yearly_prev_hysterectomy</span> <span class="o">=</span> <span class="p">(</span><span class="n">women_with_hysterectomy</span> <span class="o">/</span> <span class="n">women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">parity_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parity</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">parity</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">la_parity</span> <span class="o">==</span> <span class="n">parity</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">par</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">la_parity</span> <span class="o">&gt;=</span> <span class="n">parity</span><span class="p">))])</span>

            <span class="n">yearly_prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span> <span class="o">/</span> <span class="n">women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">parity_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yearly_prev</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;preg_info&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;women_repro_age&#39;</span><span class="p">:</span> <span class="n">women_reproductive_age</span><span class="p">,</span>
                          <span class="s1">&#39;women_pregnant&#39;</span><span class="p">:</span> <span class="n">pregnant_at_year_end</span><span class="p">,</span>
                          <span class="s1">&#39;prev_sa&#39;</span><span class="p">:</span> <span class="n">yearly_prev_sa</span><span class="p">,</span>
                          <span class="s1">&#39;prev_pe&#39;</span><span class="p">:</span> <span class="n">yearly_prev_pe</span><span class="p">,</span>
                          <span class="s1">&#39;hysterectomy&#39;</span><span class="p">:</span> <span class="n">yearly_prev_hysterectomy</span><span class="p">,</span>
                          <span class="s1">&#39;parity&#39;</span><span class="p">:</span> <span class="n">parity_list</span><span class="p">})</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on May 27, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>