

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.pregnancy_supervisor &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.pregnancy_supervisor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.pregnancy_supervisor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.labour</span> <span class="kn">import</span> <span class="n">LabourOnsetEvent</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="PregnancySupervisor"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor">[docs]</a><span class="k">class</span> <span class="nc">PregnancySupervisor</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This module is responsible for simulating the antenatal period of pregnancy (the period from conception until</span>
<span class="sd">     the termination of pregnancy). A number of outcomes are managed by this module including early pregnancy loss</span>
<span class="sd">     (induced/spontaneous abortion, ectopic pregnancy and antenatal stillbirth) and pregnancy complications of the</span>
<span class="sd">     antenatal period (nutritional deficiencies , anaemia, placental praevia/abruption,</span>
<span class="sd">     premature rupture of membranes (PROM), chorioamnionitis, hypertensive disorders (gestational hypertension,</span>
<span class="sd">     pre-eclampsia, eclampsia), gestational diabetes, maternal death). This module calculates likelihood of care seeking</span>
<span class="sd">     for routine antenatal care and emergency obstetric care in the event of severe complications.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PregnancySupervisor.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># Here we define the pregnancy_disease_tracker dictionary used by the logger to calculate summary stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Here we define the mother and newborn information dictionary which stored surplus information about women</span>
        <span class="c1"># across the length of pregnancy and the postnatal period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># This variable will store a Bitset handler for the property ps_deficiencies_in_pregnancy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># This variable will store a Bitset handler for the property ps_abortion_complications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complication</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
                <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;prob_ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of ectopic pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ectopic_smoker&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of ectopic pregnancy in a smoker&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_multiples&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a woman is currently carrying more than one pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that this womans pregnancy will be complicated by placenta praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_spontaneous_abortion_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of spontaneous abortion per month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_age_35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women aged 35 years or older&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_age_31_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women aged 31-34 years old&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_spont_abortion_prev_sa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of spontaneous abortion in women who have previously experiences spontaneous &#39;</span>
                        <span class="s1">&#39;abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_induced_abortion_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of induced abortion per month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_haemorrhage_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of haemorrhage following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of sepsis following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_injury_post_abortion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of injury following an abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;baseline_prob_early_labour_onset&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly baseline risk of labour onsetting before term&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_calcium_ptl&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset for women receiving calcium supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_preterm_labour_post_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of early labour onset following PROM&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_iron_def_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly risk of a pregnant woman becoming iron deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_folate_def_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly risk of a pregnant woman becoming folate deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_iron_def_ifa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effect of iron supplementation on iron deficiency &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_folate_def_ifa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effect of folate supplementation on folate deficiency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_b12_def_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly risk of a pregnant woman becoming b12 deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;baseline_prob_anaemia_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline risk of a woman developing anaemia secondary only to pregnant&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_iron_deficient&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of a woman developing anaemia in pregnancy if she is iron deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_folate_deficient&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of a woman developing anaemia in pregnancy if she is folate deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_b12_deficient&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of a woman developing anaemia in pregnancy if she is b12 deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_iron_folic_acid&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk reduction of maternal anaemia for women taking daily iron/folic acid&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_maternal_malaria&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of anaemia secondary to malaria infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mild_mod_sev_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a womans anaemia will be mild, moderate or severe&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pre_eclampsia_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of pre-eclampsia per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_calcium_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk reduction of pre-eclampsia for women taking daily calcium supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_gest_htn_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of gestational hypertension per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_gest_htn_calcium&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Effect of calcium supplementation on risk of developing gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_anti_htns_progression&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Effect of anti hypertensive medication in reducing the risk of progression from mild to severe&#39;</span>
                        <span class="s1">&#39; hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_sgh_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mpe_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild pre-eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_spe_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe pre-eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_ec_matrix&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of eclampsia moving between states: gestational hypertension,&#39;</span>
                        <span class="s1">&#39; severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_gest_diab_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of gestational diabetes per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_gest_diab_obesity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of gestational diabetes for women who are obese&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_glycaemic_control_diet_exercise&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a womans GDM is controlled by diet and exercise during the first month of &#39;</span>
                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_glycaemic_control_orals&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a womans GDM is controlled by oral anti-diabetics during the first month of &#39;</span>
                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_glycaemic_control_insulin&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a womans GDM is controlled by insulin during the first month of &#39;</span>
                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_placental_abruption_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly probability that a woman will develop placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antepartum_haem_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly probability that a woman will develop antepartum bleeding during pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of antepartum haemorrhage due to ongoing placenta praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of antepartum haemorrhage due to placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_mod_sev_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that APH is mild/moderate or severe&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_prom_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly probability that a woman will experience premature rupture of membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly probability of a women developing chorioamnionitis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_chorio_post_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of chorioamnionitis after PROM&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_clinical_chorio&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that a woman with chorioamnionitis will have clinical presentation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_to_clinical_chorio&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Risk that histological chorioamnionitis will progress to clinical disease&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_still_birth_per_month&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of stillbirth per month without the impact of risk factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_gest_diab&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with gestational diabetes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_mild_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with mild pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with mild gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_severe_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with severe gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_severe_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_maternal_malaria&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in women with malaria&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_still_birth_food_sups&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk reduction of still birth for women receiving nutritional supplements&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_gdm_case_management&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of GDM case management on mothers risk of stillbirth &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_ectopic_pregnancy_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman dying from a ruptured ectopic pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_ectopic_pregnancy_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of ectopic pregnancy case management&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_induced_abortion_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of death following an induced abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_spontaneous_abortion_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;underlying risk of death following an spontaneous abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_post_abortion_care&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of post abortion care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antepartum_haem_stillbirth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of stillbirth for a woman suffering acute antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antepartum_haem_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman suffering acute antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antenatal_spe_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman experiencing acute severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antenatal_ec_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of death for a woman experiencing eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_monthly_death_severe_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;monthly risk of death for a woman with severe hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_antenatal_ec_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a stillbirth following an episode of eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for chorioamnionitis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_still_birth_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of still birth for chorioamnionitis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_first_anc_visit_gestational_age&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of initiation of ANC by month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_four_or_more_anc_visits&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman undergoing 4 or more basic ANC visits&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_eight_or_more_anc_visits&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman undergoing 8 or more basic ANC visits&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_anc_at_facility_level_1_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities a woman will attend ANC 1 at facility levels 1 or 2&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probability_htn_persists&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a womans hypertension persisting post birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who is pregnant will seek care in the event of a complication&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_care_pregnancy_loss&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who has developed complications post pregnancy loss will seek care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_care_induction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman who is post term will seek care for induction of labour&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;current gestational age, in weeks, of a womans &#39;</span>
                                                            <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Date first ANC visit is scheduled for&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Whether a womans is experiencing ectopic pregnancy and&#39;</span>
                                                            <span class="s1">&#39; its current state&#39;</span><span class="p">,</span>
                                         <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">,</span> <span class="s1">&#39;ruptured&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a womans is pregnant with multiple fetuses&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a womans pregnancy will be complicated by placenta&#39;</span>
                                                    <span class="s1">&#39;praevia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column, stores types of anaemia causing &#39;</span>
                                                            <span class="s1">&#39;deficiencies in pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman has anaemia in pregnancy and its &#39;</span>
                                                               <span class="s1">&#39;severity&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this womans is predicted to attend 4 or more &#39;</span>
                                                                <span class="s1">&#39;antenatal care visits during her pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Bitset column holding types of abortion complication&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has had any previous pregnancies end in &#39;</span>
                                                       <span class="s1">&#39;spontaneous abortion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has had any previous pregnancies end in &#39;</span>
                                                   <span class="s1">&#39;still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;if this woman suffers from a hypertensive disorder of &#39;</span>
                                                        <span class="s1">&#39;pregnancy&#39;</span><span class="p">,</span>
                                     <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has experienced pre-eclampsia in a previous &#39;</span>
                                                   <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is experiencing gestational diabetes&#39;</span><span class="p">,</span>
                                 <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">,</span> <span class="s1">&#39;controlled&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has ever suffered from gestational diabetes &#39;</span>
                                                  <span class="s1">&#39;during a previous pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;severity of this womans antepartum haemorrhage&#39;</span><span class="p">,</span>
                                              <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has experience rupture of &#39;</span>
                                                                  <span class="s1">&#39;membranes before the onset of labour. If this is &#39;</span>
                                                                  <span class="s1">&#39;&lt;37 weeks from gestation the woman has preterm &#39;</span>
                                                                  <span class="s1">&#39;premature rupture of membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Whether a womans is experiencing chorioamnionitis and&#39;</span>
                                                           <span class="s1">&#39;its current state&#39;</span><span class="p">,</span>
                                                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;histological&#39;</span><span class="p">,</span> <span class="s1">&#39;clinical&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;signifies a woman in undergoing an acute emergency event in her &#39;</span>
                                                   <span class="s1">&#39;pregnancy- used to consolidated care seeking in the instance of &#39;</span>
                                                   <span class="s1">&#39;multiple complications&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="PregnancySupervisor.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_PregnancySupervisor.xlsx&#39;</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span>

        <span class="c1"># Here we map &#39;disability&#39; parameters to associated DALY weights to be passed to the health burden module.</span>
        <span class="c1"># Currently this module calculates and reports all DALY weights from all maternal modules</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_daly_weights&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">{</span><span class="s1">&#39;abortion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">352</span><span class="p">),</span>
                 <span class="s1">&#39;abortion_haem&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;abortion_sep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;ectopic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">351</span><span class="p">),</span>
                 <span class="s1">&#39;ectopic_rupture&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;mild_mod_aph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;severe_aph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;chorio&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;mild_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">476</span><span class="p">),</span>
                 <span class="s1">&#39;mild_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">476</span><span class="p">),</span>
                 <span class="s1">&#39;moderate_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">480</span><span class="p">),</span>
                 <span class="s1">&#39;moderate_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;severe_anaemia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;severe_anaemia_pp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">478</span><span class="p">),</span>
                 <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">861</span><span class="p">),</span>
                 <span class="s1">&#39;hypertension&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">343</span><span class="p">),</span>
                 <span class="s1">&#39;gest_diab&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">971</span><span class="p">),</span>
                 <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">348</span><span class="p">),</span>
                 <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">340</span><span class="p">),</span>
                 <span class="s1">&#39;mild_mod_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;severe_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">338</span><span class="p">),</span>
                 <span class="s1">&#39;secondary_pph&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">339</span><span class="p">),</span>
                 <span class="s1">&#39;vesicovaginal_fistula&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">349</span><span class="p">),</span>
                 <span class="s1">&#39;rectovaginal_fistula&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="mi">350</span><span class="p">),</span>
                 <span class="p">}</span></div>

<div class="viewcode-block" id="PregnancySupervisor.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># This bitset property stores nutritional deficiencies that can occur in the antenatal period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">,</span>
                                                       <span class="p">[</span><span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">])</span>

        <span class="c1"># This bitset property stores &#39;types&#39; of complication that can occur after an abortion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">,</span>
                                                    <span class="p">[</span><span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="PregnancySupervisor.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>

        <span class="c1"># Register and schedule the PregnancySupervisorEvent</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PregnancySupervisorEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Register and schedule logging event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PregnancyLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Define the conditions/outcomes we want to track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;multiples&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;placenta_praevia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;placental_abruption&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;ectopic_pregnancy_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;induced_abortion_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;spontaneous_abortion_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;iron_def&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;folate_def&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;b12_def&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;antenatal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;new_onset_pre_eclampsia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;new_onset_gest_diab&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;new_onset_gest_htn&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;new_onset_severe_pe&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;new_onset_eclampsia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;prom&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pre_term&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                          <span class="s1">&#39;women_at_6_months&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># ==================================== LINEAR MODEL EQUATIONS =================================================</span>
        <span class="c1"># All linear equations used in this module are stored within the ps_linear_equations parameter below</span>

        <span class="c1"># TODO: process of &#39;selection&#39; of important predictors in linear equations is ongoing, a linear model that</span>
        <span class="c1">#  is empty of predictors at the end of this process will be converted to a set probability</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation calculates a womans risk of her current pregnancy being ectopic (implantation of the</span>
            <span class="c1"># embryo outside of the uterus). This risk is applied once per pregnancy</span>
            <span class="s1">&#39;ectopic&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_ectopic_pregnancy&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_tob&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_ectopic_smoker&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation is used to determine her current pregnancy will be twins. This risk is applied once per</span>
            <span class="c1"># pregnancy</span>
            <span class="s1">&#39;multiples&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_multiples&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a womans risk of placenta praevia (placenta partially/completely covers the</span>
            <span class="c1"># cervix). This risk is applied once per pregnancy</span>
            <span class="s1">&#39;placenta_praevia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_placenta_praevia&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a womans monthly risk of spontaneous abortion (miscarriage) and is applied</span>
            <span class="c1"># monthly until 28 weeks gestation</span>
            <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_spontaneous_abortion_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_spont_abortion_prev_sa&#39;</span><span class="p">]),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;age_years&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt;34&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_spont_abortion_age_35&#39;</span><span class="p">])</span>
                                      <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(30,35)&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_spont_abortion_age_31_34&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of induced abortion and is applied monthly until 28 weeks</span>
            <span class="c1"># gestation</span>
            <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_induced_abortion_per_month&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a womans monthly risk of labour onsetting prior to her &#39;assigned&#39; due date.</span>
            <span class="c1"># This drives preterm birth rates</span>
            <span class="s1">&#39;early_onset_labour&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;baseline_prob_early_labour_onset&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_preterm_labour_post_prom&#39;</span><span class="p">]),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_calcium_ptl&#39;</span><span class="p">])),</span>
            <span class="c1">#   Predictor(&#39;ps_chorioamnionitis&#39;).when(&#39;histological&#39;, params[&#39;rr_preterm_labour_chorio&#39;])</span>
            <span class="c1">#                                     .when(&#39;clinical&#39;, params[&#39;rr_preterm_labour_chorio&#39;])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing anaemia during her pregnancy. This is</span>
            <span class="c1"># currently influenced by nutritional deficiencies and malaria status</span>
            <span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;baseline_prob_anaemia_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_anaemia_if_iron_deficient&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">element_repr</span><span class="p">(</span><span class="s1">&#39;iron&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_anaemia_if_folate_deficient&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">element_repr</span><span class="p">(</span><span class="s1">&#39;folate&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_anaemia_if_b12_deficient&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">element_repr</span><span class="p">(</span><span class="s1">&#39;b12&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="c1">#     Predictor(&#39;ma_is_infected&#39;).when(True, params[&#39;rr_anaemia_maternal_malaria&#39;])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing pre-eclampsia during her pregnancy. This is</span>
            <span class="c1"># currently influenced by receipt of calcium supplementation</span>
            <span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_pre_eclampsia_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_calcium_pre_&#39;</span>
                                                                                <span class="s1">&#39;eclamp&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing gestational hypertension</span>
            <span class="c1"># during her pregnancy. This is currently influenced receipt of calcium supplementation</span>
            <span class="s1">&#39;gest_htn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_gest_htn_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_gest_htn_calcium&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing gestational diabetes</span>
            <span class="c1"># during her pregnancy.This is currently influenced by obesity</span>
            <span class="s1">&#39;gest_diab&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_gest_diab_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_bmi&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_gest_diab_obesity&#39;</span><span class="p">])</span>
                                   <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_gest_diab_obesity&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing placental abruption</span>
            <span class="c1"># during her pregnancy.</span>
            <span class="s1">&#39;placental_abruption&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_placental_abruption_per_month&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing antepartum haemorrhage during her pregnancy.</span>
            <span class="c1"># APH can only occur in the presence of one of two preceding causes (placenta praevia and placental</span>
            <span class="c1"># abruption) hence the use of an additive model</span>
            <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">ADDITIVE</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_aph_placenta_praevia&#39;</span><span class="p">]),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_aph_placental_abruption&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of developing premature rupture of membranes during her</span>
            <span class="c1"># pregnancy.</span>
            <span class="s1">&#39;premature_rupture_of_membranes&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_prom_per_month&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a womans risk of developing chorioamnionitis following PROM .</span>
            <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_chorioamnionitis&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_chorio_post_prom&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a womans monthly risk of antenatal still birth</span>
            <span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_still_birth_per_month&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;uncontrolled&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_gest_diab&#39;</span><span class="p">]),</span>
                <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(ps_gest_diab == &quot;controlled &quot;) &amp; (ac_gest_diab_on_treatment != &quot;none&quot;)&#39;</span><span class="p">,</span>
                                 <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_gest_diab&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_gdm_case_management&#39;</span><span class="p">])),</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_mild_pre_eclamp&#39;</span><span class="p">])</span>
                                             <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_gest_htn&#39;</span><span class="p">])</span>
                                             <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_severe_gest_htn&#39;</span><span class="p">])</span>
                                             <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_still_birth_severe_pre_eclamp&#39;</span><span class="p">])),</span>
            <span class="c1">#    Predictor(&#39;ma_is_infected&#39;).when(True, params[&#39;rr_still_birth_maternal_malaria&#39;])),</span>

            <span class="c1"># This equation calculates a risk of dying after ectopic pregnancy and is mitigated by treatment</span>
            <span class="s1">&#39;ectopic_pregnancy_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_ectopic_pregnancy_death&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_ectopic_pregnancy_&#39;</span>
                                                                            <span class="s1">&#39;treatment&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a risk of dying after complications following an induced abortion. It is reduced</span>
            <span class="c1"># by treatment</span>
            <span class="s1">&#39;induced_abortion_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_induced_abortion_death&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_post_abortion_care_interventions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt;0&#39;</span><span class="p">,</span>
                                                                      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_post_abortion_care&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a risk of dying after complications following a spontaneous abortion. It is</span>
            <span class="c1"># reduced by treatment</span>
            <span class="s1">&#39;spontaneous_abortion_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_spontaneous_abortion_death&#39;</span><span class="p">],</span>
                <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;ac_post_abortion_care_interventions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt;0&#39;</span><span class="p">,</span>
                                                                      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_post_abortion_care&#39;</span><span class="p">])),</span>

            <span class="c1"># This equation calculates a risk of still birth following an antepartum haemorrhage</span>
            <span class="s1">&#39;antepartum_haemorrhage_still_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_antepartum_haem_stillbirth&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of dying following an antepartum haemorrhage</span>
            <span class="s1">&#39;antepartum_haemorrhage_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_antepartum_haem_death&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of dying from eclampsia</span>
            <span class="s1">&#39;eclampsia_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_antenatal_ec_death&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of still birth following eclampsia</span>
            <span class="s1">&#39;eclampsia_still_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_antenatal_ec_still_birth&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of death due to severe hypertension</span>
            <span class="s1">&#39;death_from_hypertensive_disorder&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_monthly_death_severe_htn&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of death due to chorioamnionitis</span>
            <span class="s1">&#39;chorioamnionitis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cfr_chorioamnionitis&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a risk of still birth due to chorioamnionitis</span>
            <span class="s1">&#39;chorioamnionitis_still_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_still_birth_chorioamnionitis&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a the probability a woman will seek care following complications associated with</span>
            <span class="c1"># pregnancy loss (ectopic, induced/spontaneous abortion)</span>
            <span class="s1">&#39;care_seeking_pregnancy_loss&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_loss&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a the probability a woman will seek care due to complications during pregnancy</span>
            <span class="s1">&#39;care_seeking_pregnancy_complication&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_pregnancy_complication&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a the probability a woman will attend at least 4 ANC contacts during her</span>
            <span class="c1"># pregnancy - derived from Wingstons analysis of DHS data</span>
            <span class="s1">&#39;four_or_more_anc_visits&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_four_or_more_anc_visits&#39;</span><span class="p">]),</span>

            <span class="c1"># This equation calculates a the probability a woman will attend at least 8 ANC contacts during her</span>
            <span class="c1"># pregnancy - derived from Wingstons analysis of DHS data</span>
            <span class="s1">&#39;eight_or_more_anc_visits&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_eight_or_more_anc_visits&#39;</span><span class="p">]),</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="PregnancySupervisor.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_deficiencies_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_abortion_complications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PregnancySupervisor.further_on_birth_pregnancy_supervisor"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.further_on_birth_pregnancy_supervisor">[docs]</a>    <span class="k">def</span> <span class="nf">further_on_birth_pregnancy_supervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module. This function contains additional</span>
<span class="sd">        code related to the pregnancy supervisor module that should be ran on_birth for all births - it has been</span>
<span class="sd">        parcelled into functions to ensure each modules (pregnancy,antenatal care, labour, newborn, postnatal) on_birth</span>
<span class="sd">        code is ran in the correct sequence (as this can vary depending on how modules are registered)</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># We reset all womans gestational age when they deliver as they are no longer pregnant</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

            <span class="c1"># We currently assume that hyperglycemia due to gestational diabetes resolves following birth</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="c1"># We store the date of resolution for women who were aware of their diabetes (as the DALY weight only</span>
                <span class="c1"># occurs after diagnosis)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;gest_diab_onset&#39;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;gest_diab_resolution&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is PregnancySupervisor, being alerted about a health system interaction &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;ps_daly_weights&#39;</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is PregnancySupervisor reporting my health values&#39;</span><span class="p">)</span>
        <span class="n">monthly_daly</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># First we define a function that calculates disability associated with &#39;acute&#39; complications of pregnancy</span>
        <span class="k">def</span> <span class="nf">acute_daly_calculation</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
            <span class="c1"># We cycle through each complication for all women in the mni, if the condition has never ocurred then we</span>
            <span class="c1"># pass</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]):</span>
                <span class="k">return</span>

            <span class="c1"># If the complication has onset within the last month...</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>

                <span class="c1"># We assume that any woman who experiences an acute event receives the whole weight for that daly</span>
                <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

                <span class="c1"># Ensure some weight is assigned</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Next we define a function that calculates disability associated with &#39;chronic&#39; complications of pregnancy</span>
        <span class="k">def</span> <span class="nf">chronic_daly_calculations</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]):</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]):</span>

                    <span class="c1"># If the complication has not yet resolved, and started more than a month ago, the woman gets a</span>
                    <span class="c1"># months disability</span>
                    <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                        <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">365.25</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">365.25</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
                        <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span>

                    <span class="c1"># Otherwise, if the complication started this month she gets a daly weight relative to the number of</span>
                    <span class="c1"># days she has experience the complication</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span>
                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                        <span class="n">days_since_onset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]),</span>
                                                        <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                        <span class="n">daly_weight</span> <span class="o">=</span> <span class="n">days_since_onset</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">365.25</span><span class="p">)</span>

                        <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daly_weight</span>
                        <span class="k">assert</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Its possible for a condition to resolve (via treatment) and onset within the same month</span>
                    <span class="c1"># (i.e. anaemia). If so, here we calculate how many days this month an individual has suffered</span>
                    <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]:</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span> <span class="ow">and</span> \
                          <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                            <span class="k">return</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Calculate daily weight and how many days this woman hasnt had the complication</span>
                            <span class="n">daily_weight</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">365.25</span>
                            <span class="n">days_without_complication</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span>
                                <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]),</span>
                                <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>

                            <span class="c1"># Use the average days in a month to calculate how many days shes had the complication this</span>
                            <span class="c1"># month</span>
                            <span class="n">avg_days_in_month</span> <span class="o">=</span> <span class="mf">365.25</span> <span class="o">/</span> <span class="mi">12</span>
                            <span class="n">days_with_comp</span> <span class="o">=</span> <span class="n">avg_days_in_month</span> <span class="o">-</span> <span class="n">days_without_complication</span><span class="o">.</span><span class="n">days</span>

                            <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daily_weight</span> <span class="o">*</span> <span class="n">days_with_comp</span>

                            <span class="k">assert</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                            <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># If the complication has truly resolved, check the dates make sense</span>
                        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span>

                        <span class="c1"># We calculate how many days she has been free of the complication this month to determine how</span>
                        <span class="c1"># many days she has suffered from the complication this month</span>
                        <span class="n">days_free_of_comp_this_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                                                                 <span class="sa">f</span><span class="s1">&#39;resolution&#39;</span><span class="p">]),</span>
                                                                    <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                        <span class="n">mid_way_calc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">days_free_of_comp_this_month</span>
                        <span class="n">days_with_comp_this_month</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mid_way_calc</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
                        <span class="n">daly_weight</span> <span class="o">=</span> <span class="n">days_with_comp_this_month</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">365.25</span><span class="p">)</span>
                        <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daly_weight</span>

                        <span class="k">assert</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                        <span class="c1"># Reset the dates to stop additional disability being applied</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

        <span class="c1"># Then for each alive person in the MNI we cycle through all the complications that can lead to disability and</span>
        <span class="c1"># calculate their individual daly weight for the month</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mni</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;abortion&#39;</span><span class="p">,</span> <span class="s1">&#39;abortion_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;abortion_sep&#39;</span><span class="p">,</span> <span class="s1">&#39;ectopic&#39;</span><span class="p">,</span> <span class="s1">&#39;ectopic_rupture&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;mild_mod_aph&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_aph&#39;</span><span class="p">,</span> <span class="s1">&#39;chorio&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">,</span>  <span class="s1">&#39;mild_mod_pph&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pph&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_pph&#39;</span><span class="p">]:</span>
                    <span class="n">acute_daly_calculation</span><span class="p">(</span><span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span> <span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hypertension&#39;</span><span class="p">,</span> <span class="s1">&#39;gest_diab&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_anaemia&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_anaemia&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;severe_anaemia&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_anaemia_pp&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_anaemia_pp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_anaemia_pp&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;vesicovaginal_fistula&#39;</span><span class="p">,</span> <span class="s1">&#39;rectovaginal_fistula&#39;</span><span class="p">]:</span>
                    <span class="n">chronic_daly_calculations</span><span class="p">(</span><span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span> <span class="n">person</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">monthly_daly</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
                                                  <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span>
                                                                                               <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span>
                                                                                         <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>

        <span class="n">daly_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>
        <span class="n">daly_series</span><span class="p">[</span><span class="n">monthly_daly</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">monthly_daly</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">daly_series</span></div>

<div class="viewcode-block" id="PregnancySupervisor.store_dalys_in_mni"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.store_dalys_in_mni">[docs]</a>    <span class="k">def</span> <span class="nf">store_dalys_in_mni</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">mni_variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called across the maternal health modules and stores onset/resolution dates for complications</span>
<span class="sd">        in an indiviudals MNI dictionary</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param mni_variable: key of mni dict being assigned</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mni_variable</span><span class="si">}</span><span class="s1"> is being stored for mother </span><span class="si">{</span><span class="n">individual_id</span> <span class="si">}</span><span class="s1">on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mni_variable</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div>

<div class="viewcode-block" id="PregnancySupervisor.pregnancy_supervisor_property_reset"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.pregnancy_supervisor_property_reset">[docs]</a>    <span class="k">def</span> <span class="nf">pregnancy_supervisor_property_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind_or_df</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called when properties housed in the PregnancySupervisorModule should be reset. For example</span>
<span class="sd">        following pregnancy loss</span>
<span class="sd">        :param ind_or_df: &quot;individual/data_frame&quot;(STR) whether this function has been called to reset properties for an</span>
<span class="sd">         individual row of the DF or a slice of the data frame</span>
<span class="sd">        :param id_or_index: pass the function either an individual ID (INT) or index of subset of data frame</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">ind_or_df</span> <span class="o">==</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span>
            <span class="nb">set</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">set</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span>

        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;iron&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_linear_model"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_linear_model">[docs]</a>    <span class="k">def</span> <span class="nf">apply_linear_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lm</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function will apply the linear model (lm) on the dataframe (df) to get a probability of some event</span>
<span class="sd">        happening to each individual. It then returns a series with same index with bools indicating the outcome based</span>
<span class="sd">        on the toss of the biased coin.</span>
<span class="sd">        :param lm: The linear model</span>
<span class="sd">        :param df: The dataframe</span>
<span class="sd">        :return: Series with same index containing outcomes (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_spontaneous_abortion"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_spontaneous_abortion">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_spontaneous_abortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of spontaneous abortion to a slice of data frame and is called by</span>
<span class="sd">        PregnancySupervisorEvent. It calls the apply_risk_of_abortion_complications function for women who loose their</span>
<span class="sd">        pregnancy.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># We use the apply_linear_model to determine if any women will experience spontaneous miscarriage</span>
        <span class="n">spont_abortion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]])</span>

        <span class="c1"># The apply_risk_of_abortion_complications function is called for women who lose their pregnancy. It resets</span>
        <span class="c1"># properties, set complications and care seeking</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">spont_abortion</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spont_abortion</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> has just undergone spontaneous abortion&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_abortion_complications</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_induced_abortion"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_induced_abortion">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_induced_abortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of induced abortion to a slice of data frame and is called by</span>
<span class="sd">        PregnancySupervisorEvent. It calls the apply_risk_of_abortion_complications for women who loose their pregnancy.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># This function follows the same pattern as apply_risk_of_spontaneous_abortion (only women with unintended</span>
        <span class="c1"># pregnancy may seek induced abortion)</span>
        <span class="n">abortion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;induced_abortion&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;co_unintended_preg&#39;</span><span class="p">]])</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">abortion</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">abortion</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c1"># Similarly the abortion function is called for each of these women</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> has just undergone induced abortion&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_abortion_complications</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_abortion_complications"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_abortion_complications">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_abortion_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function makes changes to the data frame for women who have experienced induced or spontaneous abortion.</span>
<span class="sd">        Additionally it determines if a woman will develop complications associated with pregnancy loss, manages care</span>
<span class="sd">        seeking and schedules potential death</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param cause: &#39;type&#39; of abortion (spontaneous abortion OR induced abortion) (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Women who have an abortion have key pregnancy variables reset</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span>
                                                  <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Women who have spontaneous abortion are at higher risk of future spontaneous abortions, we store this</span>
        <span class="c1"># accordingly</span>
        <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_spont_abortion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># We store the type of abortion for analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># We apply a risk of developing specific complications associated with abortion type and store using a bitset</span>
        <span class="c1"># property</span>
        <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;spontaneous_abortion&#39;</span> <span class="ow">or</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_haemorrhage_post_abortion&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;abortion_haem_onset&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_sepsis_post_abortion&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;abortion_sep_onset&#39;</span><span class="p">)</span>

        <span class="c1"># Women who induce an abortion are at risk of developing an injury to the reproductive tract</span>
        <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;induced_abortion&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_injury_post_abortion&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;injury&#39;</span><span class="p">)</span>

        <span class="c1"># Then we determine if this woman will seek care, and schedule presentation to the health system</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has experienced one or more complications following &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;abortion and may choose to seek care&#39;</span><span class="p">)</span>

            <span class="c1"># We assume only women with complicated abortions will experience disability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;abortion_onset&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># Schedule possible death</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_deficiencies_and_anaemia"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_deficiencies_and_anaemia">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_deficiencies_and_anaemia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of deficiencies and anaemia to a slice of the data frame. It is called by</span>
<span class="sd">        PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># TODO - AT this is an example of a block of code that is replicated within the postnatal module that could</span>
        <span class="c1">#  maybe live in a central module (or combine pregnancy and postnatal supervisor events)</span>

        <span class="c1"># This function iterates through the three key anaemia causing deficiencies (iron, folate</span>
        <span class="c1"># and b12) and determines a the risk of onset for a subset of pregnant women. Following this, woman have a</span>
        <span class="c1"># probability of anaemia calculated and relevant changes to the data frame occur</span>

        <span class="k">def</span> <span class="nf">apply_risk</span><span class="p">(</span><span class="n">deficiency</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;iron&#39;</span> <span class="ow">or</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;folate&#39;</span><span class="p">:</span>
                <span class="c1"># First we select a subset of the pregnant population who are not suffering from the deficiency in</span>
                <span class="c1"># question. (When applying risk of iron/folate deficiency we fist apply risk to women not on iron/folic</span>
                <span class="c1"># acid treatment)</span>
                <span class="n">selected_women</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># As IFA treatment does not effect B12 we select the appropriate women regardless of IFA treatment</span>
                <span class="c1"># status</span>
                <span class="n">selected_women</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>

            <span class="c1"># We determine their risk of deficiency</span>
            <span class="n">new_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_women</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_per&#39;</span>
                                                                                     <span class="sa">f</span><span class="s1">&#39;_month&#39;</span><span class="p">],</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">selected_women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># And change their property accordingly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;b12&#39;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Next we select women who aren&#39;t deficient of iron/folate but are receiving IFA treatment</span>
                <span class="n">def_treatment</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>

                <span class="c1"># We reduce their individual risk of deficiencies due to treatment and make changes to the data frame</span>
                <span class="n">risk_of_def</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_per_month&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;treatment_effect_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_ifa&#39;</span><span class="p">]</span>

                <span class="n">new_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">def_treatment</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">risk_of_def</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">def_treatment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">])</span>

        <span class="c1"># Now we run the function for each</span>
        <span class="k">for</span> <span class="n">deficiency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">]:</span>
            <span class="n">apply_risk</span><span class="p">(</span><span class="n">deficiency</span><span class="p">)</span>

        <span class="c1"># ------------------------------------------ ANAEMIA ---------------------------------------------------------</span>
        <span class="c1"># Now we determine if a subset of pregnant women will become anaemic using a linear model, in which the</span>
        <span class="c1"># preceding deficiencies act as predictors</span>
        <span class="n">anaemia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="c1"># We use a weight random draw to determine the severity of the anaemia</span>
        <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                           <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mild_mod_sev_anaemia&#39;</span><span class="p">],</span>
                                                           <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">])),</span>
                                           <span class="n">index</span><span class="o">=</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice_severity</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c1"># We store onset date of anaemia according to severity, as weights vary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_anaemia_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed anaemia during week &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">gestation_of_interest</span><span class="si">}</span><span class="s1">of the antenatal period, </span><span class="si">{</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anaemia</span><span class="p">])</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_gestational_diabetes"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_gestational_diabetes">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_gestational_diabetes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of gestational diabetes to a slice of the data frame. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">gest_diab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;gest_diab&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                                                               <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                                                               <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                                               <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                                                               <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                                                               <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="c1"># Gestational diabetes, at onset, is defined as uncontrolled prior to treatment</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uncontrolled&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_gest_diab&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed gestational diabetes,&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">gest_diab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_diab</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_hypertensive_disorders"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_hypertensive_disorders">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_hypertensive_disorders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of mild pre-eclampsia and mild gestational diabetes to a slice of the data frame. It</span>
<span class="sd">        is called by PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># TODO - AT this is an example of a block of code that is replicated within the postnatal module that could</span>
        <span class="c1">#  maybe live in a central module (or combine pregnancy and postnatal supervisor events)</span>

        <span class="c1">#  ----------------------------------- RISK OF PRE-ECLAMPSIA ----------------------------------------------</span>
        <span class="c1"># We assume all women must developed a mild pre-eclampsia/gestational hypertension before progressing to a more</span>
        <span class="c1"># severe disease - we do not apply incidence of severe pre-eclampsia/eclampsia explicitly like this - see</span>
        <span class="c1"># PregnancySupervisorEvent)</span>
        <span class="n">pre_eclampsia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;pre_eclampsia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span>
                   <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_pre_eclampsia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed pre_eclampsia &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#  -------------------------------- RISK OF GESTATIONAL HYPERTENSION --------------------------------------</span>
        <span class="c1"># For women who dont develop pre-eclampsia during this month, we apply a risk of gestational hypertension</span>
        <span class="n">gest_hypertension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_gest_htn&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed gestational hypertension&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_progression_of_hypertension"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_progression_of_hypertension">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_progression_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies a risk of progression of hypertensive disorders to women who are experiencing one of the</span>
<span class="sd">        hypertensive disorders. It is called by PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># TODO - AT this is an example of a block of code that is replicated within the postnatal module that could</span>
        <span class="c1">#  maybe live in a central module (or combine pregnancy and postnatal supervisor events)</span>

        <span class="k">def</span> <span class="nf">apply_risk</span><span class="p">(</span><span class="n">selected</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">):</span>

            <span class="c1"># Define the possible states that can be moved between</span>
            <span class="n">disease_states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">disease_states</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_states</span><span class="p">)</span>

            <span class="c1"># Probability of moving between states is stored in a matrix. Risk of progression from mild gestational</span>
            <span class="c1"># hypertension to severe gestational hypertension is modified by treatment effect</span>

            <span class="n">risk_ghtn_remains_mild</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">-</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">)</span>

            <span class="c1"># We reset the parameter here to allow for testing with the original parameter</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">risk_ghtn_remains_mild</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_sgh_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mpe_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_spe_matrix&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_ec_matrix&#39;</span><span class="p">]</span>

            <span class="c1"># We update the data frame with transitioned states (which may not have changed)</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;ps_htn_disorders&quot;</span><span class="p">]</span>
            <span class="n">new_status</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transition_states</span><span class="p">(</span><span class="n">current_status</span><span class="p">,</span> <span class="n">prob_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;ps_htn_disorders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_status</span>

            <span class="c1"># We evaluate the series of women in this function and select the women who have transitioned to severe</span>
            <span class="c1"># pre-eclampsia</span>
            <span class="n">assess_status_change_for_severe_pre_eclampsia</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span> <span class="o">&amp;</span> \
                                                            <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span>
            <span class="n">new_onset_severe_pre_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">[</span>
                <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">]</span>

            <span class="c1"># For these women, we set ps_emergency_event to True to signify they may seek care as they have moved to a</span>
            <span class="c1"># more severe form of the disease</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;The following women have developed severe pre-eclampsia during their &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;pregnancy </span><span class="si">{</span><span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_severe_pe&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_onset_severe_pre_eclampsia</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># This process is then repeated for women who have developed eclampsia</span>
            <span class="n">assess_status_change_for_eclampsia</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span>
            <span class="n">new_onset_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_eclampsia</span><span class="p">[</span><span class="n">assess_status_change_for_eclampsia</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;The following women have developed eclampsia during their &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;pregnancy </span><span class="si">{</span><span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_eclampsia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_onset_eclampsia</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;eclampsia_onset&#39;</span><span class="p">)</span>

        <span class="c1"># Here we select the women in the data frame who are at risk of progression.</span>
        <span class="n">women_not_on_anti_htns</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> \
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span>

        <span class="n">women_on_anti_htns</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span>

        <span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_not_on_anti_htns</span><span class="p">,</span> <span class="n">risk_progression_mild_to_severe_htn</span><span class="p">)</span>
        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_on_anti_htns</span><span class="p">,</span> <span class="p">(</span><span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">*</span>
                                        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_anti_htns_progression&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_death_from_hypertension"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_death_from_hypertension">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_death_from_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of death to women with severe hypertensive disease (severe gestational hypertension/</span>
<span class="sd">        severe pre-eclampsia). For women who die this function schedules InstantaneousDeathEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Risk of death is applied to women with severe hypertensive disease</span>
        <span class="n">at_risk_of_death_htn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;death_from_hypertensive_disorder&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;severe_gest_htn|severe_pre_eclamp&#39;</span><span class="p">))])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have died due to severe hypertensive disorder,&#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Those women who die have InstantaneousDeath scheduled</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                        <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">]</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_placental_abruption"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_placental_abruption">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_placental_abruption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of placental abruption to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">placenta_abruption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                   <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed placental abruption,&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">placenta_abruption</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_abruption</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_antepartum_haemorrhage"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_antepartum_haemorrhage">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of antepartum haemorrhage to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">antepartum_haemorrhage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># Weighted random draw is used to determine severity (for DALY weight mapping)</span>
        <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_mod_sev_aph&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span>
                <span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">])),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># We store the severity of the bleed and signify this woman is experiencing an emergency event</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">random_choice_severity</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Store onset to calculate daly weights</span>
        <span class="n">severe_women</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span>
                        <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>

        <span class="n">severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;severe_aph_onset&#39;</span><span class="p">)</span>

        <span class="n">non_severe_women</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                   <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>

        <span class="n">non_severe_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">non_severe_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span>
                                                                       <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;mild_mod_aph_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women are experiencing an antepartum haemorrhage,&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">antepartum_haemorrhage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">antepartum_haemorrhage</span><span class="p">])</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_onset_and_progression_antenatal_infections"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_onset_and_progression_antenatal_infections">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_onset_and_progression_antenatal_infections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of new onset chorioamnionitis and risk of progression of chorioamnionitis state</span>
<span class="sd">        to a slice of the dataframe. It is called by PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># First assess if women with asymptomatic histological chorioamnionitis will develop clinical disease this</span>
        <span class="c1"># month</span>
        <span class="n">histo_chorio</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                              <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;histological&#39;</span><span class="p">)]</span>

        <span class="n">progression</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histo_chorio</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_to_clinical_&#39;</span>
                                                                                   <span class="s1">&#39;chorio&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">histo_chorio</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># We store the updated property and updated the mni dictionary (those who dont progress are assumed to have</span>
        <span class="c1"># resolved, applied at the end of function to stop newlry resolved women become infected again)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;clinical&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">progression</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span> <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;chorio_onset&#39;</span><span class="p">)</span>

        <span class="c1"># Here we use a linear equation to determine if women without infection will develop infection</span>
        <span class="n">chorio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chorio</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed chorioamnionitis during pregnancy&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Determine if clinical or histological chorioamnionitis (i.e. the woman displays symptoms)</span>
        <span class="n">type_of_chorio</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chorio</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_clinical_chorio&#39;</span><span class="p">],</span>
                                   <span class="n">index</span><span class="o">=</span><span class="n">chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Assume women with clinical chorioamnionitis may seek care</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;clinical&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Similarly assume only symptomatic infection leads to DALYs</span>
        <span class="n">type_of_chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">,</span>
                                                                   <span class="n">mni_variable</span><span class="o">=</span><span class="s1">&#39;chorio_onset&#39;</span><span class="p">)</span>

        <span class="c1"># Non clinical cases are assumed to be histological</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">type_of_chorio</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">type_of_chorio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;histological&#39;</span>

        <span class="c1"># Women who didnt progress from histological to clinical are resolved now (see above)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">progression</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">progression</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_premature_rupture_of_membranes"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_premature_rupture_of_membranes">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_premature_rupture_of_membranes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of premature rupture of membranes to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">prom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;premature_rupture_of_membranes&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># We allow women to seek care for PROM</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;prom&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have experience premature rupture of membranes&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prom</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prom</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_preterm_labour"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_preterm_labour">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_preterm_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of preterm labour to a slice of the dataframe. It is called by</span>
<span class="sd">        PregnancySupervisorEvent.</span>
<span class="sd">        :param gestation_of_interest: gestation in weeks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">preterm_labour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;early_onset_labour&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">preterm_labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">preterm_labour</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women will go into preterm labour at some point before the &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;next month of their pregnancy: </span><span class="si">{</span><span class="n">preterm_labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">preterm_labour</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;pre_term&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">preterm_labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">preterm_labour</span><span class="p">])</span>

        <span class="c1"># To prevent clustering of labour onset we scatter women to go into labour on a random day before their</span>
        <span class="c1"># next month gestation</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">preterm_labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">preterm_labour</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">27</span> <span class="o">-</span> <span class="mi">22</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="c1"># We only allow labour to onset from 24 weeks (to match with our definition of preterm labour)</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">27</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">35</span> <span class="o">-</span> <span class="mi">31</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">poss_day_onset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">37</span> <span class="o">-</span> <span class="mi">35</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span>
                <span class="n">onset_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">poss_day_onset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If any other gestational ages are pass, the function should end</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> was passed to the preterm birth function at&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">. No changes will be &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;made&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Due date is updated</span>
            <span class="n">new_due_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">onset_day</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span><span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">person</span><span class="p">,</span>
                                                      <span class="n">new_due_date</span><span class="o">=</span><span class="n">new_due_date</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> will go into preterm labour on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">new_due_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># And the labour onset event is scheduled for the new due date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person</span><span class="p">),</span>
                                    <span class="n">new_due_date</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.update_variables_post_still_birth_for_data_frame"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.update_variables_post_still_birth_for_data_frame">[docs]</a>    <span class="k">def</span> <span class="nf">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">women</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function updates variables for a slice of the dataframe who have experience antepartum stillbirth</span>
<span class="sd">        :param women: women who are experiencing stillbirth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">women</span><span class="p">)</span>

        <span class="c1"># We reset the relevant pregnancy variables</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># And reset relevant variables</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># We turn the &#39;delete_mni&#39; key to true- so after the next daly poll this womans entry is deleted</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Call functions across the modules to ensure properties are rest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;data_frame&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;data_frame&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;data_frame&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">women</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have have experienced an antepartum&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; stillbirth,</span><span class="si">{</span><span class="n">women</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.update_variables_post_still_birth_for_individual"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.update_variables_post_still_birth_for_individual">[docs]</a>    <span class="k">def</span> <span class="nf">update_variables_post_still_birth_for_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called to reset all the relevant pregnancy and treatment variables for a woman who undergoes</span>
<span class="sd">        stillbirth outside of the PregnancySupervisor polling event.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has experience an antepartum stillbirth on &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="PregnancySupervisor.apply_risk_of_still_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.apply_risk_of_still_birth">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_still_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function applies risk of still birth to a slice of the data frame. It is called by PregnancySupervisorEvent</span>
<span class="sd">        :param gestation_of_interest: INT used to select women from the data frame at certain gestation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">still_birth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="n">still_birth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_birth</span><span class="p">])</span></div>

<div class="viewcode-block" id="PregnancySupervisor.induction_care_seeking_and_still_birth_risk"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.induction_care_seeking_and_still_birth_risk">[docs]</a>    <span class="k">def</span> <span class="nf">induction_care_seeking_and_still_birth_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gestation_of_interest</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called for post term women and applies a probability that they will seek care for induction</span>
<span class="sd">        and if not will experience antenatal stillbirth</span>
<span class="sd">        :param gestation_of_interest: INT used to select women from the data frame at certain gestation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># We select the appropriate women</span>
        <span class="n">post_term_women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gestation_of_interest</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]]</span>

        <span class="c1"># Apply a probability they will seek care for induction</span>
        <span class="n">care_seekers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">post_term_women</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_seek_care_induction&#39;</span><span class="p">],</span>
                                 <span class="n">index</span><span class="o">=</span><span class="n">post_term_women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># If they do, we scheduled them to preset to a health facility immediately (this HSI schedules the correct</span>
        <span class="c1"># labour modules)</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seekers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">induction</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">induction</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

        <span class="c1"># We apply risk of still birth to those who dont seek care</span>
        <span class="n">non_care_seekers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seekers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seekers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">still_birth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">],</span> <span class="n">non_care_seekers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_variables_post_still_birth_for_data_frame</span><span class="p">(</span><span class="n">still_birth</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">still_birth</span><span class="p">])</span></div>

<div class="viewcode-block" id="PregnancySupervisor.care_seeking_pregnancy_loss_complications"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.care_seeking_pregnancy_loss_complications">[docs]</a>    <span class="k">def</span> <span class="nf">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function manages care seeking for women experiencing ectopic pregnancy or complications following</span>
<span class="sd">        spontaneous/induced abortion.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :return: Returns True/False value to signify care seeking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Determine probability of care seeking via the linear model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_pregnancy_loss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will seek care following pregnancy loss&#39;</span><span class="p">)</span>

            <span class="c1"># We assume women will seek care via HSI_GenericEmergencyFirstApptAtFacilityLevel1 and will be admitted for</span>
            <span class="c1"># care in CareOfWomenDuringPregnancy module</span>

            <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will not seek care following pregnancy loss&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PregnancySupervisor.generate_mother_and_newborn_dictionary_for_individual"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisor.generate_mother_and_newborn_dictionary_for_individual">[docs]</a>    <span class="k">def</span> <span class="nf">generate_mother_and_newborn_dictionary_for_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function generates variables within the mni dictionary for women. It is abstracted to a function for</span>
<span class="sd">        testing purposes&quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="s1">&#39;abortion_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;abortion_haem_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;abortion_sep_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;eclampsia_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_mod_aph_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_aph_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;chorio_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;ectopic_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;ectopic_rupture_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;gest_diab_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;gest_diab_diagnosed_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;gest_diab_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_anaemia_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_anaemia_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;moderate_anaemia_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;moderate_anaemia_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_anaemia_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_anaemia_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_anaemia_pp_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_anaemia_pp_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;moderate_anaemia_pp_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;moderate_anaemia_pp_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_anaemia_pp_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_anaemia_pp_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;hypertension_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;hypertension_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;obstructed_labour_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;sepsis_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;uterine_rupture_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;mild_mod_pph_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;severe_pph_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;secondary_pph_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;vesicovaginal_fistula_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;vesicovaginal_fistula_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;rectovaginal_fistula_onset&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;rectovaginal_fistula_resolution&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
                              <span class="s1">&#39;test_run&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># used by labour module when running some model tests</span>
                              <span class="p">}</span></div></div>


<div class="viewcode-block" id="PregnancySupervisorEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent">[docs]</a><span class="k">class</span> <span class="nc">PregnancySupervisorEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is the PregnancySupervisorEvent, it is a weekly event which has two primary functions.</span>
<span class="sd">    1.) It updates the gestational age (in weeks) of all women who are pregnant.</span>
<span class="sd">    2.) It applies risk of complications/outcomes and care seeking during the antenatal period at pre-defined time</span>
<span class="sd">    points of pregnancy (defined below)&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PregnancySupervisorEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="PregnancySupervisorEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancySupervisorEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># =================================== UPDATING LENGTH OF PREGNANCY ============================================</span>
        <span class="c1"># Length of pregnancy is commonly measured as gestational age which commences on the first day of a womans last</span>
        <span class="c1"># menstrual period (therefore including around 2 weeks in which a woman isnt pregnant)</span>

        <span class="c1"># We calculate a womans gestational age by first calculating the foetal age (measured from conception) and then</span>
        <span class="c1"># adding 2 weeks. The literature describing the epidemiology of maternal conditions almost exclusively uses</span>
        <span class="c1"># gestational age</span>

        <span class="n">alive_and_preg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span>
        <span class="n">foetal_age_in_days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span>
        <span class="n">foetal_age_in_weeks</span> <span class="o">=</span> <span class="n">foetal_age_in_days</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">rounded_weeks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">foetal_age_in_weeks</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rounded_weeks</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;updating gestational ages on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># Here we begin to populate the mni dictionary for each newly pregnant woman. Within this module this dictionary</span>
        <span class="c1"># contains information about the onset of complications in order to calculate monthly DALYs</span>
        <span class="n">newly_pregnant</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_preg</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">newly_pregnant</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">generate_mother_and_newborn_dictionary_for_individual</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="c1"># =========================== APPLYING RISK OF ADVERSE PREGNANCY OUTCOMES =====================================</span>
        <span class="c1"># The aim of this event is to apply risk of certain outcomes of pregnancy at relevant points in a womans</span>
        <span class="c1"># gestation. Risk of complications that occur only once during pregnancy (below) are applied within the event,</span>
        <span class="c1"># otherwise code applying risk is stored in functions (above)</span>

        <span class="c1"># At the beginning of pregnancy (3 weeks GA (and therefore the first week a woman is pregnant) we determine if</span>
        <span class="c1"># a woman will develop ectopic pregnancy, multiple pregnancy, placenta praevia and if/when she will seek care</span>
        <span class="c1"># for her first antenatal visit</span>

        <span class="c1">#  ------------------------------APPLYING RISK OF ECTOPIC PREGNANCY -------------------------------------------</span>
        <span class="c1"># We use the apply_linear_model function to determine which women will develop ectopic pregnancy - this format</span>
        <span class="c1"># is similar to the functions which apply risk of complication</span>
        <span class="n">new_pregnancy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ectopic_risk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;ectopic&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span><span class="p">])</span>

        <span class="c1"># Make the appropriate changes to the data frame and log the number of ectopic pregnancies</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not_ruptured&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have experience an ectopic pregnancy,&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># For women whose pregnancy is ectopic we scheduled them to the EctopicPregnancyEvent in between 3-5 weeks</span>
            <span class="c1"># of pregnancy (this simulates time period prior to which symptoms onset- and may trigger care seeking)</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">ectopic_risk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ectopic_risk</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person</span><span class="p">),</span>
                                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))</span>

        <span class="c1">#  ---------------------------- APPLYING RISK OF MULTIPLE PREGNANCY -------------------------------------------</span>
        <span class="c1"># For the women who aren&#39;t having an ectopic, we determine if they may be carrying multiple pregnancies and make</span>
        <span class="c1"># changes accordingly</span>
        <span class="n">multiples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;multiples&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;multiples&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women are pregnant with multiples, &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">multiples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#  -----------------------------APPLYING RISK OF PLACENTA PRAEVIA  -------------------------------------------</span>
        <span class="c1"># Next,we apply a one off risk of placenta praevia (placenta will grow to cover the cervix either partially or</span>
        <span class="c1"># completely) which will increase likelihood of bleeding later in pregnancy</span>
        <span class="n">placenta_praevia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_placenta_praevia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">multiples</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following womens pregnancy is complicated by placenta praevia &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">placenta_praevia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">placenta_praevia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># ----------------------------------- SCHEDULING FIRST ANC VISIT -----------------------------------------</span>
        <span class="c1"># Finally for these women we determine care seeking for the first antenatal care contact of their</span>
        <span class="c1"># pregnancy. We use a linear model to determine if women will attend four or more visits</span>
        <span class="n">anc_attendance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;four_or_more_anc_visits&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_pregnancy</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="c1"># This property is used  during antenatal care to ensure the right % of women attend four or more visits</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anc_attendance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">anc_attendance</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Gestation of first ANC visit (month) is selected via a random weighted draw to represent the distribution</span>
        <span class="c1"># of first ANC attendance by gestational age</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">anc_attendance</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">random_draw_gest_at_anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                                                             <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_first_anc_visit_gestational_age&#39;</span><span class="p">])</span>

            <span class="c1"># We use month ten to capture women who will never attend ANC during their pregnancy</span>
            <span class="k">if</span> <span class="n">random_draw_gest_at_anc</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Otherwise we use the result of the random draw to schedule the first ANC visit</span>
                <span class="n">days_until_anc_month_start</span> <span class="o">=</span> <span class="n">random_draw_gest_at_anc</span> <span class="o">*</span> <span class="mi">30</span>  <span class="c1"># we approximate 30 days in a month</span>
                <span class="n">days_until_anc_month_end</span> <span class="o">=</span> <span class="n">days_until_anc_month_start</span> <span class="o">+</span> <span class="mi">29</span>
                <span class="n">days_until_anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">days_until_anc_month_start</span><span class="p">,</span> <span class="n">days_until_anc_month_end</span><span class="p">)</span>
                <span class="n">first_anc_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_anc</span><span class="p">)</span>

                <span class="c1"># We store that date as a property which is used by the HSI to ensure the event only runs when it</span>
                <span class="c1"># should</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_anc_date</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> will attend ANC 1 in </span><span class="si">{</span><span class="n">random_draw_gest_at_anc</span><span class="si">}</span><span class="s1"> months on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">first_anc_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># We used a weighted draw to decide what facility level this woman will seek care at, as ANC is offered</span>
                <span class="c1"># at multiple levels</span>

                <span class="n">facility_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_anc_at_facility_level_1_2&#39;</span><span class="p">]))</span>

                <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">first_anc_appt</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span>
                    <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">first_anc_appt</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="n">first_anc_date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="n">first_anc_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

        <span class="c1"># ------------------------ APPLY RISK OF ADDITIONAL PREGNANCY COMPLICATIONS -----------------------------------</span>
        <span class="c1"># The following functions apply risk of key complications/outcomes of pregnancy as specific time points of a</span>
        <span class="c1"># mothers gestation in weeks. These &#39;gestation_of_interest&#39; parameters roughly represent the last week in each</span>
        <span class="c1"># month of pregnancy. These time  points at which risk is applied, vary between complications according to their</span>
        <span class="c1"># epidemiology</span>

        <span class="c1"># The application of these risk is intentionally ordered as described below...</span>

        <span class="c1"># Women in the first five months of pregnancy are at risk of spontaneous abortion (miscarriage)</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_spontaneous_abortion</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># From the second month of pregnancy until month 5 women who do not experience spontaneous abortion may undergo</span>
        <span class="c1"># induced abortion</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_induced_abortion</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># Every month a risk of micronutrient deficiency and maternal anaemia is applied</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_deficiencies_and_anaemia</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># In the later months of pregnancy we apply a background risk of still birth. Risk of still birth is applied to</span>
        <span class="c1"># all women every month, with additional risk applied to women who experience acute pregnancy emergencies</span>
        <span class="c1"># (antepartum haemorrhage, eclampsia, chorioamnionitis)</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_still_birth</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># For women whose pregnancy will continue will apply a risk of developing a number of acute and chronic</span>
        <span class="c1"># (length of pregnancy) complications</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_hypertensive_disorders</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_gestational_diabetes</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_placental_abruption</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_antepartum_haemorrhage</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_premature_rupture_of_membranes</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_onset_and_progression_antenatal_infections</span><span class="p">(</span>
                <span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">]:</span>
            <span class="c1"># Women with hypertension are at risk of there condition progression, this risk is applied months 6-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_progression_of_hypertension</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>
            <span class="c1"># And of death...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_death_from_hypertension</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># From month 5-8 we apply risk of a woman going into early labour</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_preterm_labour</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span>

        <span class="c1"># ------------------------------- CARE SEEKING FOR PREGNANCY EMERGENCIES --------------------------------------</span>
        <span class="c1"># Every week when the event runs we determine if any women who have experience an emergency event in pregnancy</span>
        <span class="c1"># will seek care</span>

        <span class="c1"># Any women for whom ps_emergency_event == True may chose to seek care for one or more severe complications</span>
        <span class="c1"># (antepartum haemorrhage, severe pre-eclampsia, eclampsia or premature rupture of membranes) - this is distinct</span>
        <span class="c1"># from care seeking following abortion/ectopic</span>
        <span class="n">care_seeking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_pregnancy_complication&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="c1"># We reset this variable to prevent additional unnecessary care seeking next month</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_emergency_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># We assume women who seek care will present to a form of Maternal Assessment Unit- not through normal A&amp;E</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> will seek care following acute pregnancy&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;complications&#39;</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">tlo.methods.care_of_women_during_pregnancy</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">acute_pregnancy_hsi</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">acute_pregnancy_hsi</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># -------- APPLYING RISK OF DEATH/STILL BIRTH FOR NON-CARE SEEKERS FOLLOWING PREGNANCY EMERGENCIES --------</span>
        <span class="c1"># We select the women who have chosen not to seek care following pregnancy emergency- and we now apply risk of</span>
        <span class="c1"># death and pregnancy loss (other wise this risk is applied following treatment in the</span>
        <span class="c1"># CareOfWomenDuringPregnancy module)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women will not seek care after experiencing a &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;pregnancy emergency: </span><span class="si">{</span><span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">apply_risk_of_outcomes_to_individual</span><span class="p">(</span><span class="n">complication</span><span class="p">):</span>
                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">]])[</span><span class="n">person</span><span class="p">]</span>
                <span class="n">risk_of_still_birth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_still_birth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">]])[</span><span class="n">person</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;death&#39;</span>

                <span class="c1"># For women who survive we determine if they will experience a stillbirth</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_still_birth</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;still_birth&#39;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="s1">&#39;none&#39;</span>

            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>

                <span class="c1"># As women could have more than one severe complication at once we apply risk of death from each</span>
                <span class="c1"># complication in turn</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                    <span class="n">outcome_aph</span> <span class="o">=</span> <span class="n">apply_risk_of_outcomes_to_individual</span><span class="p">(</span><span class="s1">&#39;antepartum_haemorrhage&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">outcome_aph</span> <span class="o">!=</span> <span class="s1">&#39;death&#39;</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outcome_aph</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="c1"># This process if repeated for eclampsia</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                    <span class="n">outcome_ec</span> <span class="o">=</span> <span class="n">apply_risk_of_outcomes_to_individual</span><span class="p">(</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">outcome_ec</span> <span class="o">!=</span> <span class="s1">&#39;death&#39;</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outcome_ec</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;clinical&#39;</span><span class="p">:</span>
                    <span class="n">outcome_ch</span> <span class="o">=</span> <span class="n">apply_risk_of_outcomes_to_individual</span><span class="p">(</span><span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outcome_ch</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="c1"># For women who will die we schedule the InstantaneousDeath Event</span>
                <span class="k">if</span> <span class="n">outcome_aph</span> <span class="o">==</span> <span class="s1">&#39;death&#39;</span> <span class="ow">or</span> <span class="n">outcome_ec</span> <span class="o">==</span> <span class="s1">&#39;death&#39;</span> <span class="ow">or</span> <span class="n">outcome_ch</span> <span class="o">==</span> <span class="s1">&#39;death&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person</span><span class="si">}</span><span class="s1"> has died following a pregnancy emergency on &#39;</span>
                                      <span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                            <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>

                <span class="c1"># And for women who lose their pregnancy we reset the relevant variables</span>
                <span class="k">elif</span> <span class="n">outcome_aph</span> <span class="o">==</span> <span class="s1">&#39;still_birth&#39;</span> <span class="ow">or</span> <span class="n">outcome_ec</span> <span class="o">==</span> <span class="s1">&#39;still_birth&#39;</span> <span class="ow">or</span> <span class="n">outcome_ch</span> <span class="o">==</span> <span class="s1">&#39;still_birth&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">update_variables_post_still_birth_for_individual</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>

        <span class="c1"># ============================ POST TERM RISK OF STILLBIRTH ==================================================</span>
        <span class="c1"># Finally we determine if women who are post term will seek care for induction/experience stillbirth</span>
        <span class="k">for</span> <span class="n">gestation_of_interest</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">induction_care_seeking_and_still_birth_risk</span><span class="p">(</span><span class="n">gestation_of_interest</span><span class="o">=</span><span class="n">gestation_of_interest</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="EctopicPregnancyEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent">[docs]</a><span class="k">class</span> <span class="nc">EctopicPregnancyEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is EctopicPregnancyEvent. It is scheduled by the set_pregnancy_complications function within</span>
<span class="sd">     PregnancySupervisorEvent for women who have experienced ectopic pregnancy. This event makes changes to the data</span>
<span class="sd">     frame for women with ectopic pregnancies, applies a probability of care seeking and schedules the</span>
<span class="sd">     EctopicRuptureEvent.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EctopicPregnancyEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EctopicPregnancyEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Check only the right women have arrived here</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_ruptured&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">9</span>
        <span class="c1"># assert ~df.at[individual_id, &#39;hs_is_inpatient&#39;]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># reset pregnancy variables and store onset for daly calcualtion</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ectopic_onset&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_due_date</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">new_due_date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span>
            <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Determine if women will seek care at this stage</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">):</span>

            <span class="c1"># For women who dont seek care (and get treatment) we schedule EctopicPregnancyRuptureEvent (simulating</span>
            <span class="c1"># fallopian tube rupture) in an additional 2-4 weeks from this event (if care seeking is unsuccessful</span>
            <span class="c1"># then this event is scheduled by the HSI (did_not_run)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyRuptureEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))</span></div></div>


<div class="viewcode-block" id="EctopicPregnancyRuptureEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent">[docs]</a><span class="k">class</span> <span class="nc">EctopicPregnancyRuptureEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is EctopicPregnancyRuptureEvent. It is scheduled by the EctopicPregnancyEvent for women who have</span>
<span class="sd">    experienced an ectopic pregnancy which has ruptured due to lack of treatment. This event manages care seeking post</span>
<span class="sd">    rupture and schedules EarlyPregnancyLossDeathEvent&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EctopicPregnancyRuptureEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EctopicPregnancyRuptureEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EctopicPregnancyRuptureEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Check the right woman has arrived at this event</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_ruptured&#39;</span>
        <span class="c1"># assert ~df.at[individual_id, &#39;ac_inpatient&#39;]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;persons </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> untreated ectopic pregnancy has now ruptured on &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Set the variable</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ruptured&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ectopic_rupture_onset&#39;</span><span class="p">)</span>

        <span class="c1"># We see if this woman will now seek care following rupture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">care_seeking_pregnancy_loss_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># We delayed the death event by three days to allow any treatment effects to mitigate risk of death</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent">[docs]</a><span class="k">class</span> <span class="nc">EarlyPregnancyLossDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is EarlyPregnancyLossDeathEvent. It is scheduled by the EctopicPregnancyRuptureEvent &amp; abortion for</span>
<span class="sd">    women who are at risk of death following a loss of their pregnancy&quot;&quot;&quot;</span>

<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cause</span> <span class="o">=</span> <span class="n">cause</span></div>

<div class="viewcode-block" id="EarlyPregnancyLossDeathEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.EarlyPregnancyLossDeathEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Individual risk of death is calculated through the linear model</span>
        <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ps_linear_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span>
                <span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If the death occurs we record it here</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has died due to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="si">}</span><span class="s1"> on date &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise we reset any variables</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">abortion_complications</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pac_interventions</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                       <span class="s1">&#39;mva&#39;</span><span class="p">,</span> <span class="s1">&#39;d_and_c&#39;</span><span class="p">,</span> <span class="s1">&#39;misoprostol&#39;</span><span class="p">,</span>
                                                                                       <span class="s1">&#39;antibiotics&#39;</span><span class="p">,</span> <span class="s1">&#39;blood_products&#39;</span><span class="p">,</span>
                                                                                       <span class="s1">&#39;injury_repair&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent">[docs]</a><span class="k">class</span> <span class="nc">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is GestationalDiabetesGlycaemicControlEvent. It is scheduled by CareOfWomenDuringPregnancy module after a</span>
<span class="sd">    woman is started on treatment for gestational diabetes. This event determines if the treatment a woman has been</span>
<span class="sd">    started on for GDM will effectively control her blood sugars</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="GestationalDiabetesGlycaemicControlEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.GestationalDiabetesGlycaemicControlEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="c1"># Check only the right women are sent here</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>

            <span class="c1"># We apply a probability that the treatment this woman is receiving for her GDM (diet and exercise/</span>
            <span class="c1"># oral anti-diabetics/ insulin) will not control this womans hyperglycaemia</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;prob_glycaemic_control_</span><span class="si">{</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>

                <span class="c1"># If so we reset her diabetes status as uncontrolled, her treatment is ineffective at reducing risk of</span>
                <span class="c1"># still birth, and when she returns for follow up she should be started on the next treatment available</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uncontrolled&#39;</span></div></div>


<div class="viewcode-block" id="PregnancyLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">PregnancyLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is PregnancyLoggingEvent. It runs yearly to produce summary statistics around pregnancy.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PregnancyLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>

<div class="viewcode-block" id="PregnancyLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.pregnancy_supervisor.html#tlo.methods.pregnancy_supervisor.PregnancyLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Previous Year...</span>
        <span class="n">one_year_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>

        <span class="c1"># Denominators...</span>
        <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">total_births_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">ra_lower_limit</span> <span class="o">=</span> <span class="mi">14</span>
        <span class="n">ra_upper_limit</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">women_reproductive_age</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="n">ra_lower_limit</span><span class="p">)</span> <span class="o">&amp;</span>
                                           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="n">ra_upper_limit</span><span class="p">))]</span>
        <span class="n">total_women_reproductive_age</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">women_reproductive_age</span><span class="p">)</span>

        <span class="c1"># Numerators</span>
        <span class="n">antenatal_maternal_deaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_death&#39;</span><span class="p">]</span>
        <span class="n">antepartum_stillbirths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antenatal_stillbirth&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">antenatal_maternal_deaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">antenatal_maternal_deaths</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">antepartum_stillbirths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">antepartum_stillbirths</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">total_ectopics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;ectopic_pregnancy&#39;</span><span class="p">]</span>
        <span class="n">total_multiples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;multiples&#39;</span><span class="p">]</span>
        <span class="n">total_abortions_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;induced_abortion&#39;</span><span class="p">]</span>
        <span class="n">total_spontaneous_abortions_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;spontaneous_abortion&#39;</span><span class="p">]</span>
        <span class="n">total_iron_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;iron_def&#39;</span><span class="p">]</span>
        <span class="n">total_folate_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;folate_def&#39;</span><span class="p">]</span>
        <span class="n">total_b12_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;b12_def&#39;</span><span class="p">]</span>
        <span class="n">total_anaemia_cases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;maternal_anaemia&#39;</span><span class="p">]</span>
        <span class="n">total_ia_deaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;induced_abortion_death&#39;</span><span class="p">]</span>
        <span class="n">total_sa_deaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;spontaneous_abortion_death&#39;</span><span class="p">]</span>
        <span class="n">crude_new_onset_pe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_pre_eclampsia&#39;</span><span class="p">]</span>
        <span class="n">crude_new_gh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_gest_htn&#39;</span><span class="p">]</span>
        <span class="n">crude_new_gd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_gest_diab&#39;</span><span class="p">]</span>
        <span class="n">crude_new_spe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_severe_pe&#39;</span><span class="p">]</span>
        <span class="n">crude_new_ec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;new_onset_eclampsia&#39;</span><span class="p">]</span>
        <span class="n">placenta_praevia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;placenta_praevia&#39;</span><span class="p">]</span>
        <span class="n">placental_abruption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;placental_abruption&#39;</span><span class="p">]</span>
        <span class="n">crude_aph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">]</span>
        <span class="n">prom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;prom&#39;</span><span class="p">]</span>
        <span class="n">preterm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="s1">&#39;pre_term&#39;</span><span class="p">]</span>

        <span class="n">dict_for_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;repro_women&#39;</span><span class="p">:</span> <span class="n">total_women_reproductive_age</span><span class="p">,</span>
                           <span class="s1">&#39;crude_deaths&#39;</span><span class="p">:</span> <span class="n">antenatal_maternal_deaths</span><span class="p">,</span>
                           <span class="s1">&#39;antenatal_mmr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">antenatal_maternal_deaths</span><span class="o">/</span><span class="n">total_births_last_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">,</span>
                           <span class="s1">&#39;crude_antenatal_sb&#39;</span><span class="p">:</span> <span class="n">antepartum_stillbirths</span><span class="p">,</span>
                           <span class="s1">&#39;antenatal_sbr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">antepartum_stillbirths</span><span class="o">/</span><span class="n">total_births_last_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;total_spontaneous_abortions&#39;</span><span class="p">:</span> <span class="n">total_spontaneous_abortions_t</span><span class="p">,</span>
                           <span class="s1">&#39;spontaneous_abortion_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_spontaneous_abortions_t</span> <span class="o">/</span>
                                                         <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;spontaneous_abortion_death_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_sa_deaths</span> <span class="o">/</span> <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;total_induced_abortions&#39;</span><span class="p">:</span> <span class="n">total_abortions_t</span><span class="p">,</span>
                           <span class="s1">&#39;induced_abortion_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_abortions_t</span> <span class="o">/</span> <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;induced_abortion_death_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_ia_deaths</span> <span class="o">/</span> <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;crude_multiples&#39;</span><span class="p">:</span> <span class="n">total_multiples</span><span class="p">,</span>
                           <span class="s1">&#39;multiples_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_multiples</span> <span class="o">/</span> <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;crude_ectopics&#39;</span><span class="p">:</span> <span class="n">total_ectopics</span><span class="p">,</span>
                           <span class="s1">&#39;ectopic_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_ectopics</span> <span class="o">/</span> <span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;crude_iron_def&#39;</span><span class="p">:</span> <span class="n">total_iron_def</span><span class="p">,</span>
                           <span class="s1">&#39;crude_folate_def&#39;</span><span class="p">:</span> <span class="n">total_folate_def</span><span class="p">,</span>
                           <span class="s1">&#39;crude_b12_def&#39;</span><span class="p">:</span> <span class="n">total_b12_def</span><span class="p">,</span>
                           <span class="s1">&#39;crude_anaemia&#39;</span><span class="p">:</span> <span class="n">total_anaemia_cases</span><span class="p">,</span>
                           <span class="s1">&#39;anaemia_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_anaemia_cases</span><span class="o">/</span><span class="n">total_women_reproductive_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
                           <span class="s1">&#39;crude_pe&#39;</span><span class="p">:</span> <span class="n">crude_new_onset_pe</span><span class="p">,</span>
                           <span class="s1">&#39;crude_gest_htn&#39;</span><span class="p">:</span> <span class="n">crude_new_gh</span><span class="p">,</span>
                           <span class="s1">&#39;crude_gd&#39;</span><span class="p">:</span> <span class="n">crude_new_gd</span><span class="p">,</span>
                           <span class="s1">&#39;crude_spe&#39;</span><span class="p">:</span> <span class="n">crude_new_spe</span><span class="p">,</span>
                           <span class="s1">&#39;crude_ec&#39;</span><span class="p">:</span> <span class="n">crude_new_ec</span><span class="p">,</span>
                           <span class="s1">&#39;crude_p_p&#39;</span><span class="p">:</span> <span class="n">placenta_praevia</span><span class="p">,</span>
                           <span class="s1">&#39;crude_p_a&#39;</span><span class="p">:</span> <span class="n">placental_abruption</span><span class="p">,</span>
                           <span class="s1">&#39;crude_aph&#39;</span><span class="p">:</span> <span class="n">crude_aph</span><span class="p">,</span>
                           <span class="s1">&#39;crude_prom&#39;</span><span class="p">:</span> <span class="n">prom</span><span class="p">,</span>
                           <span class="s1">&#39;crude_pre_term&#39;</span><span class="p">:</span> <span class="n">preterm</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;ps_summary_statistics&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dict_for_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly summary statistics output from the pregnancy supervisor module&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pregnancy_disease_tracker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 08, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>