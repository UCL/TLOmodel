

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tlo.methods.labour &mdash; TLOmodel 0.1.dev2457+g44ac319.d20241008 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=6ea10ece" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=0e657b16"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TLOmodel
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/index.html">Resource files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../learning.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../methods.html">tlo.methods</a></li>
      <li class="breadcrumb-item active">tlo.methods.labour</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tlo.methods.labour</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">Date</span><span class="p">,</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span>
<span class="kn">from</span> <span class="nn">tlo.logging.helpers</span> <span class="kn">import</span> <span class="n">get_dataframe_row_as_dict_for_logging</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">labour_lm</span><span class="p">,</span> <span class="n">pregnancy_helper_functions</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hsi_event</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="n">GenericFirstAppointmentsMixin</span>
<span class="kn">from</span> <span class="nn">tlo.methods.postnatal_supervisor</span> <span class="kn">import</span> <span class="n">PostnatalWeekOneMaternalEvent</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="n">HSIEventScheduler</span>
    <span class="kn">from</span> <span class="nn">tlo.population</span> <span class="kn">import</span> <span class="n">IndividualProperties</span>


<span class="c1"># Standard logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Detailed logger</span>
<span class="n">logger_detail</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.detail&quot;</span><span class="p">)</span>
<span class="n">logger_detail</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Postnatal logger</span>
<span class="n">logger_pn</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;tlo.methods.postnatal_supervisor&quot;</span><span class="p">)</span>
<span class="n">logger_pn</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="Labour">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour">[docs]</a>
<span class="k">class</span> <span class="nc">Labour</span><span class="p">(</span><span class="n">Module</span><span class="p">,</span> <span class="n">GenericFirstAppointmentsMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is module is responsible for the process of labour, birth and the immediate postnatal period (up until</span>
<span class="sd">    48hrs post birth). This model has a number of core functions including; initiating the onset of labour for women on</span>
<span class="sd">    their pre-determined due date (or prior to this for preterm labour/admission for delivery), applying the incidence</span>
<span class="sd">     of a core set of maternal complications occurring in the intrapartum period and outcomes such as maternal death or</span>
<span class="sd">     still birth, scheduling birth for women surviving labour and applying risk of complications and outcomes in the</span>
<span class="sd">     postnatal period. Complications explicitly modelled in this module include obstructed labour, antepartum</span>
<span class="sd">     haemorrhage, maternal infection and sepsis, progression of hypertensive disorders, uterine rupture and postpartum</span>
<span class="sd">      haemorrhage. In addition to the natural history of labour this module manages care seeking for women in labour</span>
<span class="sd">      (for delivery or following onset of complications at a home birth) and includes HSIs which represent</span>
<span class="sd">      Skilled Birth Attendance at either Basic or Comprehensive level emergency obstetric care facilities.</span>
<span class="sd">      Following birth this module manages postnatal care delivered via HSI_Labour_ReceivesPostnatalCheck and schedules</span>
<span class="sd">      PostnatalWeekOneMaternalEvent which represents the start of a womans postnatal period.</span>
<span class="sd">      &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Labour.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># First we define dictionaries which will store the current parameters of interest (to allow parameters to</span>
        <span class="c1"># change between 2010 and 2020) and the linear models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># This list contains the individual_ids of women in labour, used for testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># These lists will contain possible complications and are used as checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># Finally define a dictionary which will hold the required consumables for each intervention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>


    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">}</span>

    <span class="n">OPTIONAL_INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Stunting&#39;</span><span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">,</span> <span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">,</span> <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span> <span class="s1">&#39;Contraception&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;intrapartum_sepsis&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;antepartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;postpartum_sepsis&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;postpartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;secondary_postpartum_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">)}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal Disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># n.b. Parameters are stored as LIST variables due to containing values to match both 2010 and 2015 data.</span>

        <span class="c1">#  PARITY AT BASELINE...</span>
        <span class="s1">&#39;intercept_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;intercept value for linear regression equation predicating womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_age_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in age by 1 year in the linear regression equation predicating &#39;</span>
                        <span class="s1">&#39;womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_mar_stat_2_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of a change in marriage status from comparison (level 1) in the linear &#39;</span>
                        <span class="s1">&#39;regression equation predicating womans parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_mar_stat_3_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of a change in marriage status from comparison (level 1) in the linear &#39;</span>
                        <span class="s1">&#39;regression equation predicating womans parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_4_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_3_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_2_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_1_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_edu_lev_2_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in education level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_edu_lev_3_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in education level in the linear regression equation predicating womans &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_rural_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of rural living in the linear regression equation predicating womans parity at 2010 &#39;</span>
                        <span class="s1">&#39;base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_previous_caesarean_at_baseline&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of previously having delivered via caesarean section at baseline&#39;</span><span class="p">),</span>

        <span class="c1"># POSTTERM RATE</span>
        <span class="s1">&#39;risk_post_term_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of remaining pregnant past 42 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_potl_bmi_30_35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of maternal BMI being between 30 and 35 on risk of post term labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_potl_bmi_35+&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of maternal BMI being between above 35 on risk of post term labour&#39;</span><span class="p">),</span>

        <span class="c1"># MISC...</span>
        <span class="s1">&#39;list_limits_for_defining_term_status&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;List of number of days of gestation used to define term, early preterm, late preterm and &#39;</span>
                        <span class="s1">&#39;post term delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;allowed_interventions&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of interventions allowed to run, used in analysis&#39;</span><span class="p">),</span>

        <span class="c1"># BIRTH WEIGHT...</span>
        <span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of mean birth weights from gestational age at birth 24-41 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;standard_deviation_birth_weights&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of standard deviations associated with mean birth weights from gestational age at &#39;</span>
                        <span class="s1">&#39;birth 24-41 weeks&#39;</span><span class="p">),</span>
        <span class="s1">&#39;residual_prob_of_macrosomia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that those allocated to be normal birth weight and above will be macrosomic &#39;</span>
                        <span class="s1">&#39;(&gt;4kg)&#39;</span><span class="p">),</span>

        <span class="c1"># OBSTRUCTED LABOUR....</span>
        <span class="s1">&#39;prob_obstruction_cpd&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of a woman developing obstructed labour secondary to cephalopelvic disproportion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_obstruction_cpd_stunted_mother&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of obstruction secondary to CPD in mothers who are stunted&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_obstruction_foetal_macrosomia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of obstruction secondary to CPD in mothers who are carrying a macrosomic &#39;</span>
                        <span class="s1">&#39;foetus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstruction_malpos_malpres&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of a woman developing obstructed labour secondary to malposition or malpresentation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstruction_other&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of a woman developing obstructed labour secondary to other causes&#39;</span><span class="p">),</span>

        <span class="c1"># ANTEPARTUM HAEMORRHAGE...</span>
        <span class="s1">&#39;prob_placental_abruption_during_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman developing placental abruption during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placenta_praevia_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman with placenta praevia experiencing an APH during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placental_abruption_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman with placental abruption experiencing an APH during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_placental_abruption_hypertension&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of placental abruption in women with hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_placental_abruption_previous_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative risk of placental abruption in women who delivered previously via caesarean section&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a maternal hemorrhage is non-severe (&lt;1000mls) or severe (&gt;1000mls)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for antepartum haemorrhage during labour&#39;</span><span class="p">),</span>

        <span class="c1"># MATERNAL INFECTION...</span>
        <span class="s1">&#39;prob_sepsis_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following chorioamnionitis infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_sepsis_chorio_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of chorioamnionitis following PROM&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_endometritis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following endometritis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_sepsis_endometritis_post_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of endometritis following caesarean delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_urinary_tract&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following urinary tract infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_skin_soft_tissue&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following skin or soft tissue infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_sepsis_sst_post_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of skin/soft tissue sepsis following caesarean delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for sepsis during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for sepsis following delivery&#39;</span><span class="p">),</span>

        <span class="c1"># UTERINE RUPTURE...</span>
        <span class="s1">&#39;prob_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a uterine rupture during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ur_parity_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have delivered 2 times previously&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ur_parity_3_or_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have delivered 3-4 times previously&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ur_parity_5+&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have delivered &gt; 5 times previously&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ur_prev_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have previously delivered via caesarean &#39;</span>
                        <span class="s1">&#39;section&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_ur_obstructed_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;relative risk of uterine rupture in women who have been in obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for uterine rupture in labour&#39;</span><span class="p">),</span>

        <span class="c1"># HYPERTENSIVE DISORDERS...</span>
        <span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of gestational hypertension progressing to severe gestational hypertension&#39;</span>
                        <span class="s1">&#39;during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_severe_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe gestational hypertension progressing to severe pre-eclampsia &#39;</span>
                        <span class="s1">&#39;during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_mild_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild pre-eclampsia progressing to severe pre-eclampsia during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_severe_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe pre-eclampsia progressing to eclampsia during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for eclampsia during labours&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_severe_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for severe pre eclampsia during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for eclampsia following delivery&#39;</span><span class="p">),</span>

        <span class="c1"># INTRAPARTUM STILLBIRTH...</span>
        <span class="s1">&#39;prob_ip_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;baseline probability of intrapartum still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_maternal_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers who have died during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ur&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing uterine rupture&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_hypertension&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing intrapartum sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers pregnant with twins&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_both_twins_ip_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that if this mother will experience still birth, and she is pregnant with twins, &#39;</span>
                        <span class="s1">&#39;that neither baby will survive&#39;</span><span class="p">),</span>

        <span class="c1"># POSTPARTUM HAEMORRHAGE...</span>
        <span class="s1">&#39;prob_pph_uterine_atony&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing uterine atony&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_ua_hypertension&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk risk of pph after secondary to uterine atony in hypertensive women&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_ua_multiple_pregnancy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk risk of pph after secondary to uterine atony in women pregnant with twins&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_ua_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk risk of pph after secondary to uterine atony in women with placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_ua_macrosomia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk risk of pph after secondary to uterine atony in women with macrosomic foetus&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_ua_diabetes&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing uterine atony&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_retained_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing retained placenta&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_other_causes&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing other pph causes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_death_from_haem_with_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk increase of death in women who are anaemic at time of PPH&#39;</span><span class="p">),</span>

        <span class="c1"># CARE SEEKING FOR HEALTH CENTRE DELIVERY...</span>
        <span class="s1">&#39;odds_deliver_in_health_centre&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds of a woman delivering in a health centre compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_20_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 20-24 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_25_29&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 25-29 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_30_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 30-34 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_35_39&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 35-39 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_40_44&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 40-44 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_45_49&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 45-49 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_wealth_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 4 delivering at health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_wealth_3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 3 delivering at health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_wealth_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 2 delivering at health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_wealth_1&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 1 delivering at health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_parity_3_to_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman with a parity of 3-4 delivering in a health centre compared to&#39;</span>
                        <span class="s1">&#39;a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_parity_&gt;4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a parity &gt;4 delivering in health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_rural&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a married woman delivering in a health centre compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_married&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a married woman delivering in a health centre compared to a hospital&#39;</span><span class="p">),</span>

        <span class="c1"># CARE SEEKING FOR HOME BIRTH...</span>
        <span class="s1">&#39;odds_deliver_at_home&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds of a woman delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_20_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 20-24 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_25_29&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 25-29 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_30_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 30-34 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_35_39&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 35-39 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_40_44&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 40-44 delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_45_49&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 45-49 delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_rural&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a rural delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_primary_education&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a primary education delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_secondary_education&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a secondary education delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_wealth_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 4 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_wealth_3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 3 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_wealth_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 2 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_wealth_1&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman at wealth level 1 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_parity_3_to_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman with a parity of 3-4 delivering at home compared to&#39;</span>
                        <span class="s1">&#39;a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_parity_&gt;4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a parity &gt;4 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_married&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a married woman delivering in a home compared to a hospital&#39;</span><span class="p">),</span>

        <span class="s1">&#39;probability_delivery_hospital&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of delivering in a hospital&#39;</span><span class="p">),</span>

        <span class="c1"># PNC CHECK...</span>
        <span class="s1">&#39;prob_timings_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman who will receive a PNC check will receive care &lt;48hrs post birth &#39;</span>
                        <span class="s1">&#39;or &gt; 48hrs post birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_will_attend_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;baseline odss a woman will seek PNC for her and her newborn following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_age_30_35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women aged 30-35 attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_age_&gt;35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women aged &gt; 35 attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_rural&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women who live rurally attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_wealth_level_1&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women from the highest wealth level attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_anc4+&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women who attended ANC4+ attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_caesarean_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women who delivered by caesarean attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_facility_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women who delivered in a health facility attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_pnc_parity_&gt;4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;odds ratio for women with a parity of &gt;4 attending PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_of_attending_pn_event_by_day&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities used in a weighted random draw to determine when a woman will attend the &#39;</span>
                        <span class="s1">&#39;postnatal event&#39;</span><span class="p">),</span>

        <span class="c1"># EMERGENCY CARE SEEKING...</span>
        <span class="s1">&#39;prob_careseeking_for_complication&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman seeking skilled assistance after developing a complication at a &#39;</span>
                        <span class="s1">&#39;home birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_careseeking_for_complication_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman seeking skilled assistance after developing a postnatal complication &#39;</span>
                        <span class="s1">&#39;following a home birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;test_care_seeking_probs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;dummy probabilities of delivery care seeking used in testing&#39;</span><span class="p">),</span>

        <span class="c1"># TREATMENT PARAMETERS...</span>
        <span class="s1">&#39;prob_delivery_modes_ec&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman admitted with eclampsia will deliver normally, via caesarean or &#39;</span>
                        <span class="s1">&#39;via assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_delivery_modes_spe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman admitted with severe pre-eclampsia will deliver normally, via &#39;</span>
                        <span class="s1">&#39;caesarean or via assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;residual_prob_avd&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman will deliver via assisted vaginal delivery for an indication not &#39;</span>
                        <span class="s1">&#39;explicitly modelled&#39;</span><span class="p">),</span>
        <span class="s1">&#39;residual_prob_caesarean&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman will deliver via caesarean section for an indication not &#39;</span>
                        <span class="s1">&#39;explicitly modelled&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_adherent_ifa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability that a woman started on postnatal IFA will be adherent&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative effect of iron and folic acid on anaemia status&#39;</span><span class="p">),</span>
        <span class="s1">&#39;number_ifa_tablets_required_postnatally&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;total number of iron and folic acid tablets required during postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_maternal_infection_clean_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Effect of clean delivery practices on risk of maternal infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_maternal_chorio_abx_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Relative effect of antibiotics for premature rupture of membranes on maternal risk of &#39;</span>
                        <span class="s1">&#39;chorioamnionitis prior to birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_amtsl&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;relative risk of severe postpartum haemorrhage following active management of the third &#39;</span>
                        <span class="s1">&#39;stage of labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_haemostatis_uterotonics&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of uterotonics stopping a postpartum haemorrhage due to uterine atony &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_successful_manual_removal_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of manual removal of retained products arresting a post partum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;success_rate_pph_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of surgery for postpartum haemorrhage being successful&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_surg_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of surgery on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_hyst_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of hysterectomy on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_bt_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for postpartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sepsis_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for sepsis on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;success_rate_uterine_repair&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability repairing a ruptured uterus surgically&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_successful_assisted_vaginal_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of successful assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_repair_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of surgical uterine repair treatment for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_treatment_effect_bt_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_hysterectomy_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of blood hysterectomy for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia_treatment_effect_severe_pe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for severe pre eclampsia on risk of eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for eclampsia on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;anti_htns_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of IV anti hypertensive treatment on risk of death secondary to severe pre-eclampsia/&#39;</span>
                        <span class="s1">&#39;eclampsia stillbirth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;anti_htns_treatment_effect_progression&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;effect of IV anti hypertensive treatment on risk of progression from mild to severe gestational&#39;</span>
            <span class="s1">&#39; hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aph_bt_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for antepartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for severe anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aph_cs_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of caesarean section for antepartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_avd_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of assisted vaginal delivery on risk of intrapartum still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_cs_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;effect of caesarean section delivery on risk of intrapartum still birth&#39;</span><span class="p">),</span>

        <span class="c1"># HEALTH CARE WORKER AVAILABILITY AND COMPETENCE...</span>
        <span class="s1">&#39;prob_hcw_avail_iv_abx&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - parenteral antibiotics&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_uterotonic&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - parenteral uterotonics&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_anticonvulsant&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - parenteral anticonvulsants&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_man_r_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - manual removal of retained placenta&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_avd&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_blood_tran&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - blood transfusion&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - obstetric surgery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_retained_prod&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - removal of retained products of conception&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_hcw_avail_neo_resus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;average probability that a health facility providing EmONC care has a HCW available that can&#39;</span>
                        <span class="s1">&#39; delivery signal function - neonatal resuscitation&#39;</span><span class="p">),</span>

        <span class="s1">&#39;mean_hcw_competence_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;mean competence of HCW at delivering EmONC care at a health centre. A draw below this level &#39;</span>
                        <span class="s1">&#39;prevents intervention delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;mean_hcw_competence_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;mean competence of HCW at delivering EmONC care at a hospital. A draw below this level &#39;</span>
                        <span class="s1">&#39;prevents intervention delivery&#39;</span><span class="p">),</span>

        <span class="s1">&#39;prob_intervention_delivered_anaemia_assessment_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will have their Hb levels checked during PNC given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>

        <span class="c1"># ANALYSIS PARAMETERS</span>
        <span class="s1">&#39;analysis_year&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Year on which changes in parameters as part of analysis should be enacted (1st day, &#39;</span>
                       <span class="s1">&#39;1st month)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_analysis_in_progress&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Used within the pregnancy_helper_function to signify that labour/postnatal &#39;</span>
                        <span class="s1">&#39;analysis is currently being conducted&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_bemonc_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;parameter used in analysis to allow manipulation of coverage of BEmONC interventions&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_cemonc_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;parameter used in analysis to allow manipulation of coverage of CEmONC interventions&#39;</span><span class="p">),</span>
        <span class="s1">&#39;bemonc_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;set probability of BEmONC intervention being delivered during analysis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cemonc_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;set probability of CEmONC intervention being delivered during analysis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;bemonc_cons_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;set probability of BEmONC consumables being available&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cemonc_cons_availability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;set probability of CEmONC consumables being available&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_pnc_coverage&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event that an alternative level of PNC coverage has been &#39;</span>
                        <span class="s1">&#39;determined following the events run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;alternative_pnc_quality&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals within the analysis event that an alternative level of PNC quality has been &#39;</span>
                        <span class="s1">&#39;determined following the events run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pnc_availability_odds&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Target odds of maternal PNC coverage when analysis is being conducted - only applied if&#39;</span>
                        <span class="s1">&#39;alternative_pnc_coverage is true&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Target probability of quality/consumables when analysis is being conducted - only applied if &#39;</span>
                        <span class="s1">&#39;alternative_pnc_coverage is true&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sba_sens_analysis_max&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals that max coverage of SBA is being forced for sensitivity analysis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pnc_sens_analysis_max&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals that max coverage of PNC is being forced for sensitivity analysis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pnc_sens_analysis_min&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Signals that min coverage of SBA is being forced for sensitivity analysis&#39;</span><span class="p">),</span>

    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;The date on which a newly pregnant woman is scheduled to&#39;</span>
                                                              <span class="s1">&#39; go into labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is currently in labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans most recent pregnancy has ended &#39;</span>
                                                           <span class="s1">&#39;in a stillbirth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_parity&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;total number of previous deliveries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;total number of previous deliveries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced an antepartum haemorrhage&#39;</span>
                                                          <span class="s1">&#39; in this delivery and it severity&#39;</span><span class="p">,</span>
                                       <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>

        <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced uterine rupture in this &#39;</span>
                                                   <span class="s1">&#39;delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans uterine rupture has been treated&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has developed sepsis due to an intrapartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has developed sepsis due to a postpartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;If this woman has received treatment for maternal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans eclampsia has been treated&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has been treated for severe &#39;</span>
                                                                  <span class="s1">&#39;pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has been treated for maternal &#39;</span>
                                                                   <span class="s1">&#39;hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_gest_htn_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has is receiving regular &#39;</span>
                                                         <span class="s1">&#39;antihypertensives&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced an postpartum haemorrhage in this&#39;</span>
                                                   <span class="s1">&#39;delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BITSET</span><span class="p">,</span> <span class="s1">&#39; Treatment for received for postpartum haemorrhage &#39;</span>
                                                               <span class="s1">&#39;(bitset)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has had a hysterectomy as treatment for a &#39;</span>
                                                        <span class="s1">&#39;complication of labour, and therefore is unable to conceive&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of on which this mother last delivered&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is in the postpartum period, from delivery until &#39;</span>
                                                 <span class="s1">&#39;day +42 (6 weeks)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Number of postnatal checks this woman has received&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is receiving iron and folic acid during &#39;</span>
                                                             <span class="s1">&#39;the postnatal period&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Labour.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">parameter_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_LabourSkilledBirth&#39;</span>
                                                                          <span class="s1">&#39;Attendance.xlsx&#39;</span><span class="p">,</span>
                                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">parameter_dataframe</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># For the first period (2010-2015) we use the first value in each list as a parameter</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_current_parameter_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#  we store different potential treatments for postpartum haemorrhage via bistet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">,</span>
                                           <span class="p">[</span><span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">])</span>

        <span class="c1">#  ----------------------------ASSIGNING PARITY AT BASELINE --------------------------------------------------</span>
        <span class="c1"># This equation predicts the parity of each woman at baseline (who is of reproductive age)</span>
        <span class="n">parity_equation</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_parity</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># We assign parity to all women of reproductive age at baseline</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">),</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">parity_equation</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">),</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Parity was calculated incorrectly at initialisation&#39;</span><span class="p">)</span>

        <span class="c1">#  ----------------------- ASSIGNING PREVIOUS CS DELIVERY AT BASELINE -----------------------------------------</span>
        <span class="c1"># This equation determines the proportion of women at baseline who have previously delivered via caesarean</span>
        <span class="c1"># section</span>
        <span class="n">reproductive_age_women</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">la_parity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">previous_cs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reproductive_age_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reproductive_age_women</span><span class="p">]))</span> <span class="o">&lt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;prob_previous_caesarean_at_baseline&#39;</span><span class="p">],</span>
            <span class="n">index</span><span class="o">=</span><span class="n">reproductive_age_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reproductive_age_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">previous_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">previous_cs</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="Labour.get_and_store_labour_item_codes">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.get_and_store_labour_item_codes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_and_store_labour_item_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function defines the required consumables for each intervention delivered during this module and stores</span>
<span class="sd">        them in a module level dictionary called within HSIs</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>

        <span class="c1"># ---------------------------------- BLOOD TEST EQUIPMENT ---------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span>
             <span class="p">}</span>
        <span class="c1"># ---------------------------------- IV DRUG ADMIN EQUIPMENT  -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span>
             <span class="p">}</span>

        <span class="c1"># ------------------------------------------ FULL BLOOD COUNT -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;full_blood_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># -------------------------------------------- DELIVERY ------------------------------------------------------</span>
        <span class="c1"># assuming CDK has blade, soap, cord tie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;delivery_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Clean delivery kit&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Chlorhexidine 1.5</span><span class="si">% s</span><span class="s1">olution_5_CMST&#39;</span><span class="p">):</span> <span class="mi">20</span><span class="p">,</span>
             <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;delivery_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Gauze, absorbent 90cm x 40m_each_CMST&#39;</span><span class="p">):</span> <span class="mi">30</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">):</span> <span class="mi">8000</span>
             <span class="p">}</span>

        <span class="c1"># -------------------------------------------- CAESAREAN DELIVERY ------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;caesarean_delivery_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Halothane (fluothane)_250ml_CMST&#39;</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Ceftriaxone 1g, PFR_each_CMST&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Metronidazole 200mg_1000_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># todo: replace</span>
             <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;caesarean_delivery_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Scalpel blade size 22 (individually wrapped)_100_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">):</span> <span class="mi">8000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Declofenac injection_each_CMST&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="p">}</span>

        <span class="c1"># -------------------------------------------- OBSTETRIC SURGERY ----------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstetric_surgery_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Halothane (fluothane)_250ml_CMST&#39;</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Ceftriaxone 1g, PFR_each_CMST&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Metronidazole 200mg_1000_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># todo: replace</span>
             <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstetric_surgery_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Scalpel blade size 22 (individually wrapped)_100_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">):</span> <span class="mi">8000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Declofenac injection_each_CMST&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="p">}</span>

        <span class="c1"># -------------------------------------------- ABX FOR PROM -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">):</span> <span class="mi">8</span><span class="p">}</span>

        <span class="c1"># -------------------------------------------- ANTENATAL STEROIDS ---------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;antenatal_steroids&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Dexamethasone 5mg/ml, 5ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">12</span><span class="p">}</span>

        <span class="c1"># -------------------------------------  INTRAVENOUS ANTIHYPERTENSIVES ---------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_antihypertensives&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Hydralazine, powder for injection, 20 mg ampoule&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># --------------------------------------- ORAL ANTIHYPERTENSIVES ---------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;oral_antihypertensives&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Methyldopa 250mg_1000_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># ----------------------------------  SEVERE PRE-ECLAMPSIA/ECLAMPSIA  -----------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;magnesium_sulfate&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Magnesium sulfate, injection, 500 mg/ml in 10-ml ampoule&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;eclampsia_management_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">):</span> <span class="mi">23_040</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="p">}</span>
        <span class="c1"># -------------------------------------  OBSTRUCTED LABOUR  ---------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Lidocaine HCl (in dextrose 7.5%), ampoule 2 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">):</span> <span class="mi">8</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Gentamycin, injection, 40 mg/ml in 2 ml vial&#39;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">):</span> <span class="mi">8000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Gauze, absorbent 90cm x 40m_each_CMST&#39;</span><span class="p">):</span> <span class="mi">30</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Suture pack&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="p">}</span>
        <span class="c1"># -------------------------------------  OBSTETRIC VACUUM   ---------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;vacuum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Vacuum, obstetric&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># -------------------------------------  MATERNAL SEPSIS  -----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;maternal_sepsis_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Benzylpenicillin 3g (5MU), PFR_each_CMST&#39;</span><span class="p">):</span> <span class="mi">8</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Gentamycin, injection, 40 mg/ml in 2 ml vial&#39;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
             <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;maternal_sepsis_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">):</span> <span class="mi">23_040</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">):</span> <span class="mi">8000</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="p">}</span>
        <span class="c1"># -------------------------------------  ACTIVE MANAGEMENT THIRD STAGE  ---------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;amtsl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Oxytocin, injection, 10 IU in 1 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># -------------------------------------  POSTPARTUM HAEMORRHAGE  ---------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;pph_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Oxytocin, injection, 10 IU in 1 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">5</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;pph_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Misoprostol, tablet, 200 mcg&#39;</span><span class="p">):</span> <span class="mi">600</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">6</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">):</span> <span class="mi">23_040</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Foley catheter&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
             <span class="p">}</span>

        <span class="c1"># -------------------------------------  BLOOD TRANSFUSION  ---------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Blood, one unit&#39;</span><span class="p">):</span> <span class="mi">2</span><span class="p">}</span>

        <span class="c1"># ------------------------------------------ FULL BLOOD COUNT -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;hb_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Haemoglobin test (HB)&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># ---------------------------------- IRON AND FOLIC ACID ------------------------------------------------------</span>
        <span class="c1"># Dose changes at run time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>

        <span class="c1"># -------------------------------------------- RESUSCITATION ------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;resuscitation&#39;</span><span class="p">]</span> <span class="o">=</span>\
            <span class="p">{</span><span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Infant resuscitator, clear plastic + mask + bag_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span></div>


<div class="viewcode-block" id="Labour.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="c1"># Update self.current_parameters</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_current_parameter_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># We call the following function to store the required consumables for the simulation run within the appropriate</span>
        <span class="c1"># dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_and_store_labour_item_codes</span><span class="p">()</span>

        <span class="c1"># We set the LoggingEvent to run on the last day of each year to produce statistics for that year</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Schedule analysis event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAndPostnatalCareAnalysisEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;analysis_year&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># This list contains all the women who are currently in labour and is used for checks/testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># This list contains all possible complications/outcomes of the intrapartum and postpartum phase- its used in</span>
        <span class="c1"># assert functions as a test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;obstruction_cpd&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_malpos_malpres&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_other&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;sepsis_chorioamnionitis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepsis_endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_skin_soft_tissue&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;sepsis_urinary_tract&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_retained_placenta&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;pph_other&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">,</span> <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;sepsis&#39;</span><span class="p">]</span>
        <span class="c1"># define any dx_tests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>
            <span class="n">full_blood_count_hb_pn</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;full_blood_count&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># ======================================= LINEAR MODEL EQUATIONS ==============================================</span>
        <span class="c1"># Here we define the equations that will be used throughout this module using the linear</span>
        <span class="c1"># model and stored them as a parameter</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation predicts the parity of each woman at baseline (who is of reproductive age)</span>
            <span class="s1">&#39;parity&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_parity</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation predicts if a woman will go into post term labour</span>
            <span class="s1">&#39;post_term_labour&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_post_term_labour</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of obstructed labour. As we assume obstructed labour can</span>
            <span class="c1"># only occur following on of three preceding causes, this model is additive</span>
            <span class="s1">&#39;obstruction_cpd_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_obstruction_cpd_ip</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing sepsis due to chorioamnionitis infection</span>
            <span class="c1"># during the intrapartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;sepsis_chorioamnionitis_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_chorioamnionitis_ip</span><span class="p">,</span>
                                                             <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing sepsis due to endometritis infection</span>
            <span class="c1"># during the postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;sepsis_endometritis_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_endometritis_pp</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing sepsis due to skin or soft tissue</span>
            <span class="c1"># infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;sepsis_skin_soft_tissue_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_skin_soft_tissue_pp</span><span class="p">,</span>
                                                             <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing a urinary tract infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;sepsis_urinary_tract_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_urinary_tract_pp</span><span class="p">,</span>
                                                          <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following sepsis during labour and is mitigated</span>
            <span class="c1"># by treatment</span>
            <span class="s1">&#39;intrapartum_sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>
            <span class="s1">&#39;postpartum_sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following eclampsia and is mitigated</span>
            <span class="c1"># by treatment delivered either immediately prior to admission for delivery or during labour</span>
            <span class="s1">&#39;eclampsia_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_eclampsia_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following eclampsia and is mitigated</span>
            <span class="c1"># by treatment delivered either immediately prior to admission for delivery or during labour</span>
            <span class="s1">&#39;severe_pre_eclampsia_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_severe_pre_eclamp_death</span><span class="p">,</span>
                                                             <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of placental abruption in labour</span>
            <span class="s1">&#39;placental_abruption_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_placental_abruption_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of antepartum haemorrhage. We assume APH can only occur</span>
            <span class="c1"># in the presence of a preceding placental causes (abruption/praevia) therefore this model is additive</span>
            <span class="s1">&#39;antepartum_haem_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_antepartum_haem_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following antepartum haemorrhage. Risk is</span>
            <span class="c1"># mitigated by treatment</span>
            <span class="s1">&#39;antepartum_haemorrhage_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_antepartum_haem_death</span><span class="p">,</span>
                                                               <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of postpartum haemorrhage due to uterine atony</span>
            <span class="s1">&#39;pph_uterine_atony_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_pph_uterine_atony_pp</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of postpartum haemorrhage due to retained placenta</span>
            <span class="s1">&#39;pph_retained_placenta_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_pph_retained_placenta_pp</span><span class="p">,</span>
                                                           <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following postpartum haemorrhage. Risk is</span>
            <span class="c1"># mitigated by treatment</span>
            <span class="s1">&#39;postpartum_haemorrhage_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_postpartum_haem_pp_death</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of uterine rupture</span>
            <span class="s1">&#39;uterine_rupture_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_uterine_rupture_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following uterine rupture. Risk if reduced by</span>
            <span class="c1"># treatment</span>
            <span class="s1">&#39;uterine_rupture_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_uterine_rupture_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of still birth during the intrapartum period. Assisted</span>
            <span class="c1"># vaginal delivery and caesarean delivery are assumed to significantly reduce risk</span>
            <span class="s1">&#39;intrapartum_still_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_intrapartum_still_birth</span><span class="p">,</span>
                                                          <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This regression equation uses data from the DHS to predict a womans probability of choosing to deliver in</span>
            <span class="c1"># a health centre</span>
            <span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_probability_delivery_health_centre</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This regression equation uses data from the DHS to predict a womans probability of choosing to deliver in</span>
            <span class="c1"># at home</span>
            <span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_probability_delivery_at_home</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine the probability that a woman will seek care for PNC after delivery</span>
            <span class="s1">&#39;postnatal_check&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_postnatal_check</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Here we create a dict with all the models to be scaled and the &#39;target&#39; rate parameter</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span>
        <span class="n">models_to_be_scaled</span> <span class="o">=</span> <span class="p">[[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;uterine_rupture_ip&#39;</span><span class="p">],</span> <span class="s1">&#39;prob_uterine_rupture&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_will_attend_pnc&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_deliver_at_home&#39;</span><span class="p">],</span>
                               <span class="p">[</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">],</span> <span class="s1">&#39;odds_deliver_in_health_centre&#39;</span><span class="p">]]</span>

        <span class="c1"># Scale all models updating the parameter used as the intercept of the linear models</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_to_be_scaled</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">scale_linear_model_at_initialisation</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parameter_key</span><span class="o">=</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="Labour.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Labour.further_on_birth_labour">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.further_on_birth_labour">[docs]</a>
    <span class="k">def</span> <span class="nf">further_on_birth_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module. This function contains additional</span>
<span class="sd">        code related to the labour module that should be ran on_birth for all births - it has been</span>
<span class="sd">        parcelled into functions to ensure each modules (pregnancy,antenatal care, labour, newborn, postnatal) on_birth</span>
<span class="sd">        code is ran in the correct sequence (as this can vary depending on how modules are registered)</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># log delivery setting</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;delivery_setting_and_mode&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;facility_type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]),</span>
                                                           <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]})</span>

        <span class="c1"># Store only live births to a mother parity</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Only live births contribute to parity</span>

        <span class="c1"># Currently we assume women who received antihypertensive in the antenatal period will continue to use them</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.on_hsi_alert">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.on_hsi_alert">[docs]</a>
    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This is called whenever there is an HSI event commissioned by one of the other disease modules.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is Labour, being alerted about a health system interaction &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.report_daly_values">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.report_daly_values">[docs]</a>
    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is Labour reporting my health values&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to population properties data frame</span>

        <span class="c1"># All dalys related to maternal outcome are outputted by the pregnancy supervisor module...</span>
        <span class="n">daly_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">daly_series</span></div>


    <span class="c1"># ===================================== HELPER AND TESTING FUNCTIONS ==============================================</span>
<div class="viewcode-block" id="Labour.set_date_of_labour">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_date_of_labour">[docs]</a>
    <span class="k">def</span> <span class="nf">set_date_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by contraception.py within the events &#39;PregnancyPoll&#39; and &#39;Fail&#39; for women who are</span>
<span class="sd">        allocated to become pregnant during a simulation run. This function schedules the onset of labour between 37</span>
<span class="sd">        and 44 weeks gestational age (not foetal age) to ensure all women who become pregnant will go into labour.</span>
<span class="sd">        Women may enter labour before the due date set in this function either due to pre-term labour or induction/</span>
<span class="sd">        caesarean section.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is having their labour scheduled on date &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="c1"># Check only alive newly pregnant women are scheduled to this function</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">and</span>
           <span class="p">(</span><span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Attempt to schedule labour for woman </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> inappropriately&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># At the point of conception we schedule labour to onset for all women between after 37 weeks gestation - first</span>
        <span class="c1"># we determine if she will go into labour post term (42+ weeks)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;post_term_labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
           <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]:</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span>
                    <span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span>
                    <span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">35</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span>

        <span class="c1"># Here we check that no one is scheduled to go into labour before 37 gestational age (35 weeks foetal age,</span>
        <span class="c1"># ensuring all preterm labour comes from the pregnancy supervisor module</span>
        <span class="n">days_until_labour</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">days_until_labour</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Labour scheduled for woman </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> beyond the maximum estimated &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;possible length of pregnancy&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.predict">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.predict">[docs]</a>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function compares the result of a specific linear equation with a random draw providing a boolean for</span>
<span class="sd">        the outcome under examination</span>
<span class="sd">        :param eq: Linear model equation</span>
<span class="sd">        :param person_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">]]</span>

        <span class="c1"># We define specific external variables used as predictors in the equations defined below</span>
        <span class="n">has_rbt</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;received_blood_transfusion&#39;</span><span class="p">]</span>
        <span class="n">mode_of_delivery</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span>
        <span class="n">received_clean_delivery</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">]</span>
        <span class="n">received_abx_for_prom</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span>
        <span class="n">amtsl_given</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]</span>
        <span class="n">delivery_setting</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span>

        <span class="n">macrosomia</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;macrosomia&#39;</span>

        <span class="c1"># We run a random draw and return the outcome</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">eq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">person</span><span class="p">,</span>
                                                     <span class="n">received_clean_delivery</span><span class="o">=</span><span class="n">received_clean_delivery</span><span class="p">,</span>
                                                     <span class="n">received_abx_for_prom</span><span class="o">=</span><span class="n">received_abx_for_prom</span><span class="p">,</span>
                                                     <span class="n">mode_of_delivery</span><span class="o">=</span><span class="n">mode_of_delivery</span><span class="p">,</span>
                                                     <span class="n">received_blood_transfusion</span><span class="o">=</span><span class="n">has_rbt</span><span class="p">,</span>
                                                     <span class="n">amtsl_given</span><span class="o">=</span><span class="n">amtsl_given</span><span class="p">,</span>
                                                     <span class="n">macrosomia</span><span class="o">=</span><span class="n">macrosomia</span><span class="p">,</span>
                                                     <span class="n">delivery_setting</span><span class="o">=</span><span class="n">delivery_setting</span><span class="p">)[</span><span class="n">person_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="Labour.reset_due_date">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.reset_due_date">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_due_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">,</span> <span class="n">new_due_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called at various points in the PregnancySupervisor module to reset the due-date of women who</span>
<span class="sd">        may have experience pregnancy loss or will now go into pre-term labour on new due-date</span>
<span class="sd">        :param ind_or_df: (STR) Is this function being use on an individual row or slice of the data frame</span>
<span class="sd">         &#39;individual&#39;/&#39;data_frame&#39;</span>
<span class="sd">        :param id_or_index: The individual id OR dataframe slice that this change will be made for</span>
<span class="sd">        :param new_due_date: (DATE) the new due-date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_due_date</span></div>


<div class="viewcode-block" id="Labour.check_labour_can_proceed">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.check_labour_can_proceed">[docs]</a>
    <span class="k">def</span> <span class="nf">check_labour_can_proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the LabourOnsetEvent to evaluate if labour can proceed for the woman who has arrived</span>
<span class="sd">         at the event</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :returns True/False if labour can proceed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If the mother has died OR has lost her pregnancy OR is already in labour then the labour events wont run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">or</span> <span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">, however this is event is no longer relevant for this &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;individual and will not run&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If she is alive, pregnant, not in labour AND her due date is today then the event will run</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> \
           <span class="ow">and</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">:</span>

            <span class="c1"># If the woman in not currently an inpatient then we assume this is her normal labour</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ac_admitted_for_immediate_delivery</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and will now go into labour at gestation &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Otherwise she may have gone into labour whilst admitted as an inpatient and is awaiting induction/</span>
            <span class="c1"># caesarean when she is further along in her pregnancy, in that case labour can proceed via the method she</span>
            <span class="c1"># was admitted for</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">, who is currently admitted and awaiting &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery, has just gone into spontaneous labour and reached &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;LabourOnsetEvent on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> - she will now go into labour &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;at gestation </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If she is alive, pregnant, not in labour BUT her due date is not today, however shes been admitted then we</span>
        <span class="c1"># labour can progress as she requires early delivery</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ac_admitted_for_immediate_delivery</span> <span class="o">!=</span>
                                                                         <span class="s1">&#39;none&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">- they have been admitted for delivery due to &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;complications in the antenatal period and will now progress into the &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;labour event at gestation </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># We set her due date to today so she the event will run properly</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Labour.set_intrapartum_complications">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_intrapartum_complications">[docs]</a>
    <span class="k">def</span> <span class="nf">set_intrapartum_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function is called either during a LabourAtHomeEvent OR HSI_Labour_ReceivesSkilledBirthAttendanceDuring</span>
<span class="sd">        Labour for all women during labour (home birth vs facility delivery). The function is used to apply risk of</span>
<span class="sd">        complications which have been passed ot it including the preceding causes of obstructed labour</span>
<span class="sd">        (malposition, malpresentation and cephalopelvic disproportion), obstructed labour, uterine rupture, placental</span>
<span class="sd">        abruption, antepartum haemorrhage,  infections (chorioamnionitis/other) and sepsis. Properties in the dataframe</span>
<span class="sd">         are set accordingly including properties which map to disability weights to capture DALYs</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param complication: (STR) the complication passed to the function which is being evaluated</span>
<span class="sd">        [&#39;obstruction_cpd&#39;, &#39;obstruction_malpos_malpres&#39;, &#39;obstruction_other&#39;, &#39;placental_abruption&#39;,</span>
<span class="sd">        &#39;antepartum_haem&#39;, &#39;sepsis_chorioamnionitis&#39;, &#39;uterine_rupture&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># First we run check to ensure only women who have started the labour process are passed to this function</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is having risk of complications applied but has no &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;delivery setting&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Then we check that only complications from the master complication list are passed to the function (to ensure</span>
        <span class="c1"># any typos for string variables are caught)</span>
        <span class="k">if</span> <span class="n">complication</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A complication (&quot;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&quot;) was passed to &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;set_intrapartum_complications&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Here we make sure women who have experienced complications antenatally cant experience</span>
        <span class="c1"># the same complication again when this code runs</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">((</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">])</span> <span class="ow">or</span>
           <span class="p">((</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis_chorioamnionitis&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">])):</span>
            <span class="k">return</span>

        <span class="c1"># For the preceding complications that can cause obstructed labour, we apply risk using a set probability</span>
        <span class="k">if</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;obstruction_malpos_malpres&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_other&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="c1"># Otherwise we use the linear model to predict likelihood of a complication</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_ip&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># --------------------------------------- COMPLICATION ------------------------------------------------------</span>
        <span class="c1"># If &#39;result&#39; == True, this woman will experience the complication passed to the function</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed </span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1"> during birth on date&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># For &#39;complications&#39; stored in a biset property - they are set here</span>
            <span class="k">if</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;obstruction_cpd&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_malpos_malpres&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_other&#39;</span><span class="p">):</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour_onset&#39;</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;obstruction_cpd&#39;</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;cpd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Otherwise they are stored as individual properties (women with undiagnosed placental abruption may present</span>
            <span class="c1"># to labour)</span>
            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span>
                <span class="n">random_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice</span>

                <span class="k">if</span> <span class="n">random_choice</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;mild_mod_aph_onset&#39;</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                   <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;mild_mod_antepartum_haemorrhage&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;severe_aph_onset&#39;</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                   <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;severe_antepartum_haemorrhage&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis_chorioamnionitis&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;chorio_in_preg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;sepsis_onset&#39;</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="Labour.set_postpartum_complications">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_postpartum_complications">[docs]</a>
    <span class="k">def</span> <span class="nf">set_postpartum_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called in BirthAndPostnatalOutcomesEvent during  for all women following labour and birth</span>
<span class="sd">        (home birth vs facility delivery). The function is used to apply risk of complications which have been passed</span>
<span class="sd">        ot it including the preceding causes of postpartum haemorrhage (uterine atony, retained placenta, lacerations,</span>
<span class="sd">        other), postpartum haemorrhag or sepsis. Properties in the dataframe are set accordingly including properties</span>
<span class="sd">        which map to disability weights to capture DALYs</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param complication: (STR) the complication passed to the function which is being evaluated [</span>
<span class="sd">        &#39;sepsis_endometritis&#39;, &#39;sepsis_skin_soft_tissue&#39;, &#39;sepsis_urinary_tract&#39;, &#39;pph_uterine_atony&#39;,</span>
<span class="sd">        &#39;pph_retained_placenta&#39;, &#39;pph_other&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># This function follows a roughly similar pattern as set_intrapartum_complications</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is having risk of complications applied but has no &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;delivery setting&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">complication</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A complication (&quot;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&quot;) was passed to &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;set_postpartum_complications&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#  We determine if this woman has experienced any of the other potential preceding causes of PPH</span>
        <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;pph_other&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_pph_other_causes&#39;</span><span class="p">]</span>

        <span class="c1"># For the other complications which can be passed to this function we use the linear model to return a womans</span>
        <span class="c1"># risk and compare that to a random draw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_pp&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># ------------------------------------- COMPLICATION ---------------------------------------------------------</span>
        <span class="c1"># If result == True the complication has happened and the appropriate changes to the data frame are made</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;sepsis_endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_urinary_tract&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_skin_soft_tissue&#39;</span><span class="p">):</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;sepsis_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis_endometritis&#39;</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;endo_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;pph_uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_other&#39;</span><span class="p">):</span>
                <span class="c1"># Set primary complication to true</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">logger_pn</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;postnatal&#39;</span><span class="p">})</span>

                <span class="c1"># Store mni variables used during treatment</span>
                <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;pph_uterine_atony&#39;</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;uterine_atony&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;pph_retained_placenta&#39;</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;retained_placenta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># We set the severity to map to DALY weights</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;mild_mod_pph_onset&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;severe_pph_&#39;</span>
                                                                                                        <span class="s1">&#39;onset&#39;</span><span class="p">]):</span>

                    <span class="n">random_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;non_severe&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">random_choice</span> <span class="o">==</span> <span class="s1">&#39;non_severe&#39;</span><span class="p">:</span>
                        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;mild_mod_pph_onset&#39;</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;severe_pph_onset&#39;</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.progression_of_hypertensive_disorders">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.progression_of_hypertensive_disorders">[docs]</a>
    <span class="k">def</span> <span class="nf">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called during LabourAtHomeEvent/BirthAndPostnatalEvent or HSI_Labour_Receives</span>
<span class="sd">        SkilledBirthAttendanceDuring/HSI_Labour_ReceivesPostnatalCheck to determine if a woman with a hypertensive</span>
<span class="sd">        disorder will experience progression to a more severe state of disease during labour or the immediate</span>
<span class="sd">         postpartum period. We do not allow for new onset of  hypertensive disorders during this module - only</span>
<span class="sd">        progression of exsisting disease.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param property_prefix: (STR) &#39;pn&#39; or &#39;ps&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="n">property_prefix</span> <span class="o">==</span> <span class="s1">&#39;ps&#39;</span><span class="p">:</span>
            <span class="n">timing</span> <span class="o">=</span> <span class="s1">&#39;intrapartum&#39;</span>
            <span class="n">current_log</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timing</span> <span class="o">=</span> <span class="s1">&#39;postnatal&#39;</span>
            <span class="n">current_log</span> <span class="o">=</span> <span class="n">logger_pn</span>

        <span class="c1"># n.b. on birth women whose hypertension will continue into the postnatal period have their disease state stored</span>
        <span class="c1"># in a new property therefore antenatal/intrapartum hypertension is &#39;ps_htn_disorders&#39; and postnatal is</span>
        <span class="c1"># &#39;pn_htn_disorders&#39; hence the use of property prefix variable (as this function is called before and after</span>
        <span class="c1"># birth)</span>

        <span class="c1"># Women can progress from severe pre-eclampsia to eclampsia</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>

            <span class="n">risk_ec</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_severe_pre_eclamp&#39;</span><span class="p">]</span>

            <span class="c1"># Risk of progression from severe pre-eclampsia to eclampsia during labour is mitigated by administration of</span>
            <span class="c1"># magnesium sulfate in women with severe pre-eclampsia (this may have been delivered on admission or in the</span>
            <span class="c1"># antenatal ward)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>
                <span class="n">risk_progression_spe_ec</span> <span class="o">=</span> <span class="n">risk_ec</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eclampsia_treatment_effect_severe_pe&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">risk_progression_spe_ec</span> <span class="o">=</span> <span class="n">risk_ec</span>

            <span class="k">if</span> <span class="n">risk_progression_spe_ec</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;eclampsia&#39;</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;eclampsia_onset&#39;</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                <span class="n">current_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">timing</span><span class="p">})</span>

        <span class="c1"># Or from mild to severe gestational hypertension, risk reduced by treatment</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]:</span>
                <span class="n">risk_prog_gh_sgh</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span>
                    <span class="s1">&#39;anti_htns_treatment_effect_progression&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">risk_prog_gh_sgh</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">risk_prog_gh_sgh</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_gest_htn&#39;</span>

                <span class="n">current_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">timing</span><span class="p">})</span>

        <span class="c1"># Or from severe gestational hypertension to severe pre-eclampsia...</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">current_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">timing</span><span class="p">})</span>

        <span class="c1"># Or from mild pre-eclampsia to severe pre-eclampsia...</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">current_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span>
                                                                    <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">timing</span><span class="p">})</span></div>


<div class="viewcode-block" id="Labour.apply_risk_of_early_postpartum_death">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.apply_risk_of_early_postpartum_death">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called for all women who have survived labour. This function is called at various points in</span>
<span class="sd">        the model depending on a womans pathway through key events/HSI events. The function cycles through each</span>
<span class="sd">        complication to determine if that will contribute to a womans death and then schedules InstantaneousDeathEvent</span>
<span class="sd">        accordingly.  For women who survive their properties from the labour module are reset and they are scheduled to</span>
<span class="sd">        PostnatalWeekOneEvent</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Check the right women are at risk of death</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Function checks df for any potential cause of death, uses CFR parameters to determine risk of death</span>
        <span class="c1"># (either from one or multiple causes) and if death occurs returns the cause</span>
        <span class="n">potential_cause_of_death</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_for_risk_of_death_from_cause_maternal</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;postnatal&#39;</span><span class="p">)</span>

        <span class="c1"># Log df row containing complications and treatments to calculate met need</span>

        <span class="c1"># If a cause is returned death is scheduled</span>
        <span class="k">if</span> <span class="n">potential_cause_of_death</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_mni_for_maternal_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="n">potential_cause_of_death</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">])</span>

        <span class="c1"># If she hasn&#39;t died from any complications, we reset some key properties that resolve after risk of death</span>
        <span class="c1"># has been applied</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset&#39;</span>
                                                                                                         <span class="s1">&#39;_spe&#39;</span><span class="p">]):</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;retained_placenta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;uterine_atony&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">)</span>

            <span class="c1"># ================================ SCHEDULE POSTNATAL WEEK ONE EVENT =================================</span>
            <span class="c1"># For women who have survived first 24 hours after birth we reset all the key labour variables and</span>
            <span class="c1"># scheduled them to attend the first event in the PostnatalSupervisorModule - PostnatalWeekOne Event</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;passed_through_week_one&#39;</span><span class="p">]:</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

                <span class="c1">#  complication variables</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Labour specific treatment variables</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># This event determines if women will develop complications in week one. We stagger when women</span>
                <span class="c1"># arrive at this event to simulate bunching of complications in the first few days after birth</span>
                <span class="n">days_post_birth_td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span>
                <span class="n">days_post_birth_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">days_post_birth_td</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">days_post_birth_int</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> scheduled to PN week one at &gt;1 &#39;</span>
                                                  <span class="sa">f</span><span class="s1">&#39;week postnatal&#39;</span><span class="p">)</span>

                <span class="n">day_for_event</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_of_attending_pn_event_by_day&#39;</span><span class="p">]))</span>

                <span class="c1"># Ensure no women go to this event after week 1</span>
                <span class="k">if</span> <span class="n">day_for_event</span> <span class="o">+</span> <span class="n">days_post_birth_int</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">day_for_event</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                    <span class="n">PostnatalWeekOneMaternalEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day_for_event</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;passed_through_week_one&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is still stored in self.women_in_labour&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is currently in labour within &#39;</span>
                                                  <span class="sa">f</span><span class="s1">&#39;apply_risk_of_early_postpartum_death&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.labour_characteristics_checker">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.labour_characteristics_checker">[docs]</a>
    <span class="k">def</span> <span class="nf">labour_characteristics_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function is called at multiples points in the module to ensure women of the right characteristics are</span>
<span class="sd">        in labour. This function doesnt check for a woman being pregnant or alive, as some events will still run despite</span>
<span class="sd">        those variables being set to false</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">sex</span> <span class="o">!=</span> <span class="s1">&#39;F&#39;</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">14</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">51</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">22</span> <span class="ow">or</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span><span class="p">)</span>
          <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has characteristics that mean they should&#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39; not be in labour &#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.postpartum_characteristics_checker">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.postpartum_characteristics_checker">[docs]</a>
    <span class="k">def</span> <span class="nf">postpartum_characteristics_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function is called at multiples points in the module to ensure women of the right characteristics are</span>
<span class="sd">        in the period following labour. This function doesnt check for a woman being pregnant or alive, as some events</span>
<span class="sd">        will still run despite those variables being set to false</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mni</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">sex</span> <span class="o">!=</span> <span class="s1">&#39;F&#39;</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">14</span> <span class="ow">or</span>
            <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">51</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;passed_through_week_one&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has characteristics that mean they should&#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39; not be in the postnatal period &#39;</span><span class="p">)</span></div>


    <span class="c1"># ============================================== HSI FUNCTIONS ====================================================</span>
    <span class="c1"># Management of each complication is housed within its own function, defined here in the module, and all follow a</span>
    <span class="c1"># similar pattern in which consumables are requested and the intervention is delivered if they are available</span>

<div class="viewcode-block" id="Labour.prophylactic_labour_interventions">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.prophylactic_labour_interventions">[docs]</a>
    <span class="k">def</span> <span class="nf">prophylactic_labour_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function houses prophylactic interventions delivered by a Skilled Birth Attendant to women in labour.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># params[&#39;allowed_interventions&#39;] contains a list of interventions delivered in this module. Removal of</span>
        <span class="c1"># interventions from this list within test/analysis will stop this intervention from running</span>
        <span class="k">if</span> <span class="s1">&#39;prophylactic_labour_interventions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1">#  We determine if the HCW will administer antibiotics for women with premature rupture of membranes</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]:</span>

            <span class="c1"># The mother may have received these antibiotics already if she presented to the antenatal ward from the</span>
            <span class="c1"># community following PROM. We store this in the mni dictionary</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Run HCW check</span>
                <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;iv_abx&#39;</span><span class="p">,</span>
                                                                                           <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

                <span class="c1"># If she has not already receive antibiotics, we check for consumables</span>
                <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                    <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;abx_for_prom&#39;</span><span class="p">],</span>
                    <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">])</span>

                <span class="c1"># Then query if these consumables are available during this HSI And provide if available.</span>
                <span class="c1"># Antibiotics for from reduce risk of newborn sepsis within the first</span>
                <span class="c1"># week of life</span>
                <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ------------------------------ STEROIDS FOR PRETERM LABOUR -------------------------------</span>
        <span class="c1"># Next we see if women in pre term labour will receive antenatal corticosteroids</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;early_preterm_labour&#39;</span> <span class="ow">or</span> \
           <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;late_preterm_labour&#39;</span><span class="p">:</span>

            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;antenatal_steroids&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">])</span>

            <span class="c1"># If available they are given. Antenatal steroids reduce a preterm newborns chance of developing</span>
            <span class="c1"># respiratory distress syndrome and of death associated with prematurity</span>
            <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.determine_delivery_mode_in_spe_or_ec">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.determine_delivery_mode_in_spe_or_ec">[docs]</a>
    <span class="k">def</span> <span class="nf">determine_delivery_mode_in_spe_or_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called following treatment for either severe pre-eclampsia or eclampsia during labour and</span>
<span class="sd">        determines if women with these conditions will undergo vaginal, assisted vaginal or caesarean section due to</span>
<span class="sd">         their complication</span>
<span class="sd">        :param person_id: mothers individual id</span>
<span class="sd">        :param hsi_event: HSI event</span>
<span class="sd">        :param complication: (STR) severe_pre_eclamp OR eclampsia</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># We use a weighted random draw to determine the delivery mode of this woman depending on her complication</span>
        <span class="c1"># (eclampsia, the more severe of the two conditions, is assumed to be more likely to lead to caesarean section)</span>
        <span class="n">delivery_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vaginal&#39;</span><span class="p">,</span> <span class="s1">&#39;avd&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">delivery_modes</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_delivery_modes_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;avd&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assessment_for_assisted_vaginal_delivery</span><span class="p">(</span><span class="n">hsi_event</span><span class="p">,</span> <span class="n">indication</span><span class="o">=</span><span class="s1">&#39;spe_ec&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;cs&#39;</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spe_ec&#39;</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_severe_pre_eclampsia_mgso4">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_severe_pre_eclampsia_mgso4">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_severe_pre_eclampsia_mgso4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">labour_stage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function represents the diagnosis and management of severe pre-eclampsia during labour. This function</span>
<span class="sd">        defines the required consumables and administers the intervention if available. The intervention is</span>
<span class="sd">        intravenous magnesium sulphate.  It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour or</span>
<span class="sd">        HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        :param labour_stage: intrapartum or postpartum period of labour (STR) &#39;ip&#39; or &#39;pp&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># Women who have been admitted for delivery due to severe pre-eclampsia AND have already received magnesium</span>
        <span class="c1"># before moving to the labour ward do not receive the intervention again</span>
        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_severe_pre_eclampsia&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">):</span>

            <span class="c1"># Determine if this person will deliver vaginally or via caesarean</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;ip&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">determine_delivery_mode_in_spe_or_ec</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="s1">&#39;spe&#39;</span><span class="p">)</span>

            <span class="c1"># Run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;anticonvulsant&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># Define and check for the required consumables</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;magnesium_sulfate&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;eclampsia_management_optional&#39;</span><span class="p">])</span>

            <span class="c1"># If the consumables are available - the intervention is delivered. IV magnesium reduces the</span>
            <span class="c1"># probability that a woman with severe pre-eclampsia will experience eclampsia in labour</span>
            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mag_sulph&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_hypertension">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_hypertension">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">labour_stage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of hypertension during labour. This function</span>
<span class="sd">        defines the required consumable  and administers the intervention if available. The intervention is</span>
<span class="sd">        intravenous magnesium sulphate.  It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour or</span>
<span class="sd">        HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># If the treatment is not allowed to be delivered or it has already been delivered the function won&#39;t run</span>
        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_hypertension&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>

            <span class="c1"># Then query if these consumables are available during this HSI</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_antihypertensives&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">])</span>

            <span class="c1"># If they are available then the woman is started on treatment. Intravenous antihypertensive reduce a</span>
            <span class="c1"># womans risk of progression from mild to severe gestational hypertension ANd reduce risk of death for</span>
            <span class="c1"># women with severe pre-eclampsia and eclampsia</span>
            <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;iv_htns&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

                <span class="n">dose</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span> <span class="c1"># approximating 4 tablets a day, for 6 weeks</span>
                <span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">:</span> <span class="n">dose</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;oral_antihypertensives&#39;</span><span class="p">]}</span>
                <span class="n">avail</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_eclampsia">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_eclampsia">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">labour_stage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of eclampsia during or following labour. This function</span>
<span class="sd">        defines the required consumables and administers the intervention if available. The intervention is</span>
<span class="sd">        intravenous magnesium sulphate.  It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour or</span>
<span class="sd">        HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        :param labour_stage: intrapartum or postpartum period of labour (STR) &#39;ip&#39; or &#39;pp&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_eclampsia&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>

            <span class="c1"># Run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;anticonvulsant&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># define and check required consumables</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;magnesium_sulfate&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;eclampsia_management_optional&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">determine_delivery_mode_in_spe_or_ec</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="s1">&#39;ec&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                <span class="c1"># Treatment with magnesium reduces a womans risk of death from eclampsia</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mag_sulph&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.assessment_for_assisted_vaginal_delivery">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_for_assisted_vaginal_delivery">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_for_assisted_vaginal_delivery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">indication</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of obstructed labour during labour. This function</span>
<span class="sd">        defines the required consumables and administers the intervention if available. The intervention in this</span>
<span class="sd">        function is assisted vaginal delivery. It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param indication: STR indication for assessment and delivery of AVD</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">def</span> <span class="nf">refer_for_cs</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">indication</span> <span class="o">==</span> <span class="s1">&#39;other&#39;</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">indication</span> <span class="o">==</span> <span class="s1">&#39;spe_ec&#39;</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indication</span>
            <span class="k">elif</span> <span class="n">indication</span> <span class="o">==</span> <span class="s1">&#39;ol&#39;</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indication</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;assessment_and_treatment_of_obstructed_labour&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">])</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_now&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Define the consumables...</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">indication</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;spe_ec&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">)):</span>
            <span class="c1"># We assume women with CPD cannot be delivered via AVD and will require a caesarean</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cpd&#39;</span><span class="p">]:</span>

                <span class="c1"># If the general package is available AND the facility has the correct tools to carry out the</span>
                <span class="c1"># delivery then it can occur</span>
                <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                    <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;vacuum&#39;</span><span class="p">],</span>
                    <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstructed_labour&#39;</span><span class="p">])</span>

                <span class="c1"># run HCW check</span>
                <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;avd&#39;</span><span class="p">,</span>
                                                                                           <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                    <span class="c1"># Add used equipment</span>
                    <span class="n">hsi_event</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Delivery Forceps&#39;</span><span class="p">,</span> <span class="s1">&#39;Vacuum extractor&#39;</span><span class="p">})</span>

                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;avd_</span><span class="si">{</span><span class="n">indication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

                    <span class="c1"># If AVD was successful then we record the mode of delivery. We use this variable to reduce</span>
                    <span class="c1"># risk of intrapartum still birth when applying risk in the death event</span>
                    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_successful_assisted_vaginal_delivery&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrumental&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># If unsuccessful, this woman will require a caesarean section</span>
                        <span class="n">refer_for_cs</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If no consumables, this woman will require a caesarean section</span>
                    <span class="n">refer_for_cs</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If AVD is not clinically indicated, this woman will require a caesarean section</span>
                <span class="n">refer_for_cs</span><span class="p">()</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_maternal_sepsis">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_maternal_sepsis">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">labour_stage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of maternal sepsis during or following labour. This</span>
<span class="sd">        function defines the required consumables and administers the intervention if they are available. The</span>
<span class="sd">        intervention in this function is maternal sepsis case management. It is called by either</span>
<span class="sd">         HSI_Labour_PresentsForSkilledBirthAttendanceInLabour OR  HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        :param labour_stage: intrapartum or postpartum period of labour (STR) &#39;ip&#39; or &#39;pp&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_maternal_sepsis&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="p">((</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">])</span> <span class="ow">or</span>
           <span class="p">(</span><span class="n">labour_stage</span> <span class="o">==</span> <span class="s1">&#39;pp&#39;</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">])):</span>

            <span class="c1"># run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;iv_abx&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># Define and check available consumables</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;maternal_sepsis_core&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;maternal_sepsis_optional&#39;</span><span class="p">])</span>

            <span class="c1"># If delivered this intervention reduces a womans risk of dying from sepsis</span>
            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sepsis_abx&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.assessment_and_plan_for_antepartum_haemorrhage">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_plan_for_antepartum_haemorrhage">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_plan_for_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis of antepartum haemorrhage during  labour. This</span>
<span class="sd">        function ensures that woman is referred for comprehensive care via caesarean section and blood transfusion.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_plan_for_referral_antepartum_haemorrhage&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># We assume that any woman who has been referred from antenatal inpatient care due to haemorrhage are</span>
        <span class="c1"># automatically scheduled for blood transfusion</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                <span class="s1">&#39;ac_admitted_for_immediate_&#39;</span>
                                                                                <span class="s1">&#39;delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

            <span class="c1"># Caesarean delivery reduces the risk of intrapartum still birth and blood transfusion reduces the risk</span>
            <span class="c1"># of maternal death due to bleeding</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;la_aph&#39;</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.assessment_for_referral_uterine_rupture">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_for_referral_uterine_rupture">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_for_referral_uterine_rupture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis of uterine rupture during  labour and ensures</span>
<span class="sd">        that a woman is referred for comprehensive care via caesarean section, surgical repair and blood transfusion.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_plan_for_referral_uterine_rupture&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># When uterine rupture is present, the mni dictionary is updated to allow treatment to be scheduled</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ur&#39;</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.active_management_of_the_third_stage_of_labour">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.active_management_of_the_third_stage_of_labour">[docs]</a>
    <span class="k">def</span> <span class="nf">active_management_of_the_third_stage_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the administration of active management of the third stage of labour. This</span>
<span class="sd">        function checks the availability of consumables and delivers the intervention accordingly. It is called by</span>
<span class="sd">        HSI_Labour_PresentsForSkilledBirthAttendanceFollowingLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;active_management_of_the_third_stage_of_labour&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Define and check available consumables</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;amtsl&#39;</span><span class="p">],</span>
            <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">])</span>

        <span class="c1"># run HCW check</span>
        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;uterotonic&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="c1"># This treatment reduces a womans risk of developing uterine atony AND retained placenta, both of which are</span>
        <span class="c1"># preceding causes of postpartum haemorrhage</span>
        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_pph_uterine_atony">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_pph_uterine_atony">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_pph_uterine_atony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of postpartum haemorrhage secondary to uterine atony</span>
<span class="sd">        following labour. This function defines the required consumables and administers the intervention if they are</span>
<span class="sd">        available. The intervention in this function is  intravenous uterotonics followed by referral for further care</span>
<span class="sd">        in the event of continued haemorrhage. It is called by HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_pph_uterine_atony&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;retained_placenta&#39;</span><span class="p">]:</span>

            <span class="c1"># Define and check available consumables</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;pph_core&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;pph_optional&#39;</span><span class="p">])</span>

            <span class="c1"># run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;uterotonic&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;uterotonics&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

                <span class="c1"># We apply a probability that this treatment will stop a womans bleeding in the first instance</span>
                <span class="c1"># meaning she will not require further treatment</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_haemostatis_uterotonics&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>

                    <span class="c1"># Bleeding has stopped, this woman will not be at risk of death</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;uterine_atony&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># If uterotonics do not stop bleeding the woman is referred for additional treatment</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_pph_retained_placenta">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_pph_retained_placenta">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_pph_retained_placenta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of postpartum haemorrhage secondary to retained placenta</span>
<span class="sd">        following labour. This function defines the required consumables and administers the intervention if they are</span>
<span class="sd">        available. The intervention in this function is manual removal of placenta (bedside) followed by referral for</span>
<span class="sd">        further care in the event of continued haemorrhage. It is called by HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_pph_retained_placenta&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;retained_placenta&#39;</span><span class="p">])</span> <span class="ow">or</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span>
        <span class="p">):</span>

            <span class="c1"># Log the consumables but dont condition the treatment on their availability - the primary mechanism of this</span>
            <span class="c1"># intervention doesnt require consumables</span>
            <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;pph_optional&#39;</span><span class="p">])</span>

            <span class="c1"># run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;man_r_placenta&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># Similar to uterotonics we apply a probability that this intervention will successfully stop</span>
            <span class="c1"># bleeding to ensure some women go on to require further care</span>
            <span class="k">if</span> <span class="n">sf_check</span><span class="p">:</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;man_r_placenta&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_successful_manual_removal_placenta&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>

                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;retained_placenta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;man_r_placenta&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.surgical_management_of_pph">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.surgical_management_of_pph">[docs]</a>
    <span class="k">def</span> <span class="nf">surgical_management_of_pph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the surgical management of postpartum haemorrhage (all-cause) following labour. This</span>
<span class="sd">        function is called during HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare for women who have PPH and</span>
<span class="sd">        medical management has failed.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># We log the required consumables and condition the surgery happening on the availability of the</span>
        <span class="c1"># first consumable in this package, the anaesthetic required for the surgery</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstetric_surgery_core&#39;</span><span class="p">],</span>
            <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;obstetric_surgery_optional&#39;</span><span class="p">])</span>

        <span class="c1"># run HCW check</span>
        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;surg&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="c1"># Add used equipment</span>
            <span class="n">hsi_event</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">healthcare_system</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">from_pkg_names</span><span class="p">(</span><span class="s1">&#39;Major Surgery&#39;</span><span class="p">))</span>

            <span class="c1"># determine if uterine preserving surgery will be successful</span>
            <span class="n">treatment_success_pph</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;success_rate_pph_surgery&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">treatment_success_pph</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the treatment is unsuccessful then women will require a hysterectomy to stop the bleeding</span>
                <span class="n">hsi_event</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Hysterectomy set&#39;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># log intervention delivery</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pph_surg&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.blood_transfusion">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.blood_transfusion">[docs]</a>
    <span class="k">def</span> <span class="nf">blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the blood transfusion during or after labour. This function is called during</span>
<span class="sd">        HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare for women who have experience blood loss due to</span>
<span class="sd">        antepartum haemorrhage, postpartum haemorrhage or uterine rupture</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Check consumables</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;blood_transfusion&#39;</span><span class="p">],</span>
            <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">])</span>

        <span class="c1"># check HCW</span>
        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;blood_tran&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="n">hsi_event</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Drip stand&#39;</span><span class="p">,</span> <span class="s1">&#39;Infusion pump&#39;</span><span class="p">})</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;blood_tran&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># We assume that anaemia is corrected by blood transfusion</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;severe_anaemia_resolution&#39;</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="Labour.assessment_and_treatment_of_anaemia">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_anaemia">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_anaemia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the management of postnatal anaemia including iron and folic acid administration and</span>
<span class="sd">        blood testing. Women with severe anaemia are scheduled to receive blood. It is called during</span>
<span class="sd">        HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Add used equipment</span>
        <span class="n">hsi_event</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Analyser, Haematology&#39;</span><span class="p">})</span>

        <span class="c1"># Use dx_test function to assess anaemia status</span>
        <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
            <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;full_blood_count_hb_pn&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">])</span>

        <span class="c1"># Check consumables</span>
        <span class="k">if</span> <span class="n">test_result</span><span class="p">:</span>
            <span class="c1"># Start iron and folic acid supplementation for women not already receiving this</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span><span class="p">:</span>

                <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">6</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">dose</span> <span class="o">=</span> <span class="n">days</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">:</span> <span class="n">dose</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">]}</span>
                <span class="n">avail</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>

                <span class="c1"># Start iron and folic acid treatment</span>
                <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">]:</span>
                        <span class="c1"># Store date of resolution for daly calculations</span>
                        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span>
                            <span class="n">person_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pn_anaemia_following_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_anaemia_resolution&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

            <span class="c1"># Severe anaemia would require treatment via blood transfusion</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_anaemia_following_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.assessment_for_depression">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_for_depression">[docs]</a>
    <span class="k">def</span> <span class="nf">assessment_for_depression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function schedules depression screening for women who attend postnatal care via the Depression module. It</span>
<span class="sd">        is called within HSI_Labour_ReceivesPostnatalCheck.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;Depression&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Depression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_on_presentation_to_care</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                                      <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.interventions_delivered_pre_discharge">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.interventions_delivered_pre_discharge">[docs]</a>
    <span class="k">def</span> <span class="nf">interventions_delivered_pre_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the interventions that are delivered to women prior to discharge. This are considered</span>
<span class="sd">        part of essential postnatal care and currently include testing for HIV and postnatal iron and folic acid</span>
<span class="sd">        supplementation. It is called by HSI_Labour_ReceivesPostnatalCheck</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># HIV testing occurs within the HIV module for women who haven&#39;t already been diagnosed.</span>
        <span class="c1"># The probability of getting the HIV test is determined by the Hiv module.</span>
        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decide_whether_hiv_test_for_mother</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">referred_from</span><span class="o">=</span><span class="s2">&quot;labour&quot;</span><span class="p">)</span>

        <span class="c1"># ------------------------------- Postnatal iron and folic acid ---------------------------------------------</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="n">_i</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;number_ifa_tablets_required_postnatally&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">]}</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>

        <span class="c1"># Women are started on iron and folic acid for the next three months which reduces risk of anaemia in the</span>
        <span class="c1"># postnatal period</span>
        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_adherent_ifa&#39;</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.run_if_receives_skilled_birth_attendance_cant_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.run_if_receives_skilled_birth_attendance_cant_run">[docs]</a>
    <span class="k">def</span> <span class="nf">run_if_receives_skilled_birth_attendance_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_Labour_PresentsForSkilledBirthAttendanceFollowingLabour if the HSI is unable to</span>
<span class="sd">        run on the date it has been scheduled for. For these women who cannot deliver in a facility despite presenting</span>
<span class="sd">         for care, they will be scheduled to undergo a home birth via LabourAtHomeEvent and will continue with the</span>
<span class="sd">         correct schedule of labour events</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour will not run for &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Women may have presented to HSI_Labour_PresentsForSkilledBirthAttendanceFollowingLabour following</span>
        <span class="c1"># complications at a home birth. Those women should not be scheduled to LabourAtHomeEvent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;home_birth&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;hsi_cant_run&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Labour.run_if_receives_postnatal_check_cant_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.run_if_receives_postnatal_check_cant_run">[docs]</a>
    <span class="k">def</span> <span class="nf">run_if_receives_postnatal_check_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_Labour_ReceivesPostnatalCheck if the HSI is unable to</span>
<span class="sd">        run on the date it has been scheduled for. For these women who have may have experienced life threatening</span>
<span class="sd">        complications we apply risk of death in this function, as it would have been applied in the HSI which can not</span>
<span class="sd">        run</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;HSI_Labour_ReceivesPostnatalCheck will not run for </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.run_if_receives_comprehensive_emergency_obstetric_care_cant_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.run_if_receives_comprehensive_emergency_obstetric_care_cant_run">[docs]</a>
    <span class="k">def</span> <span class="nf">run_if_receives_comprehensive_emergency_obstetric_care_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare if the HSI is unable to</span>
<span class="sd">        run on the date it has been scheduled for. For these women who have may have experienced life threatening</span>
<span class="sd">        complications we apply risk of death in this function, as it would have been applied in the HSI which can not</span>
<span class="sd">        run</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare will not run for&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># For women referred to this event after the postnatal SBA HSI we apply risk of death (as if should have been</span>
        <span class="c1"># applied in this event if it ran)</span>
        <span class="k">if</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="Labour.do_at_generic_first_appt_emergency">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.do_at_generic_first_appt_emergency">[docs]</a>
    <span class="k">def</span> <span class="nf">do_at_generic_first_appt_emergency</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">individual_properties</span><span class="p">:</span> <span class="n">IndividualProperties</span><span class="p">,</span>
        <span class="n">schedule_hsi_event</span><span class="p">:</span> <span class="n">HSIEventScheduler</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;PregnancySupervisor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">labour_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;Labour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">women_in_labour</span>

        <span class="k">if</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">labour_list</span><span class="p">:</span>
            <span class="n">la_currently_in_labour</span> <span class="o">=</span> <span class="n">individual_properties</span><span class="p">[</span><span class="s2">&quot;la_currently_in_labour&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">la_currently_in_labour</span>
                <span class="o">&amp;</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s2">&quot;sought_care_for_complication&quot;</span><span class="p">]</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s2">&quot;sought_care_labour_phase&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;intrapartum&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;1a&quot;</span><span class="p">,</span> <span class="s2">&quot;1b&quot;</span><span class="p">]),</span>
                <span class="p">)</span>
                <span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="LabourOnsetEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent">[docs]</a>
<span class="k">class</span> <span class="nc">LabourOnsetEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the LabourOnsetEvent. It is scheduled by the set_date_of_labour function for all women who are newly</span>
<span class="sd">    pregnant. In addition it is scheduled via the Pregnancy Supervisor module for women who are going into preterm</span>
<span class="sd">    labour and by the Care of Women During Pregnancy module for women who require emergency delivery as an intervention</span>
<span class="sd">    to treat a pregnancy-threatening complication.</span>

<span class="sd">    It represents the start of a womans labour and is the first event all woman who are going to give birth</span>
<span class="sd">    pass through - regardless of mode of delivery or if they are already an inpatient. This event performs a number of</span>
<span class="sd">    different functions including populating the mni dictionary to store additional variables important to labour</span>
<span class="sd">    and HSIs, determining if and where a woman will seek care for delivery, schedules the LabourAtHome event and the</span>
<span class="sd">    HSI_Labour_PresentsForSkilledAttendance at birth (depending on care seeking), the BirthAndPostnatalEvent and the</span>
<span class="sd">    LabourDeathAndStillBirthEvent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourOnsetEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="LabourOnsetEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># First we use this check to determine if labour can precede (includes checks on is_alive)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_labour_can_proceed</span><span class="p">(</span><span class="n">individual_id</span><span class="p">):</span>

            <span class="c1"># We indicate this woman is now in labour using this property, and by adding her individual ID to our</span>
            <span class="c1"># labour list (for testing)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">women_in_labour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># We then run the labour_characteristics_checker as a final check that only appropriate women are here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># Update the mni with new variables</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_mni_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># ===================================== LABOUR STATE  =====================================================</span>
            <span class="c1"># Next we categories each woman according to her gestation age at delivery. These categories include term</span>
            <span class="c1"># (37-42 weeks gestational age), post term (42 weeks plus), early preterm (24-33 weeks) and late preterm</span>
            <span class="c1"># (34-36 weeks)</span>

            <span class="c1"># First we calculate foetal age - days from conception until todays date and then add 2 weeks to calculate</span>
            <span class="c1"># gestational age</span>
            <span class="n">foetal_age_in_days</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
            <span class="n">gestational_age_in_days</span> <span class="o">=</span> <span class="n">foetal_age_in_days</span> <span class="o">+</span> <span class="mi">14</span>

            <span class="c1"># We use parameters containing the upper and lower limits, in days, that a mothers pregnancy has to be to be</span>
            <span class="c1"># categorised accordingly</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_defining_term_status&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> \
               <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_defining_term_status&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;term_labour&#39;</span>

            <span class="c1"># Here we allow a woman to go into early preterm labour with a gestational age of 23 (limit is 24) to</span>
            <span class="c1"># account for PregnancySupervisor only updating weekly</span>
            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_&#39;</span>
                        <span class="s1">&#39;defining_term_status&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_&#39;</span>
                                                                                        <span class="s1">&#39;defining_term_status&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;early_preterm_labour&#39;</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;early_preterm_labour&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_defining_term_status&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits&#39;</span>
                                                                                                        <span class="s1">&#39;_for_defining&#39;</span>
                                                                                                        <span class="s1">&#39;_term_&#39;</span>
                                                                                                        <span class="s1">&#39;status&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;late_preterm_labour&#39;</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;late_preterm_labour&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="k">elif</span> <span class="n">gestational_age_in_days</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;list_limits_for_defining_term_status&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;postterm_labour&#39;</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;post_term_labour&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

            <span class="n">labour_state</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span>

            <span class="c1"># We check all women have had their labour state set</span>
            <span class="k">if</span> <span class="n">labour_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has not had their labour state stored in &#39;</span>
                                              <span class="sa">f</span><span class="s1">&#39;the mni&#39;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent, person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has now gone into &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labour_state</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># ----------------------------------- FOETAL WEIGHT/BIRTH WEIGHT ----------------------------------------</span>
            <span class="c1"># Here we determine the weight of the foetus being carried by this mother, this is calculated here to allow</span>
            <span class="c1"># the size of the baby to effect risk of certain maternal complications (i.e. obstructed labour)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">:</span>
                <span class="n">mean_birth_weight_list_location</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mean_birth_weight_list_location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">24</span><span class="p">)</span>

            <span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;standard_deviation_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">]</span>

            <span class="c1"># We randomly draw this newborns weight from a normal distribution around the mean for their gestation</span>
            <span class="n">birth_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span>
                                                  <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

            <span class="c1"># Then we calculate the 10th and 90th percentile, these are the case definition for &#39;small for gestational</span>
            <span class="c1"># age and &#39;large for gestational age&#39;</span>
            <span class="n">small_for_gestational_age_cutoff</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                <span class="mf">0.1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

            <span class="n">large_for_gestational_age_cutoff</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                <span class="mf">0.9</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mean_birth_weights&#39;</span><span class="p">][</span><span class="n">mean_birth_weight_list_location</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">standard_deviation</span><span class="p">)</span>

            <span class="c1"># Make the appropriate changes to the mni dictionary (both are stored as property of the newborn on birth)</span>
            <span class="k">if</span> <span class="n">birth_weight</span> <span class="o">&gt;=</span> <span class="mi">4000</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;macrosomia&#39;</span>
            <span class="k">elif</span> <span class="n">birth_weight</span> <span class="o">&gt;=</span> <span class="mi">2500</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;residual_prob_of_macrosomia&#39;</span><span class="p">]:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;macrosomia&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
            <span class="k">elif</span> <span class="mi">1500</span> <span class="o">&lt;=</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">2500</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;low_birth_weight&#39;</span>
            <span class="k">elif</span> <span class="mi">1000</span> <span class="o">&lt;=</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;very_low_birth_weight&#39;</span>
            <span class="k">elif</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;extremely_low_birth_weight&#39;</span>

            <span class="k">if</span> <span class="n">birth_weight</span> <span class="o">&lt;</span> <span class="n">small_for_gestational_age_cutoff</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;small_for_gestational_age&#39;</span>
            <span class="k">elif</span> <span class="n">birth_weight</span> <span class="o">&gt;</span> <span class="n">large_for_gestational_age_cutoff</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;large_for_gestational_age&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;birth_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>

            <span class="c1"># ===================================== CARE SEEKING AND DELIVERY SETTING ================================</span>
            <span class="c1"># Next we determine if women who are now in labour will seek care for delivery. We assume women who have</span>
            <span class="c1"># been admitted antenatally for delivery will be delivering in hospital and that is scheduled accordingly</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                <span class="c1"># Here we calculate this womans predicted risk of home birth and health centre birth</span>
                <span class="n">pred_hb_delivery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>
                <span class="n">pred_hc_delivery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>
                <span class="n">pred_hp_delivery</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probability_delivery_hospital&#39;</span><span class="p">]</span>

                <span class="c1"># The denominator is calculated</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="n">pred_hp_delivery</span> <span class="o">+</span> <span class="n">pred_hb_delivery</span> <span class="o">+</span> <span class="n">pred_hc_delivery</span>

                <span class="c1"># Followed by the probability of each of the three outcomes - home birth, health centre birth or</span>
                <span class="c1"># hospital birth</span>
                <span class="n">prob_hb</span> <span class="o">=</span> <span class="n">pred_hb_delivery</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">prob_hc</span> <span class="o">=</span> <span class="n">pred_hc_delivery</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">prob_hp</span> <span class="o">=</span> <span class="n">pred_hp_delivery</span> <span class="o">/</span> <span class="n">denom</span>

                <span class="c1"># And a probability weighted random draw is used to determine where the woman will deliver</span>
                <span class="n">facility_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;home_birth&#39;</span><span class="p">,</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital&#39;</span><span class="p">]</span>

                <span class="c1"># This allows us to simply manipulate care seeking during labour test file</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;test_run&#39;</span><span class="p">]:</span>
                    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;test_care_seeking_probs&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">prob_hb</span><span class="p">,</span> <span class="n">prob_hc</span><span class="p">,</span> <span class="n">prob_hp</span><span class="p">]</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">facility_types</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We assume all women with complications will deliver in a hospital</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hospital&#39;</span>

            <span class="c1"># Check all women&#39;s &#39;delivery setting&#39; is set</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> did not have their delivery setting stored in &#39;</span>
                                              <span class="sa">f</span><span class="s1">&#39;the mni&#39;</span><span class="p">)</span>

            <span class="c1"># Women delivering at home move the the LabourAtHomeEvent as they will not receive skilled birth attendance</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

            <span class="c1"># Otherwise the appropriate HSI is scheduled</span>
            <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
                <span class="n">health_centre_delivery</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="s1">&#39;1a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">health_centre_delivery</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
                <span class="n">facility_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
                <span class="n">hospital_delivery</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">hospital_delivery</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

            <span class="c1"># ======================================== SCHEDULING BIRTH AND DEATH EVENTS ============================</span>
            <span class="c1"># We schedule all women to move through both the death and birth event.</span>

            <span class="c1"># The death event is scheduled to happen after a woman has received care OR delivered at home to allow for</span>
            <span class="c1"># any treatment effects to mitigate risk of poor outcomes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourDeathAndStillBirthEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span>
                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

            <span class="c1"># After the death event women move to the Birth Event where, for surviving women and foetus, birth occurs</span>
            <span class="c1"># in the simulation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">BirthAndPostnatalOutcomesEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span>
                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="LabourAtHomeEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent">[docs]</a>
<span class="k">class</span> <span class="nc">LabourAtHomeEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the LabourAtHomeEvent. It is scheduled by the LabourOnsetEvent for women who will not seek delivery care at</span>
<span class="sd">    a  health facility. This event applies the probability that women delivering at home will experience</span>
<span class="sd">    complications associated with the intrapartum phase of labour and makes the appropriate changes to the data frame.</span>
<span class="sd">     Additionally, this event applies a probability that women who develop complications during a home birth may choose</span>
<span class="sd">     to seek care from at a health facility. In that case the appropriate HSI is scheduled.</span>
<span class="sd">     &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourAtHomeEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="LabourAtHomeEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Check only women delivering at home pass through this event and that the right characteristics are present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> arrived at home birth event incorrectly&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># ===================================  APPLICATION OF COMPLICATIONS ===========================================</span>
        <span class="c1"># Using the complication_application function we loop through each complication and determine if a woman</span>
        <span class="c1"># will experience any of these if she has delivered at home</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;obstruction_cpd&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_malpos_malpres&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_other&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_chorioamnionitis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                           <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

        <span class="c1"># And we determine if any existing hypertensive disorders would worsen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">)</span>

        <span class="c1"># ==============================  CARE SEEKING FOLLOWING COMPLICATIONS ========================================</span>
        <span class="c1"># Next we determine if women who develop a complication during a home birth will seek care</span>

        <span class="c1"># (Women who have been scheduled a home birth after seeking care at a facility that didnt have capacity to</span>
        <span class="c1"># deliver the HSI will not try to seek care if they develop a complication)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;hsi_cant_run&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_careseeking_for_complication&#39;</span><span class="p">]:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_labour_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;intrapartum&#39;</span>

                    <span class="c1"># We assume women present to the health system through the generic a&amp;e appointment</span>
                    <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="n">HSI_GenericEmergencyFirstAppt</span>

                    <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_GenericEmergencyFirstAppt</span><span class="p">(</span>
                        <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                        <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span>
                                                                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="LabourDeathAndStillBirthEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent">[docs]</a>
<span class="k">class</span> <span class="nc">LabourDeathAndStillBirthEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This is the LabourDeathAndStillBirthEvent. It is scheduled by the LabourOnsetEvent for all women in the labour</span>
<span class="sd">     module following the application of complications (and possibly treatment) for women who have given birth at home</span>
<span class="sd">     OR in a facility . This event determines if women who have experienced complications in labour will die or</span>
<span class="sd">     experience an intrapartum stillbirth.</span>
<span class="sd">     &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourDeathAndStillBirthEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="LabourDeathAndStillBirthEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Check the correct amount of time has passed between labour onset and this event event</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> arrived at LabourDeathAndStillBirthEvent at the &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;wrong date&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Function checks df for any potential cause of death, uses CFR parameters to determine risk of death</span>
        <span class="c1"># (either from one or multiple causes) and if death occurs returns the cause</span>
        <span class="n">potential_cause_of_death</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_for_risk_of_death_from_cause_maternal</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;intrapartum&#39;</span><span class="p">)</span>

        <span class="c1"># If a cause is returned death is scheduled</span>
        <span class="k">if</span> <span class="n">potential_cause_of_death</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_mni_for_maternal_death</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="n">potential_cause_of_death</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">])</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Next we determine if she will experience a stillbirth during her delivery</span>
        <span class="n">outcome_of_still_birth_equation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;intrapartum_still_birth&#39;</span><span class="p">],</span>
                                                              <span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># We also assume that if a womans labour has started prior to 24 weeks the baby would not survive and we class</span>
        <span class="c1"># this as a stillbirth</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="ow">or</span> <span class="n">outcome_of_still_birth_equation</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has experienced an intrapartum still birth&#39;</span><span class="p">)</span>

            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="c1"># If this woman will experience a stillbirth and she was not pregnant with twins OR she was pregnant with</span>
            <span class="c1"># twins but both twins have died during labour we reset/set the appropriate variables</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_both_twins_ip_still_&#39;</span>
                                                                                         <span class="s1">&#39;birth&#39;</span><span class="p">])):</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># This variable is therefore only ever true when the pregnancy has ended in stillbirth</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Next reset pregnancy and update contraception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># If one twin survives we store this as a property of the MNI which is reference on_birth of the newborn</span>
            <span class="c1"># outcomes to ensure this twin pregnancy only leads to one birth</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_both_twins_ip_still_&#39;</span>
                                                                                          <span class="s1">&#39;birth&#39;</span><span class="p">])):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;single twin stillbirth for </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]:</span>
            <span class="c1"># We delete the mni dictionary if both mother and baby have died in labour, if the mother has died but</span>
            <span class="c1"># the baby has survived we delete the dictionary following the on_birth function of NewbornOutcomes</span>
            <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;intrapartum_stillbirth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother_id&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                                            <span class="s1">&#39;date_of_ip_stillbirth&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">})</span>

        <span class="c1"># Reset property</span>
        <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Finally, reset some treatment variables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">potential_cause_of_death</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>
</div>



<div class="viewcode-block" id="BirthAndPostnatalOutcomesEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthAndPostnatalOutcomesEvent">[docs]</a>
<span class="k">class</span> <span class="nc">BirthAndPostnatalOutcomesEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is BirthAndPostnatalOutcomesEvent. It is scheduled by LabourOnsetEvent when women go into labour. This event</span>
<span class="sd">    calls the do_birth function for all women who have gone into labour to generate a newborn within the simulation.</span>
<span class="sd">    Additionally, this event applies the incidence of complications immediately following birth and determines if each</span>
<span class="sd">    woman will receive a full postnatal check-up and when.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BirthAndPostnatalOutcomesEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthAndPostnatalOutcomesEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="BirthAndPostnatalOutcomesEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthAndPostnatalOutcomesEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># This event tells the simulation that the woman&#39;s pregnancy is over and generates the new child in the</span>
        <span class="c1"># data frame - Check the correct amount of time has passed between labour onset and birth event and that women</span>
        <span class="c1"># at the event have the right characteristics present</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> arrived at BirthAndPostnatalOutcomesEvent at the &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;wrong date&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># =============================================== BIRTH ====================================================</span>
        <span class="c1"># If the mother is alive and still pregnant OR has died but the foetus has survived we generate a child.</span>

        <span class="c1"># Live women are scheduled to move to the postpartum event to determine if they experience any additional</span>
        <span class="c1"># complications</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A Birth is now occurring, to mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># If the mother is pregnant with twins, we call the do_birth function twice and then link the twins</span>
            <span class="c1"># (via sibling id) in the newborn module</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ps_multiple_pregnancy</span><span class="p">:</span>
                <span class="n">child_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]:</span>
                    <span class="n">child_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> will now deliver twins </span><span class="si">{</span><span class="n">child_one</span><span class="si">}</span><span class="s1"> &amp; &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">child_two</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">link_twins</span><span class="p">(</span><span class="n">child_one</span><span class="p">,</span> <span class="n">child_two</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># If the mother survived labour but experienced a stillbirth we reset all the relevant pregnancy variables now</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_labour</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_pregnancy_supervisor</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_postnatal_supervisor</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">further_on_birth_care_of_women_in_pregnancy</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

        <span class="c1"># Next we apply the risk of complications following delivery</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sepsis_endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_urinary_tract&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_skin_soft_tissue&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;pph_uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;pph_other&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]:</span>
                <span class="n">logger_pn</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;sepsis_postnatal&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;postnatal&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]:</span>
                <span class="n">logger_pn</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;primary_postpartum_haemorrhage&#39;</span><span class="p">,</span>
                                                                  <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;postnatal&#39;</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>

            <span class="c1"># Following this we determine if this woman will receive/seek care for postnatal care after delivery</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;new_onset_spe&#39;</span><span class="p">])</span> <span class="ow">or</span>
               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)):</span>

                <span class="c1"># Women with complications have a higher baseline probability of seeking postnatal care</span>
                <span class="n">prob_pnc</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_careseeking_for_complication_pn&#39;</span><span class="p">]</span>
                <span class="n">has_comps</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We use a linear model to determine if women without complications will receive any postnatal care</span>
                <span class="n">prob_pnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">mother_id</span><span class="p">]],</span>
                    <span class="n">mode_of_delivery</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">mother_id</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
                    <span class="n">delivery_setting</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">mother_id</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="p">)[</span><span class="n">mother_id</span><span class="p">]</span>
                <span class="n">has_comps</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># If she will receive PNC, we determine if this will happen less than 48 hours from birth or later</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_pnc</span><span class="p">:</span>
                <span class="n">timing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;&lt;48&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;48&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_timings_pnc&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;&lt;48&#39;</span> <span class="ow">or</span> <span class="n">has_comps</span><span class="p">:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;early&#39;</span>

                    <span class="n">early_event</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesPostnatalCheck</span><span class="p">(</span>
                        <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                        <span class="n">early_event</span><span class="p">,</span>
                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For women who do not have prompt PNC, we determine if they will die from complications occurring</span>
                    <span class="c1"># following birth that have not been treated</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;late&#39;</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Similarly for women who will not receive PNC at all we apply risk of death</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;didnt_seek_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour. This event is the first HSI for women who have</span>
<span class="sd">    chosen to deliver in a health care facility. Broadly this HSI represents care provided by a skilled birth attendant</span>
<span class="sd">    during labour. This event...</span>

<span class="sd">    1.) Determines if women will benefit from prophylactic interventions and delivers the interventions</span>
<span class="sd">    2.) Applies risk of intrapartum complications</span>
<span class="sd">    3.) Determines if women who have experience complications will benefit from treatment interventions and delivers</span>
<span class="sd">        the interventions</span>
<span class="sd">    4.) Schedules additional comprehensive emergency obstetric care for women who need it. (Comprehensive</span>
<span class="sd">        interventions (blood transfusion, caeasarean section and surgery) are housed within a different HSI.)</span>

<span class="sd">    Only interventions that can be delivered in BEmONC facilities are delivered in this HSI. These include intravenous</span>
<span class="sd">    antibiotics, intravenous anticonvulsants and assisted vaginal delivery. Additionally women may receive</span>
<span class="sd">    antihypertensives in line with Malawi&#39;s EHP. Interventions will only be attempted to be delivered if the squeeze</span>
<span class="sd">    factor of the HSI is below a predetermined threshold of each intervention. CEmONC level interventions are managed</span>
<span class="sd">    within HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;DeliveryCare_Basic&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;NormalDelivery&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># First we capture women who have presented to this event during labour at home. Currently we just set these</span>
        <span class="c1"># women to be delivering at a health centre (this will need to be randomised to match any available data)</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;health_centre&#39;</span>

        <span class="c1"># Next we check this woman has the right characteristics to be at this event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># Log potential error</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> is receiving SBA with delivery setting as home birth&#39;</span><span class="p">)</span>

        <span class="c1"># Here we ensure that women who were admitted via the antenatal ward for assisted/caesarean delivery have the</span>
        <span class="c1"># correct variables updated leading to referral for delivery</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_now&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">):</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;avd_now&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_assisted_vaginal_delivery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indication</span><span class="o">=</span><span class="s1">&#39;spe_ec&#39;</span><span class="p">)</span>

        <span class="c1"># LOG CONSUMABLES FOR DELIVERY...</span>
        <span class="c1"># We assume all deliveries require this basic package of consumables</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
            <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;delivery_core&#39;</span><span class="p">],</span>
            <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;delivery_optional&#39;</span><span class="p">])</span>

        <span class="c1"># Add used equipment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Delivery set&#39;</span><span class="p">,</span> <span class="s1">&#39;Weighing scale&#39;</span><span class="p">,</span> <span class="s1">&#39;Stethoscope, foetal, monaural, Pinard, plastic&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Resuscitaire&#39;</span><span class="p">,</span> <span class="s1">&#39;Sphygmomanometer&#39;</span><span class="p">,</span> <span class="s1">&#39;Tray, emergency&#39;</span><span class="p">,</span> <span class="s1">&#39;Suction machine&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Thermometer&#39;</span><span class="p">,</span> <span class="s1">&#39;Drip stand&#39;</span><span class="p">,</span> <span class="s1">&#39;Infusion pump&#39;</span><span class="p">})</span>

        <span class="c1"># If the clean delivery kit consumable is available, we assume women benefit from clean delivery</span>
        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ===================================== PROPHYLACTIC CARE ===================================================</span>
        <span class="c1"># The following function manages the consumables and administration of prophylactic interventions in labour</span>
        <span class="c1"># (clean delivery practice, antibiotics for PROM, steroids for preterm labour)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">prophylactic_labour_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># ================================= PROPHYLACTIC MANAGEMENT PRE-ECLAMPSIA  ==============================</span>
        <span class="c1"># Next we see if women with severe pre-eclampsia will be identified and treated, reducing their risk of</span>
        <span class="c1"># eclampsia</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_severe_pre_eclampsia_mgso4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>

        <span class="c1"># ===================================== APPLYING COMPLICATION INCIDENCE =======================================</span>
        <span class="c1"># Following administration of prophylaxis we assess if this woman will develop any complications during labour.</span>
        <span class="c1"># Women who have sought care because of complication have already had these risk applied so it doesnt happen</span>
        <span class="c1"># again</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;obstruction_cpd&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_malpos_malpres&#39;</span><span class="p">,</span> <span class="s1">&#39;obstruction_other&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_chorioamnionitis&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">]:</span>
                <span class="c1"># Uterine rupture is the only complication we dont apply the risk of here due to the causal link</span>
                <span class="c1"># between obstructed labour and uterine rupture. Therefore we want interventions for obstructed labour</span>
                <span class="c1"># to reduce the risk of uterine rupture</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;maternal_complication&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                                               <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">})</span>

        <span class="c1"># ======================================= COMPLICATION MANAGEMENT ==========================</span>
        <span class="c1"># Next, women in labour are assessed for complications and treatment delivered if a need is identified and</span>
        <span class="c1"># consumables are available</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_assisted_vaginal_delivery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indication</span><span class="o">=</span><span class="s1">&#39;ol&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labour_stage</span><span class="o">=</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_plan_for_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_referral_uterine_rupture</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># -------------------------- Active Management of the third stage of labour ----------------------------------</span>
        <span class="c1"># Prophylactic treatment to prevent postpartum bleeding is applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">active_management_of_the_third_stage_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># -------------------------- Caesarean section/AVD for un-modelled reason ------------------------------------</span>
        <span class="c1"># We apply a probability to women who have not already been allocated to undergo assisted/caesarean delivery</span>
        <span class="c1"># that they will require assisted/caesarean delivery to capture indications which are not explicitly modelled</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;instrumental&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;previous_scar&#39;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;residual_prob_caesarean&#39;</span><span class="p">]:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;residual_prob_avd&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_assisted_vaginal_delivery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indication</span><span class="o">=</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>

        <span class="c1"># -------------------------- Newborn resuscitation ------------------------------------------------------------</span>
        <span class="c1"># We check in this HSI that if the mother has a live born baby who requires resucitation that they will receive</span>
        <span class="c1"># the intervention</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="c1"># TODO: potential issue is that this consumable is being logged now for every birth as opposed to</span>
            <span class="c1">#  for each birth where resuscitation of the newborn is required</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;resuscitation&#39;</span><span class="p">],</span> <span class="n">opt_cons</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># Run HCW check</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                                                                                       <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;neo_resus&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sf_check</span> <span class="ow">and</span> <span class="n">avail</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;neo_will_receive_resus_if_needed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ========================================== SCHEDULING CEMONC CARE =========================================</span>
        <span class="c1"># Finally women who require additional treatment have the appropriate HSI scheduled to deliver further care</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">!=</span> <span class="s1">&#39;1a&#39;</span><span class="p">:</span>
                <span class="n">cemonc_fl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cemonc_fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>

            <span class="n">surgical_management</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;intrapartum&#39;</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">cemonc_fl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">surgical_management</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># If a this woman has experienced a complication the appointment footprint is changed from normal to</span>
        <span class="c1"># complicated</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;CompDelivery&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.never_ran">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.never_ran">[docs]</a>
    <span class="k">def</span> <span class="nf">never_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_skilled_birth_attendance_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_skilled_birth_attendance_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_skilled_birth_attendance_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_Labour_ReceivesPostnatalCheck</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_Labour_ReceivesPostnatalCheck. It is scheduled by BirthAndPostnatalOutcomesEvent for all women who</span>
<span class="sd">    will receive full postnatal checkup after birth. Additionally, this event is scheduled by the</span>
<span class="sd">    PostnatalSupervisorEvent for women who require PNC later in the postnatal period. This event represents the</span>
<span class="sd">    postpartum care contact after delivery and includes assessment and treatment of severe pre-eclampsia, hypertension,</span>
<span class="sd">    sepsis and postpartum bleeding. In addition woman are scheduled HIV screening if appropriate and started on</span>
<span class="sd">    postnatal iron tablets</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalCare_Maternal&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_facility_level_for_pnc</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Ensure that women who were scheduled to receive early PNC have received care prior to passing through</span>
            <span class="c1"># PostnatalWeekOneMaternalEvent</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;early&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;passed_through_week_one&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> attended early PNC too late&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> attended early PNC twice&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;late&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;passed_through_week_one&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> attended late PNC too early&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> attended late PNC twice&#39;</span><span class="p">)</span>

        <span class="c1"># Run checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postpartum_characteristics_checker</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># log the PNC visit</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                                 <span class="s1">&#39;delivery_setting&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]),</span>
                                                 <span class="s1">&#39;visit_number&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">],</span>
                                                 <span class="s1">&#39;timing&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]})</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_pn_checks_maternal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># reset variable for capturing early pnc</span>
        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

        <span class="c1"># Perform assessments and treatment for each of the major complications that can occur after birth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_pph_retained_placenta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_pph_uterine_atony</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_severe_pre_eclampsia_mgso4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_anaemia_assessment_pnc&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_anaemia</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_depression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_pre_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Schedule higher level care for women requiring comprehensive treatment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">!=</span> <span class="s1">&#39;1a&#39;</span><span class="p">:</span>
            <span class="n">cemonc_fl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cemonc_fl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>

            <span class="n">surgical_management</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;postpartum&#39;</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">cemonc_fl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">surgical_management</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Women who require treatment for postnatal complications are schedule to the inpatient HSI to capture inpatient</span>
        <span class="c1"># days</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">la_sepsis_treatment</span> <span class="ow">or</span>
              <span class="n">mother</span><span class="o">.</span><span class="n">la_eclampsia_treatment</span> <span class="ow">or</span>
              <span class="n">mother</span><span class="o">.</span><span class="n">la_severe_pre_eclampsia_treatment</span> <span class="ow">or</span>
              <span class="n">mother</span><span class="o">.</span><span class="n">la_maternal_hypertension_treatment</span> <span class="ow">or</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">)):</span>

            <span class="n">postnatal_inpatient</span> <span class="o">=</span> <span class="n">HSI_Labour_PostnatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">cemonc_fl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">postnatal_inpatient</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># ====================================== APPLY RISK OF DEATH===================================================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck.never_ran">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck.never_ran">[docs]</a>
    <span class="k">def</span> <span class="nf">never_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_postnatal_check_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_postnatal_check_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_postnatal_check_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesPostnatalCheck._get_facility_level_for_pnc">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesPostnatalCheck._get_facility_level_for_pnc">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_facility_level_for_pnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">person_id</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;will_receive_pnc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;early&#39;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;1a&#39;</span></div>
</div>



<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare. This event houses all the interventions that are</span>
<span class="sd">    required to be delivered at a CEmONC level facility including caesarean section, blood transfusion and surgery</span>
<span class="sd">    during or following labour Currently we assume that if this even runs and the consumables are available then the</span>
<span class="sd">    intervention is delivered i.e. we dont apply squeeze factor threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">timing</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">:</span>
            <span class="n">t_id</span> <span class="o">=</span> <span class="s1">&#39;DeliveryCare_Comprehensive&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_id</span> <span class="o">=</span> <span class="s1">&#39;PostnatalCare_Comprehensive&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="n">t_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="n">timing</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># We use the variable self.timing to differentiate between women sent to this event during labour and women</span>
        <span class="c1"># sent after labour</span>

        <span class="c1"># ========================================== CAESAREAN SECTION ===============================================</span>
        <span class="c1"># For women arriving to this event during labour who have been referred for caesarean the intervention is</span>
        <span class="c1"># delivered</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">:</span>

            <span class="c1"># We log the required consumables and condition the caesarean happening on the availability of the</span>
            <span class="c1"># first consumable in this package, the anaesthetic required for the surgery</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                <span class="n">cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;caesarean_delivery_core&#39;</span><span class="p">],</span>
                <span class="n">opt_cons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_lab_consumables</span><span class="p">[</span><span class="s1">&#39;caesarean_delivery_optional&#39;</span><span class="p">])</span>

            <span class="c1"># We check that the HCW will deliver the intervention</span>
            <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;surg&#39;</span><span class="p">,</span>
                                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Block CS delivery for this analysis</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_analysis_in_progress&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cemonc_availability&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;cs delivery blocked for this analysis&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;other&#39;</span><span class="p">):</span>
                <span class="c1"># If intervention is delivered - add used equipment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">healthcare_system</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">from_pkg_names</span><span class="p">(</span><span class="s1">&#39;Major Surgery&#39;</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;caesarean_delivery&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">get_dataframe_row_as_dict_for_logging</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;cs_indications&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                                        <span class="s1">&#39;indication&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]})</span>

                <span class="c1"># The appropriate variables in the MNI and dataframe are stored. Current caesarean section reduces</span>
                <span class="c1"># risk of intrapartum still birth and death due to antepartum haemorrhage</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_section&#39;</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># ================================ SURGICAL MANAGEMENT OF RUPTURED UTERUS =====================================</span>
        <span class="c1"># Women referred after the labour HSI following correct identification of ruptured uterus will also need to</span>
        <span class="c1"># undergo surgical repair of this complication</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>

            <span class="c1"># If the staff and consumables are available to deliver a caesarean for this individual we do not run any</span>
            <span class="c1"># further checks and surgical repair is assume to have occurred during their caesarean surgery</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_section&#39;</span><span class="p">:</span>

                <span class="c1"># log treatment is delivered</span>
                <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;ur_surg&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c1"># Determine if the uterus can be repaired</span>
                <span class="n">treatment_success_ur</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;success_rate_uterine_repair&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">treatment_success_ur</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Unsuccessful repair will lead to this woman requiring a hysterectomy. Hysterectomy will also reduce</span>
                <span class="c1"># risk of death from uterine rupture but leads to permanent infertility in the simulation</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_equipment</span><span class="p">({</span><span class="s1">&#39;Hysterectomy set&#39;</span><span class="p">})</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ============================= SURGICAL MANAGEMENT OF POSTPARTUM HAEMORRHAGE==================================</span>
        <span class="c1"># Women referred for surgery immediately following labour will need surgical management of postpartum bleeding</span>
        <span class="c1"># Treatment is varied accordingly to underlying cause of bleeding</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">)</span> <span class="ow">and</span>
           <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">surgical_management_of_pph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># =========================================== BLOOD TRANSFUSION ===============================================</span>
        <span class="c1"># Women referred for blood transfusion alone or in conjunction with one of the above interventions will receive</span>
        <span class="c1"># that here</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Women who have passed through the postpartum SBA HSI have not yet had their risk of death calculated because</span>
        <span class="c1"># they required interventions delivered via this event. We now determine if these women will survive</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># Schedule HSI that captures inpatient days</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">postnatal_inpatient</span> <span class="o">=</span> <span class="n">HSI_Labour_PostnatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">postnatal_inpatient</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Women who delivered via caesarean have the appropriate footprint applied</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_section&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Csection&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

        <span class="c1"># And those who didnt have surgery had the expected footprint overwritten</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                      <span class="s1">&#39;surgery&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.never_ran">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.never_ran">[docs]</a>
    <span class="k">def</span> <span class="nf">never_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_comprehensive_emergency_obstetric_care_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_comprehensive_emergency_obstetric_care_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">run_if_receives_comprehensive_emergency_obstetric_care_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_Labour_PostnatalWardInpatientCare">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_PostnatalWardInpatientCare">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_Labour_PostnatalWardInpatientCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_Labour_PostnatalWardInpatientCare. It is scheduled by HSI_Labour_ReceivesPostnatalCheck for all women</span>
<span class="sd">    require treatment as inpatients after delivery. The primary function of this event is to capture inpatient bed</span>
<span class="sd">    days</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_PostnatalWardInpatientCare.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_PostnatalWardInpatientCare.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalCare_Maternal_Inpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span></div>


<div class="viewcode-block" id="HSI_Labour_PostnatalWardInpatientCare.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_PostnatalWardInpatientCare.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_PostnatalWardInpatientCare now running to capture &#39;</span>
                                         <span class="s1">&#39;inpatient time for an unwell postnatal woman&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_Labour_PostnatalWardInpatientCare.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_PostnatalWardInpatientCare.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_PostnatalWardInpatientCare: did not run&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_Labour_PostnatalWardInpatientCare.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_PostnatalWardInpatientCare.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_PostnatalWardInpatientCare: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="LabourAndPostnatalCareAnalysisEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAndPostnatalCareAnalysisEvent">[docs]</a>
<span class="k">class</span> <span class="nc">LabourAndPostnatalCareAnalysisEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is LabourAndPostnatalCareAnalysisEvent. This event is scheduled in initialise_simulation. When this event runs,</span>
<span class="sd">     and if any of the module parameters the signify analysis is being conducted are set to True, then key parameters</span>
<span class="sd">    are overridden to alter the coverage and/or quality of either B/CEmONC interventions or Postnatal Care for mothers</span>
<span class="sd">    and newborns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="LabourAndPostnatalCareAnalysisEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAndPostnatalCareAnalysisEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">)</span></div>


<div class="viewcode-block" id="LabourAndPostnatalCareAnalysisEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAndPostnatalCareAnalysisEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">mni_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">mni</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">pn_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">nb_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Check to see if analysis is being conducted when this event runs</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_bemonc_availability&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_cemonc_availability&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_pnc_coverage&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_pnc_quality&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sba_sens_analysis_max&#39;</span><span class="p">]</span> \
           <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_sens_analysis_max&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_sens_analysis_min&#39;</span><span class="p">]:</span>

            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_analysis_in_progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># If PNC analysis is being conducted we reset the intercept parameter of the equation determining care</span>
            <span class="c1"># seeking for PNC and scale the model</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_pnc_coverage&#39;</span><span class="p">]:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_odds&#39;</span><span class="p">]</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;odds_will_attend_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)]</span>
                <span class="n">mode_of_delivery</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">delivery_setting</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;mode_of_delivery&#39;</span> <span class="ow">in</span> <span class="n">mni_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">mode_of_delivery</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mni_df</span><span class="p">[</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;delivery_setting&#39;</span> <span class="ow">in</span> <span class="n">mni_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">delivery_setting</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mni_df</span><span class="p">[</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)],</span>
                    <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                    <span class="n">mode_of_delivery</span><span class="o">=</span><span class="n">mode_of_delivery</span><span class="p">,</span>
                    <span class="n">delivery_setting</span><span class="o">=</span><span class="n">delivery_setting</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span>
                <span class="n">scaled_intercept</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">target</span> <span class="o">/</span> <span class="n">mean</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">target</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">mean</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mean</span><span class="p">))</span> <span class="k">else</span> <span class="mf">1.0</span>

                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;odds_will_attend_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_intercept</span>

                <span class="c1"># Then override the parameters which control neonatal care seeking</span>
                <span class="n">cov_prob</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_odds&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_odds&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_timings_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_pnc_check_newborn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cov_prob</span>
                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_timings_pnc_newborns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alternative_pnc_quality&#39;</span><span class="p">]:</span>
                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_kmc_available&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_anaemia_assessment_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_sens_analysis_max&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_sens_analysis_min&#39;</span><span class="p">]:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">la_linear_models</span><span class="p">[</span><span class="s1">&#39;postnatal_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span>
                         <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                         <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">])</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_timings_pnc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">],</span>
                                              <span class="mi">1</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]]</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_careseeking_for_complication_pn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>
                <span class="n">pn_params</span><span class="p">[</span><span class="s1">&#39;prob_care_seeking_postnatal_emergency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>

                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_pnc_check_newborn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>
                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_timings_pnc_newborns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">],</span>
                                                          <span class="mi">1</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]]</span>
                <span class="n">nb_params</span><span class="p">[</span><span class="s1">&#39;prob_care_seeking_for_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>
                <span class="n">pn_params</span><span class="p">[</span><span class="s1">&#39;prob_care_seeking_postnatal_emergency_neonate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pnc_availability_probability&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sba_sens_analysis_max&#39;</span><span class="p">]:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;odds_deliver_at_home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>
</div>



<div class="viewcode-block" id="LabourLoggingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">LabourLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the LabourLoggingEvent. It uses the data frame and the labour_tracker to produce summary statistics which</span>
<span class="sd">    are processed and presented by different analysis scripts &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourLoggingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>


<div class="viewcode-block" id="LabourLoggingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">repro_women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">hysterectomy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_has_had_hysterectomy</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span>
                                                                                                           <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">labour</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span>
                                                                                                    <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">postnatal</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span>
                                                                                                 <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">inpatient</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span>
                                                                                                <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">prop_hyst</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hysterectomy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hysterectomy</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">repro_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">repro_women</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">prop_in_labour</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labour</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labour</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">repro_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">repro_women</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">prop_pn</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">postnatal</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">postnatal</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">repro_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">repro_women</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">prop_ip</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inpatient</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inpatient</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">repro_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">repro_women</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;women_data_debug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;hyst&#39;</span><span class="p">:</span> <span class="n">prop_hyst</span><span class="p">,</span>
                                                  <span class="s1">&#39;labour&#39;</span><span class="p">:</span> <span class="n">prop_in_labour</span><span class="p">,</span>
                                                  <span class="s1">&#39;pn&#39;</span><span class="p">:</span> <span class="n">prop_pn</span><span class="p">,</span>
                                                  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">prop_ip</span><span class="p">})</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Oct 08, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>