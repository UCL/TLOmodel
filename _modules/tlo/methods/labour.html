

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.labour &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.labour</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.labour</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">labour_lm</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hiv</span> <span class="kn">import</span> <span class="n">HSI_Hiv_TestAndRefer</span>
<span class="kn">from</span> <span class="nn">tlo.methods.postnatal_supervisor</span> <span class="kn">import</span> <span class="n">PostnatalWeekOneEvent</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="Labour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour">[docs]</a><span class="k">class</span> <span class="nc">Labour</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is module is responsible for the the process of labour, birth and the immediate postnatal period (up until</span>
<span class="sd">    48hrs post birth). This model has a number of core functions including; initiating the onset of labour for women on</span>
<span class="sd">    their pre-determined due date (or prior to this for preterm labour/admission for delivery), applying the incidence</span>
<span class="sd">     of a core set of maternal complications ocurring in the intrapartum period and outcomes such as maternal death or</span>
<span class="sd">     still birth, scheduling birth for women surviving labour and applying risk of complications and outcomes in the</span>
<span class="sd">     postnatal period. Complications explicitly modelled in this module include obstructed labour, antepartum</span>
<span class="sd">     haemorrhage, maternal infection and sepsis, progression of hypertensive disorders, uterine rupture and postpartum</span>
<span class="sd">      haemorrhage. In addition to the natural history of labour this module manages care seeking for women in labour</span>
<span class="sd">      (for delivery or following onset of complications at a home birth) and includes HSIs which represent</span>
<span class="sd">      Skilled Birth Attendance at either Basic or Comprehensive level emergency obstetric care facilities.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Labour.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># This dictionary will track incidence of complications of labour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># This list contains the individual_ids of women in labour, used for testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># These lists will contain possible complications and are used as checks in assert functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span></div>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Demography&#39;</span><span class="p">,</span> <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span> <span class="s1">&#39;PregnancySupervisor&#39;</span>
    <span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Contraception&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PostnatalSupervisor&#39;</span>
    <span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;intrapartum stillbirth&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Labour&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">#  ===================================  NATURAL HISTORY PARAMETERS =============================================</span>
        <span class="s1">&#39;intercept_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;intercept value for linear regression equation predicating womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_age_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in age by 1 year in the linear regression equation predicating &#39;</span>
                        <span class="s1">&#39;womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_mar_stat_2_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of a change in marriage status from comparison (level 1) in the linear &#39;</span>
                        <span class="s1">&#39;regression equation predicating womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_mar_stat_3_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of a change in marriage status from comparison (level 1) in the linear &#39;</span>
                        <span class="s1">&#39;regression equation predicating womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_5_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of a change in wealth status from comparison (level 1) in the linear &#39;</span>
                        <span class="s1">&#39;regression equation predicating womens parity at 2010 baseline&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_4_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womens &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_3_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womens &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_2_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womens &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_wealth_lev_1_parity_lr2010&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womens &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lower_limit_term_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;minimum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;term&#39;</span><span class="p">),</span>
        <span class="s1">&#39;upper_limit_term_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;maximum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;term&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lower_limit_early_preterm_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;minimum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;early preterm&#39;</span><span class="p">),</span>
        <span class="s1">&#39;upper_limit_early_preterm_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;maximum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;early preterm&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lower_limit_late_preterm_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;minimum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;early preterm&#39;</span><span class="p">),</span>
        <span class="s1">&#39;upper_limit_late_preterm_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;maximum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;late preterm&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lower_limit_postterm_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;minimum number of days gestation at which a woman can go into labour and be categorised as &#39;</span>
                        <span class="s1">&#39;post term &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pl_ol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of an increase in wealth level in the linear regression equation predicating womens &#39;</span>
                        <span class="s1">&#39;parity at 2010 base line&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_cephalopelvic_dis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;an individuals probability of experiencing CPD&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_malpresentation&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;an individuals probability of experiencing malpresentation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_malposition&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;an individuals probability of experiencing malposition&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstruction_cpd&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of obstruction in a woman with CPD&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstruction_malpos&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of obstruction in a woman with malposition&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstruction_malpres&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of obstruction in a woman with malpresentation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_placental_abruption_during_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman developing placental abruption during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placenta_praevia_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman with placenta praevia experiencing an APH during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_aph_placental_abruption_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman with placental abruption experiencing an APH during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_chorioamnionitis_ip&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of chorioamnionitis infection during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_other_maternal_infection_ip&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of other obstetric infection in labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_endometritis_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of endometritis infection following labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_skin_soft_tissue_inf_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a skin or soft tissue infection following labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_urinary_tract_inf_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a urinary tract infection following labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_other_maternal_infection_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of other obstetric infections following labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following chorioamnionitis infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_other_maternal_infection_ip&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following other intrapartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a uterine rupture during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_ur_grand_multip&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have delivered &gt;4 times previously&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_ur_prev_cs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of uterine rupture in women who have previously delivered via caesarean &#39;</span>
                        <span class="s1">&#39;section&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_ur_ref_ol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;relative risk of uterine rupture in women who have been referred in obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a maternal hemorrhage is non-severe (&lt;1000mls) or severe (&gt;1000mls)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for antepartum haemorrhage during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for eclampsia during labours&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_severe_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for severe pre eclampsia during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for sepsis during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for uterine rupture in labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_ip_still_birth_unk_cause&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of intrapartum still birth secondary to unknown cause&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_maternal_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers who have died during labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ur&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing uterine rupture&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing intrapartum sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_spe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_still_birth_ec&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of still birth in mothers experiencing eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_both_twins_ip_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability that if this mother will experience still birth, and she is pregnant with twins, &#39;</span>
                        <span class="s1">&#39;that neither baby will survive&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_uterine_atony&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of uterine atony following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_lacerations&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of genital tract lacerations following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_retained_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of placental retention following delievery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_other_pph_cause&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of other pph causing factors&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_uterine_atony&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing uterine atony&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_lacerations&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing genital tract lacerations&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_retained_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing retained placenta&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pph_other_causes&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of pph after experiencing otehr pph causes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_endometritis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following endometritis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_urinary_tract_inf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following urinary tract infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_skin_soft_tissue_inf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following skin or soft tissue infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_other_maternal_infection_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of sepsis following other maternal postpartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_death_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk increase of death in women who are anaemic at time of PPH&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for eclampsia following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_pp_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for sepsis following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of gestational hypertension progressing to severe gestational hypertension&#39;</span>
                        <span class="s1">&#39;during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_severe_gest_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of severe gestational hypertension progressing to severe pre-eclampsia &#39;</span>
                        <span class="s1">&#39;during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_mild_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of mild pre-eclampsia progressing to severe pre-eclampsia during/after labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_progression_severe_pre_eclamp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of severe pre-eclampsia progressing to eclampsia during/after labour&#39;</span><span class="p">),</span>

        <span class="c1"># ================================= HEALTH CARE SEEKING PARAMETERS ===========================================</span>
        <span class="s1">&#39;odds_deliver_in_health_centre&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds of a woman delivering in a health centre compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_25_29&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 25-29 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_30_34&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 30-34 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_35_39&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 35-39 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_40_44&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 40-44 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_age_45_49&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 45-49 delivering in a health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_rural&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman living in a rural setting delivery in a health centre compared&#39;</span>
                        <span class="s1">&#39;to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_parity_3_to_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman with a parity of 3-4 delivering in a health centre compared to&#39;</span>
                        <span class="s1">&#39;a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_parity_&gt;4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a parity &gt;4 delivering in health centre compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hc_delivery_married&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a married woman delivering in a health centre compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_deliver_at_home&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds of a woman delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_35_39&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 35-39 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_40_44&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 40-44 delivering at home compared to a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_age_45_49&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman aged 45-49 delivering at home compared to a hospital&#39;</span><span class="p">),</span>

        <span class="s1">&#39;rrr_hb_delivery_parity_3_to_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio for a woman with a parity of 3-4 delivering at home compared to&#39;</span>
                        <span class="s1">&#39;a hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rrr_hb_delivery_parity_&gt;4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk ratio of a woman with a parity &gt;4 delivering at home compared to a &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_careseeking_for_complication&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds of a woman seeking skilled assistance after developing a complication at a home birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_comp_careseeking_wealth_2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio of a woman of wealth level 2 seeking assistance after developing a complication at &#39;</span>
                        <span class="s1">&#39;a home birth &#39;</span><span class="p">),</span>
        <span class="s1">&#39;test_care_seeking_probs&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;dummy probabilities of delivery care seeking used in testing&#39;</span><span class="p">),</span>

        <span class="c1"># ================================= TREATMENT PARAMETERS =====================================================</span>
        <span class="s1">&#39;treatment_effect_maternal_infection_clean_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Effect of clean delivery practices on risk of maternal infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_pph_amtsl&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;relative risk of severe postpartum haemorrhage following active management of the third &#39;</span>
                        <span class="s1">&#39;stage of labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_haemostatis_uterotonics&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of uterotonics stopping a postpartum haemorrhage due to uterine atony &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_successful_manual_removal_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of manual removal of retained products arresting a post partum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;success_rate_pph_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of surgery for postpartum haemorrhage being successful&#39;</span><span class="p">),</span>
        <span class="s1">&#39;success_rate_surgical_removal_placenta&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of surgery for retained placenta being successful&#39;</span><span class="p">),</span>
        <span class="s1">&#39;success_rate_uterine_repair&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability repairing a ruptured uterus surgically&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_successful_assisted_vaginal_delivery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of successful assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_obstructed_labour_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for obstructed labour in a health &#39;</span>
                        <span class="s1">&#39;centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_obstructed_labour_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for obstructed labour in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for maternal sepsis in a health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for maternal sepsis in a level 1&#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_severe_pe_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for severe pre-eclampsia in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_severe_pe_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for severe pre-eclampsia in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_hypertension_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for hypertension in a level 1 health &#39;</span>
                        <span class="s1">&#39;centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_hypertension_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for hypertension in a level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_antepartum_haem_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment for referral by birth attendant for antepartum haemorrhage&#39;</span>
                        <span class="s1">&#39; in a health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_antepartum_haem_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment for treatment by birth attendant for antepartum haemorrhage&#39;</span>
                        <span class="s1">&#39; in a level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_uterine_rupture_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for uterine rupture in a health centre&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_uterine_rupture_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for uterine rupture in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_ec_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for eclampsia in a level 1 hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_ec_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for eclampsia in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_pph_hc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for postpartum haemorrhage in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_of_assessment_of_pph_hp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of dx_test assessment by birth attendant for postpartum haemorrhage in a level 1 &#39;</span>
                        <span class="s1">&#39;hospital&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sepsis_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for sepsis on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia_treatment_effect_severe_pe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for severe pre eclampsia on risk of eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;eclampsia_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of treatment for eclampsia on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;anti_htns_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of IV anti hypertensive treatment on risk of death secondary to severe pre-eclampsia/&#39;</span>
                        <span class="s1">&#39;eclampsia stillbirth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;anti_htns_treatment_effect_progression&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;effect of IV anti hypertensive treatment on risk of progression from mild to severe gestational&#39;</span>
            <span class="s1">&#39; hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aph_bt_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for antepartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_uterotonics_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of uterotonics on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_mrp_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of uterotonics on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_surg_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of surgery on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_treatment_effect_hyst_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of hysterectomy on maternal death due to postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pph_bt_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for postpartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aph_cs_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of caesarean section for antepartum haemorrhage on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_repair_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of surgical uterine repair treatment for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_treatment_effect_bt_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of blood transfusion treatment for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ur_hysterectomy_treatment_effect_md&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of blood hysterectomy for uterine rupture on risk of maternal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_avd_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of assisted vaginal delivery on risk of intrapartum still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_cs_still_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of caesarean section delivery on risk of intrapartum still birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;allowed_interventions&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;list of interventions allowed to run, used in analysis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_proph_ints&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which prophylactic interventions for birth cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_spe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for severe pre-eclampsia cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_ol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for obstructed labour cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_sep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for maternal sepsis cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for hypertension cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_ec&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for eclampsia cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_ur&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for uterine rupture cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for antepartum haemorrhage cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_treatment_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for antepartum haemorrhage cant be given&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_threshold_amtsl&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold below which treatment for amtsl cant be given&#39;</span><span class="p">),</span>

        <span class="c1"># ================================= DALY WEIGHT PARAMETERS =====================================================</span>
        <span class="s1">&#39;daly_wt_haemorrhage_moderate&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;DALY weight for a moderate maternal haemorrhage (&lt;1 litre)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;daly_wt_haemorrhage_severe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;DALY weight for a severe maternal haemorrhage (&gt;1 litre)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;daly_wt_maternal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;DALY weight for maternal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;daly_wt_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;DALY weight for eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;daly_wt_obstructed_labour&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;DALY weight for obstructed labour&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;The date on which a newly pregnant woman is scheduled to&#39;</span>
                                                              <span class="s1">&#39; go into labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is currently in labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans most recent pregnancy has ended &#39;</span>
                                                           <span class="s1">&#39;in a stillbirth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_parity&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;total number of previous deliveries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has ever delivered via caesarean section&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_has_previously_delivered_preterm&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has had a previous preterm &#39;</span>
                                                                    <span class="s1">&#39;delivery for any of her previous deliveries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing obstructed labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_obstructed_labour_causes&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column holding list of possible causes of obstructed&#39;</span>
                                                           <span class="s1">&#39; labour&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced placental abruption&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced an antepartum haemorrhage&#39;</span>
                                                          <span class="s1">&#39; in this delivery and it severity&#39;</span><span class="p">,</span>
                                       <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;la_antepartum_haem_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans antepartum haemorrhage has been &#39;</span>
                                                             <span class="s1">&#39;treated&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced uterine rupture in this &#39;</span>
                                                   <span class="s1">&#39;delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans uterine rupture has been treated&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has developed sepsis due to an intrapartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has developed sepsis due to a postpartum infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_ip_infection&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column holding list of infections&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_pp_infection&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column holding list of postpartum infections&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;If this woman has received treatment for maternal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this womans eclampsia has been treated&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has been treated for severe &#39;</span>
                                                                  <span class="s1">&#39;pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has been treated for maternal &#39;</span>
                                                                   <span class="s1">&#39;hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the woman has experienced an postpartum haemorrhage in this&#39;</span>
                                                   <span class="s1">&#39;delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_postpartum_haem_cause&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column holding causes of postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39; Treatment for received for postpartum haemorrhage &#39;</span>
                                                            <span class="s1">&#39;(bitset)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman has had a hysterectomy as treatment for a &#39;</span>
                                                        <span class="s1">&#39;complication of labour, and therefore is unable to conceive&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39; whether the woman has died as a result of this &#39;</span>
                                                            <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_maternal_death_in_labour_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of death for a date in pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of on which this mother last delivered&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is in the postpartum period, from delivery until &#39;</span>
                                                 <span class="s1">&#39;day +42 (6 weeks)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a woman is receiving iron and folic acid during &#39;</span>
                                                             <span class="s1">&#39;the postnatal period&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Labour.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>

        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_LabourSkilledBirthAttendance.xlsx&#39;</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_has_previously_delivered_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour_causes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_ip_infection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_pp_infection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_cause&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Maternal sepsis and haemorrhage are outcomes of preceding clinical events. We use a bitset handler to manage</span>
        <span class="c1"># a property of the women that captures if she has experienced one or more of the necessary pre-ceding clinical</span>
        <span class="c1"># events that could trigger sepsis of haemorrhage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intrapartum_infections</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_maternal_ip_infection&#39;</span><span class="p">,</span>
                                                    <span class="p">[</span><span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_maternal_pp_infection&#39;</span><span class="p">,</span>
                                                   <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_cause&#39;</span><span class="p">,</span>
                                                  <span class="p">[</span><span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_obstructed_labour</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour_causes&#39;</span><span class="p">,</span>
                                                        <span class="p">[</span><span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="s1">&#39;malposition&#39;</span><span class="p">,</span> <span class="s1">&#39;malpresentation&#39;</span><span class="p">])</span>

        <span class="c1"># Additionally we store different potential treatments for postpartum haemorrhage in this way</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">,</span>
                                           <span class="p">[</span><span class="s1">&#39;uterotonics&#39;</span><span class="p">,</span> <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">])</span>

        <span class="c1">#  ----------------------------ASSIGNING PARITY AT BASELINE --------------------------------------------------</span>
        <span class="c1"># This equation predicts the parity of each woman at baseline (who is of reproductive age)</span>
        <span class="n">parity_equation</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_parity</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># We assign parity to all women of reproductive age at baseline</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">),</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="n">parity_equation</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)])</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">),</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="Labour.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>

        <span class="c1"># We set the LoggingEvent to run a the last day of each year to produce statistics for that year</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># This list contains all the women who are currently in labour and is used for checks/testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># This dictionary is the complication tracker used by the logger to output incidence of complications/outcomes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ip_stillbirth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;maternal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sepsis_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;eclampsia_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;postpartum_haem_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;sepsis_pp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;health_centre_birth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;hospital_birth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;caesarean_section&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;early_preterm&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                               <span class="s1">&#39;late_preterm&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;post_term&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># This list contains all possible complications/outcomes of the intrapartum and postpartum phase- its used in</span>
        <span class="c1"># assert functions as a test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="s1">&#39;malposition&#39;</span><span class="p">,</span> <span class="s1">&#39;malpresentation&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis_pp&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>

        <span class="c1"># =======================Register dx_tests for complications during labour/postpartum=======================</span>
        <span class="c1"># We register all the dx_tests needed within the labour HSI events. For simplicity we use the dx_test here to</span>
        <span class="c1"># represent clinical assessment of a woman for a specific complication. If a dx_test assessment returns True a</span>
        <span class="c1"># woman will be given treatment (provided their are available consumables and the squeeze is not too high)</span>

        <span class="c1"># We vary the &#39;sensitivity&#39; of these assessment between health centres and hospitals to allow for future</span>
        <span class="c1"># calibration to SARA survey data which varies by facility type ...(hp = hospital, hc= health centre)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>

            <span class="c1"># Obstructed Labour diagnosis</span>
            <span class="n">assess_obstructed_labour_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_obstructed_labour_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_obstructed_labour_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_obstructed_labour_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Sepsis diagnosis intrapartum...</span>
            <span class="c1"># dx_tests for intrapartum and postpartum sepsis only differ in the &#39;property&#39; variable</span>
            <span class="n">assess_sepsis_hc_ip</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_sepsis&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_sepsis_hp_ip</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_sepsis&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Sepsis diagnosis postpartum</span>
            <span class="n">assess_sepsis_hc_pp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_sepsis_hp_pp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_sepsis_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Hypertension diagnosis</span>
            <span class="n">assess_hypertension_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_hypertension_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_hypertension_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_hypertension_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># severe pre-eclampsia diagnosis</span>
            <span class="n">assess_severe_pe_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_severe_pe_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_severe_pe_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_severe_pe_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Eclampsia diagnosis</span>
            <span class="n">assess_eclampsia_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_ec_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_eclampsia_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_ec_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Antepartum Haemorrhage</span>
            <span class="n">assess_aph_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_antepartum_haem_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_aph_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_antepartum_haem_hc&#39;</span><span class="p">]),</span>

            <span class="c1"># Uterine Rupture</span>
            <span class="n">assess_uterine_rupture_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_uterine_rupture_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_uterine_rupture_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_uterine_rupture_hp&#39;</span><span class="p">]),</span>

            <span class="c1"># Postpartum haemorrhage</span>
            <span class="n">assess_pph_hc</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_pph_hc&#39;</span><span class="p">]),</span>

            <span class="n">assess_pph_hp</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;sensitivity_of_assessment_of_pph_hp&#39;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="c1"># ======================================= LINEAR MODEL EQUATIONS ==============================================</span>
        <span class="c1"># Here we define the equations that will be used throughout this module using the linear</span>
        <span class="c1"># model and stored them as a parameter</span>

        <span class="c1"># TODO: process of &#39;selection&#39; of important predictors in linear equations is ongoing, a linear model that</span>
        <span class="c1">#  is empty of predictors at the end of this process will be converted to a set probability</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation predicts the parity of each woman at baseline (who is of reproductive age)</span>
            <span class="s1">&#39;parity&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_parity</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of obstructed labour. As we assume obstructed labour can</span>
            <span class="c1"># only occur following on of three preceding causes, this model is additive</span>
            <span class="s1">&#39;obstructed_labour_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_obstructed_labour_ip</span><span class="p">,</span>
                                                       <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing chorioamnionitis infection during the</span>
            <span class="c1"># intrapartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;chorioamnionitis_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_chorioamnionitis_ip</span><span class="p">,</span>
                                                      <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing other undefined infection during the</span>
            <span class="c1"># intrapartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;other_maternal_infection_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_other_maternal_infections_ip</span><span class="p">,</span>
                                                              <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing endometritis infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;endometritis_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_endometritis_pp</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing skin or soft tissue infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;skin_soft_tissue_inf_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_skin_soft_tissue_inf_pp</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing a urinary tract infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;urinary_tract_inf_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_urinary_tract_inf_pp</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of developing other undefined infection during the</span>
            <span class="c1"># postpartum phase of labour and is mitigated by clean delivery</span>
            <span class="s1">&#39;other_maternal_infection_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_other_maternal_infection_pp</span><span class="p">,</span>
                                                              <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk risk of developing intrapartum sepsis. We assume sepsis</span>
            <span class="c1"># can only occur in the presence of a preceding infection therefore this model is additive</span>
            <span class="s1">&#39;sepsis_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_ip</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following sepsis during labour and is mitigated</span>
            <span class="c1"># by treatment</span>
            <span class="s1">&#39;sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk risk of developing postpartum sepsis. We assume sepsis</span>
            <span class="c1"># can only occur in the presence of a preceding infection therefore this model is additive</span>
            <span class="s1">&#39;sepsis_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_pp</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following postpartum sepsis and is mitigated</span>
            <span class="c1"># by treatment</span>
            <span class="s1">&#39;sepsis_pp_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_sepsis_pp_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following eclampsia and is mitigated</span>
            <span class="c1"># by treatment delivered either immediately prior to admission for delivery or during labour</span>
            <span class="s1">&#39;eclampsia_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_eclampsia_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following eclampsia and is mitigated</span>
            <span class="c1"># by treatment delivered either immediately prior to admission for delivery or during labour</span>
            <span class="s1">&#39;eclampsia_pp_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_eclampsia_pp_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following eclampsia and is mitigated</span>
            <span class="c1"># by treatment delivered either immediately prior to admission for delivery or during labour</span>
            <span class="s1">&#39;severe_pre_eclamp_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_severe_pre_eclamp_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of placental abruption in labour</span>
            <span class="s1">&#39;placental_abruption_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_placental_abruption_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of antepartum haemorrhage. We assume APH can only occur</span>
            <span class="c1"># in the presence of a preceding placental causes (abruption/praevia) therefore this model is additive</span>
            <span class="s1">&#39;antepartum_haem_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_antepartum_haem_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following antepartum haemorrhage. Risk is</span>
            <span class="c1"># mitigated by treatment</span>
            <span class="s1">&#39;antepartum_haem_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_antepartum_haem_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of postpartum haemorrhage. We assume PPH can only occur</span>
            <span class="c1"># in the presence of a preceding causes (uterine atony/retained placenta/lacerations/other) therefore this</span>
            <span class="c1"># model is additive</span>
            <span class="s1">&#39;postpartum_haem_pp&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_postpartum_haem_pp</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following postpartum haemorrhage. Risk is</span>
            <span class="c1"># mitigated by treatment</span>
            <span class="s1">&#39;postpartum_haem_pp_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_postpartum_haem_pp_death</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of uterine rupture</span>
            <span class="s1">&#39;uterine_rupture_ip&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_uterine_rupture_ip</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of death following uterine rupture. Risk if reduced by</span>
            <span class="c1"># treatment</span>
            <span class="s1">&#39;uterine_rupture_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_uterine_rupture_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to calculate a womans risk of still birth during the intrapartum period. Assisted</span>
            <span class="c1"># vaginal delivery and caesarean delivery are assumed to significantly reduce risk</span>
            <span class="s1">&#39;intrapartum_still_birth&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_intrapartum_still_birth</span><span class="p">,</span>
                                                          <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This regression equation uses data from the DHS to predict a womans probability of choosing to deliver in</span>
            <span class="c1"># a health centre</span>
            <span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_probability_delivery_health_centre</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This regression equation uses data from the DHS to predict a womans probability of choosing to deliver in</span>
            <span class="c1"># at home</span>
            <span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_probability_delivery_at_home</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation calculates a womans probability of seeking care following a complication during labour or</span>
            <span class="c1"># immediately after birth</span>
            <span class="s1">&#39;care_seeking_for_complication&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">labour_lm</span><span class="o">.</span><span class="n">predict_care_seeking_for_complication</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="Labour.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_has_previously_delivered_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour_causes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_ip_infection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_pp_infection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_cause&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Labour.further_on_birth_labour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.further_on_birth_labour">[docs]</a>    <span class="k">def</span> <span class="nf">further_on_birth_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module. This function contains additional</span>
<span class="sd">        code related to the labour module that should be ran on_birth for all births - it has been</span>
<span class="sd">        parcelled into functions to ensure each modules (pregnancy,antenatal care, labour, newborn, postnatal) on_birth</span>
<span class="sd">        code is ran in the correct sequence (as this can vary depending on how modules are registered)</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]</span>

        <span class="c1"># If a mothers labour has resulted in an intrapartum still birth her child is still generated by the simulation</span>
        <span class="c1"># but the death is recorded through the InstantaneousDeath function</span>

        <span class="c1"># Store only live births to a mother parity</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Only live births contribute to parity</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;live_birth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                                <span class="s1">&#39;child&#39;</span><span class="p">:</span> <span class="n">child_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;intrapartum stillbirth&#39;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">])</span>

        <span class="c1"># We use this variable in the postnatal supervisor module to track postpartum women</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div>

<div class="viewcode-block" id="Labour.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This is called whenever there is an HSI event commissioned by one of the other disease modules.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is Labour, being alerted about a health system interaction &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is Labour reporting my health values&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to population properties data frame</span>

        <span class="n">daly_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">daly_series</span></div>

    <span class="c1"># ===================================== HELPER AND TESTING FUNCTIONS ==============================================</span>
<div class="viewcode-block" id="Labour.set_date_of_labour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_date_of_labour">[docs]</a>    <span class="k">def</span> <span class="nf">set_date_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by contraception.py within the events &#39;PregnancyPoll&#39; and &#39;Fail&#39; for women who are</span>
<span class="sd">        allocated to become pregnant during a simulation run. This function schedules the onset of labour between 37</span>
<span class="sd">        and 44 weeks gestational age (not foetal age) to ensure all women who become pregnant will go into labour.</span>
<span class="sd">        Women may enter labour before the due date set in this function either due to pre-term labour or induction/</span>
<span class="sd">        caesarean section.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is having their labour scheduled on date &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="c1"># Check only alive newly pregnant women are scheduled to this function</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1"># At the point of conception we schedule labour to onset for all women between 37 and 44 weeks gestation age.</span>
        <span class="c1"># As a womans pregnancy progresses she has a risk of early labour onset applied from 24 weeks within the</span>
        <span class="c1"># pregnancy supervisor module</span>

        <span class="c1"># n.b 35 weeks from conception = 37 weeks gestational age (see PregnancySupervisorEvent)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">35</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span>

        <span class="c1"># Here we check that no one is scheduled to go into labour before 37 gestational age (35 weeks foetal age,</span>
        <span class="c1"># ensuring all preterm labour comes from the pregnancy supervisor module</span>
        <span class="n">days_until_labour</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
        <span class="k">assert</span> <span class="n">days_until_labour</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">245</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.predict"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function compares the result of a specific linear equation with a random draw providing a boolean for</span>
<span class="sd">        the outcome under examination</span>
<span class="sd">        :param eq: Linear model equation</span>
<span class="sd">        :param person_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">]]</span>

        <span class="c1"># We define specific external variables used as predictors in the equations defined below</span>
        <span class="n">has_rbt</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;received_blood_transfusion&#39;</span><span class="p">]</span>
        <span class="n">mode_of_delivery</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span>
        <span class="n">received_clean_delivery</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">]</span>
        <span class="n">received_abx_for_prom</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span>

        <span class="c1"># We run a random draw and return the outcome</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">eq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">person</span><span class="p">,</span>
                                                     <span class="n">received_clean_delivery</span><span class="o">=</span><span class="n">received_clean_delivery</span><span class="p">,</span>
                                                     <span class="n">received_abx_for_prom</span><span class="o">=</span><span class="n">received_abx_for_prom</span><span class="p">,</span>
                                                     <span class="n">mode_of_delivery</span><span class="o">=</span><span class="n">mode_of_delivery</span><span class="p">,</span>
                                                     <span class="n">received_blood_transfusion</span><span class="o">=</span><span class="n">has_rbt</span><span class="p">)[</span><span class="n">person_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="Labour.reset_due_date"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.reset_due_date">[docs]</a>    <span class="k">def</span> <span class="nf">reset_due_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind_or_df</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">,</span> <span class="n">new_due_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called at various points in the PregnancySupervisor module to reset the due-date of women who</span>
<span class="sd">        may have experience pregnancy loss or will now go into pre-term labour on new due-date</span>
<span class="sd">        :param ind_or_df: (STR) Is this function being use on an individual row or slice of the data frame</span>
<span class="sd">         &#39;individual&#39;/&#39;data_frame&#39;</span>
<span class="sd">        :param id_or_index: The individual id OR dataframe slice that this change will be made for</span>
<span class="sd">        :param new_due_date: (DATE) the new due-date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">ind_or_df</span> <span class="o">==</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span>

        <span class="n">change</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_due_date</span></div>

<div class="viewcode-block" id="Labour.check_labour_can_proceed"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.check_labour_can_proceed">[docs]</a>    <span class="k">def</span> <span class="nf">check_labour_can_proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the LabourOnsetEvent to evaluate if labour can proceed for the woman who has arrived</span>
<span class="sd">         at the event</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :returns True/False if labour can proceed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If the mother has died OR has lost her pregnancy OR is already in labour then the labour events wont run</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">or</span> <span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">, however this is event is no longer relevant for this &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;individual and will not run&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If she is alive, pregnant, not in labour AND her due date is today then the event will run</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">:</span>

            <span class="c1"># If the woman in not currently an inpatient then we assume this is her normal labour</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ac_admitted_for_immediate_delivery</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and will now go into labour at gestation &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Otherwise she may have gone into labour whilst admitted as an inpatient and is awaiting induction/</span>
            <span class="c1"># caesarean when she is further along in her pregnancy, in that case labour can proceed via the method she</span>
            <span class="c1"># was admitted for</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">, who is currently admitted and awaiting &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery, has just gone into spontaneous labour and reached &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;LabourOnsetEvent on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> - she will now go into labour &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;at gestation </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If she is alive, pregnant, not in labour BUT her due date is not today, however shes been admitted then we</span>
        <span class="c1"># labour can progress as she requires early delivery</span>
        <span class="k">elif</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ac_admitted_for_immediate_delivery</span> <span class="o">!=</span>
                                                                         <span class="s1">&#39;none&#39;</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has just reached LabourOnsetEvent on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">- they have been admitted for delivery due to &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;complications in the antenatal period and will now progress into the &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;labour event at gestation </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># We set her due date to today so she the event will run properly</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Labour.set_intrapartum_complications"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_intrapartum_complications">[docs]</a>    <span class="k">def</span> <span class="nf">set_intrapartum_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is called either during a LabourAtHomeEvent OR HSI_Labour_ReceivesSkilledBirthAttendanceDuring</span>
<span class="sd">        Labour for all women during labour (home birth vs facility delivery). The function is used to apply risk of</span>
<span class="sd">        complications which have been passed ot it including the preceding causes of obstructed labour</span>
<span class="sd">        (malposition, malpresentation and cephalopelvic disproportion), obstructed labour, uterine rupture, placental</span>
<span class="sd">        abruption, antepartum haemorrhage,  infections (chorioamnionitis/other) and sepsis. Properties in the dataframe</span>
<span class="sd">         are set accordingly including properties which map to disability weights to capture DALYs</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param complication: (STR) the complication passed to the function which is being evaluated</span>
<span class="sd">        [&#39;cephalopelvic_dis&#39;, &#39;malposition&#39;, &#39;malpresentation&#39;,&#39;obstructed_labour&#39;, &#39;placental_abruption&#39;,</span>
<span class="sd">        &#39;antepartum_haem&#39;, &#39;chorioamnionitis&#39;, &#39;other_maternal_infection&#39;, &#39;uterine_rupture&#39;, &#39;sepsis&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># First we run check to ensure only women who have started the labour process are passed to this function</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>

        <span class="c1"># Then we check that only complications from the master complication list are passed to the function (to ensure</span>
        <span class="c1"># any typos for string variables are caught)</span>
        <span class="k">assert</span> <span class="n">complication</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span>

        <span class="c1"># Women may have been admitted for delivery from the antenatal ward because they have developed a complication</span>
        <span class="c1"># in pregnancy requiring delivery. Here we make sure women admitted due to these complications do not experience</span>
        <span class="c1"># the same complication again when this code runs</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

            <span class="c1"># Both &#39;la_antepartum_haem&#39; and &#39;ps_antepartum_haem&#39; will trigger treatment if identified</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="c1"># Onset of placental abruption antenatally or intrapartum can lead to APH in linear model</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_placental_abruption&#39;</span><span class="p">]:</span>
                <span class="k">return</span>

            <span class="c1"># Women admitted with histological chorioamnionitis from the community are more at risk of sepsis</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;histological&#39;</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="c1"># Women admitted with clinical chorioamnionitis from the community are assumed to be septic in labour</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;clinical&#39;</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span>

        <span class="c1"># For the preceding complications that can cause obstructed labour, we apply risk using a set probability</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;malposition&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span>
                                                                                        <span class="s1">&#39;malpresentation&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="c1"># Otherwise we use the linear model to predict likelihood of a complication</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_ip&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># --------------------------------------- COMPLICATION ------------------------------------------------------</span>
        <span class="c1"># If &#39;result&#39; == True, this woman will experience the complication passed to the function</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed </span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1"> during birth on date&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># For &#39;complications&#39; stored in a biset property - they are set here</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;malposition&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span>
                                                                                            <span class="s1">&#39;malpresentation&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_obstructed_labour</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intrapartum_infections</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">)</span>

            <span class="c1"># Otherwise they are stored as individual properties (women with undiagnosed placental abruption may present</span>
            <span class="c1"># to labour)</span>
            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;placental_abruption&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">:</span>
                <span class="n">random_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild_moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice</span>
                <span class="k">if</span> <span class="n">random_choice</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;mild_mod_aph_onset&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;severe_aph_onset&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;obstructed_labour&#39;</span> <span class="ow">or</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;uterine_rupture&#39;</span> <span class="ow">or</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.set_postpartum_complications"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_postpartum_complications">[docs]</a>    <span class="k">def</span> <span class="nf">set_postpartum_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called either during a PostpartumLabourAtHomeEvent OR HSI_Labour_ReceivesSkilledBirthAttendance</span>
<span class="sd">        FollowingLabour for all women following labour and birth (home birth vs facility delivery). The function is</span>
<span class="sd">        used to apply risk of complications which have been passed ot it including the preceding causes of postpartum</span>
<span class="sd">        haemorrhage (uterine atony, retained placenta, lacerations, other), postpartum haemorrhage, preceding infections</span>
<span class="sd">         to sepsis (endometritis, skin/soft tissue infection, urinary tract, other), sepsis. Properties in the dataframe</span>
<span class="sd">         are set accordingly including properties which map to disability weights to capture DALYs</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param complication: (STR) the complication passed to the function which is being evaluated [</span>
<span class="sd">        &#39;endometritis&#39;, &#39;skin_soft_tissue_inf&#39;, &#39;urinary_tract_inf&#39;, &#39;other_maternal_infection&#39;, &#39;sepsis&#39;,</span>
<span class="sd">        &#39;uterine_atony&#39;,&#39;lacerations&#39;, &#39;retained_placenta&#39;, &#39;other_pph_cause&#39;,&#39;postpartum_haem&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># This function follows a roughly similar pattern as set_intrapartum_complications</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">assert</span> <span class="n">complication</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span>

        <span class="c1"># For the complications than can contribute to postpartum bleeding we use a fixed probability to apply risk</span>
        <span class="c1"># (not a linear equation). Women who received active management of labour have a reduced risk of uterine atony</span>
        <span class="c1"># or retained placenta- both of which can contribute to postpartum bleeding</span>
        <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;uterine_atony&#39;</span> <span class="ow">or</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]:</span>
                <span class="n">risk_of_pph_cause</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_pph_amtsl&#39;</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">risk_of_pph_cause</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

        <span class="c1"># Next we determine if this woman has experienced any of the other potential preceding causes of PPH</span>
        <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;lacerations&#39;</span> <span class="ow">or</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="c1"># For the other complications which can be passed to this function we use the linear model to return a womans</span>
        <span class="c1"># risk and compare that to a random draw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_pp&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># ------------------------------------- COMPLICATION ---------------------------------------------------------</span>
        <span class="c1"># If result == True the complication has happened and the appropriate changes to the data frame are made</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed </span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1"> during the&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; postpartum phase of a birth on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;endometritis&#39;</span> <span class="ow">or</span> \
                <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span> <span class="ow">or</span> \
                <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;urinary_tract_inf&#39;</span> <span class="ow">or</span> \
               <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span>
                <span class="c1"># We run a check here to ensure only women with an infection can develop sepsis</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span>
                                                          <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_pp&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">_onset&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;uterine_atony&#39;</span> <span class="ow">or</span> \
                <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;lacerations&#39;</span> <span class="ow">or</span> \
                <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;retained_placenta&#39;</span> <span class="ow">or</span> \
               <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="n">complication</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">:</span>

                <span class="c1"># Similarly we make sure that PPH can only occur after a preceding cause</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;la_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># We set the severity to map to DALY weights</span>
                <span class="n">random_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;non_severe&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;severity_maternal_haemorrhage&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">random_choice</span> <span class="o">==</span> <span class="s1">&#39;non_severe&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;mild_mod_pph_onset&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;severe_pph_onset&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.progression_of_hypertensive_disorders"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.progression_of_hypertensive_disorders">[docs]</a>    <span class="k">def</span> <span class="nf">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called during LabourAtHomeEvent/PostpartumLabourAtHomeEvent or HSI_Labour_Receives</span>
<span class="sd">        SkilledBirthAttendanceDuring/FollowingLabour to determine if a woman with a hypertensive disorder will</span>
<span class="sd">        experience progression to a more severe state of disease during labour or the immediate postpartum period.</span>
<span class="sd">        We do not allow for new onset of  hypertensive disorders during this module - only progression of</span>
<span class="sd">        exsisting disease.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param property_prefix: (STR) &#39;pn&#39; or &#39;ps&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># n.b. on birth women whose hypertension will continue into the postnatal period have their disease state stored</span>
        <span class="c1"># in a new property therefore antenatal/intrapartum hypertension is &#39;ps_htn_disorders&#39; and postnatal is</span>
        <span class="c1"># &#39;pn_htn_disorders&#39; hence the use of property prefix variable (as this function is called before and after</span>
        <span class="c1"># birth)</span>

        <span class="c1"># Women can progress from severe pre-eclampsia to eclampsia</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>

            <span class="n">risk_ec</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_severe_pre_eclamp&#39;</span><span class="p">]</span>

            <span class="c1"># Risk of progression from severe pre-eclampsia to eclampsia during labour is mitigated by administration of</span>
            <span class="c1"># magnesium sulfate in women with severe pre-eclampsia (this may have been delivered on admission or in the</span>
            <span class="c1"># antenatal ward)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>
                <span class="n">risk_progression_spe_ec</span> <span class="o">=</span> <span class="n">risk_ec</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;eclampsia_treatment_effect_severe_pe&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">risk_progression_spe_ec</span> <span class="o">=</span> <span class="n">risk_ec</span>

            <span class="k">if</span> <span class="n">risk_progression_spe_ec</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;eclampsia&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;eclampsia_onset&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed eclampsia_</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Or from mild to severe gestational hypertension, risk reduced by treatment</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]:</span>
                <span class="n">risk_prog_gh_sgh</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span>
                    <span class="s1">&#39;anti_htns_treatment_effect_progression&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">risk_prog_gh_sgh</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_gest_htn&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">risk_prog_gh_sgh</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_gest_htn&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed severe_gest_htn_</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Or from severe gestational hypertension to severe pre-eclampsia...</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed severe_pre_eclamp_&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Or from mild pre-eclampsia to severe pre-eclampsia...</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_progression_mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed severe_pre_eclamp_&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">property_prefix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.set_maternal_death_status_intrapartum"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_maternal_death_status_intrapartum">[docs]</a>    <span class="k">def</span> <span class="nf">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the LabourDeathEvent. A &#39;cause&#39; of death is passed to this function and a linear</span>
<span class="sd">        model is used to calculate if the cause will contribute to this womans death during labour</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param cause: (STR) complication which may cause death</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Check that only the correct causes are being passed to the function</span>
        <span class="k">assert</span> <span class="n">cause</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_intrapartum_complications</span>

        <span class="c1"># todo: only allow death from severe haemorrhage (IP and PP)</span>

        <span class="c1"># We determine if this woman will die of the complication defined in the function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1"> has contributed to person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> death during labour&#39;</span><span class="p">)</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;cause_of_death_in_labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cause</span><span class="p">)</span>

            <span class="c1"># This information is passed to the event where the InstantaneousDeathEvent is scheduled - this allows for</span>
            <span class="c1"># the application of multiple risk of death from multiple complications</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># As eclampsia is a transient acute event, if women survive we reset their disease state to severe</span>
            <span class="c1"># pre-eclampsia</span>
            <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span></div>

<div class="viewcode-block" id="Labour.set_maternal_death_status_postpartum"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.set_maternal_death_status_postpartum">[docs]</a>    <span class="k">def</span> <span class="nf">set_maternal_death_status_postpartum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by from within the apply_risk_of_early_postpartum_death function (below).</span>
<span class="sd">        A &#39;cause&#39; of death is passed to this function and a linear model is used to calculate if the cause will</span>
<span class="sd">        contribute to this womans death following labour</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param cause: (STR) complication which may cause death</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">assert</span> <span class="n">cause</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_postpartum_complications</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_pp_death&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1"> has contributed to person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> death following labour&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;cause_of_death_in_labour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">_postpartum&#39;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_death_in_labour_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span></div>

<div class="viewcode-block" id="Labour.apply_risk_of_early_postpartum_death"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.apply_risk_of_early_postpartum_death">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called for all women who have survived labour. This function is called at various points in</span>
<span class="sd">        the model depending on a womans pathway through labour and includes PostpartumLabourAtHomeEvent,</span>
<span class="sd">        HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour, HSI_Labour_ReceivesComprehensiveEmergencyObstetric</span>
<span class="sd">        Care and HSI_Labour_ReceivesCareFollowingCaesareanSection. The function cycles through each complication to</span>
<span class="sd">        determine if that will contribute to a womans death and then schedules InstantaneousDeathEvent accordingly.</span>
<span class="sd">        For women who survive their properties from the labour module are reset and they are scheduled to</span>
<span class="sd">        PostnatalWeekOneEvent</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># We ensure that this function is only being applied to the correct women</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># We then move through each complication to calculate risk of death</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_maternal_death_status_postpartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_maternal_death_status_postpartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;postpartum_haem&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_maternal_death_status_postpartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;sepsis&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_postpartum&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;maternal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">])</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has died due to postpartum complications&#39;</span><span class="p">)</span>

        <span class="c1"># For women who have survived we first reset all the appropriate variables as this is the last function ran</span>
        <span class="c1"># within the module</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_postpartum&#39;</span><span class="p">]:</span>
            <span class="c1"># ================================ RESET LABOUR MODULE VARIABLES =========================================</span>
            <span class="c1"># Reset labour variable</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

            <span class="c1"># Followed by all bitset variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intrapartum_infections</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_obstructed_labour</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="s1">&#39;malpresentation&#39;</span><span class="p">,</span> <span class="s1">&#39;malposition&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">)</span>

            <span class="c1"># Other complication variables</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_placental_abruption&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Treatment variables</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;uterotonics&#39;</span><span class="p">,</span> <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">)</span>

        <span class="c1"># todo: This event looks at the mother and child  pair an applies risk of complications- therefore I cant</span>
        <span class="c1">#  condition on the mother being alive for the event to be schedule (otherwise newborns of mothers who died in</span>
        <span class="c1">#  labour or after labour dont get risk applied) - should be fine as event wont run on mothers who arent alive</span>

        <span class="c1"># ================================ SCHEDULE POSTNATAL WEEK ONE EVENT =====================================</span>
        <span class="c1"># For women who have survived first 24 hours after birth we scheduled them to attend the first event in the</span>
        <span class="c1"># PostnatalSupervisorModule - PostnatalWeekOne Event</span>

        <span class="c1"># This event determines if women/newborns will develop complications in week one. We stagger when women</span>
        <span class="c1"># arrive at this event to simulate bunching of complications in the first few days after birth</span>

        <span class="n">days_post_birth_td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span>
        <span class="n">days_post_birth_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">days_post_birth_td</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>

        <span class="k">assert</span> <span class="n">days_post_birth_int</span> <span class="o">&lt;</span> <span class="mi">6</span>

        <span class="c1"># change to parameter</span>
        <span class="n">day_for_event</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]))</span>

        <span class="c1"># Ensure no women go to this event after week 1</span>
        <span class="k">if</span> <span class="n">day_for_event</span> <span class="o">+</span> <span class="n">days_post_birth_int</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">day_for_event</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostnatalWeekOneEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day_for_event</span><span class="p">))</span>

        <span class="c1"># Here we remove all women (dead and alive) who have passed through the labour events from the checker list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.labour_characteristics_checker"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.labour_characteristics_checker">[docs]</a>    <span class="k">def</span> <span class="nf">labour_characteristics_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is called at multiples points in the module to ensure women of the right characteristics are</span>
<span class="sd">        in labour. This function doesnt check for a woman being pregnant or alive, as some events will still run despite</span>
<span class="sd">        those variables being set to false</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">51</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">22</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">la_due_date_current_pregnancy</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.postpartum_characteristics_checker"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.postpartum_characteristics_checker">[docs]</a>    <span class="k">def</span> <span class="nf">postpartum_characteristics_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is called at multiples points in the module to ensure women of the right characteristics are</span>
<span class="sd">        in the period following labour. This function doesnt check for a woman being pregnant or alive, as some events</span>
<span class="sd">        will still run despite those variables being set to false</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_in_labour</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&gt;</span> <span class="mi">14</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">51</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span></div>

    <span class="c1"># ============================================== HSI FUNCTIONS ====================================================</span>
    <span class="c1"># Management of each complication is housed within its own function, defined here in the module, and all follow a</span>
    <span class="c1"># similar pattern ...</span>
    <span class="c1">#                   a.) The required consumables for the intervention(s) are defined</span>
    <span class="c1">#                   b.) The woman is assessed for a complication using the dx_test function. Specificity of</span>
    <span class="c1">#                       assessment varies between facility type (hospital or health centre)</span>
    <span class="c1">#                   c.) If she has the complication and it is correctly identified by HCWs, they check</span>
    <span class="c1">#                       consumables are available</span>
    <span class="c1">#                   d.) If the consumables are available- she will receive treatment</span>

    <span class="c1"># The function is only called if the squeeze factor of the HSI calling the function is below a set &#39;threshold&#39; for</span>
    <span class="c1"># each intervention. Thresholds will vary between intervention</span>

<div class="viewcode-block" id="Labour.prophylactic_labour_interventions"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.prophylactic_labour_interventions">[docs]</a>    <span class="k">def</span> <span class="nf">prophylactic_labour_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function houses prophylactic interventions delivered by a Skilled Birth Attendant to women in labour.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="c1"># params[&#39;allowed_interventions&#39;] contains a list of interventions delivered in this module. Removal of</span>
        <span class="c1"># interventions from this list within test/analysis will stop this intervention from running</span>
        <span class="k">if</span> <span class="s1">&#39;prophylactic_labour_interventions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ----------------------------------CLEAN DELIVERY PRACTICES ---------------------------------------------</span>
            <span class="c1"># The first in this suite of interventions is clean delivery practices. We assume clean birth practices are</span>
            <span class="c1"># delivered if a clean birth kit is available at the facility</span>
            <span class="c1"># pkg_code_clean_delivery_kit = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Clean practices and immediate essential newborn &#39;</span>
            <span class="c1">#                                                        &#39;care (in facility)&#39;, &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_clean_delivery_kit])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># If available we store this intervention in the mni dictionary. Clean delivery will reduce a mothers risk</span>
            <span class="c1"># of intrapartum infections</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be able to experience clean birth practices &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;during her delivery as the consumables are available&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will not be able to experience clean birth &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;practices during her delivery as the consumables arent available&#39;</span><span class="p">)</span>

            <span class="c1"># --------------------------------- ANTIBIOTICS FOR PROM/PPROM -------------------------------------------</span>
            <span class="c1"># Next we determine if the HCW will administer antibiotics for women with premature rupture of membranes</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_premature_rupture_of_membranes&#39;</span><span class="p">]:</span>

                <span class="c1"># The mother may have received these antibiotics already if she presented to the antenatal ward from the</span>
                <span class="c1"># community following PROM. We store this in the mni dictionary</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]:</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If she has not already receive antibiotics, we check for consumables</span>
                    <span class="c1"># item_code_benpen = pd.unique(</span>
                    <span class="c1">#     consumables.loc[</span>
                    <span class="c1">#         consumables[&#39;Items&#39;] ==</span>
                    <span class="c1">#         &#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;,</span>
                    <span class="c1">#         &#39;Item_Code&#39;])[0]</span>
                    <span class="n">item_code_benpen</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># item_code_wfi = pd.unique(consumables.loc[consumables[&#39;Items&#39;] ==</span>
                    <span class="c1"># &#39;Water for injection, 10ml_Each_CMST&#39;, &#39;Item_Code&#39;])[0]</span>
                    <span class="c1"># item_code_needle = pd.unique(</span>
                    <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Syringe, needle + swab&#39;, &#39;Item_Code&#39;])[0]</span>
                    <span class="c1"># item_code_gloves = pd.unique(</span>
                    <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] ==</span>
                    <span class="c1">#     &#39;Gloves, exam, latex, disposable, pair&#39;, &#39;Item_Code&#39;])[0]</span>

                    <span class="c1"># consumables_abx_for_prom = {</span>
                    <span class="c1">#     &#39;Intervention_Package_Code&#39;: {},</span>
                    <span class="c1">#     &#39;Item_Code&#39;: {item_code_benpen: 4, item_code_wfi: 1, item_code_needle: 1,</span>
                    <span class="c1">#                   item_code_gloves: 1}}</span>

                    <span class="c1"># Then query if these consumables are available during this HSI</span>
                    <span class="c1"># outcome_of_request_for_consumables = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
                    <span class="c1">#     hsi_event=hsi_event,</span>
                    <span class="c1">#     cons_req_as_footprint=consumables_abx_for_prom)</span>
                    <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
                        <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="p">}</span>

                    <span class="c1"># And provide if available. Antibiotics for from reduce risk of newborn sepsis within the first</span>
                    <span class="c1"># week of life</span>
                    <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_benpen</span><span class="p">]:</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This facility has provided antibiotics for mother &#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> who is a risk of sepsis due to PROM&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This facility has no antibiotics for the treatment of PROM.&#39;</span><span class="p">)</span>

            <span class="c1"># ------------------------------ STEROIDS FOR PRETERM LABOUR -------------------------------</span>
            <span class="c1"># Next we see if women in pre term labour will receive antenatal corticosteroids</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;early_preterm_labour&#39;</span> <span class="ow">or</span> \
               <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;late_preterm_labour&#39;</span><span class="p">:</span>

                <span class="c1"># item_code_steroids_prem_dexamethasone = pd.unique(</span>
                <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Dexamethasone 5mg/ml, 5ml_each_CMST&#39;, &#39;Item_Code&#39;])[0]</span>
                <span class="c1"># item_code_steroids_prem_betamethasone = pd.unique(</span>
                <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Betamethasone, 12 mg injection&#39;, &#39;Item_Code&#39;])[0]</span>
                <span class="n">item_code_steroids_prem_dexamethasone</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">item_code_steroids_prem_betamethasone</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># consumables_steriod_preterm = {</span>
                <span class="c1">#     &#39;Intervention_Package_Code&#39;: {},</span>
                <span class="c1">#     &#39;Item_Code&#39;: {item_code_steroids_prem_dexamethasone: 1, item_code_steroids_prem_betamethasone: 1}}</span>

                <span class="c1"># outcome_of_request_for_consumables = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
                <span class="c1">#     hsi_event=hsi_event,</span>
                <span class="c1">#     cons_req_as_footprint=consumables_steriod_preterm)</span>
                <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
                <span class="p">}</span>

                <span class="c1"># If available they are given. Antenatal steriods reduce a preterm newborns chance of developing</span>
                <span class="c1"># respiratory distress syndrome and of death associated with prematurity</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span>
                    <span class="n">item_code_steroids_prem_dexamethasone</span><span class="p">])</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_steroids_prem_betamethasone</span><span class="p">]):</span>

                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This facility has provided corticosteroids for mother &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> who is in preterm labour&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This facility has no steroids for women in preterm labour.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_severe_pre_eclampsia_mgso4"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_severe_pre_eclampsia_mgso4">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_severe_pre_eclampsia_mgso4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function represents the diagnosis and management of severe pre-eclampsia during labour. This function</span>
<span class="sd">        defines the required consumables, uses the dx_test to determine a woman with severe pre-eclampsia is correctly</span>
<span class="sd">        identified, and administers the intervention if so. The intervention is intravenous magnesium sulphate.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># Women who have been admitted for delivery due to severe pre-eclampsia AND have already received magnesium</span>
        <span class="c1"># before moving to the labour ward do not receive the intervention again</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                        <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has already received magnesium therapy following &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; to the antenatal ward prior to onset of labour &#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_severe_pre_eclampsia&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define the required consumables</span>
            <span class="c1"># pkg_code_severe_pre_eclampsia = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Management of eclampsia&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>
            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_severe_pre_eclampsia])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Here we run a dx_test function to determine if the birth attendant will correctly identify this womans</span>
            <span class="c1"># severe pre-eclampsia, and therefore administer treatment</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;severe_pe_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># If so, and the consumables are available - the intervention is delivered. IV magnesium reduces the</span>
                <span class="c1"># probability that a woman with severe pre-eclampsia will experience eclampsia in labour</span>
                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_severe_pre_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has has their severe pre-eclampsia &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;identified during delivery. As consumables are available &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;they will receive treatment&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their severe pre-eclampsia &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;identified during delivery and will not be treated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_hypertension"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_hypertension">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of hypertension during labour. This function</span>
<span class="sd">        defines the required consumables, uses the dx_test to determine a woman with hypertension is correctly</span>
<span class="sd">        identified, and administers the intervention if so. The intervention is intravenous antihypertensives.</span>
<span class="sd">        It is called by HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_hypertension&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># item_code_hydralazine = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Hydralazine, powder for injection, 20 mg ampoule&#39;,</span>
            <span class="c1">#                     &#39;Item_Code&#39;])[0]</span>
            <span class="c1"># item_code_wfi = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Water for injection, 10ml_Each_CMST&#39;, &#39;Item_Code&#39;])[0]</span>
            <span class="c1"># item_code_needle = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Syringe, needle + swab&#39;, &#39;Item_Code&#39;])[0]</span>
            <span class="c1"># item_code_gloves = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] == &#39;Gloves, exam, latex, disposable, pair&#39;, &#39;Item_Code&#39;])[0]</span>

            <span class="n">item_code_hydralazine</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item_code_wfi</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item_code_needle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># consumables_gest_htn_treatment = {</span>
            <span class="c1">#     &#39;Intervention_Package_Code&#39;: {},</span>
            <span class="c1">#     &#39;Item_Code&#39;: {item_code_hydralazine: 1,</span>
            <span class="c1">#                   item_code_wfi: 1,</span>
            <span class="c1">#                   item_code_gloves: 1,</span>
            <span class="c1">#                   item_code_needle: 1}}</span>

            <span class="c1"># Then query if these consumables are available during this HSI</span>
            <span class="c1"># outcome_of_request_for_consumables = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
            <span class="c1">#     hsi_event=hsi_event,</span>
            <span class="c1">#     cons_req_as_footprint=consumables_gest_htn_treatment)</span>
            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;hypertension_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># If they are available then the woman is started on treatment. Intravenous antihypertensive reduce a</span>
                <span class="c1"># womans risk of progression from mild to severe gestational hypertension ANd reduce risk of death for</span>
                <span class="c1"># women with severe pre-eclampsia and eclampsia</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hydralazine</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_wfi</span><span class="p">])</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">]):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_maternal_hypertension_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has has their hypertension identified during &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;delivery. As consumables are available they will receive&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39; treatment&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their hypertension identified during &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery and will not be treated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_eclampsia"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_eclampsia">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of eclampsia during or following labour. This function</span>
<span class="sd">        defines the required consumables, uses the dx_test to determine a woman with eclampsia is correctly</span>
<span class="sd">        identified, and administers the intervention if so. The intervention is intravenous magnesium sulphate.</span>
<span class="sd">        It is called by either HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        or HSI_Labour_ReceivesCareForPostpartumPeriod</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_eclampsia&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pkg_code_eclampsia = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Management of eclampsia&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_eclampsia])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;eclampsia_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                    <span class="c1"># Treatment with magnesium reduces a womans risk of death from eclampsia</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_eclampsia_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has has their eclampsia identified during &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;delivery. As consumables are available they will receive &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their eclampsia identified &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;during delivery and will not be treated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_obstructed_labour_via_avd"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_obstructed_labour_via_avd">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_obstructed_labour_via_avd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of obstructed labour during labour. This function</span>
<span class="sd">        defines the required consumables, uses the dx_test to determine a woman with obstructed labour is correctly</span>
<span class="sd">        identified, and administers the intervention if so. The intervention in this function is assisted vaginal</span>
<span class="sd">        delivery. It is called by either HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_obstructed_labour&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pkg_code_obstructed_labour = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Management of obstructed labour&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>
            <span class="c1"># item_code_forceps = pd.unique(consumables.loc[consumables[&#39;Items&#39;] ==</span>
            <span class="c1"># &#39;Forceps, obstetric&#39;, &#39;Item_Code&#39;])[0]</span>
            <span class="c1"># item_code_vacuum = pd.unique(consumables.loc[consumables[&#39;Items&#39;] == &#39;Vacuum, obstetric&#39;, &#39;Item_Code&#39;])[0]</span>
            <span class="n">pkg_code_obstructed_labour</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item_code_forceps</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">item_code_vacuum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># consumables_obstructed_labour = {&#39;Intervention_Package_Code&#39;: {pkg_code_obstructed_labour: 1},</span>
            <span class="c1">#                                  &#39;Item_Code&#39;: {item_code_forceps: 1, item_code_vacuum: 1}}</span>

            <span class="c1"># outcome_of_request_for_consumables_ol = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
            <span class="c1">#     hsi_event=hsi_event,</span>
            <span class="c1">#     cons_req_as_footprint=consumables_obstructed_labour)</span>
            <span class="n">outcome_of_request_for_consumables_ol</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;obstructed_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;labour_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># If the general package is available AND the facility has the correct tools to carry out the delivery</span>
                <span class="c1"># then it can occur</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables_ol</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">][</span><span class="n">pkg_code_obstructed_labour</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="p">((</span><span class="n">outcome_of_request_for_consumables_ol</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_forceps</span><span class="p">])</span> <span class="ow">or</span>
                         <span class="p">(</span><span class="n">outcome_of_request_for_consumables_ol</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_vacuum</span><span class="p">])):</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has had her obstructed labour identified&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;during delivery. Staff will attempt an assisted vaginal delivery&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;as the equipment is available&#39;</span><span class="p">)</span>

                    <span class="c1"># We assume women with CPD cannot be delivered via AVD and will require a caesarean</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_obstructed_labour</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                        <span class="n">treatment_success</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">treatment_success</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_successful_assisted_vaginal_delivery&#39;</span><span class="p">]</span> <span class="o">&gt;</span> \
                                            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

                    <span class="c1"># If AVD was successful then we record the mode of delivery. We use this variable to reduce risk of</span>
                    <span class="c1"># intrapartum still birth when applying risk in the death event</span>
                    <span class="k">if</span> <span class="n">treatment_success</span><span class="p">:</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrumental&#39;</span>

                    <span class="c1"># Otherwise if the delivery is unsuccessful woman will be referred for a caesarean</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Following a failed assisted vaginal delivery other &#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will need additional treatment&#39;</span><span class="p">)</span>

                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their obstructed labour identified &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;during delivery and will not be treated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_maternal_sepsis"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_maternal_sepsis">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">,</span> <span class="n">labour_stage</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of maternal sepsis during or following labour. This</span>
<span class="sd">        function defines the required consumables, uses the dx_test to determine a woman with sepsis is correctly</span>
<span class="sd">        identified, and administers the intervention if so. The intervention in this function is maternal sepsis case</span>
<span class="sd">        management. It is called by either HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        or HSI_Labour_ReceivesCareForPostpartumPeriod</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        :param labour_stage: intrapartum or postpartum period of labour (STR) &#39;ip&#39; or &#39;pp&#39;:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_maternal_sepsis&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pkg_code_sepsis = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Maternal sepsis case management&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_sepsis])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;sepsis_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labour_stage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># If delivered this intervention reduces a womans risk of dying from sepsis</span>
                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has has their sepsis identified during &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;delivery. As consumables are available they will receive &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span>

                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their sepsis identified during &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery and will not be treated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_plan_for_antepartum_haemorrhage"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_plan_for_antepartum_haemorrhage">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_plan_for_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis of antepartum haemorrhage during  labour. This</span>
<span class="sd">        function uses the dx_test to determine a woman with antepartum haemorrhage is correctly identified, and ensure</span>
<span class="sd">        that woman is referred for comprehensive care via caesarean section and blood transfusion.</span>
<span class="sd">        It is called by either HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_plan_for_referral_antepartum_haemorrhage&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We assume that any woman who has been referred from antenatal inpatient care due to haemorrhage are</span>
            <span class="c1"># automatically scheduled for blood transfusion</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;ac_admitted_for_immediate_&#39;</span>
                                                                                    <span class="s1">&#39;delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> who was admitted for treatment following an &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;antepartum haemorrhage will be referred for treatment &#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Otherwise the same format is followed, women are evaluated via the dx_test function. If bleeding is</span>
                <span class="c1"># determined then they will be referred for caesarean delivery</span>

                <span class="c1"># Caesarean delivery reduces the risk of intrapartum still birth and blood transfusion reduces the risk</span>
                <span class="c1"># of maternal death due to bleeding</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                           <span class="sa">f</span><span class="s1">&#39;aph_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                           <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has has their antepartum haemorrhage &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;identified during delivery. They will now be referred for &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;additional treatment&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their antepartum haemorrhage &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;identified during delivery and will not be referred for &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;treatment&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_for_referral_uterine_rupture"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_for_referral_uterine_rupture">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_for_referral_uterine_rupture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis of uterine rupture during  labour. This</span>
<span class="sd">        function uses the dx_test to determine a woman with uterine rupture is correctly identified, and ensure</span>
<span class="sd">        that woman is referred for comprehensive care via caesarean section, surgical repair and blood transfusion.</span>
<span class="sd">        It is called by either HSI_Labour_PresentsForSkilledBirthAttendanceInLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_plan_for_referral_uterine_rupture&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;uterine_&#39;</span>
                                                                                       <span class="sa">f</span><span class="s1">&#39;rupture_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;mother </span><span class="si">%d</span><span class="s1"> has has their uterine rupture identified during delivery. &#39;</span>
                                                 <span class="s1">&#39;They will now be referred for additional treatment&#39;</span><span class="p">)</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had their uterine_rupture identified &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;during delivery and will not be referred for treatment&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.active_management_of_the_third_stage_of_labour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.active_management_of_the_third_stage_of_labour">[docs]</a>    <span class="k">def</span> <span class="nf">active_management_of_the_third_stage_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the administration of active management of the third stage of labour. This</span>
<span class="sd">        function checks the availibility of consumables and delivers the intervention accordingly. It is called by</span>
<span class="sd">        HSI_Labour_PresentsForSkilledBirthAttendanceFollowingLabour</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;active_management_of_the_third_stage_of_labour&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pkg_code_am = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Active management of the 3rd stage of labour&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_am])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># This treatment reduces a womans risk of developing uterine atony AND retained placenta, both of which are</span>
            <span class="c1"># preceding causes of postpartum haemorrhage</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive active management of the third &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;stage of labour&#39;</span><span class="p">)</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive active management of the third &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;stage of labour&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_pph_uterine_atony"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_pph_uterine_atony">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_pph_uterine_atony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of postpartum haemorrhage secondary to uterine atony</span>
<span class="sd">        following labour. This function defines the required consumables, uses the dx_test to determine a woman with</span>
<span class="sd">        PPH/UA is correctly identified, and administers the intervention if so. The intervention in this function is</span>
<span class="sd">        intravenous uterotonics followed by referral for further care in the event of continued haemorrhage.</span>
<span class="sd">         It is called by HSI_Labour_ReceivesCareForPostpartumPeriod</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_pph_uterine_atony&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># pkg_code_pph = pd.unique(</span>
            <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Treatment of postpartum hemorrhage&#39;,</span>
            <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># consumables_needed_pph = {&#39;Intervention_Package_Code&#39;: {pkg_code_pph: 1}, &#39;Item_Code&#39;: {}}</span>

            <span class="c1"># outcome_of_request_for_consumables_pph = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
            <span class="c1">#     hsi_event=hsi_event,</span>
            <span class="c1">#     cons_req_as_footprint=consumables_needed_pph)</span>
            <span class="n">outcome_of_request_for_consumables_pph</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_pph_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">outcome_of_request_for_consumables_pph</span><span class="p">:</span>

                    <span class="c1"># We apply a probability that this treatment will stop a womans bleeding in the first instance</span>
                    <span class="c1"># meaning she will not require further treatment</span>
                    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_haemostatis_uterotonics&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> received uterotonics for her PPH which has &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;resolved&#39;</span><span class="p">)</span>

                        <span class="c1"># We store the treatment in a bitset column, where it will be used to reduce risk of death</span>
                        <span class="c1"># after PPH. Additionally she is referred for blood which also reduces risk of death</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;uterotonics&#39;</span><span class="p">)</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># If uterotonics do not stop bleeding the woman is referred for additional treatment</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> received uterotonics for her PPH which has not&#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39; resolved and she will need additional treatment&#39;</span><span class="p">)</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Labour.assessment_and_treatment_of_pph_retained_placenta"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.assessment_and_treatment_of_pph_retained_placenta">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_and_treatment_of_pph_retained_placenta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">facility_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the diagnosis and management of postpartum haemorrhage secondary to retained placenta</span>
<span class="sd">        following labour. This function defines the required consumables, uses the dx_test to determine a woman with</span>
<span class="sd">        PPH/RP is correctly identified, and administers the intervention if so. The intervention in this function is</span>
<span class="sd">        manual removal of placenta (bedside) followed by referral for further care in the event of continued</span>
<span class="sd">        haemorrhage. It is called by HSI_Labour_ReceivesCareForPostpartumPeriod</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        :param facility_type: type of facility this intervention is being delivered in</span>
<span class="sd">        (STR) &#39;hc&#39; == health centre, &#39;hp&#39; == hospital</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;assessment_and_treatment_of_pph_retained_placenta&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pkg_code_pph = pd.unique(consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Treatment of postpartum &#39;</span>
            <span class="c1">#                                                                             &#39;hemorrhage&#39;,</span>
            <span class="c1">#                                          &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = hsi_event.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_pph])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;assess_pph_</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>

                    <span class="c1"># Similar to uterotonics we apply a probability that this intervention will successfully stop</span>
                    <span class="c1"># bleeding to ensure some women go on to require further care</span>
                    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_successful_manual_removal_placenta&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> undergone MRP due to retained placenta and &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;her PPH has resolved&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">)</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> undergone MRP due to retained placenta and her PPH has &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;not resolved- she will need further treatment&#39;</span><span class="p">)</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Labour.surgical_management_of_pph"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.surgical_management_of_pph">[docs]</a>    <span class="k">def</span> <span class="nf">surgical_management_of_pph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the surgical management of postpartum haemorrhage (all-cause) following labour. This</span>
<span class="sd">        function is either called during HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare or</span>
<span class="sd">        HSI_Labour_ReceivesCareFollowingCaesareanSection for women who have PPH and medical management has failed.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
           <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;uterotonics&#39;</span><span class="p">):</span>

            <span class="c1"># We apply a probability that surgical techniques will be effective</span>
            <span class="n">treatment_success_pph</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;success_rate_pph_surgery&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="c1"># And store the treatment which will dramatically reduce risk of death</span>
            <span class="k">if</span> <span class="n">treatment_success_pph</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> undergone surgery to manage her PPH which resolved&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">)</span>

            <span class="c1"># If the treatment is unsuccessful then women will require a hysterectomy to stop the bleeding</span>
            <span class="k">elif</span> <span class="o">~</span><span class="n">treatment_success_pph</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> undergone surgery to manage her PPH, she required&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; a hysterectomy to stop the bleeding&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hysterectomy&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Next we apply the effect of surgical treatment for women with retained placenta</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause_of_primary_pph</span><span class="o">.</span><span class="n">has_any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;manual_removal_placenta&#39;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pph_treatment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;surgery&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> undergone surgical removal of a retained placenta &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.blood_transfusion"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.blood_transfusion">[docs]</a>    <span class="k">def</span> <span class="nf">blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function represents the blood transfusion during or after labour. This</span>
<span class="sd">        function is either called during HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare or</span>
<span class="sd">        HSI_Labour_ReceivesCareFollowingCaesareanSection for women who have experience blood loss due to antepartum</span>
<span class="sd">        haemorrhage, postpartum haemorrhage or uterine rupture</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># item_code_bt1 = pd.unique(consumables.loc[consumables[&#39;Items&#39;] == &#39;Blood, one unit&#39;, &#39;Item_Code&#39;])[0]</span>
        <span class="c1"># item_code_bt2 = \</span>
        <span class="c1">#     pd.unique(consumables.loc[consumables[&#39;Items&#39;] == &#39;Lancet, blood, disposable&#39;, &#39;Item_Code&#39;])[0]</span>
        <span class="c1"># item_code_bt3 = pd.unique(consumables.loc[consumables[&#39;Items&#39;] == &#39;Test, hemoglobin&#39;, &#39;Item_Code&#39;])[0]</span>
        <span class="c1"># item_code_bt4 = pd.unique(consumables.loc[consumables[&#39;Items&#39;] == &#39;IV giving/infusion set, with needle&#39;,</span>
        <span class="c1">#                                           &#39;Item_Code&#39;])[0]</span>
        <span class="n">item_code_bt1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">item_code_bt2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">item_code_bt3</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">item_code_bt4</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># consumables_needed_bt = {&#39;Intervention_Package_Code&#39;: {}, &#39;Item_Code&#39;: {item_code_bt1: 2, item_code_bt2: 1,</span>
        <span class="c1">#                                                                         item_code_bt3: 1, item_code_bt4: 2}}</span>

        <span class="c1"># outcome_of_request_for_consumables = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
        <span class="c1">#     hsi_event=hsi_event, cons_req_as_footprint=consumables_needed_bt)</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># If they&#39;re available, the event happens</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_bt1</span><span class="p">])</span> \
            <span class="ow">and</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_bt2</span><span class="p">])</span> \
            <span class="ow">and</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_bt3</span><span class="p">])</span> \
           <span class="ow">and</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_bt4</span><span class="p">]):</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received a blood transfusion due following a&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; maternal haemorrhage&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> was unable to receive a blood transfusion due to &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;insufficient consumables&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Labour.interventions_delivered_pre_discharge"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.Labour.interventions_delivered_pre_discharge">[docs]</a>    <span class="k">def</span> <span class="nf">interventions_delivered_pre_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the interventions that are delivered to women prior to discharge. This are considered</span>
<span class="sd">        part of essential postnatal care and currently include testing for HIV and postnatal iron and folic acid</span>
<span class="sd">        supplementation. It is called by HSI_Labour_ReceivesCareForPostpartumPeriod</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hv_diagnosed&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">HSI_Hiv_TestAndRefer</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]),</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ------------------------------- Postnatal iron and folic acid ---------------------------------------------</span>
        <span class="c1"># item_code_iron_folic_acid = pd.unique(</span>
        <span class="c1">#     consumables.loc[consumables[&#39;Items&#39;] ==</span>
        <span class="c1">#     &#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;, &#39;Item_Code&#39;])[0]</span>
        <span class="n">item_code_iron_folic_acid</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># consumables_iron = {</span>
        <span class="c1">#     &#39;Intervention_Package_Code&#39;: {},</span>
        <span class="c1">#     &#39;Item_Code&#39;: {item_code_iron_folic_acid: 93}}</span>

        <span class="c1"># Check there availability</span>
        <span class="c1"># outcome_of_request_for_consumables = self.sim.modules[&#39;HealthSystem&#39;].request_consumables(</span>
        <span class="c1">#     hsi_event=hsi_event,</span>
        <span class="c1">#     cons_req_as_footprint=consumables_iron)</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Women are started on iron and folic acid for the next three months which reduces risk of anaemia in the</span>
        <span class="c1"># postnatal period</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_iron_folic_acid</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_iron_folic_acid_postnatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div></div>

        <span class="c1"># TODO: link up with Tara and EPI module to code postnatal immunisation</span>


<div class="viewcode-block" id="LabourOnsetEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent">[docs]</a><span class="k">class</span> <span class="nc">LabourOnsetEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the LabourOnsetEvent. It is scheduled by the set_date_of_labour function for all women who are newly</span>
<span class="sd">    pregnant. It represents the start of a womans labour and is the first event all woman who are going to give birth</span>
<span class="sd">    pass through - regardless of mode of delivery or if they are already an inpatient. This event performs a number of</span>
<span class="sd">    different functions including populating the mni dictionary to store additional variables important to labour</span>
<span class="sd">    and HSIs, determining if and where a woman will seek care for delivery, schedules the LabourAtHome event and the</span>
<span class="sd">    HSI_Labour_PresentsForSkilledAttendance at birth (depending on care seeking), the BirthEvent and the</span>
<span class="sd">    LabourDeathEvent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourOnsetEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="LabourOnsetEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourOnsetEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># First we use this check to determine if labour can precede (includes checks on is_alive)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_labour_can_proceed</span><span class="p">(</span><span class="n">individual_id</span><span class="p">):</span>

            <span class="c1"># We indicate this woman is now in labour using this property, and by adding her individual ID to our</span>
            <span class="c1"># labour list (for testing)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">women_in_labour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># We then run the labour_characteristics_checker as a final check that only appropriate women are here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># Append labor specific variables to the mni</span>
            <span class="n">labour_variables</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;labour_state&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="c1"># Term Labour (TL), Early Preterm (EPTL), Late Preterm (LPTL) or Post Term (POTL)</span>
                                <span class="s1">&#39;delivery_setting&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># home_birth, health_centre, hospital</span>
                                <span class="s1">&#39;twin_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s1">&#39;twin_one_comps&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;sought_care_for_twin_one&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;bf_status_twin_one&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;eibf_status_twin_one&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;delayed_pp_infection&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;onset_of_delayed_inf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s1">&#39;corticosteroids_given&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;clean_birth_practices&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;abx_for_pprom_given&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;amtsl_given&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">:</span> <span class="s1">&#39;vaginal_delivery&#39;</span><span class="p">,</span>
                                <span class="c1"># vaginal_delivery, instrumental, caesarean_section</span>
                                <span class="s1">&#39;squeeze_to_high_for_hsi&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;squeeze_to_high_for_hsi_pp&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;sought_care_labour_phase&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># none, intrapartum, postpartum</span>
                                <span class="s1">&#39;referred_for_cs&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;referred_for_blood&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;received_blood_transfusion&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)&#39;</span>
                                <span class="s1">&#39;death_in_labour&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;cause_of_death_in_labour&#39;</span><span class="p">:</span> <span class="p">[],</span>
                                <span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="s1">&#39;death_postpartum&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># True (T) or False (F)</span>
                                <span class="p">}</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">labour_variables</span><span class="p">)</span>

            <span class="c1"># ===================================== LABOUR STATE  =====================================================</span>
            <span class="c1"># Next we categories each woman according to her gestation age at delivery. These categories include term</span>
            <span class="c1"># (37-42 weeks gestational age), post term (42 weeks plus), early preterm (24-33 weeks) and late preterm</span>
            <span class="c1"># (34-36 weeks)</span>

            <span class="c1"># First we calculate foetal age - days from conception until todays date and then add 2 weeks to calculate</span>
            <span class="c1"># gestational age</span>
            <span class="n">foetal_age_in_days</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;date_of_last_pregnancy&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
            <span class="n">gestational_age_in_days</span> <span class="o">=</span> <span class="n">foetal_age_in_days</span> <span class="o">+</span> <span class="mi">14</span>

            <span class="c1"># We use parameters containing the upper and lower limits, in days, that a mothers pregnancy has to be to be</span>
            <span class="c1"># categorised accordingly</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_limit_term_days&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_limit_term_days&#39;</span><span class="p">]:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;term_labour&#39;</span>

            <span class="c1"># Here we allow a woman to go into early preterm labour with a gestational age of 23 (limit is 24) to</span>
            <span class="c1"># account for PregnancySupervisor only updating weekly</span>
            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_limit_early_preterm_days&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_limit_early_&#39;</span>
                                                                                               <span class="s1">&#39;preterm_days&#39;</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;early_preterm_labour&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;early_preterm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_has_previously_delivered_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_limit_late_preterm_days&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gestational_age_in_days</span> <span class="o">&lt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_limit_late_&#39;</span>
                                                                                              <span class="s1">&#39;preterm_days&#39;</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;late_preterm_labour&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;late_preterm&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_has_previously_delivered_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">gestational_age_in_days</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_limit_postterm_days&#39;</span><span class="p">]:</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;postterm_labour&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;post_term&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># We check all women have had their labour state set</span>
            <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">labour_state</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;labour_state&#39;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent, person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has now gone into &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labour_state</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># ===================================== CARE SEEKING AND DELIVERY SETTING ================================</span>
            <span class="c1"># Next we determine if women who are now in labour will seek care for delivery. We assume women who have</span>
            <span class="c1"># been admitted antenatally for delivery will be delivering in hospital and that is scheduled accordingly</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                <span class="c1"># Here we calculate this womans predicted risk of home birth and health centre birth</span>
                <span class="n">pred_hb_delivery</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="s1">&#39;probability_delivery_at_home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>
                <span class="n">pred_hc_delivery</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="s1">&#39;probability_delivery_health_centre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="c1"># The denominator is calculated</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">pred_hb_delivery</span> <span class="o">+</span> <span class="n">pred_hc_delivery</span>

                <span class="c1"># Followed by the probability of each of the three outcomes - home birth, health centre birth or</span>
                <span class="c1"># hospital birth</span>
                <span class="n">prob_hb</span> <span class="o">=</span> <span class="n">pred_hb_delivery</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">prob_hc</span> <span class="o">=</span> <span class="n">pred_hc_delivery</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">prob_hp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>

                <span class="c1"># And a probability weighted random draw is used to determine where the woman will deliver</span>
                <span class="n">facility_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;home_birth&#39;</span><span class="p">,</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital&#39;</span><span class="p">]</span>

                <span class="c1"># This allows us to simply manipulate care seeking during labour test file</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;test_run&#39;</span><span class="p">]:</span>
                    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;test_care_seeking_probs&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">prob_hb</span><span class="p">,</span> <span class="n">prob_hc</span><span class="p">,</span> <span class="n">prob_hp</span><span class="p">]</span>

                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">facility_types</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We assume all women with complications will deliver in a hospital</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hospital&#39;</span>

            <span class="c1"># Check all women&#39;s &#39;delivery setting&#39; is set</span>
            <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="c1"># Women delivering at home move the the LabourAtHomeEvent as they will not receive skilled birth attendance</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent, person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> as they has chosen &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;not to seek care at a health centre for delivery and will give birth &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;at home on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Otherwise the appropriate HSI is scheduled</span>
            <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
                <span class="n">health_centre_delivery</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="s1">&#39;1a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">health_centre_delivery</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent, scheduling &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;HSI_Labour_PresentsForSkilledAttendanceInLabour on date &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> for person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> as they have chosen to &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;seek care at a health centre for delivery&#39;</span><span class="p">)</span>

            <span class="c1"># TODO: hospital care could be delivered at level 1,2 or 3 but at the moment it made sense to limit to</span>
            <span class="c1">#  1 and 2. need to look at the data to make sure the right number of women are at district hospitals</span>
            <span class="c1">#  versus higher level hospitals</span>

            <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
                <span class="n">facility_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1a&#39;</span><span class="p">,</span> <span class="s1">&#39;1b&#39;</span><span class="p">])</span>  <span class="c1"># todo note choice</span>
                <span class="n">hospital_delivery</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">hospital_delivery</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent, scheduling &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;HSI_Labour_PresentsForSkilledAttendanceInLabour on date &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> for person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> as they have chosen to &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;seek care at a hospital for delivery&#39;</span><span class="p">)</span>

            <span class="c1"># ======================================== SCHEDULING BIRTH AND DEATH EVENTS ============================</span>
            <span class="c1"># We schedule all women to move through both the death and birth event.</span>

            <span class="c1"># The death event is scheduled to happen after a woman has received care OR delivered at home to allow for</span>
            <span class="c1"># any treatment effects to mitigate risk of poor outcomes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourDeathAndStillBirthEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span>
                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent scheduling a potential death for mother &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> which will occur on&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># After the death event women move to the Birth Event where, for surviving women and foetus, birth occurs</span>
            <span class="c1"># in the simulation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">BirthEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourOnsetEvent scheduling a birth on date to mother&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> which will occur on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LabourAtHomeEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent">[docs]</a><span class="k">class</span> <span class="nc">LabourAtHomeEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the LabourAtHomeEvent. It is scheduled by the LabourOnsetEvent for women who will not</span>
<span class="sd">    seek care at a health facility. This event applies the probability that women delivering at home will experience</span>
<span class="sd">    complications associated with the intrapartum phase of labour and makes the appropriate changes to the data frame.</span>
<span class="sd">     Additionally this event applies a probability that women who develop complications during a home birth may choose</span>
<span class="sd">     to seek care from at a health facility. In that case the appropriate HSI is scheduled</span>
<span class="sd">     &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourAtHomeEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="LabourAtHomeEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourAtHomeEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Check only women delivering at home pass through this event and that the right characteristics are present</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">  is now going to deliver at home&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;home_birth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># ===================================  APPLICATION OF COMPLICATIONS ===========================================</span>
        <span class="c1"># Using the complication_application function we loop through each complication and determine if a woman</span>
        <span class="c1"># will experience any of these if she has delivered at home</span>

        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="s1">&#39;malpresentation&#39;</span><span class="p">,</span> <span class="s1">&#39;malposition&#39;</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="c1"># And we determine if any existing hypertensive disorders would worsen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">)</span>

        <span class="c1"># ==============================  CARE SEEKING FOLLOWING COMPLICATIONS ========================================</span>
        <span class="c1"># Next we determine if women who develop a complication during a home birth will seek care</span>

        <span class="c1"># (Women who have been scheduled a home birth after seeking care at a facility that didnt have capacity to</span>
        <span class="c1"># deliver the HSI will not try to seek care if they develop a complication)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;squeeze_to_high_for_hsi&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_for_complication&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">):</span>

                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_labour_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;intrapartum&#39;</span>

                    <span class="c1"># We assume women present to the health system through the generic a&amp;e appointment</span>
                    <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="p">(</span>
                        <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">(</span>
                        <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                        <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will now seek care for a complication&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39; that has developed during labour&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span>
                                                                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will not seek care following a &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;complication that has developed during labour&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BirthEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthEvent">[docs]</a><span class="k">class</span> <span class="nc">BirthEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the BirthEvent. It is scheduled by LabourOnsetEvent. For women who survived labour, the appropriate</span>
<span class="sd">    variables are reset/updated and the function do_birth is executed. This event schedules PostPartumLabourEvent for</span>
<span class="sd">    those women who have survived&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BirthEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="BirthEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.BirthEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># This event tells the simulation that the woman&#39;s pregnancy is over and generates the new child in the</span>
        <span class="c1"># data frame</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> at birth event&#39;</span><span class="p">)</span>

        <span class="c1"># Check the correct amount of time has passed between labour onset and birth event and that women at the event</span>
        <span class="c1"># have the right characteristics present</span>

        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

        <span class="c1"># =============================================== BIRTH ====================================================</span>
        <span class="c1"># If the mother is alive and still pregnant we generate a  child and the woman is scheduled to move to the</span>
        <span class="c1"># postpartum event to determine if she experiences any additional complications (intrapartum stillbirths still</span>
        <span class="c1"># trigger births for monitoring purposes)</span>

        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A Birth is now occurring, to mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># If the mother is pregnant with twins, we call the do_birth function twice and then link the twins</span>
            <span class="c1"># (via sibling id) in the newborn module</span>
            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ps_multiple_pregnancy</span><span class="p">:</span>
                <span class="n">child_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
                <span class="n">child_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> will now deliver twins </span><span class="si">{</span><span class="n">child_one</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">child_two</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">link_twins</span><span class="p">(</span><span class="n">child_one</span><span class="p">,</span> <span class="n">child_two</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>

            <span class="c1"># ====================================== SCHEDULING POSTPARTUM EVENTS ======================================</span>
            <span class="c1"># Women who have birth at home will next pass to this event, again applying risk of complications</span>
            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostpartumLabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is BirthEvent scheduling PostpartumLabourAtHomeEvent for &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Otherwise we scheduled the next HSI event that manages care immediately after birth</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Women who have delivered vaginally pass to HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour</span>
                <span class="c1"># for management of the postpartum period</span>
                <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vaginal_delivery&#39;</span> <span class="ow">or</span> \
                  <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;instrumental&#39;</span><span class="p">:</span>

                    <span class="n">health_centre_care</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="s1">&#39;1a&#39;</span><span class="p">)</span>

                    <span class="n">all_facility_care</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">,</span>
                        <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1a&#39;</span><span class="p">,</span> <span class="s1">&#39;1b&#39;</span><span class="p">])</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is BirthEvent scheduling HSI_Labour_ReceivesCareFor&#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39;PostpartumPeriod for person </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> on date&#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">health_centre_care</span><span class="p">,</span>
                                                                            <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is BirthEvent scheduling &#39;</span>
                                                        <span class="s1">&#39;HSI_Labour_ReceivesCareForPostpartumPeriod for person &#39;</span>
                                                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">all_facility_care</span><span class="p">,</span>
                                                                            <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Women who delivered via c-section are scheduled to a different HSI</span>
                    <span class="n">post_cs_care</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesCareFollowingCaesareanSection</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">,</span>
                        <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;1a&#39;</span><span class="p">,</span> <span class="s1">&#39;1b&#39;</span><span class="p">]))</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is BirthEvent scheduling &#39;</span>
                                                    <span class="sa">f</span><span class="s1">&#39;HSI_Labour_ReceivesCareFollowingCaesareanSection for person &#39;</span>
                                                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1">who gave birth via caesarean section  on date &#39;</span>
                                                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">post_cs_care</span><span class="p">,</span>
                                                                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># If the mother has died during childbirth the child is still generated with is_alive=false to monitor</span>
        <span class="c1"># stillbirth rates. She will not pass through the postpartum complication events</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="o">~</span><span class="n">person</span><span class="o">.</span><span class="n">la_intrapartum_still_birth</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">la_maternal_death_in_labour</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A Birth is now occurring, to mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> who died in childbirth &#39;</span>
                                            <span class="sa">f</span><span class="s1">&#39;but her child survived&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ps_multiple_pregnancy</span><span class="p">:</span>
                <span class="n">child_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
                <span class="n">child_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">link_twins</span><span class="p">(</span><span class="n">child_one</span><span class="p">,</span> <span class="n">child_two</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">do_birth</span><span class="p">(</span><span class="n">mother_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PostpartumLabourAtHomeEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.PostpartumLabourAtHomeEvent">[docs]</a><span class="k">class</span> <span class="nc">PostpartumLabourAtHomeEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is PostpartumLabourAtHomeEvent. This event is scheduled by BirthEvent for women whose laboured and gave</span>
<span class="sd">    birth at home OR HSI_Labour_ReceivesCareForPostpartumPeriod for women who couldnt receive in-facility postpartum</span>
<span class="sd">    care due to high squeeze factor. This event applies risk of postpartum complications and determines if women</span>
<span class="sd">    experiencing complications will seek care. Finally is calls the apply_risk_of_early_postpartum_death function to</span>
<span class="sd">     determine if women experiencing the postpartum phase of labour at home will die.</span>
<span class="sd">     &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PostpartumLabourAtHomeEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.PostpartumLabourAtHomeEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostpartumLabourAtHomeEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.PostpartumLabourAtHomeEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postpartum_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Event should only run if woman is still alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has arrived at PostpartumLabourAtHomeEvent and it &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;will run&#39;</span><span class="p">)</span>

        <span class="c1"># We first determine if this woman will experience any complications immediately following/ or in the days after</span>
        <span class="c1"># birth</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>

        <span class="c1"># For women who experience a complication at home immediately following birth we use a care seeking equation to</span>
        <span class="c1"># determine if they will now seek additional care for management of this complication</span>

        <span class="c1"># Women who have come home, following a facility delivery, due to high squeeze will not try and seek care</span>
        <span class="c1"># for any complications</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis_pp&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                       <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;squeeze_to_high_for_hsi_pp&#39;</span><span class="p">]</span> <span class="ow">and</span>\
              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_for_complication&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">)):</span>

                <span class="c1"># If this woman choses to seek care, she will present to the health system via the generic emergency</span>
                <span class="c1"># system and be referred on to receive specific care</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;sought_care_labour_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;postpartum&#39;</span>

                <span class="kn">from</span> <span class="nn">tlo.methods.hsi_generic_first_appts</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_GenericEmergencyFirstApptAtFacilityLevel1</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                        <span class="n">event</span><span class="p">,</span>
                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will now seek care for a complication that&#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;has developed following labour on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will not seek care for a complication that&#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;has developed following labour on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># For women who dont seek care for complications following birth we immediately apply risk of death</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Women without complications still pass through this event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LabourDeathAndStillBirthEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent">[docs]</a><span class="k">class</span> <span class="nc">LabourDeathAndStillBirthEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the LabourDeathAndStillBirthEvent. It is scheduled by the LabourOnsetEvent for all women in the labour</span>
<span class="sd">    module following the application of complications (and possibly treatment) for women who have given birth at home</span>
<span class="sd">    OR in a facility . This event determines if women who have experienced complications in labour will die or</span>
<span class="sd">    experience an intrapartum stillbirth.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourDeathAndStillBirthEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="LabourDeathAndStillBirthEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourDeathAndStillBirthEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Check the correct amount of time has passed between labour onset and postpartum event</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># We cycle through each complication and apply risk of death using the set_maternal_death_status_intrapartum</span>
        <span class="c1"># described above</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_antepartum_haemorrhage&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span>
             <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;sepsis&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_maternal_death_status_intrapartum</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;uterine_rupture&#39;</span><span class="p">)</span>

        <span class="c1"># Next we determine if this woman will experience an intrapartum still birth. We assume any women who have had</span>
        <span class="c1"># to deliver before 24 weeks will experience stillbirth</span>

        <span class="c1"># Otherwise all woman have a risk of still birth applied which is increased by complications in labour.</span>
        <span class="c1"># Treatment modelled to reduce risk of intrapartum stillbirth include assisted vaginal delivery and</span>
        <span class="c1"># caesarean section</span>

        <span class="n">outcome_of_still_birth_equation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;la_labour_equations&#39;</span><span class="p">][</span><span class="s1">&#39;intrapartum_still_birth&#39;</span><span class="p">],</span>
                                                              <span class="n">individual_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="ow">or</span> <span class="n">outcome_of_still_birth_equation</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has experienced an intrapartum still birth&#39;</span><span class="p">)</span>

            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="c1"># If this woman will experience a stillbirth and she was not pregnant with twins OR she was pregnant with</span>
            <span class="c1"># twins but both twins have died during labour we reset/set the appropriate variables</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span>
                                                                  <span class="p">(</span><span class="n">random_draw</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_both_twins_ip_still_&#39;</span>
                                                                                        <span class="s1">&#39;birth&#39;</span><span class="p">])):</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># This variable is therefore only ever true when the pregnancy has ended in stillbirth</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Next reset pregnancy and update contraception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Contraception&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">end_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

            <span class="c1"># If one twin survives we store this as a property of the MNI which is reference on_birth of the newborn</span>
            <span class="c1"># outcomes to ensure this twin pregnancy only leads to one birth</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_multiple_pregnancy&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">random_draw</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_both_twins_ip_still_&#39;</span>
                                                                                          <span class="s1">&#39;birth&#39;</span><span class="p">])):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># For a woman who die (due to the effect of one or more of the above complications) we schedule the death event</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;maternal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">])</span>

            <span class="c1"># Log the maternal death</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is LabourDeathEvent scheduling a death for person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> on&#39;</span>
                                            <span class="sa">f</span><span class="s1">&#39; date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> who died due to intrapartum complications&#39;</span><span class="p">)</span>

            <span class="n">labour_complications</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                                    <span class="s1">&#39;death_date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                    <span class="s1">&#39;labour_profile&#39;</span><span class="p">:</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]}</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;labour_complications&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">labour_complications</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;mni dictionary for a woman &#39;</span>
                                                                                           <span class="s1">&#39;who has died in labour&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;death_in_labour&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]:</span>
                <span class="c1"># We delete the mni dictionary if both mother and baby have died in labour, if the mother has died but</span>
                <span class="c1"># the baby has survived we delete the dictionary following the on_birth function of NewbornOutcomes</span>
                <span class="k">del</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_intrapartum_still_birth&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;single_twin_still_birth&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;ip_stillbirth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A Still Birth has occurred, to mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">still_birth</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mother_id&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span>
                           <span class="s1">&#39;date_of_ip_stillbirth&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">}</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;intrapartum_stillbirth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">still_birth</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;record of intrapartum stillbirth&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour">[docs]</a><span class="k">class</span> <span class="nc">HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour. This event is the first HSI for women who have</span>
<span class="sd">    chosen to deliver in a health care facility. Broadly this HSI represents care provided by a skilled birth attendant</span>
<span class="sd">    during labour. This event...</span>

<span class="sd">    1.) Determines if women will benefit from prophylactic interventions and delivers the interventions</span>
<span class="sd">    2.) Applies risk of intrapartum complications</span>
<span class="sd">    3.) Determines if women who have experience complications will benefit from treatment interventions and delivers</span>
<span class="sd">        the interventions</span>
<span class="sd">    4.) Schedules additional comprehensive emergency obstetric care for women who need it. (Comprehensive</span>
<span class="sd">        interventions (blood transfusion, caeasarean section and surgery) are housed within a different HSI.)</span>

<span class="sd">    Only interventions that can be delivered in BEmONC facilities are delivered in this HSI. These include intravenous</span>
<span class="sd">    antibiotics, intravenous anticonvulsants and assisted vaginal delivery. Additionally women may receive</span>
<span class="sd">    antihypertensives in line with Malawi&#39;s EHP. Interventions will only be attempted to be delivered if the squeeze</span>
<span class="sd">    factor of the HSI is below a predetermined threshold of each intervention. CEmONC level interventions are managed</span>
<span class="sd">    within HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Labour_ReceivesSkilledBirthAttendanceDuringLabour&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;NormalDelivery&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is HSI_Labour_PresentsForSkilledAttendanceInLabour: Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39;has presented to a health facility on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> following the &#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39;onset of her labour&#39;</span><span class="p">)</span>

        <span class="c1"># First we capture women who have presented to this event during labour at home. Currently we just set these</span>
        <span class="c1"># women to be delivering at a health centre (this will need to be randomised to match any availble data)</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;health_centre&#39;</span>

        <span class="c1"># Next delivery setting is captured in the labour_tracker, processed by the logger and reset yearly</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;health_centre_birth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hospital&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;hospital_birth&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Next we check this woman has the right characteristics to be at this event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_characteristics_checker</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;home_birth&#39;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_due_date_current_pregnancy&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

        <span class="c1"># We use this variable to prevent repetition when calling functions in this event</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hp&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_now&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_later&#39;</span><span class="p">):</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># LOG CONSUMABLES FOR DELIVERY...</span>
        <span class="c1"># We assume all deliveries require this basic package of consumables but we do not condition the event running</span>
        <span class="c1"># on their availability</span>
        <span class="c1"># pkg_code_delivery = pd.unique(</span>
        <span class="c1">#     consumables.loc[consumables[&#39;Intervention_Pkg&#39;] == &#39;Vaginal delivery - skilled attendance&#39;,</span>
        <span class="c1">#                     &#39;Intervention_Pkg_Code&#39;])[0]</span>

        <span class="c1"># self.get_all_consumables(</span>
        <span class="c1">#     pkg_codes=[pkg_code_delivery])</span>

        <span class="c1"># ===================================== PROPHYLACTIC CARE ===================================================</span>
        <span class="c1"># The following function manages the consumables and administration of prophylactic interventions in labour</span>
        <span class="c1"># (clean delivery practice, antibiotics for PROM, steroids for preterm labour). This intervention, like all</span>
        <span class="c1"># other in the event will only occur if the squeeze factor is below a preset threshold</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_proph_ints&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">prophylactic_labour_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise she receives no benefit of prophylaxis</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive prophylactic labour interventions due&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;to high squeeze&#39;</span><span class="p">)</span>

        <span class="c1"># ================================= PROPHYLACTIC MANAGEMENT PRE-ECLAMPSIA  ==============================</span>
        <span class="c1"># Next we see if women with severe pre-eclampsia will be identified and treated, reducing their risk of</span>
        <span class="c1"># eclampsia</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_spe&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_severe_pre_eclampsia_mgso4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive assessment or treatment of severe &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;pre-eclampsia due to high squeeze&#39;</span><span class="p">)</span>

        <span class="c1"># ===================================== APPLYING COMPLICATION INCIDENCE =======================================</span>
        <span class="c1"># Following administration of prophylaxis we assess if this woman will develop any complications during labour.</span>
        <span class="c1"># Women who have sought care because of complication have already had these risk applied so it doesnt happen</span>
        <span class="c1"># again</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cephalopelvic_dis&#39;</span><span class="p">,</span> <span class="s1">&#39;malpresentation&#39;</span><span class="p">,</span> <span class="s1">&#39;malposition&#39;</span><span class="p">,</span> <span class="s1">&#39;obstructed_labour&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;placental_abruption&#39;</span><span class="p">,</span> <span class="s1">&#39;antepartum_haem&#39;</span><span class="p">,</span> <span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">]:</span>
                <span class="c1"># Uterine rupture is the only complication we dont apply the risk of here due to the causal link</span>
                <span class="c1"># between obstructed labour and uterine rupture. Therefore we want interventions for obstructed labour</span>
                <span class="c1"># to reduce the risk of uterine rupture</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">)</span>

        <span class="c1"># ======================================= COMPLICATION MANAGEMENT ==========================</span>
        <span class="c1"># Next, women in labour are assessed for complications and treatment delivered if a need is identified and</span>
        <span class="c1"># consumables are available</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_ol&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_obstructed_labour_via_avd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_sep&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_htn&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_aph&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_plan_for_antepartum_haemorrhage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_ec&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="c1"># Now we apply the risk of uterine rupture to all women who will deliver vaginally</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vaginal_delivery&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span>
                <span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;uterine_rupture&#39;</span><span class="p">)</span>

        <span class="c1"># Uterine rupture follows the same pattern as antepartum haemorrhage</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_ur&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_referral_uterine_rupture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="c1"># ========================================== SCHEDULING CEMONC CARE =========================================</span>
        <span class="c1"># Finally women who require additional treatment have the appropriate HSI scheduled to deliver further care</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>

            <span class="n">surgical_management</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">,</span>
                <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;intrapartum&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">surgical_management</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># If a this woman has experienced a complication the appointment footprint is changed from normal to</span>
        <span class="c1"># complicated</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_sepsis&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_antepartum_haem&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_obstructed_labour&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span>
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;CompDelivery&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># If a woman has chosen to deliver in a facility from the onset of labour, but the squeeze factor is too high,</span>
        <span class="c1"># she will be forced to return home to deliver</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;squeeze factor is too high for this event to run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and she will now deliver at home&#39;</span><span class="p">)</span>

            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;home_birth&#39;</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;squeeze_to_high_for_hsi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># If a woman has presented to this event during labour due to a complication, she will not receive any treatment</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;squeeze factor is too high for this event to run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and she could not receive care for the &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;complications developed during her home birth&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceDuringLabour.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is called when the HSI is passed to the health system scheduler but not scheduled as the TREATMENT_ID</span>
<span class="sd">        is not allowed under the &#39;services_available&#39; parameter of the health system.</span>
<span class="sd">        Note that this called at the time of the event being passed to the Health System at schedule_hsi_event(...) and</span>
<span class="sd">        not at the time when the HSI is intended to be run (as specified by the &#39;topen&#39; parameter in that call)&quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="c1"># If a woman has chosen to deliver in a facility but this event isnt allowed with the set service configuration</span>
        <span class="c1"># then she will deliver at home</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This event is not in the allowed service availability and therefore cannot &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">, she will now deliver at &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;home_birth&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour">[docs]</a><span class="k">class</span> <span class="nc">HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the HSI HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour. This event is scheduled by the</span>
<span class="sd">    PostpartumLabourEvent and broadly represents care delivered by a skilled birth attendant following vaginal delivery</span>
<span class="sd">    in a BEmONC facility. Care following caesarean delivery is managed in another event. The structure and flow of this</span>
<span class="sd">    event is largely similar to HSI_Labour_ReceivesSkilledBirth AttendanceDuringLabour as described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Labour_ReceivesSkilledBirthAttendanceFollowingLabour&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is HSI_Labour_ReceivesCareForPostpartumPeriodFacilityLevel1: Providing &#39;</span>
                                        <span class="sa">f</span><span class="s1">&#39;skilled attendance following birth for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vaginal_delivery&#39;</span> <span class="ow">or</span> \
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;instrumental&#39;</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;home_birth&#39;</span> <span class="ow">and</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;health_centre&#39;</span>

        <span class="c1"># We run similar checks as the labour HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postpartum_characteristics_checker</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;home_birth&#39;</span>

        <span class="c1"># -------------------------- Active Management of the third stage of labour ----------------------------------</span>
        <span class="c1"># Prophylactic treatment to prevent postpartum bleeding is applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_amtsl&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">active_management_of_the_third_stage_of_labour</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># ===================================== APPLYING COMPLICATION INCIDENCE =======================================</span>
        <span class="c1"># Again we use the mothers individual risk of each complication to determine if she will experience any</span>
        <span class="c1"># complications using the set_complications_during_facility_birth function.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;sought_care_for_complication&#39;</span><span class="p">]:</span>

            <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;lacerations&#39;</span><span class="p">,</span> <span class="s1">&#39;retained_placenta&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>

        <span class="c1"># ======================================= COMPLICATION MANAGEMENT =============================================</span>
        <span class="c1"># And then determine if interventions will be delivered...</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">facility_type_code</span> <span class="o">=</span> <span class="s1">&#39;hp&#39;</span>

        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_sep&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_htn&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_pph&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_pph_retained_placenta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_pph_uterine_atony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_ec&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facility_type_code</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_pre_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># ========================================== SCHEDULING CeMONC CARE ==========================================</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="n">surgical_management</span> <span class="o">=</span> <span class="n">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">,</span>
                <span class="n">timing</span><span class="o">=</span><span class="s1">&#39;postpartum&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">surgical_management</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># ====================================== APPLY RISK OF DEATH===================================================</span>
        <span class="c1"># For women who experience a complication following birth in a facility, but do not require additional care,</span>
        <span class="c1"># we apply risk of death considering the treatment effect applied (women referred on have this risk applied</span>
        <span class="c1"># later)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_ReceivesCareForPostpartumPeriod: did not run as the squeeze factor&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;is too high, mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will return home on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Women who delivered at a facility, but can receive no more care due to high squeeze, will go home for the</span>
        <span class="c1"># immediate period after birth- where there risk of complications is applied</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delivery_setting&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;home_birth&#39;</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;squeeze_to_high_for_hsi_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostpartumLabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This event is not in the allowed service availability and therefore cannot &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">, she will now deliver at &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostpartumLabourAtHomeEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare">[docs]</a><span class="k">class</span> <span class="nc">HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare. This event houses all the interventions that are</span>
<span class="sd">    required to be delivered at a CEmONC level facility including caesarean section, blood transfusion and surgery</span>
<span class="sd">    during or following labour Currently we assume that if this even runs and the consumables are available then the</span>
<span class="sd">    intervention is delivered i.e. we dont apply squeeze factor threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">,</span> <span class="n">timing</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Labour_ReceivesComprehensiveEmergencyObstetricCare&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>  <span class="c1"># facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="n">timing</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># consumables = self.sim.modules[&#39;HealthSystem&#39;].parameters[&#39;Consumables&#39;]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare running for &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># We use the variable self.timing to differentiate between women sent to this event during labour and women</span>
        <span class="c1"># sent after labour</span>

        <span class="c1"># ========================================== CAESAREAN SECTION ===============================================</span>
        <span class="c1"># For women arriving to this event during labour who have been referred for caesarean the intervention is</span>
        <span class="c1"># delivered</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;caesarean_section&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># pkg_code_cs = pd.unique(</span>
            <span class="c1">#     consumables.loc[</span>
            <span class="c1">#         consumables[&#39;Intervention_Pkg&#39;] == &#39;Cesearian Section with indication (with complication)&#39;,</span>
            <span class="c1">#         &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># all_available = self.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[pkg_code_cs])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># We check if the consumables are available but we dont condition the event happening on the result of the</span>
            <span class="c1"># check</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s1">&#39;All the required consumables are available and will can be used for this&#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;caesarean delivery for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;The required consumables are not available for this caesarean &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;delivery for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># The appropriate variables in the MNI and dataframe are stored. Current caesarean section reduces risk of</span>
            <span class="c1"># intrapartum still birth and death due to antepartum haemorrhage</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_section&#39;</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;amtsl_given&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_previous_cs_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ================================ SURGICAL MANAGEMENT OF RUPTURED UTERUS =====================================</span>
        <span class="c1"># Women referred after the labour HSI following correct identification of ruptured uterus will also need to</span>
        <span class="c1"># undergo surgical repair of this complication</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;la_uterine_rupture&#39;</span><span class="p">]:</span>

            <span class="c1"># We dont have a specific package code for general surgery...</span>
            <span class="c1"># dummy_surg_pkg_code = pd.unique(consumables.loc[consumables[&#39;Intervention_Pkg&#39;] ==</span>
            <span class="c1">#                                                 &#39;Cesearian Section with indication (with complication)&#39;,</span>
            <span class="c1">#                                                 &#39;Intervention_Pkg_Code&#39;])[0]</span>

            <span class="c1"># Again we check for the consumables but dont condition on consumables being avaible for the event to</span>
            <span class="c1"># happen</span>
            <span class="c1"># all_available = self.get_all_consumables(</span>
            <span class="c1">#     pkg_codes=[dummy_surg_pkg_code])</span>
            <span class="n">all_available</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Consumables required for surgery are available and therefore have been &#39;</span>
                                  <span class="s1">&#39;used&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Consumables required for surgery are unavailable and therefore have not &#39;</span>
                                  <span class="s1">&#39;been used&#39;</span><span class="p">)</span>

            <span class="c1"># We apply a probability that repair surgery will be successful which will reduce risk of death from</span>
            <span class="c1"># uterine rupture</span>
            <span class="n">treatment_success_ur</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;success_rate_uterine_repair&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">treatment_success_ur</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_uterine_rupture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Unsuccessful repair will lead to this woman requiring a hysterectomy. Hysterectomy will also reduce risk</span>
            <span class="c1"># of death from uterine rupture but leads to permanent infertility in the simulation</span>
            <span class="k">elif</span> <span class="o">~</span><span class="n">treatment_success_ur</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_has_had_hysterectomy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># ============================= SURGICAL MANAGEMENT OF POSTPARTUM HAEMORRHAGE==================================</span>
        <span class="c1"># Women referred for surgery immediately following labour will need surgical management of postpartum bleeding</span>
        <span class="c1"># Treatment is varied accordingly to underlying cause of bleeding</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                            <span class="s1">&#39;la_postpartum_haem&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">surgical_management_of_pph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># =========================================== BLOOD TRANSFUSION ===============================================</span>
        <span class="c1"># Women referred for blood transfusion alone or in conjunction with one of the above interventions will receive</span>
        <span class="c1"># that here</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Women who have passed through the postpartum SBA HSI have not yet had their risk of death calculated because</span>
        <span class="c1"># they required interventions delivered via this event. We now determine if these women will survive</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> apply_risk_of_early_postpartum_death&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>

        <span class="c1"># Here we edit the appointment footprint so only women receiving surgery require the surgical footprint</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]:</span>
            <span class="n">actual_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actual_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_surgery&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">])</span> <span class="ow">and</span>\
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_blood&#39;</span><span class="p">]:</span>
            <span class="n">actual_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">actual_appt_footprint</span><span class="p">[</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare: did not run as the &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;squeeze factor is too high, mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive care&#39;</span><span class="p">)</span>

        <span class="c1"># For women who cant deliver via caesarean we apply risk of uterine rupture (which was blocked before)</span>
        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;squeeze factor is too high for this event to run for mother&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and she is unable to deliver via &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;caesarean section&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span>
                <span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;uterine_rupture&#39;</span><span class="p">)</span>

        <span class="c1"># For women referred to this event after the postnatal SBA HSI we apply risk of death (as if should have been</span>
        <span class="c1"># applied in this event if it ran)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> apply_risk_of_early_postpartum_death&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_Labour_ReceivesComprehensiveEmergencyObstetricCare is not in the &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;allowed service availability and therefore cannot run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;meaning she will not receive CEmONC interventions she requires&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;intrapartum&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_intrapartum_complications</span><span class="p">(</span>
                <span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="s1">&#39;uterine_rupture&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">==</span> <span class="s1">&#39;postpartum&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> apply_risk_of_early_postpartum_death&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_Labour_ReceivesCareFollowingCaesareanSection"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesCareFollowingCaesareanSection">[docs]</a><span class="k">class</span> <span class="nc">HSI_Labour_ReceivesCareFollowingCaesareanSection</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_Labour_ReceivesCareFollowingCaesareanSection. It is scheduled via the BirthEvent for all women who have</span>
<span class="sd">    delivered via caesarean section and represents the care provided by a skilled birth attendant to women post</span>
<span class="sd">    section.  The structure and flow of this event is largely similar to</span>
<span class="sd">    HSI_Labour_ReceivesSkilledBirthAttendanceFollowingLabour as described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Labour_ReceivesCareFollowingCaesareanSection.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesCareFollowingCaesareanSection.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Labour</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Labour_ReceivesCareFollowingCaesareanSection&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesCareFollowingCaesareanSection.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesCareFollowingCaesareanSection.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Labour_ReceivesCareFollowingCaesareanSection is firing&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;mode_of_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_section&#39;</span>
        <span class="k">assert</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;referred_for_cs&#39;</span><span class="p">]</span>

        <span class="c1"># This event represents care women receive after delivering via caesarean section</span>
        <span class="c1"># Women pass through different &#39;post delivery&#39; events depending on mode of delivery due to how risk and</span>
        <span class="c1"># treatment of certain complications, such as postpartum haemorrhage, are managed</span>

        <span class="c1"># ===================================== APPLYING COMPLICATION INCIDENCE =======================================</span>
        <span class="c1"># Here we apply the risk that this woman will develop and infection or experience worsening hypertension after</span>
        <span class="c1"># her caesarean</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;uterine_atony&#39;</span><span class="p">,</span> <span class="s1">&#39;other_pph_cause&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>

        <span class="c1"># ======================================= PPH MANAGEMENT =============================================</span>
        <span class="n">outcome_of_pph_management</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_pph_uterine_atony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;hp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outcome_of_pph_management</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">surgical_management_of_pph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># ======================================= COMPLICATION MANAGEMENT =============================================</span>
        <span class="c1"># Next we apply the effect of any treatments</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_sep&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_maternal_sepsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;hp&#39;</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_htn&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;hp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">squeeze_factor</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_threshold_treatment_ec&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_and_treatment_of_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;hp&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_pre_discharge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># ====================================== APPLY RISK OF DEATH===================================================</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> apply_risk_of_early_postpartum_death&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesCareFollowingCaesareanSection.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesCareFollowingCaesareanSection.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;squeeze factor is too high for this event to run for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> on &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1"> and she is unable to receive post caesarean care&#39;</span><span class="p">)</span>

        <span class="c1"># For simulation runs where the squeeze is set too high for the event to run we apply risk of complications and</span>
        <span class="c1"># death as this would have happened within the HSI</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_Labour_ReceivesCareFollowingCaesareanSection.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.HSI_Labour_ReceivesCareFollowingCaesareanSection.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;HSI_Labour_ReceivesCareFollowingCaesareanSection is not allowed in the &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;current service availability, for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;and she is unable to receive care after caesarean section&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">,</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postpartum_complications</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">progression_of_hypertensive_disorders</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">property_prefix</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_early_postpartum_death</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LabourLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">LabourLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the LabourLoggingEvent. It uses the data frame and the labour_tracker to produce summary statistics which</span>
<span class="sd">    are processed and presented by different analysis scripts &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LabourLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>

<div class="viewcode-block" id="LabourLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.labour.html#tlo.methods.labour.LabourLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Previous Year...</span>
        <span class="n">one_year_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>

        <span class="c1"># Denominators...</span>
        <span class="n">total_ip_maternal_deaths_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">la_maternal_death_in_labour</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">la_maternal_death_in_labour_date</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">la_maternal_death_in_labour_date</span> <span class="o">&lt;</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">total_ip_maternal_deaths_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_ip_maternal_deaths_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">total_births_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># yearly number of complications</span>
        <span class="n">deaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;maternal_death&#39;</span><span class="p">]</span>
        <span class="n">still_births</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;ip_stillbirth&#39;</span><span class="p">]</span>
        <span class="n">ol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;obstructed_labour&#39;</span><span class="p">]</span>
        <span class="n">aph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;antepartum_haem&#39;</span><span class="p">]</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;uterine_rupture&#39;</span><span class="p">]</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>
        <span class="n">spe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">]</span>
        <span class="n">pph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;postpartum_haem&#39;</span><span class="p">]</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;sepsis&#39;</span><span class="p">]</span>
        <span class="n">sep_pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;sepsis_pp&#39;</span><span class="p">]</span>

        <span class="c1"># yearly number deliveries by setting</span>
        <span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;home_birth&#39;</span><span class="p">]</span>
        <span class="n">hospital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;health_centre_birth&#39;</span><span class="p">]</span>
        <span class="n">health_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;hospital_birth&#39;</span><span class="p">]</span>
        <span class="n">cs_deliveries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;caesarean_section&#39;</span><span class="p">]</span>

        <span class="n">ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;early_preterm&#39;</span><span class="p">]</span>
        <span class="n">lpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;late_preterm&#39;</span><span class="p">]</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;post_term&#39;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]</span>

        <span class="c1"># TODO: division by zero crashes code on small runs</span>

        <span class="n">dict_for_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_births_last_year&#39;</span><span class="p">:</span> <span class="n">total_births_last_year</span><span class="p">,</span>
            <span class="s1">&#39;maternal_deaths_checker&#39;</span><span class="p">:</span> <span class="n">deaths</span><span class="p">,</span>
            <span class="s1">&#39;maternal_deaths_df&#39;</span><span class="p">:</span> <span class="n">total_ip_maternal_deaths_last_year</span><span class="p">,</span>
            <span class="s1">&#39;still_births&#39;</span><span class="p">:</span> <span class="n">still_births</span><span class="p">,</span>
            <span class="s1">&#39;sbr&#39;</span><span class="p">:</span> <span class="n">still_births</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;intrapartum_mmr&#39;</span><span class="p">:</span> <span class="n">total_ip_maternal_deaths_last_year</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">,</span>
            <span class="s1">&#39;home_births_crude&#39;</span><span class="p">:</span> <span class="n">home</span><span class="p">,</span>
            <span class="s1">&#39;home_births_prop&#39;</span><span class="p">:</span> <span class="n">home</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;health_centre_births&#39;</span><span class="p">:</span> <span class="n">health_centre</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;hospital_births&#39;</span><span class="p">:</span> <span class="n">hospital</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;cs_delivery_rate&#39;</span><span class="p">:</span> <span class="n">cs_deliveries</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;ol_incidence&#39;</span><span class="p">:</span> <span class="n">ol</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;aph_incidence&#39;</span><span class="p">:</span> <span class="n">aph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;ur_incidence&#39;</span><span class="p">:</span> <span class="n">ur</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;ec_incidence&#39;</span><span class="p">:</span> <span class="n">ec</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;spe_incidence&#39;</span><span class="p">:</span> <span class="n">spe</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;sep_incidence&#39;</span><span class="p">:</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">sep_pp</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;sep_incidence_pp&#39;</span><span class="p">:</span> <span class="n">sep_pp</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;pph_incidence&#39;</span><span class="p">:</span> <span class="n">pph</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">dict_crude_cases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intrapartum_mmr&#39;</span><span class="p">:</span> <span class="n">total_ip_maternal_deaths_last_year</span><span class="p">,</span>
                            <span class="s1">&#39;ol_cases&#39;</span><span class="p">:</span> <span class="n">ol</span><span class="p">,</span>
                            <span class="s1">&#39;aph_cases&#39;</span><span class="p">:</span> <span class="n">aph</span><span class="p">,</span>
                            <span class="s1">&#39;ur_cases&#39;</span><span class="p">:</span> <span class="n">ur</span><span class="p">,</span>
                            <span class="s1">&#39;ec_cases&#39;</span><span class="p">:</span> <span class="n">ec</span><span class="p">,</span>
                            <span class="s1">&#39;spe_cases&#39;</span><span class="p">:</span> <span class="n">spe</span><span class="p">,</span>
                            <span class="s1">&#39;sep_cases&#39;</span><span class="p">:</span> <span class="n">sep</span><span class="p">,</span>
                            <span class="s1">&#39;sep_cases_pp&#39;</span><span class="p">:</span> <span class="n">sep_pp</span><span class="p">,</span>
                            <span class="s1">&#39;pph_cases&#39;</span><span class="p">:</span> <span class="n">pph</span><span class="p">}</span>

        <span class="n">deliveries</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ept&#39;</span><span class="p">:</span> <span class="n">ept</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                      <span class="s1">&#39;lpt&#39;</span><span class="p">:</span> <span class="n">lpt</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                      <span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="n">t</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                      <span class="s1">&#39;post_term&#39;</span><span class="p">:</span> <span class="n">pt</span> <span class="o">/</span> <span class="n">total_births_last_year</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}</span>

        <span class="c1"># deaths</span>
        <span class="n">sep_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;sepsis_death&#39;</span><span class="p">]</span>
        <span class="n">ur_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;uterine_rupture_death&#39;</span><span class="p">]</span>
        <span class="n">aph_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;antepartum_haem_death&#39;</span><span class="p">]</span>
        <span class="n">ec_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;eclampsia_death&#39;</span><span class="p">]</span>
        <span class="n">pph_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="s1">&#39;postpartum_haem_death&#39;</span><span class="p">]</span>

        <span class="n">deaths</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sepsis&#39;</span><span class="p">:</span> <span class="n">sep_d</span><span class="p">,</span>
                  <span class="s1">&#39;uterine_rupture&#39;</span><span class="p">:</span> <span class="n">ur_d</span><span class="p">,</span>
                  <span class="s1">&#39;aph&#39;</span><span class="p">:</span> <span class="n">aph_d</span><span class="p">,</span>
                  <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span> <span class="n">ec_d</span><span class="p">,</span>
                  <span class="s1">&#39;postpartum_haem&#39;</span><span class="p">:</span> <span class="n">pph_d</span><span class="p">,</span>
                  <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;labour_summary_stats_incidence&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dict_for_output</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly incidence summary &#39;</span>
                                                                                            <span class="s1">&#39;statistics output from &#39;</span>
                                                                                            <span class="s1">&#39;the labour module&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;labour_summary_stats_crude_cases&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dict_crude_cases</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly crude &#39;</span>
                                                                                               <span class="s1">&#39;summary statistics &#39;</span>
                                                                                               <span class="s1">&#39;output from the labour &#39;</span>
                                                                                               <span class="s1">&#39;module&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;labour_summary_stats_delivery&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">deliveries</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly delivery summary &#39;</span>
                                                                                      <span class="s1">&#39;statistics output from the &#39;</span>
                                                                                      <span class="s1">&#39;labour module&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;labour_summary_stats_death&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">deaths</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly death summary statistics &#39;</span>
                                                                               <span class="s1">&#39;output from the labour module&#39;</span><span class="p">)</span>

        <span class="c1"># Reset the EventTracker</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">labour_tracker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Feb 14, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>