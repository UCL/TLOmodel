

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.postnatal_supervisor &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.postnatal_supervisor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.postnatal_supervisor</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">postnatal_supervisor_lm</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hiv</span> <span class="kn">import</span> <span class="n">HSI_Hiv_TestAndRefer</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="PostnatalSupervisor"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor">[docs]</a><span class="k">class</span> <span class="nc">PostnatalSupervisor</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This module is responsible for the key conditions/complications experienced by a mother and by a neonate</span>
<span class="sd">    following labour and the immediate postpartum period (this period, from birth to day +1, is covered by the labour</span>
<span class="sd">    module).</span>

<span class="sd">    For mothers: This module applies risk of complications across the postnatal period, which is  defined as birth</span>
<span class="sd">    until day 42 post-delivery. PostnatalWeekOne Event represents the first week post birth where risk of complications</span>
<span class="sd">    remains high. The primary mortality causing complications here are infection/sepsis, secondary postpartum</span>
<span class="sd">    haemorrhage and hypertension. Women with or without complications may/may not seek Postnatal Care at day 7 post</span>
<span class="sd">    birth (we assume women who seek care will also bring their newborns with them to the HSI where they will also be</span>
<span class="sd">    assessed). This HSI assesses mothers and newborns and schedules admissions if complications are found. The</span>
<span class="sd">    PostnatalSupervisor Event applies risk of complications weekly from week 2-6 (ending on day 42). This event also</span>
<span class="sd">    determines additional care seeking for mothers who are unwell during this time period. All maternal variables are</span>
<span class="sd">    reset on day 42.</span>

<span class="sd">    For neonates: This module applies risk of complications during the neonatal period, from birth until day 28. The</span>
<span class="sd">    PostnatalWeekOne Event applies risk of early onset neonatal sepsis (sepsis onsetting prior to day 7 of life). Care</span>
<span class="sd">    may be sought (as described above) and neonates can be admitted for treatment. The PostnatalSupervisor Event applies</span>
<span class="sd">     risk of late onset neonatal sepsis from week 2-4 (ending on day 28). This event also determines additional</span>
<span class="sd">    care seeking for neonates who are unwell during this time period. All neonatal variables are reset on day 28.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PostnatalSupervisor.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># This dictionary is used to count each occurrence of an &#39;event&#39; of interest. These stored counts are used</span>
        <span class="c1"># in the LoggingEvent to calculate key outcomes (i.e. incidence rates, neonatal mortality rate etc)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">,</span> <span class="s1">&#39;HealthSystem&#39;</span><span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Labour&#39;</span><span class="p">,</span> <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span> <span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
                <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
                <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span><span class="p">}</span>  <span class="c1"># declare that this is a disease module (leave as empty set otherwise)</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">),</span>
        <span class="s1">&#39;neonatal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Neonatal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Neonatal Disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="c1"># todo - distinguish the dalys bewteen maternal and neonatal (here, lumping all under maternal)</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;maternal&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maternal disorders&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>

        <span class="c1"># NATURAL HISTORY PARAMETERS...</span>
        <span class="s1">&#39;prob_htn_resolves&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability hypertension resolves during postpartum&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_secondary_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of secondary PPH&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_secondary_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for secondary pph&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_postnatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate for postnatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_secondary_pph_severity&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild, moderate or severe secondary PPH&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_obstetric_fistula&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a woman developing an obstetric fistula after birth&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prevalence_type_of_fistula&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;prevalence of 1.) vesicovaginal 2.)rectovaginal fistula &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_iron_def_per_week_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability of a women developing iron deficiency following pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_folate_def_per_week_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability of a women developing folate deficiency following pregnancy &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_b12_def_per_week_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability of a women developing b12 deficiency following pregnancy &#39;</span><span class="p">),</span>
        <span class="s1">&#39;baseline_prob_anaemia_per_week&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Weekly probability of anaemia in pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_type_of_anaemia_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of a woman with anaemia having mild, moderate or severe anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_iron_deficient_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of developing anaemia when iron deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_folate_deficient_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of developing anaemia when folate deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_anaemia_if_b12_deficient_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;risk of developing anaemia when b12 deficient&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_early_onset_neonatal_sepsis_week_1&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Baseline probability of a newborn developing sepsis in week one of life&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_early_onset_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality for early onset neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_sepsis_disabilities&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probabilities of varying disability levels after neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_endometritis_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of endometritis in week one&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_urinary_tract_inf_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of urinary tract infection in week one&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_skin_soft_tissue_inf_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of skin and soft tissue infection in week one&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_other_inf_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of other maternal infections in week one&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_sepsis_endometritis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of developing sepsis following postpartum endometritis infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_sepsis_urinary_tract_inf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of developing sepsis following postpartum UTI&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_sepsis_skin_soft_tissue_inf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of developing sepsis following postpartum skin/soft tissue infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_sepsis_other_maternal_infection_pp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of developing sepsis following postpartum other infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_late_onset_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of late onset neonatal sepsis (all cause)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_late_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Risk of death from late neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_htn_persists&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that women who are hypertensive during pregnancy remain hypertensive in the &#39;</span>
                        <span class="s1">&#39;postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;weekly_prob_gest_htn_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability of a woman developing gestational hypertension during the postnatal &#39;</span>
                        <span class="s1">&#39;period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;weekly_prob_pre_eclampsia_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;weekly probability of a woman developing mild pre-eclampsia during the postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mgh_matrix_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_sgh_matrix_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe gestational hypertension moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_mpe_matrix_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild pre-eclampsia moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_spe_matrix_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of severe pre-eclampsia moving between states: gestational &#39;</span>
                        <span class="s1">&#39;hypertension, severe gestational hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;probs_for_ec_matrix_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of eclampsia moving between states: gestational hypertension, severe gestational &#39;</span>
                        <span class="s1">&#39;hypertension, mild pre-eclampsia, severe pre-eclampsia, &#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_eclampsia_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate of eclampsia in the postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_severe_htn_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate of severe hypertension in the postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;weekly_prob_postnatal_death&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Weekly risk of postnatal death&#39;</span><span class="p">),</span>
        <span class="s1">&#39;severity_late_infection_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability of mild infection, sepsis or severe sepsis in the later postnatal period&#39;</span><span class="p">),</span>

        <span class="c1"># TREATMENT/HEALTH SYSTEM PARAMETERS</span>
        <span class="s1">&#39;rr_iron_def_ifa_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of iron and folic acid treatment on risk of iron deficiency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_folate_def_ifa_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of iron and folic acid treatment on risk of folate deficiency &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_early_init_bf&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of early initiation of breastfeeding on neonatal sepsis rates &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_abx_prom&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of early antibiotics given to a mother with PROM on neonatal sepsis rates &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_inj_abx_sep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of injectable antibiotics on neonatal sepsis mortality&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_supp_care_sep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;effect of full supportive care on neonatal sepsis mortality&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_parenteral_antibiotics&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of parenteral antibiotics on maternal sepsis mortality &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_bemonc_care_pph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of BEmONC care on postpartum haemorrhage mortality&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_anti_htns&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of hypertensive therapy on death from eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_mag_sulph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of magnesium sulphate therapy on death from eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;neonatal_sepsis_treatment_effect&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect for neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_clean_birth&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of clean birth practices on early onset neonatal sepsis risk&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_cord_care&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of chlorhexidine cord care on early onset neonatal sepsis risk&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_anti_htns_progression_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Treatment effect of oral anti hypertensives on progression from mild/mod to severe gestational&#39;</span>
                        <span class="s1">&#39;hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_attend_pnc2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman receiving PNC1 care will return for PNC2 care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_attend_pnc3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Probability that a woman receiving PNC2 care will return for PNC3 care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_care_seeking_postnatal_emergency&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability of emergency care seeking for women in the postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_care_seeking_postnatal_emergency_neonate&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability care will be sought for a neonate with a complication&#39;</span><span class="p">),</span>
        <span class="s1">&#39;odds_care_seeking_fistula_repair&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds of a woman seeking care for treatment of obstetric fistula&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_cs_fistula_age_15_19&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for care seeking for treatment of obstetric fistula in 15-19 year olds&#39;</span><span class="p">),</span>
        <span class="s1">&#39;aor_cs_fistula_age_lowest_education&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;odds ratio for care seeking for treatment of obstetric fistula in women in the lowest &#39;</span>
                        <span class="s1">&#39;education quintile&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_pnc1_at_day_7&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;baseline probability a woman will seek PNC for her and her newborn at day + 7 &#39;</span><span class="p">),</span>
        <span class="s1">&#39;multiplier_for_care_seeking_with_comps&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;number by which prob_pnc1_at_day_7 is multiplied by to increase care seeking for PNC1 in women&#39;</span>
                        <span class="s1">&#39; with complications &#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_bp_monitoring_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of BP monitoring during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_bp_monitoring_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of BP monitoring during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_urine_protein_1_plus_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of urine dipstick during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_urine_protein_1_plus_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of urine dipstick monitoring during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_poc_hb_test_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of point of care testing during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_poc_hb_test_pn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of urine dipstick monitoring during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_maternal_sepsis_assessment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of assessment for maternal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_pph_assessment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of assessment for secondary pph&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_lons_assessment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of assessment for late onset neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_eons_assessment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of assessment for earl onset neonatal sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_sep_assessment_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will be assessed for sepsis during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_pph_assessment_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will be assessed for PPH during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_urine_ds_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive a urine disptick during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_bp_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive blood pressure testing during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_poct_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive point of care Hb testing during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_neonatal_sepsis_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a newborn will be assessed for sepsis during PNC&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_hiv_test_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a newborn will receive a HIV test at 6 weeks postnatal &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_depression_screen_pnc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a mother will receive a depression screen during PNC&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;person_id of a mothers most recent child (if twins id of the &#39;</span>
                                                       <span class="s1">&#39;first born)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;The number of weeks a woman is in the postnatal period &#39;</span>
                                                             <span class="s1">&#39;(1-6)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;The number of postnatal care visits a woman has undergone &#39;</span>
                                                      <span class="s1">&#39;following her most recent delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;The number of postnatal care visits a neonate has undergone &#39;</span>
                                                      <span class="s1">&#39;following delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Hypertensive disorders of the postnatal period&#39;</span><span class="p">,</span>
                                     <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;resolved&#39;</span><span class="p">,</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;pn_mag_sulph_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received magnesium sulphate as &#39;</span>
                                                       <span class="s1">&#39;treatment for eclampsia/ severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is receiving regular oral medication for &#39;</span>
                                                         <span class="s1">&#39;hypertension in the postnatal period&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_iv_anti_htn_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received IV anti hypertensive therapy &#39;</span>
                                                         <span class="s1">&#39;during a hypertensive emergency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing a secondary &#39;</span>
                                                             <span class="s1">&#39;postpartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_postpartum_haem_secondary_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received treatment for &#39;</span>
                                                                       <span class="s1">&#39;secondary PPH&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is experiencing postnatal (day7+) &#39;</span>
                                                          <span class="s1">&#39;sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_sepsis_late_postpartum_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received treatment for &#39;</span>
                                                                    <span class="s1">&#39;postpartum sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_maternal_pp_infection&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column for infection&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_obstetric_fistula&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Type of fistula developed after birth&#39;</span><span class="p">,</span>
                                         <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;vesicovaginal&#39;</span><span class="p">,</span> <span class="s1">&#39;rectovaginal&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this neonate has developed early onset neonatal&#39;</span>
                                                         <span class="s1">&#39; sepsis during week one of life&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this neonate has developed late neonatal sepsis &#39;</span>
                                                        <span class="s1">&#39;following discharge&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_neonatal_sepsis_disab&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Level of disability experience from a neonate post &#39;</span>
                                                                <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span>
                                                                                      <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span>
                                                                                      <span class="s1">&#39;severe_motor&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;pn_sepsis_neonatal_inj_abx&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this neonate has received injectable antibiotics&#39;</span>
                                                           <span class="s1">&#39; as treatment for late onset sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_sepsis_neonatal_full_supp_care&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this neonate has received full &#39;</span>
                                                                  <span class="s1">&#39;supportive care as treatment for late onset sepsis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_deficiencies_following_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset column, stores types of anaemia causing &#39;</span>
                                                                   <span class="s1">&#39;deficiencies following pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;severity of anaemia following pregnancy&#39;</span><span class="p">,</span>
                                                   <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether a mother is experiencing an emergency complication&#39;</span>
                                                          <span class="s1">&#39; postnatally&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="PostnatalSupervisor.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_PostnatalSupervisor.xlsx&#39;</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_inj_abx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_full_supp_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_obstetric_fistula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># This biset property stores infections that can occur in the postnatal period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;pn_maternal_pp_infection&#39;</span><span class="p">,</span>
                                                        <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">])</span>

        <span class="c1"># This biset property deficiencies that can lead to anaemia</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span>
                                                              <span class="s1">&#39;pn_deficiencies_following_pregnancy&#39;</span><span class="p">,</span>
                                                              <span class="p">[</span><span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>

        <span class="c1"># Schedule the first instance of the PostnatalSupervisorEvent</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostnatalSupervisorEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Register logging event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">PostnatalLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Define the events we want to track in the postnatal_tracker...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;endometritis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;secondary_pph&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;postnatal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s1">&#39;postnatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fistula&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;postnatal_anaemia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s1">&#39;early_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;late_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;neonatal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># Register dx_tests used as assessment for postnatal conditions during PNC visits</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>

            <span class="c1"># This dx_test represents blood pressure measurement delivered during PNC</span>
            <span class="n">blood_pressure_measurement_pn</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_bp_monitoring_pn&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_bp_monitoring_pn&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents a urine dipstick which is used to measuring the presence and amount of protein in a</span>
            <span class="c1"># womans urine, proteinuria being indicative of pre-eclampsia/eclampsia</span>
            <span class="n">urine_dipstick_protein_pn</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_urine_protein_1_plus_pn&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_urine_protein_1_plus_pn&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents point of care haemoglobin testing used in PNC to detect anaemia (all-severity)</span>
            <span class="n">point_of_care_hb_test_pn</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_poc_hb_test_pn&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_poc_hb_test_pn&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents clinical assessment of a mother for signs of sepsis</span>
            <span class="n">assessment_for_postnatal_sepsis</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_maternal_sepsis_assessment&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents clinical assessment of a mother for signs of secondary postpartum bleeding</span>
            <span class="n">assessment_for_secondary_pph</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_pph_assessment&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents clinical assessment of a newborn for signs of later onset neonatal sepsis</span>
            <span class="n">assessment_for_late_onset_neonatal_sepsis</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_lons_assessment&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents clinical assessment of a newborn for signs of early onset neonatal sepsis</span>
            <span class="n">assessment_for_early_onset_neonatal_sepsis</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_eons_assessment&#39;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="c1"># ======================================= LINEAR MODEL EQUATIONS =============================================</span>
        <span class="c1"># All linear equations used in this module are stored within the pn_linear_equations</span>
        <span class="c1"># parameter below</span>

        <span class="c1"># TODO: process of &#39;selection&#39; of important predictors in linear equations is ongoing, a linear model that</span>
        <span class="c1">#  is empty of predictors at the end of this process will be converted to a set probability</span>

        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing obstetric fistula after birth</span>
            <span class="s1">&#39;obstetric_fistula&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_obstetric_fistula</span><span class="p">,</span>
                                                    <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of secondary postpartum haemorrhage</span>
            <span class="s1">&#39;secondary_postpartum_haem&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_secondary_postpartum_haem</span><span class="p">,</span>
                                                            <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of dying following a secondary postpartum haemorrhage.</span>
            <span class="c1"># Risk of death is modified by the effect of treatment, if delivered</span>
            <span class="s1">&#39;secondary_postpartum_haem_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_secondary_postpartum_haem_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing endometritis infection</span>
            <span class="s1">&#39;endometritis&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_endometritis</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing a urinary tract infection</span>
            <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_urinary_tract_inf</span><span class="p">,</span>
                                                    <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing a skin or soft tissue infection</span>
            <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_skin_soft_tissue_inf</span><span class="p">,</span>
                                                       <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing another infection, not defined above</span>
            <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_other_maternal_infection</span><span class="p">,</span>
                                                           <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing sepsis following one of more of the above</span>
            <span class="c1"># infections</span>

            <span class="s1">&#39;sepsis_late_postpartum&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_sepsis_late_postpartum</span><span class="p">,</span>
                                                         <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of dying due to sepsis in the postnatal period. Risk of</span>
            <span class="c1"># death is modified by the effect of treatment, if delivered</span>
            <span class="s1">&#39;postnatal_sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_postnatal_sepsis_death</span><span class="p">,</span>
                                                         <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing gestational hypertension in the postnatal</span>
            <span class="c1"># period</span>
            <span class="s1">&#39;gest_htn_pn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_gest_htn_pn</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing pre-eclampsia in in the postnatal</span>
            <span class="c1"># period</span>
            <span class="s1">&#39;pre_eclampsia_pn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_pre_eclampsia_pn</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of dying from eclampsia that has developed in the</span>
            <span class="c1"># postnatal period. Risk of death is mitigated by treatment effects, if treatment is delivered</span>
            <span class="s1">&#39;eclampsia_death_pn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_eclampsia_death_pn</span><span class="p">,</span>
                                                     <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of dying due to severe hypertension</span>
            <span class="s1">&#39;death_from_hypertensive_disorder_pn&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_death_from_hypertensive_disorder_pn</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a mothers risk of developing anaemia postnatal</span>
            <span class="s1">&#39;anaemia_after_pregnancy&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span><span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_anaemia_after_pregnancy</span><span class="p">,</span>
                                                          <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a neonates risk of developing early onset neonatal sepsis</span>
            <span class="c1"># (sepsis onsetting prior to day 7) in the first week of life</span>
            <span class="s1">&#39;early_onset_neonatal_sepsis_week_1&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_early_onset_neonatal_sepsis_week_1</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a neonates risk of dying following early onset sepsis in week one.</span>
            <span class="c1"># Risk of death is mitigated by treatment effects, if delivered</span>
            <span class="s1">&#39;early_onset_neonatal_sepsis_week_1_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_early_onset_neonatal_sepsis_week_1_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a neonates risk of developing late onset neonatal sepsis</span>
            <span class="c1"># (sepsis onsetting between 7 and day 28) after  the first week of life</span>
            <span class="s1">&#39;late_onset_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_late_onset_neonatal_sepsis</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine a neonates risk of dying following late onset neonatal sepsis</span>
            <span class="c1"># (sepsis onsetting between 7 and day 28) after the first week of life</span>
            <span class="s1">&#39;late_neonatal_sepsis_death&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_late_neonatal_sepsis_death</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine the probability that a woman will seek care for PNC after delivery</span>
            <span class="s1">&#39;care_seeking_for_first_pnc_visit&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_care_seeking_for_first_pnc_visit</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine if a mother will seek care for treatment in the instance of an</span>
            <span class="c1"># emergency complication postnatally (sepsis or haemorrhage)</span>
            <span class="s1">&#39;care_seeking_postnatal_complication_mother&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_care_seeking_postnatal_complication_mother</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine if a mother will seek care for treatment for her newborn in the</span>
            <span class="c1"># instance of them developing an emergency complication postnatally (sepsis)</span>
            <span class="s1">&#39;care_seeking_postnatal_complication_neonate&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_care_seeking_postnatal_complication_neonate</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

            <span class="c1"># This equation is used to determine if a mother will seek care for treatment for her obstetric fistula</span>
            <span class="s1">&#39;care_seeking_for_fistula_repair&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span>
                <span class="n">postnatal_supervisor_lm</span><span class="o">.</span><span class="n">predict_care_seeking_for_fistula_repair</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">),</span>

        <span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HIV module is not registered in this simulation run and therefore HIV &#39;</span>
                                               <span class="s1">&#39;testing will not happen in postnatal care&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_inj_abx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_full_supp_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_obstetric_fistula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.further_on_birth_postnatal_supervisor"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.further_on_birth_postnatal_supervisor">[docs]</a>    <span class="k">def</span> <span class="nf">further_on_birth_postnatal_supervisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>

        <span class="c1"># We store the ID number of the child this woman has most recently delivered as a property of the woman. This is</span>
        <span class="c1"># because PNC is scheduled for the woman during the Labour Module but must act on both mother and child. If this</span>
        <span class="c1"># is a twin birth, only the id of the first born child is stored</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_id</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Here we determine if, following childbirth, this woman will develop a fistula</span>
            <span class="n">risk_of_fistula</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span>
                <span class="s1">&#39;obstetric_fistula&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">mother_id</span><span class="p">]])[</span><span class="n">mother_id</span><span class="p">]</span>

            <span class="c1"># todo: link with PNC (assessment), allow treatment post day 42 (dalys?)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_fistula</span><span class="p">:</span>
                <span class="c1"># We determine the specific type of fistula this woman is experiencing, to match with DALY weights</span>
                <span class="n">fistula_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;vesicovaginal&#39;</span><span class="p">,</span> <span class="s1">&#39;rectovaginal&#39;</span><span class="p">],</span>
                                               <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prevalence_type_of_fistula&#39;</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_obstetric_fistula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fistula_type</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> has developed a </span><span class="si">{</span><span class="n">fistula_type</span><span class="si">}</span><span class="s1"> post delivery&#39;</span><span class="p">)</span>

                <span class="c1"># Store the onset weight for daly calculations</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fistula_type</span><span class="si">}</span><span class="s1">_fistula_onset&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;fistula&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Determine if she will seek care for repair</span>
                <span class="n">care_seeking_for_repair</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span>
                    <span class="s1">&#39;care_seeking_for_fistula_repair&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">mother_id</span><span class="p">]])[</span><span class="n">mother_id</span><span class="p">]</span>

                <span class="c1"># Schedule repair to occur for 1 week postnatal</span>
                <span class="k">if</span> <span class="n">care_seeking_for_repair</span><span class="p">:</span>
                    <span class="n">repair_hsi</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_TreatmentForObstetricFistula</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span>
                    <span class="n">repair_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">42</span><span class="p">)))</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> will seek care for fistula repair on &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">repair_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">repair_hsi</span><span class="p">,</span>
                                                                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="n">repair_date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="n">repair_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

            <span class="c1"># ======================= CONTINUATION OF COMPLICATIONS INTO THE POSTNATAL PERIOD =========================</span>
            <span class="c1"># Certain conditions experienced in pregnancy are liable to continue into the postnatal period</span>

            <span class="c1"># HYPERTENSIVE DISORDERS...</span>
            <span class="c1"># The majority of hypertension related to pregnancy resolve with delivery of the foetus. However the</span>
            <span class="c1"># condition</span>
            <span class="c1"># may persist (and even onset within the postnatal period...)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_htn_persists&#39;</span><span class="p">]:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> will remain hypertensive despite &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;successfully delivering&#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;hypertension_onset&#39;</span><span class="p">]):</span>
                        <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;hypertension_resolution&#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;resolved&#39;</span>

            <span class="c1"># Currently we assume women who received antihypertensive in the antenatal period will continue to use them</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1">#  DEFICIENCIES/ANAEMIA...</span>
            <span class="c1"># We carry across any deficiencies that may increase this womans risk of postnatal anaemia</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">,</span>
                                                                                         <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span>
                                                                                         <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">,</span>
                                                                                         <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">mother_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">)</span>

            <span class="c1"># And similarly, if she is already anaemic then she remains so in the postnatal period</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span>

            <span class="c1"># Finally we call a function in the PregnancySupervisor module to reset the variables from pregnancy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pregnancy_supervisor_property_reset</span><span class="p">(</span>
                <span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is PostnatalSupervisor, being alerted about a health system &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;interaction person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is PostnatalSupervisor reporting my health values&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">daly_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">daly_series</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.set_infections"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.set_infections">[docs]</a>    <span class="k">def</span> <span class="nf">set_infections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">infection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the PostnatalWeekOne event to calculate a womans risk of developing an infection</span>
<span class="sd">        in the first week after birth and store that infection.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param infection: the infection for which risk of infection is being determined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Individual risk is calculated via the linear model</span>
        <span class="n">risk_infection</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">infection</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
            <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># If the infection will happen, it is stored in the bit set property and tracked</span>
        <span class="k">if</span> <span class="n">risk_infection</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed </span><span class="si">{</span><span class="n">infection</span><span class="si">}</span><span class="s1"> infection in week one of &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;the postnatal period&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">infection</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">infection</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.set_postnatal_complications_mothers"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.set_postnatal_complications_mothers">[docs]</a>    <span class="k">def</span> <span class="nf">set_postnatal_complications_mothers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">week</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the PostnatalSupervisor event. It applies risk of key complications to a subset of</span>
<span class="sd">        women during each week of the postnatal period starting from week 2. Currently this includes infection, sepsis,</span>
<span class="sd">        anaemia and hypertension</span>
<span class="sd">        :param week: week in the postnatal period used to select women in the data frame.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">apply_linear_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply_linear_model</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">def</span> <span class="nf">onset</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Runs a specific equation within the linear model for the appropriate subset of women in the postnatal period</span>
<span class="sd">             and returns a BOOL series</span>
<span class="sd">            :param eq: linear model equation</span>
<span class="sd">            :return: BOOL series</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">onset_condition</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">eq</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]])</span>
            <span class="k">return</span> <span class="n">onset_condition</span>

        <span class="c1"># -------------------------------------- INFECTIONS ---------------------------------------------------------</span>
        <span class="c1"># First we use the onset function to determine any women will develop any infections that will precede</span>
        <span class="c1"># sepsis at this point in their postnatal period</span>
        <span class="n">onset_endo</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;endometritis&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_endo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_endo</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed endometritis during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;of the postnatal period,</span><span class="si">{</span><span class="n">onset_endo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_endo</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">onset_endo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_endo</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">)</span>

        <span class="n">onset_uti</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_uti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_uti</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed a UTI during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;of the postnatal period, </span><span class="si">{</span><span class="n">onset_uti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_uti</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">onset_uti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_uti</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">)</span>

        <span class="n">onset_ssti</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_ssti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_ssti</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed a skin/soft tissue infection during &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of the postnatal period </span><span class="si">{</span><span class="n">onset_ssti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_ssti</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">onset_ssti</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_ssti</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">)</span>

        <span class="n">onset_other_inf</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_other_inf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_other_inf</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed another infection during &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of the postnatal period, &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">onset_other_inf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_other_inf</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">onset_other_inf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_other_inf</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>

        <span class="c1"># -------------------------------------- SEPSIS --------------------------------------------------------------</span>
        <span class="c1"># Next we run the linear model to see if any of the women who developed infections will lead go on to develop</span>
        <span class="c1"># maternal postnatal sepsis</span>
        <span class="n">onset_sepsis</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;sepsis_late_postpartum&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># If sepsis develops we use this property to denote that these women are experiencing an emergency and may need</span>
        <span class="c1"># to seek care</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;sepsis_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed sepsis during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;the postnatal period, </span><span class="si">{</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">])</span>

        <span class="c1"># ------------------------------------ SECONDARY PPH ----------------------------------------------------------</span>
        <span class="c1"># Next we determine if any women will experience postnatal bleeding</span>
        <span class="n">onset_pph</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;secondary_postpartum_haem&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># And set the emergency property</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;secondary_pph_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed secondary pph during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1">&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; of the postnatal period, </span><span class="si">{</span><span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;secondary_pph&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">onset_pph</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_pph</span><span class="p">])</span>

        <span class="c1"># ---------------------------------- DEFICIENCIES AND ANAEMIA --------------------------------------------------</span>
        <span class="k">def</span> <span class="nf">apply_risk</span><span class="p">(</span><span class="n">deficiency</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;iron&#39;</span> <span class="ow">or</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;folate&#39;</span><span class="p">:</span>
                <span class="c1"># First we select a subset of the pregnant population who are not suffering from the deficiency in</span>
                <span class="c1"># question. (When applying risk of iron/folate deficiency we fist apply risk to women not on iron/folic</span>
                <span class="c1"># acid treatment)</span>
                <span class="n">selected_women</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span> <span class="n">deficiency</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># As IFA treatment does not effect B12 we select the appropriate women regardless of IFA treatment</span>
                <span class="c1"># status</span>
                <span class="n">selected_women</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span> <span class="n">deficiency</span><span class="p">)</span>

            <span class="c1"># We determine their risk of deficiency</span>
            <span class="n">new_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_women</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_per&#39;</span>
                                                                                     <span class="sa">f</span><span class="s1">&#39;_week_pn&#39;</span><span class="p">],</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">selected_women</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># And change their property accordingly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">deficiency</span> <span class="o">==</span> <span class="s1">&#39;b12&#39;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Next we select women who aren&#39;t deficient of iron/folate but are receiving IFA treatment</span>
                <span class="n">def_treatment</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_all</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="n">week</span><span class="p">),</span> <span class="n">deficiency</span><span class="p">)</span>

                <span class="c1"># We reduce their individual risk of deficiencies due to treatment and make changes to the data frame</span>
                <span class="n">risk_of_def</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_per_week_pn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rr_</span><span class="si">{</span><span class="n">deficiency</span><span class="si">}</span><span class="s1">_def_ifa_pn&#39;</span><span class="p">]</span>
                <span class="n">new_def</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">def_treatment</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">risk_of_def</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">def_treatment</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_def</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_def</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">deficiency</span><span class="p">)</span>

        <span class="c1"># Now we run the function for each</span>
        <span class="k">for</span> <span class="n">deficiency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">]:</span>
            <span class="n">apply_risk</span><span class="p">(</span><span class="n">deficiency</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------- ANAEMIA ----------------------------------------------------------</span>
        <span class="c1"># Then we apply a risk of anaemia developing in this week, and determine its severity</span>
        <span class="n">onset_anaemia</span> <span class="o">=</span> <span class="n">onset</span><span class="p">(</span><span class="s1">&#39;anaemia_after_pregnancy&#39;</span><span class="p">)</span>
        <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                           <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_type_of_anaemia_pn&#39;</span><span class="p">],</span>
                                                           <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">])),</span>
                                           <span class="n">index</span><span class="o">=</span><span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice_severity</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s2">&quot;pn_anaemia_following_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_anaemia_pp_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed anaemia during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1">&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; of the postnatal period, </span><span class="si">{</span><span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_anaemia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">onset_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_anaemia</span><span class="p">])</span>

        <span class="c1"># --------------------------------------- HYPERTENSION ------------------------------------------</span>
        <span class="c1"># For women who are still experiencing a hypertensive disorder of pregnancy we determine if that will now</span>
        <span class="c1"># resolve</span>

        <span class="n">women_with_htn</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|severe_gest_htn|mild_pre_eclamp|severe_pre_eclamp|&#39;</span>
                                                 <span class="s1">&#39;eclampsia&#39;</span><span class="p">))]</span>

        <span class="n">resolvers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">women_with_htn</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_htn_resolves&#39;</span><span class="p">],</span>
                              <span class="n">index</span><span class="o">=</span><span class="n">women_with_htn</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">resolvers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resolvers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;hypertension_onset&#39;</span><span class="p">]):</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;hypertension_resolution&#39;</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resolvers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resolvers</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;resolved&#39;</span>

        <span class="c1"># And for the women who&#39;s hypertension doesnt resolve we now see if it will progress to a worsened state</span>
        <span class="c1"># This uses the transition_states function to move women between states based on the probability matrix</span>

        <span class="k">def</span> <span class="nf">apply_risk</span><span class="p">(</span><span class="n">selected</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">):</span>

            <span class="n">disease_states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">disease_states</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_states</span><span class="p">)</span>

            <span class="n">risk_ghtn_remains_mild</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">-</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">)</span>

            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">risk_ghtn_remains_mild</span><span class="p">,</span> <span class="n">risk_of_gest_htn_progression</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix_pn&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_sgh_matrix_pn&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mpe_matrix_pn&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_spe_matrix_pn&#39;</span><span class="p">]</span>
            <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_ec_matrix_pn&#39;</span><span class="p">]</span>

            <span class="n">current_status</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;pn_htn_disorders&quot;</span><span class="p">]</span>
            <span class="n">new_status</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transition_states</span><span class="p">(</span><span class="n">current_status</span><span class="p">,</span> <span class="n">prob_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s2">&quot;pn_htn_disorders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_status</span>

            <span class="c1"># Then we determine which women have transitioned to the most severe states, and may choose to seek care</span>
            <span class="n">assess_status_change_for_severe_pre_eclampsia</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span> <span class="o">&amp;</span> \
                                                            <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span>

            <span class="n">new_onset_severe_pre_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">[</span>
                <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">]</span>

            <span class="c1"># We log the women who have transitioned to severe pre-eclampsia and set pn_emergency_event_mother to True</span>
            <span class="c1"># so they may seek care</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s1">&#39;The following women have developed severe pre-eclampsia following their &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;pregnancy </span><span class="si">{</span><span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># This process is repeated for women who have now developed eclampsia</span>
            <span class="n">assess_status_change_for_eclampsia</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span>
            <span class="n">new_onset_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_eclampsia</span><span class="p">[</span><span class="n">assess_status_change_for_eclampsia</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed eclampsia during week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;the postnatal period: </span><span class="si">{</span><span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">women_with_htn_not_on_anti_htns</span> <span class="o">=</span>\
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|severe_gest_htn|mild_pre_eclamp|severe_pre_eclamp|&#39;</span>
                                                 <span class="s1">&#39;eclampsia&#39;</span><span class="p">))</span> <span class="o">&amp;</span> \
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">pn_gest_htn_on_treatment</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span>

        <span class="n">women_with_htn_on_anti_htns</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|severe_gest_htn|mild_pre_eclamp|severe_pre_eclamp|&#39;</span>
                                                 <span class="s1">&#39;eclampsia&#39;</span><span class="p">))</span> <span class="o">&amp;</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">pn_gest_htn_on_treatment</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">hs_is_inpatient</span>

        <span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_with_htn_not_on_anti_htns</span><span class="p">,</span> <span class="n">risk_progression_mild_to_severe_htn</span><span class="p">)</span>
        <span class="n">apply_risk</span><span class="p">(</span><span class="n">women_with_htn_on_anti_htns</span><span class="p">,</span> <span class="p">(</span><span class="n">risk_progression_mild_to_severe_htn</span> <span class="o">*</span>
                                                 <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_anti_htns_progression_pn&#39;</span><span class="p">]))</span>

        <span class="c1">#  -------------------------------- RISK OF PRE-ECLAMPSIA HYPERTENSION --------------------------------------</span>
        <span class="c1"># Here we apply a risk to women developing de-novo hypertensive in the later postnatal period</span>
        <span class="n">pre_eclampsia</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;pre_eclampsia_pn&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed pre_eclampsia in week </span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of the&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; postnatal period: </span><span class="si">{</span><span class="n">pre_eclampsia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pre_eclampsia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">#  -------------------------------- RISK OF GESTATIONAL HYPERTENSION --------------------------------------</span>
        <span class="n">gest_hypertension</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;gest_htn_pn&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have developed gestational hypertension in week &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">week</span><span class="si">}</span><span class="s1"> of the postnatal period &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">gest_hypertension</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gest_hypertension</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># -------------------------------- RISK OF DEATH SEVERE HYPERTENSION ------------------------------------------</span>
        <span class="c1"># Risk of death is applied to women with severe hypertensive disease</span>
        <span class="n">at_risk_of_death_htn</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;death_from_hypertensive_disorder_pn&#39;</span><span class="p">],</span>
                                                  <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span>
                                                         <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
                                                         <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;severe_gest_htn|&#39;</span>
                                                                                              <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">))])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;The following women have died due to severe hypertensive disorder,&#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1"> in the postnatal period&#39;</span><span class="p">)</span>

            <span class="c1"># Those women who die have InstantaneousDeath scheduled</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">at_risk_of_death_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">at_risk_of_death_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                        <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">])</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>

        <span class="c1"># ----------------------------------------- CARE SEEKING ------------------------------------------------------</span>
        <span class="c1"># We now use the the pn_emergency_event_mother property that has just been set for women who are experiencing</span>
        <span class="c1"># severe complications to select a subset of women who may choose to seek care</span>
        <span class="n">care_seeking</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_postnatal_complication_mother&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">week</span><span class="p">)</span> <span class="o">&amp;</span>
                   <span class="n">df</span><span class="p">[</span><span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]])</span>

        <span class="c1"># Reset this property to stop repeat care seeking</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Schedule the HSI event</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">admission_event</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_PostnatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission_event</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># For women who do not seek care we immediately apply risk of death due to complications</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;mother&#39;</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.apply_risk_of_neonatal_complications_in_week_one"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.apply_risk_of_neonatal_complications_in_week_one">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_neonatal_complications_in_week_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child_id</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by PostnatalWeekOneEvent for newborns to determine risk of complications. Currently</span>
<span class="sd">        this is limited to early onset neonatal sepsis</span>
<span class="sd">        :param child_id: childs individual id</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">abx_status</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;abx_for_prom_given&#39;</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Newborn </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has arrived at PostnatalWeekOneEvent&#39;</span><span class="p">)</span>

        <span class="c1"># We then apply a risk that this womans newborn will develop sepsis during week one</span>
        <span class="n">risk_eons</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;early_onset_neonatal_sepsis_week_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">child_id</span><span class="p">]],</span> <span class="n">received_abx_for_prom</span><span class="o">=</span><span class="n">abx_status</span><span class="p">)[</span><span class="n">child_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_eons</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Newborn </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> has developed early onset sepsis in week one of &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;the neonatal period&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;early_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.set_postnatal_complications_neonates"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.set_postnatal_complications_neonates">[docs]</a>    <span class="k">def</span> <span class="nf">set_postnatal_complications_neonates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upper_and_lower_day_limits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the PostnatalSupervisor event. It applies risk of key complication to neonates</span>
<span class="sd">        during each week of the neonatal period after week one (weeks 2, 3 &amp; 4). This is currently limited to sepsis but</span>
<span class="sd">         may be expanded at a later date</span>
<span class="sd">        :param upper_and_lower_day_limits: 2 value list of the first and last day of each week of the neonatal period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">apply_linear_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply_linear_model</span>

        <span class="c1"># Here we apply risk of late onset neonatal sepsis (sepsis onsetting after day 7) to newborns</span>
        <span class="n">onset_sepsis</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;late_onset_neonatal_sepsis&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_and_lower_day_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                   <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_days&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">upper_and_lower_day_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]])</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;late_neonatal_sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Then we determine if care will be sought for newly septic newborns</span>
        <span class="n">care_seeking</span> <span class="o">=</span> <span class="n">apply_linear_model</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_postnatal_complication_neonate&#39;</span><span class="p">],</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">onset_sepsis</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>

        <span class="c1"># We schedule the HSI according</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">admission_event</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission_event</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># And apply risk of death for newborns for which care is not sought</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">care_seeking</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">care_seeking</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.assessment_for_maternal_complication_during_pnc"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.assessment_for_maternal_complication_during_pnc">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_for_maternal_complication_during_pnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by each of the postnatal care visit HSIs and represents assessment of mothers for</span>
<span class="sd">        sepsis, postnatal bleeding, hypertension and anaemia. If these conditions are detected during PNC then women</span>
<span class="sd">        are admitted for treatment</span>
<span class="sd">        :param individual_id: individual_id (mother)</span>
<span class="sd">        :param hsi_event: HSI event in which this function is called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># We create a variable that will be set to true if a health work detects a complication and chooses to admit</span>
        <span class="c1"># (in case of multiple complications requiring admission)</span>
        <span class="n">needs_admission</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># similarly for detection of these conditions</span>
        <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Each woman is screened for postnatal depression</span>
        <span class="k">if</span> <span class="s1">&#39;Depression&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_depression_screen_pnc&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will now be receive screening for depression&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; during PNC and commence treatment as appropriate&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;de_ever_diagnosed_depression&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Depression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_when_suspected_depression</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

        <span class="c1"># Define the consumables</span>
        <span class="n">item_code_urine_dipstick</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Test strips, urine analysis&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_dipstick</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_urine_dipstick</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_dipstick</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_urine_dipstick</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span>
                                                                                          <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention&#39;</span>
                                                                                                   <span class="s1">&#39;_delivered_urine_&#39;</span>
                                                                                                   <span class="s1">&#39;ds_pnc&#39;</span><span class="p">]):</span>

            <span class="c1"># If the consumables are available the test is ran. Urine testing in ANC is predominantly used to detected</span>
            <span class="c1"># protein in the urine (proteinuria) which is indicative of pre-eclampsia</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;urine_dipstick_protein_pn&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="c1"># We use a temporary variable to store if proteinuria is detected (only sever diseases or new diagnosis</span>
                <span class="c1"># lead to admission)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span>\
                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
                    <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Urine dipstick testing was not completed in this PNC visit due to &#39;</span>
                                         <span class="s1">&#39;unavailable consumables&#39;</span><span class="p">)</span>

        <span class="c1"># The process is repeated for blood pressure monitoring- although not conditioned on consumables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_bp_pnc&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_pressure_measurement_pn&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
                    <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hypertension_onset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hypertension_diagnosed</span> <span class="ow">or</span> <span class="n">proteinuria_diagnosed</span><span class="p">:</span>
            <span class="n">needs_admission</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># SEPSIS</span>
        <span class="c1"># Women are assessed for key complications after child birth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_sep_assessment_pnc&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;assessment_for_postnatal_&#39;</span>
                                                                                       <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been assessed and diagnosed with &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;postpartum sepsis, she will be admitted for treatment&#39;</span><span class="p">)</span>

                <span class="n">needs_admission</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># HAEMORRHAGE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_pph_assessment_pnc&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;assessment_for_secondary_pph&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been assessed and diagnosed with&#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39; secondary postpartum haemorrhage hypertension, she will be &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;admitted for treatment&#39;</span><span class="p">)</span>
                <span class="n">needs_admission</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_poct_pnc&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;point_of_care_hb_test_pn&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been assessed and diagnosed with postpartum &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;anaemia, she will be admitted for treatment&#39;</span><span class="p">)</span>
                <span class="n">needs_admission</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># If any of the above complications have been detected then the woman is admitted from PNC visit to the</span>
        <span class="c1"># Postnatal ward for further care</span>
        <span class="k">if</span> <span class="n">needs_admission</span><span class="p">:</span>
            <span class="n">admission_event</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_PostnatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission_event</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.assessment_for_neonatal_complications_during_pnc"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.assessment_for_neonatal_complications_during_pnc">[docs]</a>    <span class="k">def</span> <span class="nf">assessment_for_neonatal_complications_during_pnc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">pnc_visit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by each of the postnatal care visit HSI and represents assessment of neonates for</span>
<span class="sd">        sepsis. If sepsis is detected during PNC then the neonate is  admitted for treatment.</span>
<span class="sd">        :param individual_id: individual_id (child)</span>
<span class="sd">        :param hsi_event: HSI event in which this function is called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;mother_id&#39;</span><span class="p">]</span>

        <span class="c1"># As with assessment_for_maternal_complication_during_pnc neonates are assessed for complications and admitted</span>
        <span class="c1"># as required (we specify which PNC visit this is occurring in due to a different property being used for the</span>
        <span class="c1"># type of sepsis)</span>

        <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># SEPSIS</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pnc_visit</span> <span class="o">==</span> <span class="s1">&#39;pnc1&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_neonatal_sepsis_pnc&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
              <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;assessment_for_early_onset_neonatal_sepsis&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been assessed and diagnosed with early &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;onset neonatal sepsis, they will be admitted for treatment&#39;</span><span class="p">)</span>

                <span class="n">sepsis_treatment</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">sepsis_treatment</span><span class="p">,</span>
                                                                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">pnc_visit</span> <span class="o">==</span> <span class="s1">&#39;pnc2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_neonatal_sepsis_pnc&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;assessment_for_late_onset_&#39;</span>
                                                                                       <span class="s1">&#39;neonatal_sepsis&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Neonate </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been assessed and diagnosed with late &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;onset neonatal sepsis, they will be admitted for treatment&#39;</span><span class="p">)</span>

                <span class="n">sepsis_treatment</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">sepsis_treatment</span><span class="p">,</span>
                                                                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pnc_visit</span> <span class="o">==</span> <span class="s1">&#39;pnc2&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_hiv_test_pnc&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hv_diagnosed&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;hv_diagnosed&#39;</span><span class="p">]:</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Neonate of a HIV +ve mother has been referred for &#39;</span>
                                                     <span class="s1">&#39;HIV testing during PNC at 6 weeks&#39;</span><span class="p">)</span>

                    <span class="n">individual_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                        <span class="n">HSI_Hiv_TestAndRefer</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]),</span>
                        <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">mother_id</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.apply_risk_of_maternal_or_neonatal_death_postnatal"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.apply_risk_of_maternal_or_neonatal_death_postnatal">[docs]</a>    <span class="k">def</span> <span class="nf">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_or_child</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called to calculate an individuals risk of death following the onset of a complication. For</span>
<span class="sd">        individuals who dont seek care this is immediately after the onset of complications. For those who seek care it</span>
<span class="sd">        is called at the end of the HSI to allow for treatment effects. Either a mother or a child can be passed to the</span>
<span class="sd">        function.</span>
<span class="sd">        :param mother_or_child: Person of interest for the effect of this function - pass &#39;mother&#39; or &#39;child&#39; to</span>
<span class="sd">         apply risk of death correctly</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Select the individuals row in the data frame to prevent repeated at based indexing</span>
        <span class="k">if</span> <span class="n">mother_or_child</span> <span class="o">==</span> <span class="s1">&#39;mother&#39;</span><span class="p">:</span>
            <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mother_or_child</span> <span class="o">==</span> <span class="s1">&#39;child&#39;</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># ================================== MATERNAL DEATH EQUATIONS ==============================================</span>
        <span class="c1"># We cycle through the possible causes of death to allow for increased risk of death in women with multiple</span>
        <span class="c1"># complications</span>
        <span class="k">if</span> <span class="n">mother_or_child</span> <span class="o">==</span> <span class="s1">&#39;mother&#39;</span><span class="p">:</span>
            <span class="n">postnatal_death</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># If the mother has had a hemorrhage and hasn&#39;t sought care, we calculate her risk of death</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_postpartum_haem_secondary</span><span class="p">:</span>
                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;secondary_postpartum_haem_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                    <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
                    <span class="n">postnatal_death</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># If she will survive we reset the relevant variable in the data frame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># If the mother is septic and hasn&#39;t sought care, we calculate her risk of death</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_sepsis_late_postpartum</span><span class="p">:</span>

                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;postnatal_sepsis_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                    <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
                    <span class="n">postnatal_death</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># If she will survive we reset the relevant variable in the data frame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>

            <span class="c1"># Finally if the mother has eclampsia we calculate risk of death</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;eclampsia_death_pn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
                    <span class="n">postnatal_death</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span>

            <span class="c1"># If she has died due to either (or both) of these causes, we schedule the DeathEvent</span>
            <span class="k">if</span> <span class="n">postnatal_death</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has died due to complications of the &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;postnatal period&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;maternal&#39;</span><span class="p">,</span>
                                                        <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># ================================== NEONATAL DEATH EQUATIONS ==============================================</span>
        <span class="k">if</span> <span class="n">mother_or_child</span> <span class="o">==</span> <span class="s1">&#39;child&#39;</span><span class="p">:</span>

            <span class="c1"># Neonates can have either early or late onset sepsis, not both at once- so we use either equation</span>
            <span class="c1"># depending on this neonates current condition</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_early_neonatal</span><span class="p">:</span>
                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;early_onset_neonatal_sepsis_week_1_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_late_neonatal</span><span class="p">:</span>
                <span class="n">risk_of_death</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;late_neonatal_sepsis_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                    <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_late_neonatal</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_early_neonatal</span><span class="p">:</span>

                <span class="c1"># If this neonate will die then we make the appropriate changes</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_death</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has died due to late neonatal sepsis on &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;neonatal&#39;</span><span class="p">,</span>
                                                            <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PostnatalSupervisor&#39;</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;neonatal_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Otherwise we reset the variables in the data frame</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="c1"># For surviving neonates we determine if they will experience any long term disability from their</span>
                    <span class="c1"># infection</span>
                    <span class="n">disability_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;mild_motor_and_cog&#39;</span><span class="p">,</span>  <span class="c1"># Mild motor plus cognitive impairments due to...</span>
                                             <span class="s1">&#39;mild_motor&#39;</span><span class="p">,</span>  <span class="c1"># Mild motor impairment due to...</span>
                                             <span class="s1">&#39;moderate_motor&#39;</span><span class="p">,</span>  <span class="c1"># Moderate motor impairment due to...</span>
                                             <span class="s1">&#39;severe_motor&#39;</span><span class="p">]</span>  <span class="c1"># Severe motor impairment due to...</span>
                    <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_neonatal_sepsis_disab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">disability_categories</span><span class="p">,</span>
                                                                              <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_sepsis_disabilities&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="PostnatalSupervisor.maternal_postnatal_care_care_seeking"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisor.maternal_postnatal_care_care_seeking">[docs]</a>    <span class="k">def</span> <span class="nf">maternal_postnatal_care_care_seeking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">recommended_day_next_pnc</span><span class="p">,</span> <span class="n">next_pnc_visit</span><span class="p">,</span>
                                             <span class="n">maternal_pnc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_PostnatalSupervisor_PostnatalCareContact. It determines if a mother</span>
<span class="sd">        will return to attend her next PNC visit in the schedule</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param recommended_day_next_pnc: int signifying number of days post birth the next visit should occur</span>
<span class="sd">        :param next_pnc_visit: string signifying next visit in schedule i.e. &#39;pnc2&#39;</span>
<span class="sd">        :param maternal_pnc: HSI to be scheduled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Calculate how many days since this woman has given birth</span>
        <span class="n">ppp_in_days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span>

        <span class="c1"># Calculate home many days until the next visit should be scheduled</span>
        <span class="n">days_calc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">recommended_day_next_pnc</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">ppp_in_days</span>
        <span class="n">date_next_pnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">days_calc</span>

        <span class="c1"># Apply a probability that she will chose to return for the next visit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_attend_</span><span class="si">{</span><span class="n">next_pnc_visit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">maternal_pnc</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">date_next_pnc</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">date_next_pnc</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="PostnatalSupervisorEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisorEvent">[docs]</a><span class="k">class</span> <span class="nc">PostnatalSupervisorEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is the PostnatalSupervisorEvent. It runs every week and applies risk of disease onset/resolution to women</span>
<span class="sd">    in the postnatal period of their pregnancy (48hrs - +42days post birth) &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PostnatalSupervisorEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisorEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="PostnatalSupervisorEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalSupervisorEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># ================================ UPDATING LENGTH OF POSTPARTUM PERIOD  IN WEEKS  ============================</span>
        <span class="c1"># Here we update how far into the postpartum period each woman who has recently delivered is</span>
        <span class="n">alive_and_recently_delivered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span>
        <span class="n">ppp_in_days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_recently_delivered</span><span class="p">,</span> <span class="s1">&#39;la_date_most_recent_delivery&#39;</span><span class="p">]</span>
        <span class="n">ppp_in_weeks</span> <span class="o">=</span> <span class="n">ppp_in_days</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="n">rounded_weeks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ppp_in_weeks</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_recently_delivered</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rounded_weeks</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;updating postnatal periods on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Check that all women are week 1 or above</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">alive_and_recently_delivered</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># ================================= COMPLICATIONS/CARE SEEKING FOR WOMEN ======================================</span>
        <span class="c1"># This function is called to apply risk of complications to women in weeks 2, 3, 4, 5 and 6 of the postnatal</span>
        <span class="c1"># period</span>
        <span class="k">for</span> <span class="n">week</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postnatal_complications_mothers</span><span class="p">(</span><span class="n">week</span><span class="o">=</span><span class="n">week</span><span class="p">)</span>

        <span class="c1"># ================================= COMPLICATIONS/CARE SEEKING FOR NEONATES ===================================</span>
        <span class="c1"># Next this function is called to apply risk of complications to neonates in week 2, 3 and 4 of the neonatal</span>
        <span class="c1"># period. Upper and lower limit days in the week are used to define one week.</span>
        <span class="k">for</span> <span class="n">upper_and_lower_day_limits</span> <span class="ow">in</span> <span class="p">[[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">29</span><span class="p">]]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_postnatal_complications_neonates</span><span class="p">(</span><span class="n">upper_and_lower_day_limits</span><span class="o">=</span><span class="n">upper_and_lower_day_limits</span><span class="p">)</span>

        <span class="c1"># -------------------------------------- RESETTING VARIABLES --------------------------------------------------</span>
        <span class="c1"># Finally we reset any variables that have been modified during this module</span>
        <span class="c1"># We make these changes 2 weeks after the end of the postnatal and neonatal period in case of either mother or</span>
        <span class="c1"># newborn are receiving treatment following the last PNC visit (around day 42)</span>

        <span class="c1"># Maternal variables</span>
        <span class="n">week_8_postnatal_women</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postpartum_infections_late</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="s1">&#39;b12&#39;</span><span class="p">)</span>

        <span class="n">week_8_postnatal_women_htn</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_htn_disorders</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;gest_htn|severe_gest_htn|mild_pre_eclamp|severe_pre_eclamp|eclampsia&#39;</span><span class="p">))</span>

        <span class="c1"># Schedule date of resolution for any women with hypertension</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">week_8_postnatal_women_htn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women_htn</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;hypertension_onset&#39;</span><span class="p">]):</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;hypertension_resolution&#39;</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

        <span class="n">week_8_postnatal_women_anaemia</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">la_is_postpartum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_postnatal_period_in_weeks</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pn_anaemia_following_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1"># Schedule date of resolution for any women with anaemia</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">week_8_postnatal_women_anaemia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women_anaemia</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]:</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">severity</span><span class="si">}</span><span class="s1">_anaemia_pp_resolution&#39;</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

        <span class="c1"># Reset any treatment variables</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">,</span> <span class="s1">&#39;pn_emergency_event_mother&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Schedule event that deletes the mni dictionary, we reset in greater than one months time to allow dalys to be</span>
        <span class="c1"># counted</span>

        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">week_8_postnatal_women</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_8_postnatal_women</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Neonatal variables</span>
        <span class="n">week_6_postnatal_neonates</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_days&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_days&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">49</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_6_postnatal_neonates</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_6_postnatal_neonates</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_6_postnatal_neonates</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_neonatal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_6_postnatal_neonates</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_inj_abx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">week_6_postnatal_neonates</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_full_supp_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="PostnatalWeekOneEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalWeekOneEvent">[docs]</a><span class="k">class</span> <span class="nc">PostnatalWeekOneEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is PostnatalWeekOneEvent. It is scheduled for all mothers who survive labour and the first 48 hours after</span>
<span class="sd">    birth. This event applies risk of key complications that can occur in the first week after birth to both these</span>
<span class="sd">    mothers and their recently delivered newborn. This event also determines if a woman will seek care, with her</span>
<span class="sd">    newborn, for their first postnatal care visit on day 7 after birth. For women who dont seek care for themselves,</span>
<span class="sd">    or their newborns, risk of death is applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PostnatalWeekOneEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalWeekOneEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostnatalWeekOneEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalWeekOneEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">])</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">]</span>

        <span class="c1"># If the child of interest is the first born in a twin pair, we store the id number of their sibling to allow</span>
        <span class="c1"># application of risk to both babies</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="n">child_two_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span>
            <span class="n">child_two</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">]</span>

        <span class="c1"># Run a number of checks to ensure only the correct women/children arrive here</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_is_postpartum</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_date_most_recent_delivery</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">child</span><span class="o">.</span><span class="n">age_days</span> <span class="o">&lt;</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">child_two</span><span class="o">.</span><span class="n">age_days</span> <span class="o">&lt;</span> <span class="mi">7</span>

        <span class="c1"># If both the mother and newborn have died then this even wont run (it is possible for one or the other to have</span>
        <span class="c1"># died prior to this event- hence repeat checks on is_alive throughout)</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># If the mother and both neonates in a twin pair have died then this event wont run</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="o">~</span><span class="n">child</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="o">~</span><span class="n">child_two</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># ===============================  MATERNAL COMPLICATIONS IN WEEK ONE  =======================================</span>
        <span class="c1">#  ------------------------------------- INFECTIONS AND SEPSIS ----------------------------------------------</span>
        <span class="c1"># We determine if the mother will develop any postnatal infections and if they will progress into sepsis</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has arrived at PostnatalWeekOneEvent&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">infection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">,</span> <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">,</span> <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">set_infections</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">infection</span><span class="o">=</span><span class="n">infection</span><span class="p">)</span>

            <span class="n">risk_sepsis</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;sepsis_late_postpartum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">risk_sepsis</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed postnatal sepsis during week one of the&#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39; postnatal period&#39;</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;sepsis_onset&#39;</span><span class="p">)</span>

        <span class="c1">#  ---------------------------------------- SECONDARY PPH ------------------------------------------------</span>
            <span class="c1"># Next we apply risk of secondary postpartum bleeding</span>
            <span class="n">risk_secondary_pph</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;secondary_postpartum_haem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                    <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">risk_secondary_pph</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed a secondary postpartum haemorrhage during&#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39; week one of the postnatal period&#39;</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;secondary_pph&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;secondary_pph_onset&#39;</span><span class="p">)</span>

        <span class="c1"># ----------------------------------- NEW ONSET DEFICIENCIES AND ANAEMIA -------------------------------------</span>
            <span class="c1"># And then risk of developing deficiencies or anaemia</span>
            <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

                <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_iron_def_per_week_pn&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span><span class="p">:</span>
                    <span class="n">risk_of_iron_def</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_iron_def_per_week_pn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_iron_def_ifa_pn&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_iron_def</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

                <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_folate_def_per_week_pn&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_iron_folic_acid_postnatal</span><span class="p">:</span>
                    <span class="n">risk_of_folate_def</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_folate_def_per_week_pn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rr_folate_def_ifa_pn&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">risk_of_folate_def</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_b12_def_per_week_pn&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">deficiencies_following_pregnancy</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_anaemia_following_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">risk_anaemia_after_pregnancy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;anaemia_after_pregnancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                        <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">risk_anaemia_after_pregnancy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                    <span class="n">random_choice_severity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                                                    <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_type_of_anaemia_pn&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_anaemia_following_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_choice_severity</span>

                    <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;pn_anaemia_following_pregnancy&quot;</span><span class="p">]</span> <span class="si">}</span><span class="s1">_&#39;</span>
                                                      <span class="sa">f</span><span class="s1">&#39;anaemia_pp_onset&#39;</span><span class="p">)</span>

            <span class="c1"># -------------------------------------------- HYPERTENSION -----------------------------------------------</span>
            <span class="c1"># For women who remain hypertensive after delivery we apply a probability that this will resolve in the</span>
            <span class="c1"># first week after birth</span>

            <span class="k">if</span> <span class="s1">&#39;none&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;resolved&#39;</span> <span class="ow">in</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_htn_resolves&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">individual_id</span><span class="p">][</span><span class="s1">&#39;hypertension_onset&#39;</span><span class="p">]):</span>
                        <span class="c1"># Store date of resolution for women who were aware of their hypertension (in keeping with daly</span>
                        <span class="c1"># weight definition)</span>
                        <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hypertension_resolution&#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;resolved&#39;</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># If not, we apply a risk that the hypertension might worsen and progress into a more severe form</span>
                    <span class="n">disease_states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span>
                    <span class="n">prob_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">disease_states</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">disease_states</span><span class="p">)</span>

                    <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mgh_matrix_pn&#39;</span><span class="p">]</span>
                    <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_sgh_matrix_pn&#39;</span><span class="p">]</span>
                    <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_mpe_matrix_pn&#39;</span><span class="p">]</span>
                    <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_spe_matrix_pn&#39;</span><span class="p">]</span>
                    <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;eclampsia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;probs_for_ec_matrix_pn&#39;</span><span class="p">]</span>

                    <span class="c1"># We modify the probability of progressing from mild to severe gestational hypertension for women</span>
                    <span class="c1"># who are on anti hypertensives</span>
                    <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]:</span>
                        <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">treatment_reduced_risk</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_anti_htns_progression_pn&#39;</span><span class="p">]</span>
                        <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">treatment_reduced_risk</span>
                        <span class="n">prob_matrix</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">treatment_reduced_risk</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>

                    <span class="n">current_status</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span>
                    <span class="n">new_status</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">transition_states</span><span class="p">(</span><span class="n">current_status</span><span class="p">,</span> <span class="n">prob_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">],</span> <span class="s2">&quot;pn_htn_disorders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_status</span>

                    <span class="c1"># We capture the women who progress to the most severe forms</span>
                    <span class="n">assess_status_change_for_severe_pre_eclampsia</span> <span class="o">=</span> \
                        <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;severe_pre_eclamp&quot;</span><span class="p">)</span>
                    <span class="n">assess_status_change_for_eclampsia</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_status</span> <span class="o">!=</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_status</span> <span class="o">==</span> <span class="s2">&quot;eclampsia&quot;</span><span class="p">)</span>

                    <span class="n">new_onset_severe_pre_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">[</span>
                            <span class="n">assess_status_change_for_severe_pre_eclampsia</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_severe_pre_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed severe pre-eclampsia in week one of &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;the postnatal period &#39;</span><span class="p">)</span>

                    <span class="n">new_onset_eclampsia</span> <span class="o">=</span> <span class="n">assess_status_change_for_eclampsia</span><span class="p">[</span><span class="n">assess_status_change_for_eclampsia</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_onset_eclampsia</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed eclampsia in week one of the &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;postnatal period &#39;</span><span class="p">)</span>

        <span class="c1">#  ---------------------------- RISK OF POSTPARTUM PRE-ECLAMPSIA/HYPERTENSION --------------------------------</span>
            <span class="c1"># Women who are normatensive after delivery may develop new hypertension for the first time after birth</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">risk_pe_after_pregnancy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;pre_eclampsia_pn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                    <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">risk_pe_after_pregnancy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed mild pre-eclampsia in week one of the &#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39;postnatal period &#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_pre_eclamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">risk_gh_after_pregnancy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;gest_htn_pn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                        <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">risk_gh_after_pregnancy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has developed gestational hypertension in week one &#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39;of the postnatal period &#39;</span><span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

        <span class="c1"># ===============================  NEONATAL COMPLICATIONS IN WEEK ONE  =======================================</span>
        <span class="c1"># Newborns may develop early onset sepsis in the first week of life, we apply that risk here</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_complications_in_week_one</span><span class="p">(</span><span class="n">child_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">,</span> <span class="n">mother_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># If this event is looking at a twin pair we apply risk to the second twin here</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">nb_is_twin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child_two</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_neonatal_complications_in_week_one</span><span class="p">(</span><span class="n">child_id</span><span class="o">=</span><span class="n">child_two_id</span><span class="p">,</span>
                                                                             <span class="n">mother_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
        <span class="c1"># ===================================== CARE SEEKING FOR PNC 1 ==============================================</span>
        <span class="c1"># Women who deliver in facilities are asked to return for a first postnatal check up at day 7 post birth</span>
        <span class="c1"># We assume that women with complications, or the mothers of babies with complications, are more likely to seek</span>
        <span class="c1"># postnatal care- and more quickly</span>

        <span class="n">mother_has_complications</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">child_has_complications</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">child_two_has_complications</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># (we check is_alive as this event can run if either the mother or child is dead (not both)</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="c1"># We use a temporary variable to determine if the mother has any complications that may trigger care seeking</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span>\
               <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>
                <span class="n">mother_has_complications</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                            <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                                      <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>

                <span class="n">mother_has_complications</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Repeat that process for the child</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]:</span>
                <span class="n">child_has_complications</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]:</span>
                <span class="n">child_has_complications</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]:</span>
                    <span class="n">child_two_has_complications</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_early_neonatal&#39;</span><span class="p">]:</span>
                    <span class="n">child_two_has_complications</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># If neither the mother or the child are experiencing any complications in the first week after birth,</span>
        <span class="c1"># we determine if they will present for the scheduled PNC check up at day 7</span>

        <span class="n">prob_will_seek_care</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pn_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;care_seeking_for_first_pnc_visit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">child_has_complications</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother_has_complications</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">child_two_has_complications</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">prob_will_seek_care</span><span class="p">:</span>
                <span class="n">days_until_day_7</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_date_most_recent_delivery</span>
                <span class="n">days_until_day_7_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">days_until_day_7</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>

                <span class="n">pnc_one</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_PostnatalCareContactOne</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">pnc_one</span><span class="p">,</span>
                                                                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span>
                                                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_day_7_int</span><span class="p">),</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># For women where either they or their baby has developed a complication during this time we assume likelihood</span>
        <span class="c1"># of care seeking for postnatal check up is higher</span>

        <span class="k">elif</span> <span class="n">mother_has_complications</span> <span class="ow">or</span> <span class="n">child_has_complications</span> <span class="ow">or</span> <span class="n">child_two_has_complications</span><span class="p">:</span>
            <span class="n">prob_care_seeking</span> <span class="o">=</span> <span class="n">prob_will_seek_care</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;multiplier_for_care_seeking_with_comps&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">prob_care_seeking</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="c1"># And we assume they will present earlier than day 7</span>
                <span class="n">admission_event</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_PostnatalCareContactOne</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission_event</span><span class="p">,</span>
                                                                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># For &#39;non-care seekers&#39; risk of death is applied immediately</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mother_has_complications</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;mother&#39;</span><span class="p">,</span>
                                                                                   <span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child_has_complications</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
                                                                                   <span class="n">individual_id</span><span class="o">=</span><span class="n">child_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child_two_has_complications</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
                                                                                   <span class="n">individual_id</span><span class="o">=</span><span class="n">child_two_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactOne"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactOne">[docs]</a><span class="k">class</span> <span class="nc">HSI_PostnatalSupervisor_PostnatalCareContactOne</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is HSI_PostnatalSupervisor_PostnatalCareContactOneMaternal. It is scheduled by</span>
<span class="sd">    PostnatalWeekOneEvent for women who decide to seek care for a postnatal checkup. This event is the first PNC visit</span>
<span class="sd">     women are recommended to attend after discharge, occurring on day 7 post birth. &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactOne.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactOne.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">PostnatalSupervisor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalSupervisor_PostnatalCareContactOne&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactOne.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactOne.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">])</span>

        <span class="c1"># We run checks to make sure only the correct people are passed to the event</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="c1"># Update the properties of the child</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="c1"># If both mother and child have died the event doesnt run</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">return</span>

        <span class="c1"># If the child is part of a twin pair</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>

            <span class="c1"># Check this is both of their first visits</span>
            <span class="n">child_two_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="c1"># If neither of the twins or the mother is alive, the event doesnt run</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> or child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> have arrived for PNC1 on date&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># If the mother is alive she is assessed for complications</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_maternal_complication_during_pnc</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># If the child/children is/are alive they are assessed for complications</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_neonatal_complications_during_pnc</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">pnc_visit</span><span class="o">=</span><span class="s1">&#39;pnc1&#39;</span><span class="p">)</span>

        <span class="c1"># If twins, the second child is also assessed</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_neonatal_complications_during_pnc</span><span class="p">(</span><span class="n">child_two_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">pnc_visit</span><span class="o">=</span><span class="s1">&#39;pnc1&#39;</span><span class="p">)</span>

        <span class="c1"># If either remain alive we determine if they will return for visit two</span>
        <span class="c1"># TODO: just realised im scheduling this event always using the mother id- even though its possible they could</span>
        <span class="c1">#  be dead (does that mater as long as it runs for the child?)</span>
        <span class="n">pnc2</span> <span class="o">=</span> <span class="n">HSI_PostnatalSupervisor_PostnatalCareContactTwo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">maternal_postnatal_care_care_seeking</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;pnc2&#39;</span><span class="p">,</span> <span class="n">pnc2</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactOne.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactOne.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalCareContactOne: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactOne.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactOne.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalCareContactOne: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactTwo"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactTwo">[docs]</a><span class="k">class</span> <span class="nc">HSI_PostnatalSupervisor_PostnatalCareContactTwo</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is HSI_PostnatalSupervisor_PostnatalCareContactTwoMaternal. It is scheduled by</span>
<span class="sd">    HSI_PostnatalSupervisor_PostnatalCareContactOneMaternal This event is the second PNC visit women</span>
<span class="sd">    are recommended to undertake at 6 weeks postnatal. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactTwo.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactTwo.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">PostnatalSupervisor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalSupervisor_PostnatalCareContactTwoMaternal&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactTwo.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactTwo.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_id_most_recent_child&#39;</span><span class="p">])</span>

        <span class="c1"># We run checks to make sure only the correct people are passed to the event</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="n">child_two_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_twin_sibling_id&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> or child </span><span class="si">{</span><span class="n">child_id</span><span class="si">}</span><span class="s1"> have arrived for PNC2 on date&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># If the mother is alive she is assessed for complications</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_maternal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_maternal_complication_during_pnc</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># If the child/children is/are alive they are assessed for complications</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_neonatal_complications_during_pnc</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">pnc_visit</span><span class="o">=</span><span class="s1">&#39;pnc2&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;nb_is_twin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_two_id</span><span class="p">,</span> <span class="s1">&#39;pn_pnc_visits_neonatal&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">assessment_for_neonatal_complications_during_pnc</span><span class="p">(</span><span class="n">child_two_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">pnc_visit</span><span class="o">=</span><span class="s1">&#39;pnc2&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactTwo.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactTwo.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalCareContactTwo: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalCareContactTwo.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalCareContactTwo.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalCareContactTwo: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalWardInpatientCare"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalWardInpatientCare">[docs]</a><span class="k">class</span> <span class="nc">HSI_PostnatalSupervisor_PostnatalWardInpatientCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is HSI_PostnatalSupervisor_PostnatalWardInpatientCare. It is scheduled by the PostnatalSupervisorEvent for</span>
<span class="sd">    women who develop complications during the postnatal period and decide to seek care or by either of the PNC HSIs for</span>
<span class="sd">     women assessed as requiring further care due to complications detected. Treatment delivered in this event includes</span>
<span class="sd">     management of hypertensive disorders, maternal sepsis, anaemia and secondary postpartum haemorrhage&quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalWardInpatientCare.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalWardInpatientCare.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">PostnatalSupervisor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalSupervisor_PostnatalWardInpatientCare&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;IPAdmission&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalWardInpatientCare.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalWardInpatientCare.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># These event cycles through each of the key maternal complications that a mother could be admitted due to and</span>
        <span class="c1"># delivers treatment accordingly</span>

        <span class="c1"># --------------------------------------- SEPSIS TREATMENT ---------------------------------------------------</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_sepsis_late_postpartum</span><span class="p">:</span>
            <span class="c1"># First check the availability of consumables for treatment</span>
            <span class="n">pkg_code_sepsis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Maternal sepsis case management&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_sepsis</span><span class="p">])</span>

            <span class="c1"># If available then treatment is delivered</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received treatment for sepsis as an inpatient&#39;</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_late_postpartum_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> was unable to receive treatment for sepsis due to &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;limited resources&#39;</span><span class="p">)</span>

        <span class="c1"># ------------------------------------- SECONDARY PPH TREATMENT -----------------------------------------------</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_postpartum_haem_secondary</span><span class="p">:</span>
            <span class="c1"># First check the availability of consumables for treatment</span>
            <span class="n">pkg_code_pph</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Treatment of postpartum hemorrhage&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_pph</span><span class="p">])</span>

            <span class="c1"># If available then treatment is delivered</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received treatment for secondary postpartum &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;haemorrhage as an inpatient&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postpartum_haem_secondary_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> was unable to receive treatment for secondary pph due &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;to limited resources&#39;</span><span class="p">)</span>

        <span class="c1"># ------------------------------------- HYPERTENSION TREATMENT -----------------------------------------------</span>
        <span class="c1"># Treatment for complications of hypertension include two interventions, anti hypertensive therapy and</span>
        <span class="c1"># magnesium</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;gest_htn&#39;</span> <span class="ow">or</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">:</span>
            <span class="n">approx_days_of_pn_period</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_postnatal_period_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

            <span class="c1"># Define the consumables and check their availability</span>
            <span class="n">item_code_methyldopa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Methyldopa 250mg_1000_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">consumables_gest_htn_treatment</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_methyldopa</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">approx_days_of_pn_period</span><span class="p">}}</span>

            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_gest_htn_treatment</span><span class="p">)</span>

            <span class="c1"># If they are available then the woman is started on treatment</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_methyldopa</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been started on regular antihypertensives due to &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;her HDP&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span> <span class="ow">or</span> \
            <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span> <span class="ow">or</span>\
           <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>

            <span class="c1"># Define required consumables</span>
            <span class="n">item_code_hydralazine</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hydralazine, powder for injection, 20 mg ampoule&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_wfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Water for injection, 10ml_Each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_methyldopa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Methyldopa 250mg_1000_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># As we need multiple of one consumable we use the old method to check availablity</span>
            <span class="n">consumables_gest_htn_treatment</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_hydralazine</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_wfi</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_methyldopa</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}</span>

            <span class="c1"># Then query if these consumables are available during this HSI</span>
            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_gest_htn_treatment</span><span class="p">)</span>

            <span class="c1"># If they are available then the woman is started on treatment</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hydralazine</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_wfi</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">])</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_methyldopa</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span> <span class="ow">or</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">pkg_code_severe_pre_eclampsia</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                    <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Management of eclampsia&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                    <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_severe_pre_eclampsia</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># TODO: reduce risk of progression from spe to ec when progression function when neater</span>

        <span class="c1"># ------------------------------------- ANAEMIA TREATMENT -----------------------------------------------</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">pn_anaemia_following_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Todo: add v1.1</span>

        <span class="c1"># Following treatment we use this function to determine if this woman will survive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;mother&#39;</span><span class="p">,</span>
                                                                       <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalWardInpatientCare.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalWardInpatientCare.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalWardInpatientCare: did not run&#39;</span><span class="p">)</span>

        <span class="c1"># If they event can&#39;t run we use the death function to determine if the mother has died without care</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;mother&#39;</span><span class="p">,</span>
                                                                       <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_PostnatalWardInpatientCare.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_PostnatalWardInpatientCare.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_PostnatalWardInpatientCare: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span>

        <span class="c1"># If they event can&#39;t run we use the death function to determine if the mother has died without care</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;mother&#39;</span><span class="p">,</span>
                                                                       <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PostnatalSupervisor_TreatmentForObstetricFistula"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_TreatmentForObstetricFistula">[docs]</a><span class="k">class</span> <span class="nc">HSI_PostnatalSupervisor_TreatmentForObstetricFistula</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is HSI_PostnatalSupervisor_TreatmentForObstetricFistula. It is scheduled by the on_birth function of this</span>
<span class="sd">     module for women have developed obstetric fistula and choose to seek care. Treatment delivered in this event</span>
<span class="sd">    includes surgical correction of obstetric fistula</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_PostnatalSupervisor_TreatmentForObstetricFistula.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_TreatmentForObstetricFistula.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">PostnatalSupervisor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalSupervisor_TreatmentForObstetricFistula&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_TreatmentForObstetricFistula.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_TreatmentForObstetricFistula.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># todo: no relevant consumables package identified</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span>
            <span class="n">person_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;pn_obstetric_fistula&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_fistula_resolution&#39;</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_obstetric_fistula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has undergone surgical correction of her obstetric fistula&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_PostnatalSupervisor_NeonatalWardInpatientCare"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_NeonatalWardInpatientCare">[docs]</a><span class="k">class</span> <span class="nc">HSI_PostnatalSupervisor_NeonatalWardInpatientCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is HSI_PostnatalSupervisor_NeonatalWardInpatientCare. It is scheduled by any of the PNC HSIs for neonates</span>
<span class="sd">    who are require inpatient care due to a complication of the postnatal period. Treatment is delivered in this</span>
<span class="sd">    event&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_NeonatalWardInpatientCare.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_NeonatalWardInpatientCare.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">PostnatalSupervisor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;PostnatalSupervisor_NeonatalWardInpatientCare&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;IPAdmission&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_NeonatalWardInpatientCare.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_NeonatalWardInpatientCare.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">child</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Here we deliver treatment to any neonates who have been admitted to either early or late onset sepsis</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_early_neonatal</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">pn_sepsis_late_neonatal</span><span class="p">:</span>
            <span class="n">pkg_code_sep</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                                         <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Newborn sepsis - full supportive care&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_sep</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;pn_sepsis_neonatal_full_supp_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;neonate </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> was unable to receive treatment for sepsis &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;due to limited resources&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
                                                                           <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_NeonatalWardInpatientCare.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_NeonatalWardInpatientCare.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_NeonatalWardInpatientCare: did not run&#39;</span><span class="p">)</span>

        <span class="c1"># If they event can&#39;t run we use the death function to determine if the neonate has died without care</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
                                                                       <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># In order to make sure all women have risk of death applied we dont allow this event to run again</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_PostnatalSupervisor_NeonatalWardInpatientCare.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.HSI_PostnatalSupervisor_NeonatalWardInpatientCare.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_PostnatalSupervisor_NeonatalWardInpatientCare: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">apply_risk_of_maternal_or_neonatal_death_postnatal</span><span class="p">(</span><span class="n">mother_or_child</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
                                                                       <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PostnatalLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">PostnatalLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the PostnatalLoggingEvent. It runs every year and uses the dataframe and postnatal_tracker to generate</span>
<span class="sd">    summary statistics used in analysis files. This is not a finalised event and is liable to change</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PostnatalLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>

<div class="viewcode-block" id="PostnatalLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.postnatal_supervisor.html#tlo.methods.postnatal_supervisor.PostnatalLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Previous Year...</span>
        <span class="n">one_year_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>

        <span class="c1"># Denominators...</span>
        <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">total_births_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># ra_lower_limit = 14</span>
        <span class="c1"># ra_upper_limit = 50</span>
        <span class="c1"># women_reproductive_age = df.index[(df.is_alive &amp; (df.sex == &#39;F&#39;) &amp; (df.age_years &gt; ra_lower_limit) &amp;</span>
        <span class="c1">#                                   (df.age_years &lt; ra_upper_limit))]</span>
        <span class="c1"># total_women_reproductive_age = len(women_reproductive_age)</span>

        <span class="n">total_pph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;secondary_pph&#39;</span><span class="p">]</span>
        <span class="n">total_pn_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_death&#39;</span><span class="p">]</span>
        <span class="n">total_sepsis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_sepsis&#39;</span><span class="p">]</span>
        <span class="n">total_fistula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;fistula&#39;</span><span class="p">]</span>
        <span class="n">total_endo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;endometritis&#39;</span><span class="p">]</span>
        <span class="n">total_uti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">]</span>
        <span class="n">total_ssti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">]</span>
        <span class="n">total_other_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">]</span>
        <span class="n">total_anaemia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;postnatal_anaemia&#39;</span><span class="p">]</span>

        <span class="n">maternal_dict_for_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total_fistula&#39;</span><span class="p">:</span> <span class="n">total_fistula</span><span class="p">,</span>
                                    <span class="s1">&#39;total_endo&#39;</span><span class="p">:</span> <span class="n">total_endo</span><span class="p">,</span>
                                    <span class="s1">&#39;total_uti&#39;</span><span class="p">:</span> <span class="n">total_uti</span><span class="p">,</span>
                                    <span class="s1">&#39;total_ssti&#39;</span><span class="p">:</span> <span class="n">total_ssti</span><span class="p">,</span>
                                    <span class="s1">&#39;total_other_inf&#39;</span><span class="p">:</span> <span class="n">total_other_inf</span><span class="p">,</span>
                                    <span class="s1">&#39;total_anaemia&#39;</span><span class="p">:</span> <span class="n">total_anaemia</span><span class="p">,</span>
                                    <span class="s1">&#39;total_pph&#39;</span><span class="p">:</span> <span class="n">total_pph</span><span class="p">,</span>
                                    <span class="s1">&#39;total_sepsis&#39;</span><span class="p">:</span> <span class="n">total_sepsis</span><span class="p">,</span>
                                    <span class="s1">&#39;total_deaths&#39;</span><span class="p">:</span> <span class="n">total_pn_death</span><span class="p">,</span>
                                    <span class="s1">&#39;pn_mmr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_pn_death</span><span class="o">/</span><span class="n">total_births_last_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;postnatal_maternal_summary_stats&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">maternal_dict_for_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly maternal summary statistics output from the postnatal supervisor module&#39;</span><span class="p">)</span>

        <span class="n">total_early_sepsis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;early_neonatal_sepsis&#39;</span><span class="p">]</span>
        <span class="n">total_late_sepsis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;late_neonatal_sepsis&#39;</span><span class="p">]</span>
        <span class="n">total_pn_neonatal_deaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span><span class="p">[</span><span class="s1">&#39;neonatal_death&#39;</span><span class="p">]</span>

        <span class="n">neonatal_dict_for_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eons&#39;</span><span class="p">:</span> <span class="n">total_early_sepsis</span><span class="p">,</span>
                                    <span class="s1">&#39;lons&#39;</span><span class="p">:</span> <span class="n">total_late_sepsis</span><span class="p">,</span>
                                    <span class="s1">&#39;total_deaths&#39;</span><span class="p">:</span> <span class="n">total_pn_neonatal_deaths</span><span class="p">,</span>
                                    <span class="s1">&#39;pn_nmr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total_pn_neonatal_deaths</span><span class="o">/</span><span class="n">total_births_last_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;postnatal_neonatal_summary_stats&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">neonatal_dict_for_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly neonatal summary statistics output from the postnatal supervisor module&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">postnatal_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;endometritis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;urinary_tract_inf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;skin_soft_tissue_inf&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;other_maternal_infection&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;secondary_pph&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;postnatal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;postnatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;fistula&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;postnatal_anaemia&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;early_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;late_neonatal_sepsis&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;neonatal_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="s1">&#39;neonatal_sepsis_death&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Sep 21, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>