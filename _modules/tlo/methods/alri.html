

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.alri &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.alri</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.alri</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Childhood Acute Lower Respiratory Infection Module</span>

<span class="sd">Overview</span>
<span class="sd">--------</span>
<span class="sd">Individuals are exposed to the risk of infection by a pathogen (and potentially also with a secondary bacterial</span>
<span class="sd">infection) that can cause one of several type of acute lower respiratory infection (Alri).</span>
<span class="sd">The disease is manifested as either viral pneumonia, bacterial pneumonia or bronchiolitis.</span>

<span class="sd">During an episode (prior to recovery - either naturally or cured with treatment), symptom are manifest and there may be</span>
<span class="sd">complications (e.g. local pulmonary complication: pleural effusuion, empyema, lung abscess, pneumothorax; and/or</span>
<span class="sd">systemic complications: sepsis, meningitis, and respiratory failure). There is a risk that some of these complications</span>
<span class="sd">are onset after a delay.</span>

<span class="sd">The individual may recover naturally or die. The risk of death depends on the type of disease and the presence of some</span>
<span class="sd">of the complications.</span>

<span class="sd">Health care seeking is prompted by the onset of the symptom. The individual can be treated; if successful the risk of</span>
<span class="sd">death is lowered and they are cured (symptom resolved) some days later.</span>

<span class="sd">Outstanding issues</span>
<span class="sd">------------------</span>
<span class="sd">* All HSI events</span>
<span class="sd">* Follow-up appointments for initial HSI events.</span>
<span class="sd">* Double check parameters and consumables codes for the HSI events.</span>
<span class="sd">* Duration of Alri Event is not informed by data</span>

<span class="sd">Questions</span>
<span class="sd">----------</span>

<span class="sd">#1:</span>
<span class="sd">&#39;daly_very_severe_ALRI&#39; is never used: is that right?</span>

<span class="sd">#2:</span>
<span class="sd">There are no probabilities describing the risk of onset of the complication &quot;empyema&quot;. There is the risk of empyema</span>
<span class="sd">being delayed onset (i.e. prob_pleural_effusion_to_empyema) and also the risk that &quot;empyema&quot; leads to sepsis</span>
<span class="sd">(prob_empyema_to_sepsis). However, for simplicity  we only have two phases of complication (initial and delayed), so</span>
<span class="sd">this is not represented at the moment. I am not sure if it should be or not.</span>

<span class="sd">#3:</span>
<span class="sd">The risk of death is not affected by delayed-onset complications: should it be?</span>

<span class="sd">#4:</span>
<span class="sd">Check that every parameter is used and remove those not used (from definition and from excel). I think that are several</span>
<span class="sd">not being used (e.g prob_respiratory_failure_to_multiorgan_dysfunction and r_progress_to_severe_ALRI) -- perhaps left</span>
<span class="sd"> over from an earlier version? Also, please could you tidy-up ResourceFile_Alri.xlsx? If there are sheets that need to</span>
<span class="sd">  remain in there, it would be good if you can explain what each is for on the sheet (and delete anything that is not</span>
<span class="sd">   needed).</span>

<span class="sd">#5:</span>
<span class="sd">Is it right that &#39;danger_signs&#39; is an independent symptom? It seems like this is something that is determined in the</span>
<span class="sd"> course of a diagnosis (like in diarrhoea module).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.symptommanager</span> <span class="kn">import</span> <span class="n">Symptom</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">random_date</span><span class="p">,</span> <span class="n">sample_outcome</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   MODULE DEFINITION</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Alri"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri">[docs]</a><span class="k">class</span> <span class="nc">Alri</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the disease module for Acute Lower Respiratory Infections.&quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Demography&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Epi&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Hiv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SymptomManager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Wasting&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">OPTIONAL_INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">}</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_SYMPTOMMANAGER</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span>
    <span class="p">}</span>

    <span class="n">pathogens</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;viral&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;RSV&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Rhinovirus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HMPV&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Parainfluenza&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Influenza&#39;</span><span class="p">,</span>
            <span class="s1">&#39;other_viral_pathogens&#39;</span>  <span class="c1"># &lt;-- Coronaviruses NL63, 229E OC43 and HKU1,</span>
            <span class="c1"># Cytomegalovirus, Parechovirus/Enterovirus, Adenovirus, Bocavirus</span>
        <span class="p">],</span>
        <span class="s1">&#39;bacterial&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;Strep_pneumoniae_PCV13&#39;</span><span class="p">,</span>      <span class="c1"># &lt;--  risk of acquisition is affected by the pneumococcal vaccine</span>
            <span class="s1">&#39;Strep_pneumoniae_non_PCV13&#39;</span><span class="p">,</span>  <span class="c1"># &lt;--  risk of acquisition is not affected by the pneumococcal vaccine</span>
            <span class="s1">&#39;Hib&#39;</span><span class="p">,</span>
            <span class="s1">&#39;H.influenzae_non_type_b&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Staph_aureus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Enterobacteriaceae&#39;</span><span class="p">,</span>  <span class="c1"># includes E. coli, Enterobacter species, and Klebsiella species</span>
            <span class="s1">&#39;other_Strepto_Enterococci&#39;</span><span class="p">,</span>  <span class="c1"># includes Streptococcus pyogenes and Enterococcus faecium</span>
            <span class="s1">&#39;other_bacterial_pathogens&#39;</span>
            <span class="c1"># &lt;-- includes Bordetella pertussis, Chlamydophila pneumoniae,</span>
            <span class="c1"># Legionella species, Mycoplasma pneumoniae, Moraxella catarrhalis, Non-fermenting gram-negative</span>
            <span class="c1"># rods (Acinetobacter species and Pseudomonas species), Neisseria meningitidis</span>
        <span class="p">],</span>
        <span class="s1">&#39;fungal/other&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;P.jirovecii&#39;</span><span class="p">,</span>
            <span class="s1">&#39;other_pathogens_NoS&#39;</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># Make set of all pathogens combined:</span>
    <span class="n">all_pathogens</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">pathogens</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">f</span><span class="s2">&quot;ALRI_</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Lower respiratory infections&#39;</span><span class="p">},</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower respiratory infections&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">all_pathogens</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">f</span><span class="s2">&quot;ALRI_</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Lower respiratory infections&#39;</span><span class="p">},</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower respiratory infections&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">all_pathogens</span>
    <span class="p">}</span>

    <span class="c1"># Declare the disease types:</span>
    <span class="n">disease_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span>
        <span class="s1">&#39;pneumonia&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bronchiolitis/other_alri&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Declare the Alri complications:</span>
    <span class="n">complications</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span>
        <span class="s1">&#39;pneumothorax&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pleural_effusion&#39;</span><span class="p">,</span>
        <span class="s1">&#39;empyema&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lung_abscess&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hypoxaemia&#39;</span>
    <span class="p">})</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Incidence rate by pathogens  -----</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_RSV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence rate of Alri caused by RSV in age groups 0-11, 12-23, 24-59 months, &#39;</span>
                      <span class="s1">&#39;per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Rhinovirus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Rhinovirus in age groups 0-11, 12-23, 24-59 months, &#39;</span>
                      <span class="s1">&#39;per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_HMPV&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by HMPV in age groups 0-11, 12-23, 24-59 months, &#39;</span>
                      <span class="s1">&#39;per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Parainfluenza&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Parainfluenza 1-4 in age groups 0-11, 12-23, 24-59 months, &#39;</span>
                      <span class="s1">&#39;per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Strep_pneumoniae_PCV13&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Streptoccocus pneumoniae PCV13 serotype &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Strep_pneumoniae_non_PCV13&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Streptoccocus pneumoniae non PCV13 serotype &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Hib&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Haemophilus influenzae type b &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_H.influenzae_non_type_b&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Haemophilus influenzae non-type b &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Enterobacteriaceae&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Enterobacteriaceae in age groups 0-11, 12-23, &#39;</span>
                      <span class="s1">&#39;24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_other_Strepto_Enterococci&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by other streptococci and Enterococci including &#39;</span>
                      <span class="s1">&#39;Streptococcus pyogenes and Enterococcus faecium in age groups 0-11, 12-23, 24-59 months, &#39;</span>
                      <span class="s1">&#39;per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Staph_aureus&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Staphylococcus aureus &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_Influenza&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by Influenza type A, B, and C &#39;</span>
                      <span class="s1">&#39;in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_P.jirovecii&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by P. jirovecii in age groups 0-11, &#39;</span>
                      <span class="s1">&#39;12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_other_viral_pathogens&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by other viral pathogens in age groups 0-11, 12-23, &#39;</span>
                      <span class="s1">&#39;24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_other_bacterial_pathogens&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by other viral pathogens in age groups 0-11, 12-23, &#39;</span>
                      <span class="s1">&#39;24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;base_inc_rate_ALRI_by_other_pathogens_NoS&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;baseline incidence of Alri caused by other pathogens not otherwise specified&#39;</span>
                      <span class="s1">&#39; in age groups 0-11, 12-23, 24-59 months, per child per year&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Proportions of what disease type (pneumonia/ bronchiolitis/ other alri) -----</span>
        <span class="s1">&#39;proportion_pneumonia_in_RSV_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of RSV-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Rhinovirus_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of Rhinovirus-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_HMPV_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of HMPV-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Parainfluenza_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of Parainfluenza-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Strep_pneumoniae_PCV13_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of S. pneumoniae PCV13-type-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Strep_pneumoniae_non_PCV13_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of S. pneumoniae non PCV13-type-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Hib_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of Hib ALRI-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_H.influenzae_non_type_b_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of H.influenzae non type-b-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Staph_aureus_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of S. aureus-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Enterobacteriaceae_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of Enterobacteriaceae-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_other_Strepto_Enterococci_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of other Streptococci- and Enterococci-attributed ALRI manifesting as pneumonia&#39;</span>
                      <span class="s1">&#39;by age, (based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_Influenza_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of Influenza-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_P.jirovecii_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of P. jirovecii-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_other_viral_pathogens_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of other viral pathogens-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_other_bacterial_pathogens_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of other bacterial pathogens-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_pneumonia_in_other_pathogens_NoS_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of other pathogens NoS-attributed ALRI manifesting as pneumonia by age, &#39;</span>
                      <span class="s1">&#39;(based on PERCH CXR+ results)&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Risk factors for incidence infection -----</span>
        <span class="s1">&#39;rr_ALRI_HIV/AIDS&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for children with HIV+/AIDS &#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_ALRI_incomplete_measles_immunisation&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for children with incomplete measles immunisation&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_ALRI_low_birth_weight&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for infants with low birth weight&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_ALRI_non_exclusive_breastfeeding&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for not exclusive breastfeeding upto 6 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_ALRI_indoor_air_pollution&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for indoor air pollution&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_ALRI_crowding&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for children living in crowed households (&gt;7 pph)&#39;</span>
                      <span class="p">),</span>  <span class="c1"># TODO: change to wealth?</span>
        <span class="s1">&#39;rr_ALRI_underweight&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring Alri for underweight children&#39;</span>
                      <span class="p">),</span>  <span class="c1"># TODO: change to SAM/MAM?</span>

        <span class="c1"># Probability of bacterial co- / secondary infection -----</span>
        <span class="s1">&#39;prob_viral_pneumonia_bacterial_coinfection&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of primary viral pneumonia having a bacterial co-infection&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_bacterial_coinfection_pathogen&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
                      <span class="s1">&#39;list of proportions of each bacterial pathogens in a viral/bacterial co-infection pneumonia,&#39;</span>
                      <span class="s1">&#39;the current values used are the pathogen attributable fractions (AFs) from PERCH for all ages. &#39;</span>
                      <span class="s1">&#39;The AFs were scaled to bacterial pathogens only causes - value assumed to be the proportions &#39;</span>
                      <span class="s1">&#39;of bacterial pathogens causing co-/secondary infection&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Duration of disease - natural history</span>
        <span class="s1">&#39;max_alri_duration_in_days_without_treatment&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;maximum duration in days of untreated ALRI episode, assuming an average of 7 days&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Probability of complications -----</span>
        <span class="s1">&#39;overall_progression_to_severe_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of progression to severe ALRI&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_pulmonary_complications_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of pulmonary complications in (CXR+) pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_pleural_effusion_in_pulmonary_complicated_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of pleural effusion in pneumonia with pulmonary complications&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_empyema_in_pulmonary_complicated_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of empyema in pneumonia with pulmonary complications&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_lung_abscess_in_pulmonary_complicated_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of lung abscess in pneumonia with pulmonary complications&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_pneumothorax_in_pulmonary_complicated_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of pneumothorax in pneumonia with pulmonary complications&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_hypoxaemia_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of hypoxaemia in pneumonia cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_hypoxaemia_in_bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of hypoxaemia in bronchiolitis and other alri cases&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_bacteraemia_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of bacteraemia in pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_progression_to_sepsis_with_bacteraemia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of progression to sepsis from bactereamia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;proportion_hypoxaemia_with_SpO2&lt;90%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;proportion of hypoxaemic children with SpO2 &lt;90%&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Risk of death parameters -----</span>
        <span class="s1">&#39;overall_CFR_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;overall case-fatality rate of ALRI (Not used in the simulation but is saved here as it is the &#39;</span>
                      <span class="s1">&#39;target for calibration of for the overall case-fatality rate of ALRI).)&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;baseline_odds_alri_death&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;baseline odds of alri death, no risk factors&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_age&lt;2mo&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for infants aged less than 2 months&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_P.jirovecii&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for P.jirovecii infection&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_HIV/AIDS&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for HIV/AIDS children&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_SAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for SAM&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_MAM&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for MAM&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_male&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for male children&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_SpO2&lt;93%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for SpO2&lt;=92%&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_severe_underweight&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for severely underweight children&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;or_death_ALRI_danger_signs&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;odds ratio of ALRI death for very severe pneumonia (presenting danger signs)&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Probability of symptom development -----</span>
        <span class="s1">&#39;prob_cough_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of cough in pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_difficult_breathing_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of difficulty breathing in pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_chest_indrawing_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of chest indrawing in pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_tachypnoea_in_pneumonia&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of tachypnoea in pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_cough_in_bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of cough in bronchiolitis or other alri&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_difficult_breathing_in_bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of difficulty breathing in bronchiolitis or other alri&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_tachypnoea_in_bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of tachypnoea in bronchiolitis or other alri&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_chest_indrawing_in_bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of chest wall indrawing in bronchiolitis or other alri&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_danger_signs_in_sepsis&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of any danger signs in ALRI complicated by sepsis&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_danger_signs_in_SpO2&lt;90%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of any danger signs in children with SpO2 &lt;90%&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_danger_signs_in_SpO2_90-92%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of any danger signs in children with SpO2 between 90-92%&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_chest_indrawing_in_SpO2&lt;90%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of chest indrawing in children with SpO2 &lt;90%&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_chest_indrawing_in_SpO2_90-92%&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of chest indrawing in children with SpO2 between 90-92%&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_danger_signs_in_pulmonary_complications&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of danger signs in children with pulmonary complications&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_chest_indrawing_in_pulmonary_complications&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of chest indrawing in children with pulmonary complications&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing the effects of vaccine ----------------</span>
        <span class="s1">&#39;rr_Strep_pneum_VT_ALRI_with_PCV13_age&lt;2y&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring S. pneumoniae vaccine-type Alri &#39;</span>
                      <span class="s1">&#39;for children under 2 years of age immunised wth PCV13&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_Strep_pneum_VT_ALRI_with_PCV13_age2to5y&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring S. pneumoniae vaccine-type Alri &#39;</span>
                      <span class="s1">&#39;for children aged 2 to 5 immunised wth PCV13&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_all_strains_Strep_pneum_ALRI_with_PCV13&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring S. pneumoniae all types Alri &#39;</span>
                      <span class="s1">&#39;for children immunised wth PCV13&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;effectiveness_Hib_vaccine_on_Hib_strains&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;effectiveness of Hib vaccine against H. influenzae typ-b ALRI&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;rr_Hib_ALRI_with_Hib_vaccine&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;relative rate of acquiring H. influenzae type-b Alri &#39;</span>
                      <span class="s1">&#39;for children immunised wth Hib vaccine&#39;</span>
                      <span class="p">),</span>

        <span class="c1"># Parameters governing treatment effectiveness and associated behaviours ----------------</span>
        <span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;number of days between any treatment being given in an HSI and the cure occurring.&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_for_uncomplicated_pneumonia_given_IMCI_pneumonia_treatment&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of cure for uncomplicated pneumonia given IMCI pneumonia treatment&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_of_cure_for_pneumonia_with_severe_complication_given_IMCI_severe_pneumonia_treatment&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of cure for pneumonia with severe complications given IMCI pneumonia treatment&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;prob_seek_follow_up_care_after_treatment_failure&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of seeking follow-up care after treatment failure&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;oxygen_therapy_effectiveness_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;effectiveness of oxygen therapy on death from Alri with respiratory failure&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;antibiotic_therapy_effectiveness_ALRI&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;effectiveness of antibiotic therapy on death from Alri with bacterial cause&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;5day_amoxicillin_treatment_failure_by_day6&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of treatment failure by day 6 of 5-day course amoxicillin for non-severe pneumonia&#39;</span>
                      <span class="p">),</span>
        <span class="s1">&#39;5day_amoxicillin_relapse_by_day14&#39;</span><span class="p">:</span>
            <span class="n">Parameter</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
                      <span class="s1">&#39;probability of relapse by day 14 on 5-day amoxicillin for non-severe pneumonia&#39;</span>
                      <span class="p">),</span>

    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># ---- Alri status ----</span>
        <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span>
                     <span class="s1">&#39;Does the person currently have an infection with a pathogen that can cause Alri.&#39;</span>
                     <span class="p">),</span>

        <span class="c1"># ---- The pathogen which is the attributed cause of Alri ----</span>
        <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                     <span class="s1">&#39;If infected, what is the pathogen with which the person is currently infected. (np.nan if not &#39;</span>
                     <span class="s1">&#39;infected)&#39;</span><span class="p">,</span>
                     <span class="n">categories</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">all_pathogens</span><span class="p">)</span>
                     <span class="p">),</span>
        <span class="c1"># ---- The bacterial pathogen which is the attributed co-/secondary infection ----</span>
        <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                     <span class="s1">&#39;If infected, is there a secondary bacterial pathogen (np.nan if none or not applicable)&#39;</span><span class="p">,</span>
                     <span class="n">categories</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;bacterial&#39;</span><span class="p">])</span>
                     <span class="p">),</span>
        <span class="c1"># ---- The underlying Alri condition ----</span>
        <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;If infected, what disease type is the person currently suffering from.&#39;</span><span class="p">,</span>
                     <span class="n">categories</span><span class="o">=</span><span class="n">disease_types</span>
                     <span class="p">),</span>
        <span class="c1"># ---- The peripheral oxygen saturation level ----</span>
        <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Peripheral oxygen saturation level (Sp02), measure for hypoxaemia&#39;</span><span class="p">,</span>
                     <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&lt;90%&#39;</span><span class="p">,</span> <span class="s1">&#39;90-92%&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=93%&#39;</span><span class="p">]</span>
                     <span class="p">),</span>

        <span class="c1"># ---- Treatment Status ----</span>
        <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Is this person currently receiving treatment.&#39;</span><span class="p">),</span>

        <span class="c1"># &lt; --- other properties of the form &#39;ri_complication_{complication-name}&#39; are added later --&gt;</span>

        <span class="c1"># ---- Internal variables to schedule onset and deaths due to Alri ----</span>
        <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                                <span class="s1">&#39;date of onset of current Alri event (pd.NaT is not infected)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                               <span class="s1">&#39;(scheduled) date of recovery from current Alri event (pd.NaT is not &#39;</span>
                                               <span class="s1">&#39;infected or episode is scheduled to end in death)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                            <span class="s1">&#39;(scheduled) date of death caused by current Alri event (pd.NaT is not &#39;</span>
                                            <span class="s1">&#39;infected or episode will not cause death)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">:</span>
            <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date on which the last episode of Alri is resolved, (including &#39;</span>
                                 <span class="s1">&#39;allowing for the possibility that a cure is scheduled following onset). &#39;</span>
                                 <span class="s1">&#39;This is used to determine when a new episode can begin. &#39;</span>
                                 <span class="s1">&#39;This stops successive episodes interfering with one another.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span>
                                          <span class="s1">&#39;start date of Alri treatment for current episode (pd.NaT is not infected or&#39;</span>
                                          <span class="s1">&#39; treatment has not begun)&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Alri.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_indivdual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Store arguments provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_checks</span> <span class="o">=</span> <span class="n">do_checks</span>

        <span class="k">assert</span> <span class="p">(</span><span class="n">log_indivdual</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_indivdual</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_indivdual</span><span class="p">,</span> <span class="nb">bool</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_individual</span> <span class="o">=</span> <span class="n">log_indivdual</span>

        <span class="c1"># Initialise the pointer to where the models will be stored:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Maximum duration of an episode (beginning with inection and ending with recovery)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_duration_of_episode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># dict to hold the DALY weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Pointer to store the logging event used by this module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging_event</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Alri.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        * Setup parameters values used by the module</span>
<span class="sd">        * Define symptoms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_Alri.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Parameter_values&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_params_read_in_ok</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">define_symptoms</span><span class="p">()</span></div>

<div class="viewcode-block" id="Alri.check_params_read_in_ok"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.check_params_read_in_ok">[docs]</a>    <span class="k">def</span> <span class="nf">check_params_read_in_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that every value has been read-in successfully&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                                                  <span class="sa">f</span><span class="s1">&#39;is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="n">param_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; is not read in correctly from the resourcefile.&#39;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">],</span>
                              <span class="n">param_type</span><span class="o">.</span><span class="n">python_type</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Parameter &quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&quot; &#39;</span> \
                                                       <span class="sa">f</span><span class="s1">&#39;is not read in correctly from the resourcefile.&#39;</span></div>

<div class="viewcode-block" id="Alri.define_symptoms"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.define_symptoms">[docs]</a>    <span class="k">def</span> <span class="nf">define_symptoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define the symptoms that this module will use&quot;&quot;&quot;</span>
        <span class="n">all_symptoms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cough&#39;</span><span class="p">,</span> <span class="s1">&#39;difficult_breathing&#39;</span><span class="p">,</span> <span class="s1">&#39;tachypnoea&#39;</span><span class="p">,</span> <span class="s1">&#39;chest_indrawing&#39;</span><span class="p">,</span> <span class="s1">&#39;danger_signs&#39;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">symptom_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_symptoms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">symptom_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">generic_symptoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">register_symptom</span><span class="p">(</span>
                    <span class="n">Symptom</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">symptom_name</span><span class="p">)</span>
                    <span class="c1"># (associates the symptom with the &#39;average&#39; healthcare seeking)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="Alri.pre_initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.pre_initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">pre_initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define columns for complications at run-time&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complications</span><span class="p">:</span>
            <span class="n">Alri</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span>
                <span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Whether this person has complication </span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Alri.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets that there is no one with Alri at initiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># a shortcut to the data-frame storing data for individuals</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complications</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&gt;=93%&quot;</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Alri.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares for simulation:</span>
<span class="sd">        * Schedules the main polling event</span>
<span class="sd">        * Schedules the main logging event</span>
<span class="sd">        * Establishes the linear models and other data structures using the parameters that have been read-in</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Schedule the main polling event (to first occur immediately)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriPollingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Schedule the main logging event (to first occur in one year)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging_event</span> <span class="o">=</span> <span class="n">AlriLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logging_event</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_individual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Schedule the individual check logging event (to first occur immediately, and to occur every day)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriIndividualLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_checks</span><span class="p">:</span>
            <span class="c1"># Schedule the event that does checking every day:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriCheckPropertiesEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Generate the model that determine the Natural History of the disease:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Get DALY weights</span>
        <span class="k">if</span> <span class="s1">&#39;HealthBurden&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;daly_non_severe_ALRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">47</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;daly_severe_ALRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthBurden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="mi">46</span><span class="p">)</span>

        <span class="c1"># Define the max episode duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_duration_of_episode</span> <span class="o">=</span> <span class="n">DateOffset</span><span class="p">(</span>
            <span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_alri_duration_in_days_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">]))</span></div>
        <span class="c1"># 14 days max duration of an episode (natural history) + 14 days to allow treatment</span>

<div class="viewcode-block" id="Alri.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise properties for a newborn individual.</span>
<span class="sd">        This is called by the simulation whenever a new person is born.</span>
<span class="sd">        :param mother_id: the mother for this child</span>
<span class="sd">        :param child_id: the new child</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># ---- Key Current Status Classification Properties ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complications</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&gt;=93%&quot;</span>

        <span class="c1"># ---- Internal values ----</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Alri.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Report DALY incurred in the population in the last month due to ALRI&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># get the list of people with severe pneumonia: danger signs AND either cough or difficult breathing</span>
        <span class="n">has_danger_signs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;danger_signs&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;cough&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;difficult_breathing&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># get the list of people with non-severe pneumonia</span>
        <span class="n">has_fast_breathing_or_chest_indrawing_but_not_danger_signs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;tachypnoea&#39;</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">who_has</span><span class="p">(</span><span class="s1">&#39;chest_indrawing&#39;</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="n">has_danger_signs</span>

        <span class="c1"># report the DALYs occurred</span>
        <span class="n">total_daly_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span>
        <span class="n">total_daly_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">has_danger_signs</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;daly_severe_ALRI&#39;</span><span class="p">]</span>
        <span class="n">total_daly_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">has_fast_breathing_or_chest_indrawing_but_not_danger_signs</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wts</span><span class="p">[</span><span class="s1">&#39;daly_non_severe_ALRI&#39;</span><span class="p">]</span>

        <span class="c1"># Split out by pathogen that causes the Alri</span>
        <span class="n">dummies_for_pathogen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_daly_values</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">daly_values_by_pathogen</span> <span class="o">=</span> <span class="n">dummies_for_pathogen</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">total_daly_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># add prefix to label according to the name of the causes of disability declared</span>
        <span class="n">daly_values_by_pathogen</span> <span class="o">=</span> <span class="n">daly_values_by_pathogen</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;ALRI_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">daly_values_by_pathogen</span></div>

<div class="viewcode-block" id="Alri.end_episode"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.end_episode">[docs]</a>    <span class="k">def</span> <span class="nf">end_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End the episode infection for a person (i.e. reset all properties to show no current infection or</span>
<span class="sd">        complications).</span>
<span class="sd">        This is called by AlriNaturalRecoveryEvent and AlriCureEvent.</span>
<span class="sd">        NB. &#39;ri_end_of_current_episode is not reset: this is used to prevent new infections from occurring whilst HSI</span>
<span class="sd">        from a previous episode may still be scheduled to occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Reset properties to show no current infection:</span>
        <span class="n">new_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">:</span> <span class="s1">&#39;&gt;=93%&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="p">}</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">new_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">new_properties</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># Remove all existing complications</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complications</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Resolve all the symptoms immediately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear_symptoms</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Alri.do_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.do_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">do_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">prob_of_cure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function that enacts the effects of a treatment to Alri caused by a pathogen.</span>
<span class="sd">        It will only do something if the Alri is caused by a pathogen (this module).</span>
<span class="sd">        * Log the treatment</span>
<span class="sd">        * Prevent any death event that may be scheduled from occuring (prior to the cure event)</span>
<span class="sd">        * Schedules the cure event, at which the episode is ended</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Do nothing if the person is not alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Do nothing if the person is not infected with a pathogen that can cause ALRI</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># Record that the person is now on treatment:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">]</span>

        <span class="c1"># Determine if the treatment is effective</span>
        <span class="k">if</span> <span class="n">prob_of_cure</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
            <span class="c1"># Cancel the death</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_death_date</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="c1"># Schedule the CureEvent</span>
            <span class="n">cure_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriCureEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">cure_date</span><span class="p">)</span></div>

<div class="viewcode-block" id="Alri.cancel_death_date"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.cancel_death_date">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_death_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cancels a scheduled date of death due to Alri for a person. This is called within do_treatment_alri function,</span>
<span class="sd">        and prior to the scheduling the CureEvent to prevent deaths happening in the time between</span>
<span class="sd">        a treatment being given and the cure event occurring.</span>
<span class="sd">        :param person_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span></div>

<div class="viewcode-block" id="Alri.check_properties"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.check_properties">[docs]</a>    <span class="k">def</span> <span class="nf">check_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is used in debugging to make sure that the configuration of properties is correct&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># identify those who currently have an infection with a pathogen that can cause ALRI:</span>
        <span class="n">curr_inf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span>
        <span class="n">not_curr_inf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">]</span>

        <span class="c1"># For those with no current infection, variables about the current infection should be null</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># For those with no current infection, &#39;ri_end_of_current_episode&#39; should be null or in the past or within the</span>
        <span class="c1"># period for which the episode can last.</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
                <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_duration_of_episode</span><span class="o">.</span><span class="n">days</span>
            <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># For those with no current infection, there should be no treatment</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># For those with no current infection, there should be no complications</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">not_curr_inf</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">complications</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># For those with current infection, variables about the current infection should not be null</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># For those with current infection, dates relating to this episode should make sense</span>
        <span class="c1"># - start is in the past and end is in the future</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># - a person has exactly one of a recovery_date _or_ a death_date</span>
        <span class="k">assert</span> <span class="p">((</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span>
            <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1">#  If that primary pathogen is bacterial then there should be np.nan for secondary_bacterial_pathogen:</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">curr_inf</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;bacterial&#39;</span><span class="p">]),</span> <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># If person is on treatment, they should have a treatment start date</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">curr_inf</span><span class="p">,</span> <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># There should be consistency between the properties for oxygen saturation and the presence of the complication</span>
        <span class="c1"># hypoxaemia</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ri_complication_hypoxaemia&#39;</span><span class="p">],</span> <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&gt;=93%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ri_complication_hypoxaemia&#39;</span><span class="p">],</span> <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;=93%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="Alri.impose_symptoms_for_complication"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.Alri.impose_symptoms_for_complication">[docs]</a>    <span class="k">def</span> <span class="nf">impose_symptoms_for_complication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">complication</span><span class="p">,</span> <span class="n">oxygen_saturation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Impose symptoms for a complication.&quot;&quot;&quot;</span>
        <span class="n">symptoms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">symptoms_for_complication</span><span class="p">(</span>
            <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span> <span class="n">oxygen_saturation</span><span class="o">=</span><span class="n">oxygen_saturation</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
            <span class="n">symptom_string</span><span class="o">=</span><span class="n">symptoms</span><span class="p">,</span>
            <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">Models</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper-class to store all the models that specify the natural history of the Alri disease&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">rng</span>

        <span class="c1"># dict that will hold the linear models for incidence risk for each pathogen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># set-up the linear models for the incidence risk for each pathogen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_model_for_acquisition_risk</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">make_model_for_acquisition_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Model for the acquisition of a primary pathogen that can cause ALri&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">def</span> <span class="nf">make_scaled_linear_model_for_incidence</span><span class="p">(</span><span class="n">target_prob_by_age</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a linear model that is scaled for each the age-groups.</span>
<span class="sd">            It does this by first making an unscaled linear model with an intercept of 1.0. Using this, it calculates</span>
<span class="sd">             the resulting mean incidence rate for the population (by age-group). It then creates a new linear model</span>
<span class="sd">             with an adjusted age effect so that the average incidence in the population (by age-group) matches the</span>
<span class="sd">             target.</span>
<span class="sd">            NB. It will not work if there are no persons of that age in the population.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">make_linear_model</span><span class="p">(</span><span class="n">age_effects</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Make the linear model based for a particular pathogen and a particular age-group.&quot;&quot;&quot;</span>

                <span class="k">if</span> <span class="n">age_effects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">age_effects</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="mi">0</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="mi">2</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="mi">3</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                        <span class="mi">4</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="p">}</span>

                <span class="k">return</span> <span class="n">LinearModel</span><span class="p">(</span>
                    <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                    <span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">Predictor</span><span class="p">(</span>
                        <span class="s1">&#39;age_years&#39;</span><span class="p">,</span>
                        <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">age_effects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                     <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">age_effects</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                     <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">age_effects</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                     <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">age_effects</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                     <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">age_effects</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                     <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;&gt;= 5&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_wood_burn_stove&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_ALRI_indoor_air_pollution&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(va_measles_all_doses == False) &amp; (age_years &gt;= 1)&#39;</span><span class="p">,</span>
                                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_ALRI_incomplete_measles_immunisation&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(hv_inf == True) &amp; (hv_art!= &quot;on_VL_suppressed&quot;)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_ALRI_HIV/AIDS&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;SAM&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_ALRI_underweight&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                                                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_ALRI_non_exclusive_breastfeeding&#39;</span><span class="p">])</span>
                <span class="p">)</span>

            <span class="c1"># Unpack `target_prob_by_age` to a dict with keys that match `age_years_exact` = 0, 1, 2, 3, 4</span>
            <span class="n">_target</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">0</span><span class="p">:</span> <span class="n">target_prob_by_age</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="mi">1</span><span class="p">:</span> <span class="n">target_prob_by_age</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="mi">2</span><span class="p">:</span> <span class="n">target_prob_by_age</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="mi">3</span><span class="p">:</span> <span class="n">target_prob_by_age</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="mi">4</span><span class="p">:</span> <span class="n">target_prob_by_age</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="c1"># make unscaled linear model</span>
            <span class="n">unscaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model</span><span class="p">()</span>

            <span class="c1"># Compute scaling factors for each age-group:</span>
            <span class="n">_age_effect</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">_target</span><span class="p">)</span> <span class="o">/</span>
                           <span class="n">unscaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                           <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="c1"># Return the linear model with the appropriate scaling factor</span>
            <span class="k">return</span> <span class="n">make_linear_model</span><span class="p">(</span><span class="n">age_effects</span><span class="o">=</span><span class="n">_age_effect</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">patho</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span><span class="p">[</span><span class="n">patho</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">make_scaled_linear_model_for_incidence</span><span class="p">(</span><span class="n">target_prob_by_age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;base_inc_rate_ALRI_by_</span><span class="si">{</span><span class="n">patho</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">compute_risk_of_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the risk of a pathogen, using the linear model created and the df provided&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="c1"># Run linear model to get baseline risk</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incidence_equations_by_pathogen</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># apply the reduced risk of acquisition for those vaccinated</span>
        <span class="k">if</span> <span class="n">pathogen</span> <span class="o">==</span> <span class="s2">&quot;Strep_pneumoniae_PCV13&quot;</span><span class="p">:</span>
            <span class="n">baseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;va_pneumo_all_doses&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)]</span> \
                <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_Strep_pneum_VT_ALRI_with_PCV13_age&lt;2y&#39;</span><span class="p">]</span>
            <span class="n">baseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;va_pneumo_all_doses&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))]</span> \
                <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_Strep_pneum_VT_ALRI_with_PCV13_age2to5y&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pathogen</span> <span class="o">==</span> <span class="s2">&quot;Hib&quot;</span><span class="p">:</span>
            <span class="n">baseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;va_hib_all_doses&#39;</span><span class="p">]]</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_Hib_ALRI_with_Hib_vaccine&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">baseline</span>

    <span class="k">def</span> <span class="nf">determine_disease_type_and_secondary_bacterial_coinfection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
                                                                   <span class="n">va_hib_all_doses</span><span class="p">,</span> <span class="n">va_pneumo_all_doses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines:</span>
<span class="sd">         * the disease that is caused by infection with this pathogen (from among self.disease_types)</span>
<span class="sd">         * if there is a bacterial coinfection associated that will cause the dominant disease.</span>

<span class="sd">         Note that the disease_type is &#39;bacterial_pneumonia&#39; if primary pathogen is viral and there is a secondary</span>
<span class="sd">         bacterial coinfection.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="c1"># Determine the disease type - pneumonia or bronchiolitis/other_alri</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proportion_pneumonia_in_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">_ALRI&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proportion_pneumonia_in_</span><span class="si">{</span><span class="n">pathogen</span><span class="si">}</span><span class="s1">_ALRI&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="n">disease_type</span> <span class="o">=</span> <span class="s1">&#39;pneumonia&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disease_type</span> <span class="o">=</span> <span class="s1">&#39;bronchiolitis/other_alri&#39;</span>

        <span class="c1"># Determine bacterial-coinfection</span>
        <span class="k">if</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;viral&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">disease_type</span> <span class="o">==</span> <span class="s1">&#39;pneumonia&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_viral_pneumonia_bacterial_coinfection&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
                    <span class="n">bacterial_coinfection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_bacterial_infection</span><span class="p">(</span><span class="n">va_hib_all_doses</span><span class="o">=</span><span class="n">va_hib_all_doses</span><span class="p">,</span>
                                                                               <span class="n">va_pneumo_all_doses</span><span class="o">=</span><span class="n">va_pneumo_all_doses</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bacterial_coinfection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># brochiolitis/other_alri (viral)</span>
                <span class="n">bacterial_coinfection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No bacterial co-infection in primary bacterial or fungal cause</span>
            <span class="n">bacterial_coinfection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">assert</span> <span class="n">disease_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">disease_types</span>
        <span class="k">assert</span> <span class="n">bacterial_coinfection</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;bacterial&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">disease_type</span><span class="p">,</span> <span class="n">bacterial_coinfection</span>

    <span class="k">def</span> <span class="nf">secondary_bacterial_infection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">va_hib_all_doses</span><span class="p">,</span> <span class="n">va_pneumo_all_doses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine which specific bacterial pathogen causes a secondary coinfection, or if there is no secondary</span>
<span class="sd">        bacterial infection (due to the effects of the pneumococcal vaccine).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="c1"># get probability of bacterial coinfection with each pathogen</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;bacterial&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_bacterial_coinfection_pathogen&#39;</span><span class="p">]))</span>

        <span class="c1"># Edit the probability that the coinfection will be of `Strep_pneumoniae_PCV13` if the person has had</span>
        <span class="c1"># the pneumococcal vaccine:</span>
        <span class="k">if</span> <span class="n">va_pneumo_all_doses</span><span class="p">:</span>
            <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;Strep_pneumoniae_PCV13&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_Strep_pneum_VT_ALRI_with_PCV13_age2to5y&#39;</span><span class="p">]</span>

        <span class="c1"># Edit the probability that the coinfection will be of `Hib` if the person has had</span>
        <span class="c1"># the hib vaccine:</span>
        <span class="k">if</span> <span class="n">va_hib_all_doses</span><span class="p">:</span>
            <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;Hib&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_Hib_ALRI_with_Hib_vaccine&#39;</span><span class="p">]</span>

        <span class="c1"># Add in the probability that there is none (to ensure that all probabilities sum to 1.0)</span>
        <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;_none_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># return the random selection of bacterial coinfection (including possibly np.nan for &#39;none&#39;)</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">p</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">outcome</span> <span class="k">if</span> <span class="n">outcome</span> <span class="o">!=</span> <span class="s1">&#39;_none_&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">get_complications_that_onset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disease_type</span><span class="p">,</span> <span class="n">primary_path_is_bacterial</span><span class="p">,</span> <span class="n">has_secondary_bacterial_inf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the set of complication for this person&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="n">probs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># probabilities for local pulmonary complications</span>
        <span class="n">prob_pulmonary_complications</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_pulmonary_complications_in_pneumonia&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">disease_type</span> <span class="o">==</span> <span class="s1">&#39;pneumonia&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prob_pulmonary_complications</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pneumothorax&#39;</span><span class="p">,</span> <span class="s1">&#39;pleural_effusion&#39;</span><span class="p">,</span> <span class="s1">&#39;lung_abscess&#39;</span><span class="p">,</span> <span class="s1">&#39;empyema&#39;</span><span class="p">]:</span>
                    <span class="n">probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_in_pulmonary_complicated_pneumonia&#39;</span><span class="p">]</span>
                    <span class="c1"># TODO: lung abscess, empyema should only apply to (primary or secondary) bacteria ALRIs</span>

            <span class="c1"># probabilities for systemic complications</span>
            <span class="k">if</span> <span class="n">primary_path_is_bacterial</span> <span class="ow">or</span> <span class="n">has_secondary_bacterial_inf</span><span class="p">:</span>
                <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;sepsis&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_bacteraemia_in_pneumonia&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_progression_to_sepsis_with_bacteraemia&#39;</span><span class="p">]</span>

            <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;hypoxaemia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_hypoxaemia_in_pneumonia&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">disease_type</span> <span class="o">==</span> <span class="s1">&#39;bronchiolitis/other_alri&#39;</span><span class="p">:</span>
            <span class="n">probs</span><span class="p">[</span><span class="s1">&#39;hypoxaemia&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_hypoxaemia_in_bronchiolitis/other_alri&#39;</span><span class="p">]</span>

        <span class="c1"># determine which complications are onset:</span>
        <span class="n">complications</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">complications</span>

    <span class="k">def</span> <span class="nf">get_oxygen_saturation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complication_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set peripheral oxygen saturation&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;hypoxaemia&#39;</span> <span class="ow">in</span> <span class="n">complication_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;proportion_hypoxaemia_with_SpO2&lt;90%&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">():</span>
                <span class="k">return</span> <span class="s1">&#39;&lt;90%&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;90-92%&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&gt;=93%&#39;</span>

    <span class="k">def</span> <span class="nf">symptoms_for_disease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disease_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine set of symptom (before complications) for a given instance of disease&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="k">assert</span> <span class="n">disease_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">disease_types</span>

        <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">symptom</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_</span><span class="si">{</span><span class="n">symptom</span><span class="si">}</span><span class="s1">_in_</span><span class="si">{</span><span class="n">disease_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">symptom</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s1">&#39;cough&#39;</span><span class="p">,</span> <span class="s1">&#39;difficult_breathing&#39;</span><span class="p">,</span> <span class="s1">&#39;tachypnoea&#39;</span><span class="p">,</span> <span class="s1">&#39;chest_indrawing&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># determine which symptoms are onset:</span>
        <span class="n">symptoms</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">symptoms</span>

    <span class="k">def</span> <span class="nf">symptoms_for_complication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complication</span><span class="p">,</span> <span class="n">oxygen_saturation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Probability of each symptom for a person given a complication&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="n">probs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">:</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;danger_signs&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_danger_signs_in_sepsis&#39;</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">elif</span> <span class="n">complication</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pneumothorax&#39;</span><span class="p">,</span> <span class="s1">&#39;pleural_effusion&#39;</span><span class="p">,</span> <span class="s1">&#39;empyema&#39;</span><span class="p">,</span> <span class="s1">&#39;lung_abscess&#39;</span><span class="p">]:</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;danger_signs&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_danger_signs_in_pulmonary_complications&#39;</span><span class="p">],</span>
                <span class="s1">&#39;chest_indrawing&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_chest_indrawing_in_pulmonary_complications&#39;</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">elif</span> <span class="n">complication</span> <span class="o">==</span> <span class="s1">&#39;hypoxaemia&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oxygen_saturation</span> <span class="o">==</span> <span class="s1">&#39;&lt;90%&#39;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;danger_signs&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_danger_signs_in_SpO2&lt;90%&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;chest_indrawing&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_chest_indrawing_in_SpO2&lt;90%&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">oxygen_saturation</span> <span class="o">==</span> <span class="s1">&#39;90-92%&#39;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;danger_signs&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_danger_signs_in_SpO2_90-92%&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;chest_indrawing&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_chest_indrawing_in_SpO2_90-92%&#39;</span><span class="p">]</span>
                <span class="p">}</span>

        <span class="c1"># determine which symptoms are onset:</span>
        <span class="n">symptoms</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">symptoms</span>

    <span class="k">def</span> <span class="nf">will_die_of_alri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if person will die from Alri. Returns True/False&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="c1"># check if any complications - death occurs only if a complication is present</span>
        <span class="n">any_complications</span> <span class="o">=</span> <span class="n">person</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;ri_complication_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">complications</span><span class="p">]]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

        <span class="c1"># Baseline risk:</span>
        <span class="n">odds_death</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;baseline_odds_alri_death&#39;</span><span class="p">]</span>

        <span class="c1"># The effect of age:</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;age_exact_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_age&lt;2mo&#39;</span><span class="p">]</span>

        <span class="c1"># The effect of gender:</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_male&#39;</span><span class="p">]</span>

        <span class="c1"># The effect of P.jirovecii infection:</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;P.jirovecii&#39;</span><span class="p">:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_P.jirovecii&#39;</span><span class="p">]</span>

        <span class="c1"># The effect of hypoxaemia:</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_complication_hypoxaemia&#39;</span><span class="p">]:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_SpO2&lt;93%&#39;</span><span class="p">]</span>

        <span class="c1"># The effect of factors defined in other modules:</span>
        <span class="c1"># HIV</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;on_VL_suppressed&quot;</span><span class="p">):</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_HIV/AIDS&#39;</span><span class="p">]</span>

        <span class="c1"># malnutrition:</span>
        <span class="k">if</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SAM&#39;</span><span class="p">:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_SAM&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MAM&#39;</span><span class="p">:</span>
            <span class="n">odds_death</span> <span class="o">*=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_death_ALRI_MAM&#39;</span><span class="p">]</span>

        <span class="c1"># Convert odds to probability</span>
        <span class="n">risk_death</span> <span class="o">=</span> <span class="n">odds_death</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">odds_death</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">any_complications</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">risk_death</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   DISEASE MODULE EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="AlriPollingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPollingEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriPollingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the main event that runs the acquisition of pathogens that cause Alri.</span>
<span class="sd">    It determines who is infected and when and schedules individual IncidentCase events to represent onset.</span>

<span class="sd">    A known issue is that Alri events are scheduled based on the risk of current age but occur a short time</span>
<span class="sd">    later when the children will be slightly older. This means that when comparing the model output with data, the</span>
<span class="sd">    model slightly under-represents incidence among younger age-groups and over-represents incidence among older</span>
<span class="sd">    age-groups. This is a small effect when the frequency of the polling event is high.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriPollingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPollingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_a_year_until_next_polling_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fraction_of_year_between_polling_event</span><span class="p">()</span></div>

<div class="viewcode-block" id="AlriPollingEvent.compute_fraction_of_year_between_polling_event"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPollingEvent.compute_fraction_of_year_between_polling_event">[docs]</a>    <span class="k">def</span> <span class="nf">compute_fraction_of_year_between_polling_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute fraction of a year that elapses between polling event. This is used to adjust the risk of</span>
<span class="sd">        infection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriPollingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPollingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine who will become infected and schedule for them an AlriComplicationOnsetEvent&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span>

        <span class="c1"># Compute the incidence rate for each person getting Alri and then convert into a probability</span>
        <span class="c1"># getting all children that do not currently have an Alri episode (never had or last episode resolved)</span>
        <span class="n">mask_could_get_new_alri_event</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">ri_current_infection_status</span> <span class="o">&amp;</span>
            <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">ri_end_of_current_episode</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ri_end_of_current_episode</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Compute the incidence rate for each person acquiring Alri</span>
        <span class="n">inc_of_acquiring_alri</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_alri_event</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">:</span>
            <span class="n">inc_of_acquiring_alri</span><span class="p">[</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">compute_risk_of_acquisition</span><span class="p">(</span>
                <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">,</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_could_get_new_alri_event</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">probs_of_acquiring_pathogen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="n">inc_of_acquiring_alri</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_a_year_until_next_polling_event</span>
        <span class="p">)</span>

        <span class="c1"># Sample to find outcomes:</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="n">sample_outcome</span><span class="p">(</span><span class="n">probs</span><span class="o">=</span><span class="n">probs_of_acquiring_pathogen</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>

        <span class="c1"># For persons that will become infected with a particular pathogen:</span>
        <span class="k">for</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="n">outcome</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1">#  Create the event for the onset of infection:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span>
                <span class="n">event</span><span class="o">=</span><span class="n">AlriIncidentCase</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">random_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="AlriIncidentCase"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIncidentCase">[docs]</a><span class="k">class</span> <span class="nc">AlriIncidentCase</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Event is for the onset of the infection that causes Alri. It is scheduled by the AlriPollingEvent.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriIncidentCase.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIncidentCase.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span> <span class="o">=</span> <span class="n">pathogen</span></div>

<div class="viewcode-block" id="AlriIncidentCase.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIncidentCase.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        * Determines the disease and complications associated with this case</span>
<span class="sd">        * Updates all the properties so that they pertain to this current episode of Alri</span>
<span class="sd">        * Imposes the symptoms</span>
<span class="sd">        * Schedules relevant natural history event {(either AlriNaturalRecoveryEvent or AlriDeathEvent)}</span>
<span class="sd">        * Updates the counters in the log accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span>

        <span class="c1"># The event should not run if the person is not currently alive:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Add this case to the counter:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">logging_event</span><span class="o">.</span><span class="n">new_case</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">)</span>

        <span class="c1"># ----------------- Determine the Alri disease type and bacterial coinfection for this case -----------------</span>
        <span class="n">disease_type</span><span class="p">,</span> <span class="n">bacterial_coinfection</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">determine_disease_type_and_secondary_bacterial_coinfection</span><span class="p">(</span>
            <span class="n">age</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
            <span class="n">va_hib_all_doses</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">va_hib_all_doses</span><span class="p">,</span> <span class="n">va_pneumo_all_doses</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">va_pneumo_all_doses</span><span class="p">)</span>

        <span class="c1"># ----------------------- Duration of the Alri event -----------------------</span>
        <span class="n">duration_in_days_of_alri</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;max_alri_duration_in_days_without_treatment&#39;</span><span class="p">])</span>
        <span class="c1"># assumes uniform interval around mean duration of 7 days, with range 14 days</span>

        <span class="c1"># Date for outcome (either recovery or death) with uncomplicated Alri</span>
        <span class="n">date_of_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">duration_in_days_of_alri</span><span class="p">)</span>

        <span class="c1"># Define &#39;episode end&#39; date. This the date when this episode ends. It is the last possible data that any HSI</span>
        <span class="c1"># could affect this episode.</span>
        <span class="n">episode_end</span> <span class="o">=</span> <span class="n">date_of_outcome</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;days_between_treatment_and_cure&#39;</span><span class="p">])</span>

        <span class="c1"># Update the properties in the dataframe:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
               <span class="p">(</span>
                   <span class="s1">&#39;ri_current_infection_status&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_secondary_bacterial_pathogen&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_disease_type&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_on_treatment&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_start_of_current_episode&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_end_of_current_episode&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;ri_ALRI_tx_start_date&#39;</span>
               <span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathogen</span><span class="p">,</span>
            <span class="n">bacterial_coinfection</span><span class="p">,</span>
            <span class="n">disease_type</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span>
            <span class="n">episode_end</span><span class="p">,</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="p">)</span>

        <span class="c1"># ----------------------------------- Clinical Symptoms -----------------------------------</span>
        <span class="c1"># impose clinical symptoms for new uncomplicated Alri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impose_symptoms_for_uncomplicated_disease</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">disease_type</span><span class="o">=</span><span class="n">disease_type</span><span class="p">)</span>

        <span class="c1"># ----------------------------------- Complications  -----------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impose_complications</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># ----------------------------------- Outcome  -----------------------------------</span>
        <span class="k">if</span> <span class="n">models</span><span class="o">.</span><span class="n">will_die_of_alri</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriDeathEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_of_outcome</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AlriNaturalRecoveryEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="n">date_of_outcome</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ri_scheduled_recovery_date&#39;</span><span class="p">,</span> <span class="s1">&#39;ri_scheduled_death_date&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_of_outcome</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span></div>

<div class="viewcode-block" id="AlriIncidentCase.impose_symptoms_for_uncomplicated_disease"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIncidentCase.impose_symptoms_for_uncomplicated_disease">[docs]</a>    <span class="k">def</span> <span class="nf">impose_symptoms_for_uncomplicated_disease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">disease_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imposes the clinical symptoms to uncomplicated Alri. These symptoms are not set to auto-resolve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span>
        <span class="n">symptoms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">symptoms_for_disease</span><span class="p">(</span><span class="n">disease_type</span><span class="o">=</span><span class="n">disease_type</span><span class="p">))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
            <span class="n">symptom_string</span><span class="o">=</span><span class="n">symptoms</span><span class="p">,</span>
            <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">disease_module</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="AlriIncidentCase.impose_complications"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIncidentCase.impose_complications">[docs]</a>    <span class="k">def</span> <span class="nf">impose_complications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Choose a set of complications for this person and onset these all instantanesouly.&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">models</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Determine complications</span>
        <span class="n">complications_that_onset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">get_complications_that_onset</span><span class="p">(</span>
            <span class="n">disease_type</span><span class="o">=</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_disease_type&#39;</span><span class="p">],</span>
            <span class="n">primary_path_is_bacterial</span><span class="o">=</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;ri_primary_pathogen&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pathogens</span><span class="p">[</span><span class="s1">&#39;bacterial&#39;</span><span class="p">],</span>
            <span class="n">has_secondary_bacterial_inf</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ri_secondary_bacterial_pathogen</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">oxygen_saturation</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">get_oxygen_saturation</span><span class="p">(</span><span class="n">complication_set</span><span class="o">=</span><span class="n">complications_that_onset</span><span class="p">)</span>

        <span class="c1"># Update dataframe</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ri_complication_</span><span class="si">{</span><span class="n">complication</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="n">complications_that_onset</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ri_SpO2_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxygen_saturation</span>

        <span class="c1"># Onset symptoms</span>
        <span class="k">for</span> <span class="n">complication</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">complications_that_onset</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">impose_symptoms_for_complication</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                               <span class="n">complication</span><span class="o">=</span><span class="n">complication</span><span class="p">,</span>
                                               <span class="n">oxygen_saturation</span><span class="o">=</span><span class="n">oxygen_saturation</span>
                                               <span class="p">)</span></div></div>


<div class="viewcode-block" id="AlriNaturalRecoveryEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriNaturalRecoveryEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriNaturalRecoveryEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the Natural Recovery event. It is scheduled by the AlriIncidentCase Event for someone who will recover</span>
<span class="sd">    from the infection even if no care received. It calls the &#39;end_infection&#39; function.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriNaturalRecoveryEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriNaturalRecoveryEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriNaturalRecoveryEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriNaturalRecoveryEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check if person should really recover:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">ri_current_infection_status</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ri_scheduled_recovery_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ri_scheduled_death_date</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># Log the recovery</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">logging_event</span><span class="o">.</span><span class="n">new_recovered_case</span><span class="p">(</span>
                <span class="n">age</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span>
                <span class="n">pathogen</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">ri_primary_pathogen</span>
            <span class="p">)</span>

            <span class="c1"># Do the episode:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">end_episode</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AlriCureEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCureEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriCureEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the cure event. It is scheduled by an HSI treatment event. It enacts the actual &quot;cure&quot; of the person</span>
<span class="sd">    that is caused (after some delay) by the treatment administered.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriCureEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCureEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriCureEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCureEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check if person should really be cured:</span>
        <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">ri_current_infection_status</span><span class="p">:</span>
            <span class="c1"># Log the cure:</span>
            <span class="n">pathogen</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">ri_primary_pathogen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">logging_event</span><span class="o">.</span><span class="n">new_cured_case</span><span class="p">(</span>
                <span class="n">age</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span>
                <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span>
            <span class="p">)</span>

            <span class="c1"># End the episode:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">end_episode</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AlriDeathEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriDeathEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Event is for the death of someone that is caused by the infection with a pathogen that causes Alri.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriDeathEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriDeathEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriDeathEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriDeathEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>  <span class="c1"># shortcut to the dataframe</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The event should not run if the person is not currently alive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check if person should really die of Alri:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">person</span><span class="o">.</span><span class="n">ri_current_infection_status</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ri_scheduled_death_date</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">ri_scheduled_recovery_date</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># Do the death:</span>
            <span class="n">pathogen</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">ri_primary_pathogen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span>
                <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;ALRI_&#39;</span> <span class="o">+</span> <span class="n">pathogen</span><span class="p">,</span>
                <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span>
            <span class="p">)</span>

            <span class="c1"># Log the death in the Alri logging system</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">logging_event</span><span class="o">.</span><span class="n">new_death</span><span class="p">(</span>
                <span class="n">age</span><span class="o">=</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span><span class="p">,</span>
                <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span>
            <span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1"># ==================================== HEALTH SYSTEM INTERACTION EVENTS ====================================</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HSI_Alri_GenericTreatment"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.HSI_Alri_GenericTreatment">[docs]</a><span class="k">class</span> <span class="nc">HSI_Alri_GenericTreatment</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a template for the HSI interaction events. It just shows the checks to use each time.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Alri_GenericTreatment.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.HSI_Alri_GenericTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Alri_GenericTreatment&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_Alri_GenericTreatment.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.HSI_Alri_GenericTreatment.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do the treatment&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Exit if the person is not alive or is not currently infected:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">ri_current_infection_status</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># For example, say that probability of cure = 1.0</span>
        <span class="n">prob_of_cure</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">prob_of_cure</span><span class="o">=</span><span class="n">prob_of_cure</span><span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   LOGGING EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="AlriLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Event logs the number of incident cases that have occurred since the previous logging event.</span>
<span class="sd">    Analysis scripts expect that the frequency of this logging event is once per year.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="c1"># This event to occur every year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>

        <span class="c1"># initialise trakcers of incident cases, new recoveries, new treatments and deaths due to ALRI</span>
        <span class="n">age_grps</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;2-4&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;2-4&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;2-4&quot;</span><span class="p">},</span> <span class="o">**</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="s2">&quot;5+&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)}}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;incident_cases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">age_grps</span><span class="o">=</span><span class="n">age_grps</span><span class="p">,</span> <span class="n">pathogens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;recovered_cases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">age_grps</span><span class="o">=</span><span class="n">age_grps</span><span class="p">,</span> <span class="n">pathogens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;cured_cases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">age_grps</span><span class="o">=</span><span class="n">age_grps</span><span class="p">,</span> <span class="n">pathogens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;deaths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="n">age_grps</span><span class="o">=</span><span class="n">age_grps</span><span class="p">,</span> <span class="n">pathogens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">all_pathogens</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriLoggingEvent.new_case"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.new_case">[docs]</a>    <span class="k">def</span> <span class="nf">new_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;incident_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_one</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriLoggingEvent.new_recovered_case"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.new_recovered_case">[docs]</a>    <span class="k">def</span> <span class="nf">new_recovered_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;recovered_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_one</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriLoggingEvent.new_cured_case"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.new_cured_case">[docs]</a>    <span class="k">def</span> <span class="nf">new_cured_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;cured_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_one</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriLoggingEvent.new_death"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.new_death">[docs]</a>    <span class="k">def</span> <span class="nf">new_death</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;deaths&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_one</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="o">=</span><span class="n">pathogen</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log:</span>
<span class="sd">        1) Number of new cases, by age-group and by pathogen since the last logging event</span>
<span class="sd">        2) Total number of cases, recovery, treatments and deaths since the last logging event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># 1) Number of new cases, by age-group and by pathogen, since the last logging event</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;incidence_count_by_age_and_pathogen&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="p">[</span><span class="s1">&#39;incident_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">report_current_counts</span><span class="p">(),</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;pathogens incident case counts in the last year&#39;</span>
        <span class="p">)</span>

        <span class="c1"># 2) Total number of cases, recovery, treatments and deaths since the last logging event</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;event_counts&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">report_current_total</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Counts of cases, recovery, treatment and death in the last year&#39;</span>
        <span class="p">)</span>

        <span class="c1"># 3) Reset the trackers</span>
        <span class="k">for</span> <span class="n">tracker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div></div>


<span class="k">class</span> <span class="nc">Tracker</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Helper class to be a counter for number of events occuring by age-group and by pathogen.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age_grps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pathogens</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and initalise tracker&quot;&quot;&quot;</span>

        <span class="c1"># Check and store parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span> <span class="o">=</span> <span class="n">pathogens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age_grps_lookup</span> <span class="o">=</span> <span class="n">age_grps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique_age_grps</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age_grps_lookup</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="c1"># Initialise Tracker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Produce a dict of the form: { &lt;Age-Grp&gt;: {&lt;Pathogen&gt;: &lt;Count&gt;} }&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">age</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">)))</span> <span class="k">for</span> <span class="n">age</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_age_grps</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">add_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">pathogen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increment counter by one for a specific age and pathogen&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">age</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">age_grps_lookup</span><span class="p">,</span> <span class="s1">&#39;Age not recognised&#39;</span>
        <span class="k">assert</span> <span class="n">pathogen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathogens</span><span class="p">,</span> <span class="s1">&#39;Pathogen not recognised&#39;</span>

        <span class="c1"># increment by one:</span>
        <span class="n">age_grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age_grps_lookup</span><span class="p">[</span><span class="n">age</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">[</span><span class="n">age_grp</span><span class="p">][</span><span class="n">pathogen</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">report_current_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span>

    <span class="k">def</span> <span class="nf">report_current_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">[</span><span class="n">_a</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">total</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   DEBUGGING / TESTING EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="AlriCheckPropertiesEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCheckPropertiesEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriCheckPropertiesEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This event runs daily and checks properties are in the right configuration. Only use whilst debugging!&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriCheckPropertiesEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCheckPropertiesEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="AlriCheckPropertiesEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriCheckPropertiesEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_properties</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AlriIndividualLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIndividualLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">AlriIndividualLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Event logs the daily occurrence to a single individual child.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AlriIndividualLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIndividualLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="c1"># This logging event to occur every day</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">log_individual</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_id</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;The person identified to be logged does not exist.&#39;</span></div>

<div class="viewcode-block" id="AlriIndividualLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriIndividualLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log all properties for this module&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">person_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="s1">&#39;log_individual&#39;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Properties for one person (the first under-five-year-old in the dataframe), each day.&#39;</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="AlriPropertiesOfOtherModules"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules">[docs]</a><span class="k">class</span> <span class="nc">AlriPropertiesOfOtherModules</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For the purpose of the testing, this module generates the properties upon which the Alri module relies&quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">}</span>

    <span class="c1"># Though this module provides some properties from NewbornOutcomes we do not list</span>
    <span class="c1"># NewbornOutcomes in the ALTERNATIVE_TO set to allow using in conjunction with</span>
    <span class="c1"># SimplifiedBirths which can also be used as an alternative to NewbornOutcomes</span>
    <span class="n">ALTERNATIVE_TO</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Hiv&#39;</span><span class="p">,</span> <span class="s1">&#39;Epi&#39;</span><span class="p">,</span> <span class="s1">&#39;Wasting&#39;</span><span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;hv_inf&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;hv_art&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;not&quot;</span><span class="p">,</span> <span class="s2">&quot;on_VL_suppressed&quot;</span><span class="p">,</span> <span class="s2">&quot;on_not_VL_suppressed&quot;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                               <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;extremely_low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;very_low_birth_weight&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;normal_birth_weight&#39;</span><span class="p">]),</span>

        <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;va_pneumo_all_doses&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;va_hib_all_doses&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;va_measles_all_doses&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                                   <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MAM&#39;</span><span class="p">,</span> <span class="s1">&#39;SAM&#39;</span><span class="p">,</span> <span class="s1">&#39;well&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="AlriPropertiesOfOtherModules.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlriPropertiesOfOtherModules.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="AlriPropertiesOfOtherModules.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;non_exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;va_pneumo_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;va_hib_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;va_measles_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;well&#39;</span></div>

<div class="viewcode-block" id="AlriPropertiesOfOtherModules.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="AlriPropertiesOfOtherModules.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.alri.html#tlo.methods.alri.AlriPropertiesOfOtherModules.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;non_exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;va_pneumo_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;va_hib_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;va_measles_all_doses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;un_clinical_acute_malnutrition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;well&#39;</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Mar 25, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>