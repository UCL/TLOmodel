

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.rti &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.rti</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.rti</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Road traffic injury module.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.causes</span> <span class="kn">import</span> <span class="n">Cause</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.symptommanager</span> <span class="kn">import</span> <span class="n">Symptom</span>

<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   MODULE DEFINITIONS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<div class="viewcode-block" id="RTI"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI">[docs]</a><span class="k">class</span> <span class="nc">RTI</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The road traffic injuries module for the TLO model, handling all injuries related to road traffic accidents.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTI.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># NB. Parameters passed to the module can be inserted in the __init__ definition.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SymptomManager&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;HealthBurden&quot;</span><span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Demography&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lifestyle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">INJURY_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rt_injury_1&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]</span>

    <span class="n">INJURY_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span> <span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;241&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;291&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;412&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;461&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;442&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;612&#39;</span><span class="p">,</span> <span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;712a&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;813eo&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;8113&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674a&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">]</span>

    <span class="n">SWAPPING_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674a&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;813eo&#39;</span><span class="p">]</span>

    <span class="n">INJURIES_REQ_IMAGING</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;412&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;612&#39;</span><span class="p">,</span> <span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">,</span> <span class="s1">&#39;673&#39;</span><span class="p">,</span> <span class="s1">&#39;674&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;461&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">]</span>

    <span class="n">FRACTURE_CODES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;412&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;612&#39;</span><span class="p">,</span> <span class="s1">&#39;712&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813&#39;</span><span class="p">]</span>

    <span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;112&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
        <span class="s1">&#39;113&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
        <span class="s1">&#39;1101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;211&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
        <span class="s1">&#39;212&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
        <span class="s1">&#39;241&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;2101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;291&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;342&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s1">&#39;343&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s1">&#39;361&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;363&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">&#39;322&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s1">&#39;323&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
        <span class="s1">&#39;3101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;3113&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="s1">&#39;412&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
        <span class="s1">&#39;414&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>
        <span class="s1">&#39;461&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;463&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">&#39;453a&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
        <span class="s1">&#39;453b&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
        <span class="s1">&#39;441&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">&#39;442&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s1">&#39;4101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;552&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
        <span class="s1">&#39;553&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
        <span class="s1">&#39;554&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
        <span class="s1">&#39;5101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;5113&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="s1">&#39;612&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
        <span class="s1">&#39;712a&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
        <span class="s1">&#39;712b&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
        <span class="s1">&#39;722&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
        <span class="s1">&#39;7101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;7113&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
        <span class="s1">&#39;813do&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
        <span class="s1">&#39;813eo&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="s1">&#39;813bo&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="s1">&#39;813co&#39;</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="s1">&#39;822a&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s1">&#39;822b&#39;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
        <span class="s1">&#39;8101&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;8113&#39;</span><span class="p">:</span> <span class="mi">56</span>
    <span class="p">}</span>

    <span class="c1"># Module parameters</span>
    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s1">&#39;base_rate_injrti&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Base rate of RTI per year&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age04&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 0-4 compared to base rate of RTI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age59&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 5-9 compared to base rate of RTI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age1017&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 10-17 compared to base rate of RTI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age1829&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 18-29 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age3039&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 30-39 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age4049&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 40-49 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age5059&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 50-59 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age6069&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 60-69 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_age7079&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in age 70-79 compared to base rate of RTI&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_male&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI when male compared to females&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;rr_injrti_excessalcohol&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;risk ratio of RTI in those that consume excess alcohol compared to those who do not&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;imm_death_proportion_rti&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of those involved in an RTI that die at site of accident or die before seeking medical &#39;</span>
            <span class="s1">&#39;intervention&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_bleeding_leads_to_shock&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The proportion of those with heavily bleeding injuries who go into shock&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_iss_less_than_9&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of people who pass away in the following month after medical treatment for injuries with an ISS&#39;</span>
            <span class="s1">&#39;score less than or equal to 9&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_iss_10_15&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of people who pass away in the following month after medical treatment for injuries with an ISS&#39;</span>
            <span class="s1">&#39;score from 10 to 15&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_iss_16_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of people who pass away in the following month after medical treatment for injuries with an ISS&#39;</span>
            <span class="s1">&#39;score from 16 to 24&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_iss_25_35&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of people who pass away in the following month after medical treatment for injuries with an ISS&#39;</span>
            <span class="s1">&#39;score from 25 to 34&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_iss_35_plus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Proportion of people who pass away in the following month after medical treatment for injuries with an ISS&#39;</span>
            <span class="s1">&#39;score 35 and above&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_perm_disability_with_treatment_severe_TBI&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with a treated severe TBI is permanently disabled&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_TBI_SCI_no_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with a spinal cord injury will die without treatment&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prop_death_burns_no_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with a burn injury will die without treatment&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_fractures_no_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with a fracture injury will die without treatment&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_TBI_require_craniotomy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with a traumatic brain injury will require a craniotomy surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_exploratory_laparotomy&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;probability that someone with an internal organ injury will require a exploratory_laparotomy&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_depressed_skull_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability that a skull fracture will be depressed and therefore require surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_mild_burns&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability that a burn within a region will result in &lt; 10% total body surface area&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_dislocation_requires_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability that a dislocation will require surgery to relocate the joint.&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;number_of_injured_body_regions_distribution&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;The distribution of number of injured AIS body regions, used to decide how many injuries a person has&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;injury_location_distribution&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;The distribution of where injuries are located in the body, based on the AIS body region definition&#39;</span>
        <span class="p">),</span>
        <span class="c1"># Length of stay</span>
        <span class="s1">&#39;mean_los_ISS_less_than_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean length of stay for someone with an ISS score &lt; 4&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_los_ISS_less_than_4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Standard deviation in length of stay for someone with an ISS score &lt; 4&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_los_ISS_4_to_8&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean length of stay for someone with an ISS score between 4 and 8&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_los_ISS_4_to_8&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Standard deviation in length of stay for someone with an ISS score between 4 and 8&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_los_ISS_9_to_15&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean length of stay for someone with an ISS score between 9 and 15&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_los_ISS_9_to_15&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Standard deviation in length of stay for someone with an ISS score between 9 and 15&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_los_ISS_16_to_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean length of stay for someone with an ISS score between 16 and 24&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_los_ISS_16_to_24&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Standard deviation in length of stay for someone with an ISS score between 16 and 24&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_los_ISS_more_than_25&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean length of stay for someone with an ISS score between 16 and 24&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_los_ISS_more_that_25&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Standard deviation in length of stay for someone with an ISS score between 16 and 24&#39;</span>
        <span class="p">),</span>
        <span class="c1"># DALY weights</span>
        <span class="s1">&#39;daly_wt_unspecified_skull_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_unspecified_skull_fracture - code 1674&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_basilar_skull_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_basilar_skull_fracture - code 1675&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_epidural_hematoma&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_epidural_hematoma - code 1676&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_subdural_hematoma&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_subdural_hematoma - code 1677&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_subarachnoid_hematoma&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_subarachnoid_hematoma - code 1678&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_brain_contusion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_brain_contusion - code 1679&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_intraventricular_haemorrhage&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_intraventricular_haemorrhage - code 1680&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_diffuse_axonal_injury&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_diffuse_axonal_injury - code 1681&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_subgaleal_hematoma&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_subgaleal_hematoma - code 1682&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_midline_shift&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_midline_shift - code 1683&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_facial_fracture - code 1684&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_facial_soft_tissue_injury - code 1685&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_eye_injury&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_eye_injury - code 1686&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_neck_soft_tissue_injury&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_neck_soft_tissue_injury - code 1687&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_neck_internal_bleeding - code 1688&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_neck_dislocation - code 1689&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_chest_wall_bruises_hematoma&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_chest_wall_bruises_hematoma - code 1690&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hemothorax&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hemothorax - code 1691&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_lung_contusion&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_lung_contusion - code 1692&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_diaphragm_rupture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_diaphragm_rupture - code 1693&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_rib_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_rib_fracture - code 1694&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_flail_chest&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_flail_chest - code 1695&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_chest_wall_laceration&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_chest_wall_laceration - code 1696&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_closed_pneumothorax&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_closed_pneumothorax - code 1697&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_open_pneumothorax&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_open_pneumothorax - code 1698&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_surgical_emphysema&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_surgical_emphysema aka subcuteal emphysema - code 1699&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_abd_internal_organ_injury - code 1700&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment - code 1701&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment - code 1702&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment - code 1703&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment - code 1704&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_vertebrae_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_vertebrae_fracture - code 1705&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_clavicle_scapula_humerus_fracture&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_clavicle_scapula_humerus_fracture - code 1706&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hand_wrist_fracture_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hand_wrist_fracture_with_treatment - code 1707&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hand_wrist_fracture_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hand_wrist_fracture_without_treatment - code 1708&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment - code 1709&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_radius_ulna_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_radius_ulna_fracture_long_term_without_treatment - code 1710&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_dislocated_shoulder&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_dislocated_shoulder - code 1711&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_amputated_finger&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_amputated_finger - code 1712&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_amputated_thumb&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_amputated_thumb - code 1713&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_unilateral_arm_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_unilateral_arm_amputation_with_treatment - code 1714&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_unilateral_arm_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_unilateral_arm_amputation_without_treatment - code 1715&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_bilateral_arm_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_bilateral_arm_amputation_with_treatment - code 1716&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_bilateral_arm_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_bilateral_arm_amputation_without_treatment - code 1717&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment - code 1718&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_foot_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_foot_fracture_long_term_without_treatment - code 1719&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_with_treatment - code 1720&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment - code 1721&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment - code 1722&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hip_fracture_long_term_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hip_fracture_long_term_with_treatment - code 1723&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_hip_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_hip_fracture_long_term_without_treatment - code 1724&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_pelvis_fracture_short_term - code 1725&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_pelvis_fracture_long_term - code 1726&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_femur_fracture_short_term - code 1727&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_femur_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_femur_fracture_long_term_without_treatment - code 1728&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_dislocated_hip&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_dislocated_hip - code 1729&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_dislocated_knee&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_dislocated_knee - code 1730&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_amputated_toes&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_amputated_toes - code 1731&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_with_treatment - code 1732&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_without_treatment - code 1733&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_with_treatment - code 1734&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_without_treatment - code 1735&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;rt_emergency_care_ISS_score_cut_off&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
            <span class="s1">&#39;A parameter to determine which level of injury severity corresponds to the emergency health care seeking &#39;</span>
            <span class="s1">&#39;symptom and which to the non-emergency generic injury symptom&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_MAIS3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;A parameter to determine the probability of death without medical intervention with a military AIS&#39;</span>
            <span class="s1">&#39;score of 3&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_MAIS4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;A parameter to determine the probability of death without medical intervention with a military AIS&#39;</span>
            <span class="s1">&#39;score of 4&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_MAIS5&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;A parameter to determine the probability of death without medical intervention with a military AIS&#39;</span>
            <span class="s1">&#39;score of 5&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_death_MAIS6&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;A parameter to determine the probability of death without medical intervention with a military AIS&#39;</span>
            <span class="s1">&#39;score of 6&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;femur_fracture_skeletal_traction_mean_los&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
            <span class="s1">&#39;The mean length of stay for a person with a femur fracture being treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;other_skeletal_traction_los&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
            <span class="s1">&#39;The mean length of stay for a person with a non-femur fracture being treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_foot_frac_require_cast&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a foot fracture will be treated with a plaster cast&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_foot_frac_require_maj_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a foot fracture will be treated with a major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_foot_frac_require_min_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a foot fracture will be treated with a major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_foot_frac_require_amp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a foot fracture will be treated with amputation via a major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_tib_fib_frac_require_cast&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a tibia/fibula fracture will be treated with a plaster cast&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_tib_fib_frac_require_maj_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a tibia/fibula fracture will be treated with a major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_tib_fib_frac_require_min_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a tibia/fibula fracture will be treated with a minor surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_tib_fib_frac_require_amp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a tibia/fibula fracture will be treated with an amputation via major &#39;</span>
            <span class="s1">&#39;surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_tib_fib_frac_require_traction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a tibia/fibula fracture will be treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_femural_fracture_require_major_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a femur fracture will be treated with major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_femural_fracture_require_minor_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a femur fracture will be treated with minor surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_femural_fracture_require_cast&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a femur fracture will be treated with a plaster cast&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_femural_fracture_require_amputation&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a femur fracture will be treated with amputation via major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_femural_fracture_require_traction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a femur fracture will be treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_pelvis_fracture_traction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a pelvis fracture will be treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_pelvis_frac_major_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a pelvis fracture will be treated with major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_pelvis_frac_minor_surgery&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a pelvis fracture will be treated with minor surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_pelvis_frac_cast&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a pelvis fracture will be treated with a cast&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_dis_hip_require_maj_surg&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a dislocated hip will be treated with a major surgery&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_dis_hip_require_cast&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a dislocated hip will be treated with a plaster cast&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_hip_dis_require_traction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that a person with a dislocated hip will be treated with skeletal traction&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;hdu_cut_off_iss_score&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span>
            <span class="s1">&#39;The ISS score used as a criteria to admit patients to the HDU/ICU units&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_icu_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The mean length of stay in the ICUfor those without TBI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_icu_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The standard deviation in length of stay in the ICU for those without TBI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;mean_tbi_icu_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The mean length of stay in the ICU for those with TBI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;sd_tbi_icu_days&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The standard deviation in length of stay in the ICU for those with TBI&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;prob_open_fracture_contaminated&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;The probability that an open fracture will be contaminated&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;allowed_interventions&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;List of additional interventions that can be included when performing model analysis&#39;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_112&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a skull fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a basilar skull fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_133a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a Subarachnoid hematoma&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_133b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a Brain contusion&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_133c&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is an Intraventricular haemorrhage&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_133d&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a Subgaleal hematoma&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_134a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is an Epidural hematoma&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_134b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a Subdural hematoma&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_135&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a Diffuse axonal injury/midline shift&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_1101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;head_prob_1114&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s head injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_211&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is a Facial fracture (nasal/unspecified)&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_212&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is a Facial fracture (mandible/zygomatic)&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_241&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is a soft tissue injury&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_2101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_2114&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;face_prob_291&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s face injury is an eye injury&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_3101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_3113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_342&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a Soft tissue injury in neck (vertebral artery &quot;</span>
            <span class="s2">&quot;laceration)&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_343&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a Soft tissue injury in neck (pharynx contusion)&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_361&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a Sternomastoid m. hemorrhage/ Hemorrhage, &quot;</span>
            <span class="s2">&quot;supraclavicular triangle/Hemorrhage, posterior triangle/Anterior vertebral vessel hemorrhage/ Neck muscle &quot;</span>
            <span class="s2">&quot;hemorrhage&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_363&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is a Hematoma in carotid sheath/Carotid sheath hemorrhage&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_322&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is an Atlanto-occipital subluxation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;neck_prob_323&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s neck injury is an Atlanto-axial subluxation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_4101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_4113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_461&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is Chest wall bruises/haematoma&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_463&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is Haemothorax&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_453a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a Lung contusion&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_453b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a Diaphragm rupture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_412&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a rib fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_414&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is flail chest&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_441&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a Chest wall lacerations/avulsions&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_442&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a Surgical emphysema&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;thorax_prob_443&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a Closed pneumothorax/ open pneumothorax&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;abdomen_prob_5101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s abdomen injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;abdomen_prob_5113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;abdomen_prob_552&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is a skull fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;abdomen_prob_553&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is an Injury to stomach/intestines/colon&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;abdomen_prob_554&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s thorax injury is an Injury to spleen/Urinary bladder/Liver/Urethra/&quot;</span>
            <span class="s2">&quot;Diaphragm&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_612&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a vertabrae fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_673a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury at neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_673b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury below neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_674a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury at neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_674b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury below neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_675a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury at neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_675b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury below neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;spine_prob_676&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s spine injury is a Spinal cord injury at neck level&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_7101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_7113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_712a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a Fracture to Clavicle, scapula, humerus&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_712b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a Fracture to Hand/wrist&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_712c&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a Fracture to Radius/ulna&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_722&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a dislocated shoulder&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_782a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is an Amputated finger&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_782b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a Unilateral arm amputation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_782c&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a Thumb amputation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;upper_ex_prob_783&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s upper extremity injury is a bilateral arm amputation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_8101&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a laceration&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_8113&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a burn&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_811&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a foot fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813do&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is an open foot fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_812&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Fracture to patella, tibia, fibula, ankle&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813eo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is an open Fracture to patella, tibia, fibula, &quot;</span>
            <span class="s2">&quot;ankle&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Hip fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Pelvis fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813bo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is an open Pelvis fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813c&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Femur fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_813co&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is an open Femur fracture&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_822a&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Dislocated hip&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_822b&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Dislocated knee&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_882&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is an Amputation of toes&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_883&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Unilateral leg amputation&quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;lower_ex_prob_884&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s2">&quot;The probability that this person&#39;s lower extremity injury is a Bilateral leg amputation &quot;</span>
        <span class="p">),</span>
        <span class="s1">&#39;blocked_interventions&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s2">&quot;A list of interventions that are blocked in a simulation&quot;</span>
        <span class="p">)</span>

    <span class="p">}</span>

    <span class="c1"># Define the module&#39;s parameters</span>
    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;involved in a road traffic injury&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                    <span class="s1">&#39;Injury status relating to road traffic injury: none, mild, severe&#39;</span><span class="p">,</span>
                                    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                                    <span class="p">),</span>
        <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 1 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 2 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 3 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 4 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 5 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 6 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 7 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Codes for injury 8 from RTI&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">INJURY_CODES</span><span class="p">),</span>
        <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;A property determining if this person is in shock&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_death_from_shock&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this person died from shock&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that are to be treated with casts&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that are to be treated with a minor&#39;</span>
                                                              <span class="s1">&#39;surgery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that are to be treated with a minor&#39;</span>
                                                              <span class="s1">&#39;surgery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that heal without further treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that with open fracture &#39;</span>
                                                                        <span class="s1">&#39;treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;The ISS score associated with the injuries resulting from a road traffic&#39;</span>
                                            <span class="s1">&#39;accident&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether the injuries from an RTI result in permanent disability&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_polytrauma&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;polytrauma from RTI&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;death at scene True/False&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Person has had their injuries diagnosed&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;List of dates to remove the daly weight associated with each &#39;</span>
                                                       <span class="s1">&#39;injury&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_post_med_death&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;death in following month despite medical intervention True/False&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_no_med_death&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;death in following month without medical intervention True/False&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_unavailable_med_death&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;death in the following month without medical intervention &#39;</span>
                                                         <span class="s1">&#39;being able to be provided&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_recovery_no_med&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;recovery without medical intervention True/False&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_disability&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;disability weight for current month&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_date_inj&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;date of latest injury&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_med_int&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this person is currently undergoing medical treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_in_icu_or_hdu&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this person is currently in ICU for RTI&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_MAIS_military_score&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;the maximum AIS-military score, used as a proxy to calculate the&#39;</span>
                                                      <span class="s1">&#39;probability of mortality without medical intervention&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;the date which the person has is scheduled to die without medical&#39;</span>
                                                     <span class="s1">&#39;intervention&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;The true value of the DALY weight burden&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;A list of injuries that have been left untreated due to a &#39;</span>
                                                           <span class="s1">&#39;blocked intervention&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Declare Metadata</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>  <span class="c1"># Disease modules: Any disease module should carry this label.</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_SYMPTOMMANAGER</span><span class="p">,</span>  <span class="c1"># The &#39;Symptom Manager&#39; recognises modules with this label.</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>  <span class="c1"># The &#39;HealthSystem&#39; recognises modules with this label.</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHBURDEN</span>  <span class="c1"># The &#39;HealthBurden&#39; module recognises modules with this label.</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death</span>
    <span class="n">CAUSES_OF_DEATH</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;RTI_death_without_med&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RTI_death_with_med&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RTI_unavailable_med&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RTI_imm_death&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RTI_death_shock&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Declare Causes of Death and Disability</span>
    <span class="n">CAUSES_OF_DISABILITY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;RTI&#39;</span><span class="p">:</span> <span class="n">Cause</span><span class="p">(</span><span class="n">gbd_causes</span><span class="o">=</span><span class="s1">&#39;Road injuries&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Transport Injuries&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="RTI.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reads the parameters used in the RTI module&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_RTI.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;HealthBurden&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="c1"># get the DALY weights of the seq associated with road traffic injuries</span>
            <span class="n">daly_sequlae_codes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;daly_wt_unspecified_skull_fracture&#39;</span><span class="p">:</span> <span class="mi">1674</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_basilar_skull_fracture&#39;</span><span class="p">:</span> <span class="mi">1675</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_epidural_hematoma&#39;</span><span class="p">:</span> <span class="mi">1676</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_subdural_hematoma&#39;</span><span class="p">:</span> <span class="mi">1677</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_subarachnoid_hematoma&#39;</span><span class="p">:</span> <span class="mi">1678</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_brain_contusion&#39;</span><span class="p">:</span> <span class="mi">1679</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_intraventricular_haemorrhage&#39;</span><span class="p">:</span> <span class="mi">1680</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_diffuse_axonal_injury&#39;</span><span class="p">:</span> <span class="mi">1681</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_subgaleal_hematoma&#39;</span><span class="p">:</span> <span class="mi">1682</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_midline_shift&#39;</span><span class="p">:</span> <span class="mi">1683</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">:</span> <span class="mi">1684</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">:</span> <span class="mi">1685</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_eye_injury&#39;</span><span class="p">:</span> <span class="mi">1686</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_neck_soft_tissue_injury&#39;</span><span class="p">:</span> <span class="mi">1687</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">:</span> <span class="mi">1688</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">:</span> <span class="mi">1689</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_chest_wall_bruises_hematoma&#39;</span><span class="p">:</span> <span class="mi">1690</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hemothorax&#39;</span><span class="p">:</span> <span class="mi">1691</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_lung_contusion&#39;</span><span class="p">:</span> <span class="mi">1692</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_diaphragm_rupture&#39;</span><span class="p">:</span> <span class="mi">1693</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_rib_fracture&#39;</span><span class="p">:</span> <span class="mi">1694</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_flail_chest&#39;</span><span class="p">:</span> <span class="mi">1695</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_chest_wall_laceration&#39;</span><span class="p">:</span> <span class="mi">1696</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_closed_pneumothorax&#39;</span><span class="p">:</span> <span class="mi">1697</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_open_pneumothorax&#39;</span><span class="p">:</span> <span class="mi">1698</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_surgical_emphysema&#39;</span><span class="p">:</span> <span class="mi">1699</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">:</span> <span class="mi">1700</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1701</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1702</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1703</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1704</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_vertebrae_fracture&#39;</span><span class="p">:</span> <span class="mi">1705</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_clavicle_scapula_humerus_fracture&#39;</span><span class="p">:</span> <span class="mi">1706</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hand_wrist_fracture_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1707</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hand_wrist_fracture_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1708</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1709</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_radius_ulna_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1710</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_dislocated_shoulder&#39;</span><span class="p">:</span> <span class="mi">1711</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_amputated_finger&#39;</span><span class="p">:</span> <span class="mi">1712</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_amputated_thumb&#39;</span><span class="p">:</span> <span class="mi">1713</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_unilateral_arm_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1714</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_unilateral_arm_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1715</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_bilateral_arm_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1716</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_bilateral_arm_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1717</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1718</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_foot_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1719</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1720</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1721</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1722</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hip_fracture_long_term_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1723</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_hip_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1724</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">:</span> <span class="mi">1725</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">:</span> <span class="mi">1726</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">:</span> <span class="mi">1727</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_femur_fracture_long_term_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1728</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_dislocated_hip&#39;</span><span class="p">:</span> <span class="mi">1729</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_dislocated_knee&#39;</span><span class="p">:</span> <span class="mi">1730</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_amputated_toes&#39;</span><span class="p">:</span> <span class="mi">1731</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1732</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1733</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1734</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1735</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_burns_greater_than_20_percent_body_area&#39;</span><span class="p">:</span> <span class="mi">1736</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">:</span> <span class="mi">1737</span><span class="p">,</span>
                <span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">:</span> <span class="mi">1738</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">hb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthBurden&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">daly_sequlae_codes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">hb</span><span class="o">.</span><span class="n">get_daly_weight</span><span class="p">(</span><span class="n">sequlae_code</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># ================== Test the parameter distributions to see whether they sum to roughly one ===============</span>
        <span class="c1"># test the distribution of the number of injured body regions</span>
        <span class="k">assert</span> <span class="mf">0.9999</span> <span class="o">&lt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;number_of_injured_body_regions_distribution&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.0001</span><span class="p">,</span> \
            <span class="s2">&quot;The number of injured body region distribution doesn&#39;t sum to one&quot;</span>
        <span class="c1"># test the injury location distribution</span>
        <span class="k">assert</span> <span class="mf">0.9999</span> <span class="o">&lt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;injury_location_distribution&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.0001</span><span class="p">,</span> \
            <span class="s2">&quot;The injured body region distribution doesn&#39;t sum to one&quot;</span>
        <span class="c1"># test the distributions to assign injuries to certain body regions</span>
        <span class="c1"># get the first characters of the parameter names</span>
        <span class="n">body_part_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;head_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;face_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;neck_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;thorax_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;abdomen_prob_&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;spine_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;upper_ex_prob_&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_ex_prob_&#39;</span><span class="p">]</span>
        <span class="c1"># iterate over each body part, check the probabilities add to one</span>
        <span class="k">for</span> <span class="n">body_part</span> <span class="ow">in</span> <span class="n">body_part_strings</span><span class="p">:</span>
            <span class="n">probabilities_to_assign_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">body_part</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]</span>
            <span class="n">sum_probabilities</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probabilities_to_assign_injuries</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">sum_probabilities</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sum_probabilities</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mf">0.9999</span><span class="p">),</span> <span class="s2">&quot;The probabilities&quot;</span> \
                                                                                         <span class="s2">&quot;chosen for assigning&quot;</span> \
                                                                                         <span class="s2">&quot;injuries don&#39;t&quot;</span> \
                                                                                         <span class="s2">&quot;sum to one&quot;</span>
        <span class="c1"># Check all other probabilities are between 0 and 1</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;prob_&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">probability</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">:</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">probability</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Probability is not a feasible value&quot;</span>
        <span class="c1"># create a generic severe trauma symptom, which forces people into the health system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">register_symptom</span><span class="p">(</span>
            <span class="n">Symptom</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;severe_trauma&#39;</span><span class="p">,</span>
                <span class="n">emergency_in_adults</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">emergency_in_children</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># create an injury lookup table to handle all assigning injuries/daly weights and daly weight changes. The table</span>
        <span class="c1"># is writted in the following format: [[1], 2, 3, 4]. [1] contains information used in assigning injuries e.g.</span>
        <span class="c1"># probability of injury occuring followed by information used in logging, specifically injury location, injury</span>
        <span class="c1"># category and injury severity. 2 contains the daly weight initially assigned to people who have this injury.</span>
        <span class="c1"># 3 contains any potential changes to the persons health burden upon treatment. 4 contains the daly weight to</span>
        <span class="c1"># remove once an injury is healed.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="c1"># injuries to the head</span>
            <span class="s1">&#39;112&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_112&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unspecified_skull_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unspecified_skull_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_113&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_basilar_skull_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_basilar_skull_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_133a&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subarachnoid_hematoma&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subarachnoid_hematoma&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_133b&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_brain_contusion&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_brain_contusion&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_133c&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_intraventricular_haemorrhage&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_intraventricular_haemorrhage&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133d&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_133d&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subgaleal_hematoma&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subgaleal_hematoma&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;134a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_134a&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_epidural_hematoma&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_epidural_hematoma&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;134b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_134b&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subdural_hematoma&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_subdural_hematoma&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;135&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_135&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_diffuse_axonal_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_diffuse_axonal_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;1101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_1101&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;1114&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;head_prob_1114&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_greater_than_20_percent_body_area&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_greater_than_20_percent_body_area&#39;</span><span class="p">]],</span>
            <span class="c1"># injuries to the face</span>
            <span class="s1">&#39;211&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_211&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;212&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_212&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;241&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_241&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;2101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_2101&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;2114&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_2114&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_greater_than_20_percent_body_area&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_greater_than_20_percent_body_area&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;291&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;face_prob_291&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_eye_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_eye_injury&#39;</span><span class="p">]],</span>
            <span class="c1"># injuries to the neck</span>
            <span class="s1">&#39;3101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_3101&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;3113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_3113&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;342&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_342&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;343&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_343&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;361&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_361&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;363&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_363&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_internal_bleeding&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;322&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_322&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;323&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;neck_prob_323&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_neck_dislocation&#39;</span><span class="p">]],</span>
            <span class="c1"># injuries to the chest</span>
            <span class="s1">&#39;4101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_4101&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;4113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_4113&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;461&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_461&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_chest_wall_bruises_hematoma&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_chest_wall_bruises_hematoma&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;463&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_463&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hemothorax&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hemothorax&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;453a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_453a&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_diaphragm_rupture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_diaphragm_rupture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;453b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_453b&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_lung_contusion&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_lung_contusion&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;412&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_412&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_rib_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_rib_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;414&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_414&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_flail_chest&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_flail_chest&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;441&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_441&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_closed_pneumothorax&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_closed_pneumothorax&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;442&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_442&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_surgical_emphysema&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_surgical_emphysema&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;443&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;thorax_prob_443&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_open_pneumothorax&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_open_pneumothorax&#39;</span><span class="p">]],</span>
            <span class="c1"># injuries to the abdomen</span>
            <span class="s1">&#39;5101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;abdomen_prob_5101&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;5113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;abdomen_prob_5113&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;552&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;abdomen_prob_552&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;553&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;abdomen_prob_553&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;554&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;abdomen_prob_554&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_abd_internal_organ_injury&#39;</span><span class="p">]],</span>
            <span class="c1"># injuries to the spine</span>
            <span class="s1">&#39;612&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_612&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_vertebrae_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_vertebrae_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;673a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_673a&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;673b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_673b&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;674a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_674a&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;674b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_674b&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;675a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_675a&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;675b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_675b&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_below_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;676&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;spine_prob_676&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_spinal_cord_lesion_neck_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="c1"># injuries to the upper extremities</span>
            <span class="s1">&#39;7101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_7101&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;7113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_7113&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;712a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_712a&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_clavicle_scapula_humerus_fracture&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_clavicle_scapula_humerus_fracture&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;712b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_712b&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hand_wrist_fracture_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hand_wrist_fracture_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hand_wrist_fracture_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hand_wrist_fracture_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;712c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_712c&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;722&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_722&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_shoulder&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_shoulder&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;782a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_782a&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_amputated_finger&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;782b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_782b&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_arm_amputation_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_arm_amputation_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_arm_amputation_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;782c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_782c&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_amputated_thumb&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;783&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;upper_ex_prob_783&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_arm_amputation_without_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_arm_amputation_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_arm_amputation_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="c1"># injuries to the lower extremities</span>
            <span class="s1">&#39;8101&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_8101&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;8113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_8113&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_burns_less_than_20_percent_body_area_with_treatment&#39;</span><span class="p">]],</span>
            <span class="c1"># foot fracture, can be open or not, open is more severe</span>
            <span class="s1">&#39;811&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_811&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813do&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813do&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span>
                      <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span> <span class="o">-</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="c1"># lower leg fracture can be open or not</span>
            <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_812&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_with_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_with_treatment&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813eo&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813eo&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">]</span>
                      <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_patella_tibia_fibula_fracture_without_treatment&#39;</span><span class="p">]</span> <span class="o">-</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813a&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_long_term_with_treatment&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_long_term_with_treatment&#39;</span><span class="p">]],</span>
            <span class="c1"># pelvis fracture can be open or closed</span>
            <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813b&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">],</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813bo&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813bo&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">],</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">]</span> <span class="o">-</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="c1"># femur fracture can be open or closed</span>
            <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813c&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813co&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_813co&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">]</span> <span class="o">-</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_facial_soft_tissue_injury&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;822a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_822a&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_hip&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_hip&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;822b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_822b&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_knee&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_dislocated_knee&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;882&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_882&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_amputated_toes&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;883&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_883&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_unilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;884&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;lower_ex_prob_884&#39;</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">],</span>
                    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_without_treatment&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_bilateral_lower_limb_amputation_with_treatment&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># The vast majority of the injuries should have a total change of daly weights that sum to zero, meaning that</span>
        <span class="c1"># a person recieves an injury and has the health burden which will eventually be removed once the injury has</span>
        <span class="c1"># healed. However some injuries are permanent so the person will always have some level of health burden. The</span>
        <span class="c1"># injury codes for permanent injuries are given below.</span>
        <span class="n">permanent_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">]</span>
        <span class="c1"># We need to check that the changes to all other DALY weights over the course of treatment sum to zero, do so</span>
        <span class="c1"># using pandas, convert dictionary into a dataframe</span>
        <span class="n">check_daly_change_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">)</span>
        <span class="c1"># drop the row of the dataframe used to assign people injuries</span>
        <span class="n">check_daly_change_df</span> <span class="o">=</span> <span class="n">check_daly_change_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># calculate the sum of the dataframe</span>
        <span class="n">sum_check_daly_change_df</span> <span class="o">=</span> <span class="n">check_daly_change_df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># find the injuries where the change in daly weights does not sum to zero</span>
        <span class="n">non_zero_total_daly_change</span> <span class="o">=</span> <span class="n">sum_check_daly_change_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sum_check_daly_change_df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
        <span class="c1"># ensure that these injuries are the permanent injuries</span>
        <span class="k">assert</span> <span class="n">non_zero_total_daly_change</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">==</span> <span class="n">permanent_injuries</span></div>

<div class="viewcode-block" id="RTI.rti_injury_diagnosis"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_injury_diagnosis">[docs]</a>    <span class="k">def</span> <span class="nf">rti_injury_diagnosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">the_appt_footprint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function used to alter the appointment footprint of the generic first appointments, based on the needs of</span>
<span class="sd">        the patient to be properly diagnosed. Specifically, this function will assign x-rays/ct-scans for injuries</span>
<span class="sd">        that require those diagnosis tools.</span>
<span class="sd">        :param person_id: the person in a generic appointment with an injury</span>
<span class="sd">        :param the_appt_footprint: the current appointment footprint to be altered</span>
<span class="sd">        :return: the altered appointment footprint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Filter the dataframe by the columns the injuries are stored in</span>
        <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>

        <span class="c1"># Injuries that require x rays are: fractures, spinal cord injuries, dislocations, soft tissue injuries in neck</span>
        <span class="c1"># and soft tissue injury in thorax/ lung injury</span>
        <span class="n">codes_requiring_xrays</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;412&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;612&#39;</span><span class="p">,</span> <span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">,</span> <span class="s1">&#39;673&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;674&#39;</span><span class="p">,</span> <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">]</span>
        <span class="c1"># Injuries that require a ct scan are TBIs, abdominal trauma, soft tissue injury in neck, soft tissue injury in</span>
        <span class="c1"># thorax/ lung injury and abdominal trauma</span>
        <span class="n">codes_requiring_ct_scan</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;461&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">adjust_appt_footprint</span><span class="p">(</span><span class="n">_codes</span><span class="p">,</span> <span class="n">_requirement</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">persons_injuries</span><span class="p">,</span> <span class="n">_codes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">the_appt_footprint</span><span class="p">[</span><span class="n">_requirement</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">adjust_appt_footprint</span><span class="p">(</span><span class="n">codes_requiring_xrays</span><span class="p">,</span> <span class="s1">&#39;DiagRadio&#39;</span><span class="p">)</span>
        <span class="n">adjust_appt_footprint</span><span class="p">(</span><span class="n">codes_requiring_ct_scan</span><span class="p">,</span> <span class="s1">&#39;Tomography&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up the default properties used in the RTI module and applies them to the dataframe. The default state</span>
<span class="sd">        for the RTI module is that people haven&#39;t been involved in a road traffic accident and are therefor alive and</span>
<span class="sd">        healthy.&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>  <span class="c1"># default: no one has been injured in a RTI</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_death_from_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_polytrauma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no one is dead on scene of crash</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_recovery_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no recovery without medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_post_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no death after medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_no_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_unavailable_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># default: no DALY</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_date_inj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_in_icu_or_hdu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_MAIS_military_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">alive_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alive_count</span><span class="p">)])</span></div>

<div class="viewcode-block" id="RTI.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;At the start of the simulation we schedule a logging event, which records the relevant information</span>
<span class="sd">        regarding road traffic injuries in the last month.</span>

<span class="sd">        Afterwards, we schedule three RTI events, the first is the main RTI event which takes parts</span>
<span class="sd">        of the population and assigns them to be involved in road traffic injuries and providing they survived will</span>
<span class="sd">        begin the interaction with the healthcare system. This event runs monthly.</span>

<span class="sd">        The second is the begin scheduling the RTI recovery event, which looks at those in the population who have been</span>
<span class="sd">        injured in a road traffic accident, checking every day whether enough time has passed for their injuries to have</span>
<span class="sd">        healed. When the injury has healed the associated daly weight is removed.</span>

<span class="sd">        The final event is one which checks if this person has not sought sought care or been given care, if they</span>
<span class="sd">        haven&#39;t then it asks whether they should die away from their injuries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Begin modelling road traffic injuries</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">RTIPollingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Begin checking whether the persons injuries are healed</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">RTI_Recovery_Event</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Begin checking whether those with untreated injuries die</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">RTI_Check_Death_No_Med</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Begin logging the RTI events</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">RTI_Logging_Event</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="RTI.rti_do_when_diagnosed"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_do_when_diagnosed">[docs]</a>    <span class="k">def</span> <span class="nf">rti_do_when_diagnosed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the generic first appointments when an injured person has been diagnosed</span>
<span class="sd">        in A&amp;E and needs to progress further in the health system. The injured person will then be scheduled a generic</span>
<span class="sd">        &#39;medical intervention&#39; appointment which serves three purposes. The first is to determine what treatments they</span>
<span class="sd">        require for their injuries and shedule those, the second is to contain them in the health care system with</span>
<span class="sd">        inpatient days and finally, the appointment treats injuries that heal over time without further need for</span>
<span class="sd">        resources in the health system.</span>

<span class="sd">        :param person_id: the person requesting medical care</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Check to see whether they have been sent here from A and E</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">]</span>
        <span class="c1"># Get the relevant information about their injuries</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># check this person is injured, search they have an injury code that isn&#39;t &quot;none&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_CODES</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># also test whether the regular injury symptom has been given to the person via spurious symptoms</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">spurious_symptoms</span><span class="p">,</span> \
            <span class="s1">&#39;This person has asked for medical treatment despite not being injured&#39;</span>

        <span class="c1"># If they meet the requirements, send them to HSI_RTI_MedicalIntervention for further treatment</span>
        <span class="c1"># Using counts condition to stop spurious symptoms progressing people through the model</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Medical_Intervention</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_do_for_major_surgeries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_do_for_major_surgeries">[docs]</a>    <span class="k">def</span> <span class="nf">rti_do_for_major_surgeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called in HSI_RTI_MedicalIntervention to schedule a major surgery if required. In</span>
<span class="sd">        HSI_RTI_MedicalIntervention, we determine that they need a surgery. In this function, further to scheduling the</span>
<span class="sd">        surgery, we double check that they do meet the conditions for needing a surgery. The conditions for needing a</span>
<span class="sd">        surgery is that they are alive, currently seeking medical intervention and have an injury that is treated by</span>
<span class="sd">        surgery.</span>
<span class="sd">        :param person_id: The person requesting major surgeries</span>
<span class="sd">        :param count: The amount of major surgeries required, used when scheduling surgeries to ensure that two major</span>
<span class="sd">                      surgeries aren&#39;t scheduled on the same day</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t died due to</span>
            <span class="c1"># rti</span>
            <span class="k">assert</span> <span class="n">person</span><span class="o">.</span><span class="n">rt_med_int</span><span class="p">,</span> <span class="s1">&#39;person sent here not been through RTI_MedInt&#39;</span>
            <span class="c1"># Determine what injuries are able to be treated by surgery by checking the injury codes which are currently</span>
            <span class="c1"># treated in this simulation, it seems there is a limited available to treat spinal cord injuries and chest</span>
            <span class="c1"># trauma in Malawi, so these are initially left out, but we will test different scenarios to see what</span>
            <span class="c1"># happens when we include those treatments</span>
            <span class="n">surgically_treated_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;782&#39;</span><span class="p">,</span> <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">]</span>

            <span class="c1"># If we allow surgical treatment of spinal cord injuries, extend the surgically treated codes to include</span>
            <span class="c1"># spinal cord injury codes</span>
            <span class="k">if</span> <span class="s1">&#39;include_spine_surgery&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
                <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;P674a&#39;</span><span class="p">,</span> <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">]</span>
                <span class="n">surgically_treated_codes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_codes</span><span class="p">)</span>
            <span class="c1"># If we allow surgical treatment of chest trauma, extend the surgically treated codes to include chest</span>
            <span class="c1"># trauma codes.</span>
            <span class="k">if</span> <span class="s1">&#39;include_thoroscopy&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
                <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">]</span>
                <span class="n">surgically_treated_codes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additional_codes</span><span class="p">)</span>
            <span class="c1"># check this person has an injury which should be treated here</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">rt_injuries_for_major_surgery</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">surgically_treated_codes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> \
                    <span class="s1">&#39;This person has asked for surgery but does not have an appropriate injury&#39;</span>
            <span class="c1"># isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="c1"># Check whether the person sent to surgery has an injury which actually requires surgery</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;This person has been sent to major surgery without the right injuries&#39;</span>
            <span class="c1"># for each injury which has been assigned to be treated by major surgery make sure that the injury hasn&#39;t</span>
            <span class="c1"># already been treated</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="o">.</span><span class="n">rt_injuries_for_major_surgery</span><span class="p">:</span>
                <span class="n">column</span><span class="p">,</span> <span class="n">found_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
                <span class="n">index_in_rt_recovery_dates</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">rt_date_to_remove_daly</span><span class="p">[</span><span class="n">index_in_rt_recovery_dates</span><span class="p">]):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">index_in_rt_recovery_dates</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="c1"># schedule major surgeries</span>
            <span class="k">if</span> <span class="s1">&#39;Major Surgery&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;blocked_interventions&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Major_Surgeries</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                      <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span>
                    <span class="c1"># remove the injury code from this treatment option</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># reset the time to check whether the person has died from their injuries</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_do_for_minor_surgeries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_do_for_minor_surgeries">[docs]</a>    <span class="k">def</span> <span class="nf">rti_do_for_minor_surgeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called in HSI_RTI_MedicalIntervention to schedule a minor surgery if required. In</span>
<span class="sd">        HSI_RTI_MedicalIntervention, we determine that they need a surgery. In this function, further to scheduling the</span>
<span class="sd">        surgery, we double check that they do meet the conditions for needing a surgery. The conditions for needing a</span>
<span class="sd">        surgery is that they are alive, currently seeking medical intervention and have an injury that is treated by</span>
<span class="sd">        surgery.</span>
<span class="sd">        :param person_id: The person requesting major surgeries</span>
<span class="sd">        :param count: The amount of major surgeries required, used when scheduling surgeries to ensure that two minor</span>
<span class="sd">                      surgeries aren&#39;t scheduled on the same day</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t been killed by the</span>
        <span class="c1"># RTI module</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;Person sent for treatment did not go through rti med int&#39;</span>
        <span class="c1"># Isolate the person</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># state the codes treated by minor surgery</span>
            <span class="n">surgically_treated_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;291&#39;</span><span class="p">,</span> <span class="s1">&#39;241&#39;</span><span class="p">,</span> <span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">]</span>
            <span class="c1"># check that the person requesting surgery has an injury in their minor surgery treatment plan</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
                   <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;this person has asked for a minor &#39;</span> \
                                                                            <span class="s1">&#39;surgery but does not need it&#39;</span>
            <span class="c1"># check that for each injury due to be treated with a minor surgery, the injury hasn&#39;t previously been</span>
            <span class="c1"># treated</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]:</span>
                <span class="n">column</span><span class="p">,</span> <span class="n">found_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
                <span class="n">index_in_rt_recovery_dates</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">index_in_rt_recovery_dates</span><span class="p">])</span>
            <span class="c1"># check that this person&#39;s injuries that were decided to be treated with a minor surgery and the injuries</span>
            <span class="c1"># actually treated by minor surgeries coincide</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">surgically_treated_codes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                    <span class="s1">&#39;This person has asked for a minor surgery but does not need it&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="c1"># Check whether the person requesting minor surgeries has an injury that requires minor surgery</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="c1"># schedule the minor surgery</span>
            <span class="k">if</span> <span class="s1">&#39;Minor Surgery&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;blocked_interventions&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Minor_Surgeries</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                      <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">count</span><span class="p">),</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span>
                    <span class="c1"># remove the injury code from this treatment option</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="c1"># reset the time to check whether the person has died from their injuries</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_acute_pain_management"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_acute_pain_management">[docs]</a>    <span class="k">def</span> <span class="nf">rti_acute_pain_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called in HSI_RTI_MedicalIntervention to request pain management. This should be called for every alive</span>
<span class="sd">        injured person, regardless of what their injuries are. In this function we test whether they meet the</span>
<span class="sd">        requirements to recieve for pain relief, that is they are alive and currently receiving medical treatment.</span>
<span class="sd">        :param person_id: The person requesting pain management</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t died due to</span>
            <span class="c1"># rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="c1"># check this person is injured, search they have an injury code that isn&#39;t &quot;none&quot;.</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rt_injury_1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;This person has asked for pain relief despite not being injured&#39;</span>
            <span class="c1"># schedule pain management</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Acute_Pain_Management</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                        <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_suture_kit"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_suture_kit">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_suture_kit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called by HSI_RTI_MedicalIntervention to centralise all suture kit requests. This function checks</span>
<span class="sd">        that the person asking for a suture kit meets the requirements to get one. That is they are alive, currently</span>
<span class="sd">        being treated for their injuries and that they have a laceration which needs stitching.</span>
<span class="sd">        :param person_id: The person asking for a suture kit</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t died due to</span>
            <span class="c1"># rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="n">laceration_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;6101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">]</span>
            <span class="c1"># Check they have a laceration which needs stitches</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">laceration_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;This person has asked for stiches, but doens&#39;t have a laceration&quot;</span>
            <span class="c1"># request suture</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Suture</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_shock_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_shock_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_shock_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function called by the generic emergency appointment to treat the onset of hypovolemic shock</span>
<span class="sd">        :param person_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">],</span> <span class="s1">&#39;person requesting shock treatment is not in shock&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Shock_Treatment</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                  <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_imaging"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_imaging">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_imaging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function called by the generic emergency appointment to order imaging for diagnosis</span>
<span class="sd">        :param person_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Imaging_Event</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_burn_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_burn_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_burn_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called by HSI_RTI_MedicalIntervention to centralise all burn treatment requests. This function</span>
<span class="sd">        schedules burn treatments for the person if they meet the requirements, that is they are alive, currently being</span>
<span class="sd">        treated, and they have a burn which needs to be treated.</span>
<span class="sd">        :param person_id: The person requesting burn treatment</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t died due to</span>
            <span class="c1"># rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="n">burn_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">]</span>
            <span class="c1"># Check to see whether they have a burn which needs treatment</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">burn_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;This person has asked for burn treatment, but doens&#39;t have any burns&quot;</span>

            <span class="c1"># if this person is alive ask for the hsi event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Burn_Management</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                  <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_fracture_casts"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_fracture_casts">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_fracture_casts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called by HSI_RTI_MedicalIntervention to centralise all fracture casting. This function schedules the</span>
<span class="sd">        fracture cast treatment if they meet the requirements to ask for it. That is they are alive, currently being</span>
<span class="sd">        treated and they have a fracture that needs casting (Note that this also handles slings for upper arm/shoulder</span>
<span class="sd">        fractures).</span>
<span class="sd">        :param person_id: The person asking for fracture cast/sling</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and they haven&#39;t died due to</span>
            <span class="c1"># rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="n">fracture_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">]</span>
            <span class="c1"># check that the codes assigned for treatment by rt_injuries_to_cast and the codes treated by</span>
            <span class="c1"># rti_fracture_cast coincide</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">fracture_codes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> \
                <span class="s1">&#39;This person has asked for a fracture cast&#39;</span>
            <span class="c1"># Check they have an injury treated by HSI_RTI_Fracture_Cast</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">fracture_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;This person has asked for fracture treatment, but doens&#39;t have appropriate fractures&quot;</span>
            <span class="c1"># if this person is alive request the hsi</span>
            <span class="k">if</span> <span class="s1">&#39;Fracture Casts&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;blocked_interventions&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Fracture_Cast</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                    <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># reset the time to check whether the person has died from their injuries</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_open_fracture_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_open_fracture_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_open_fracture_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function called by HSI_RTI_MedicalIntervention to centralise open fracture treatment requests. This function</span>
<span class="sd">        schedules an open fracture event, conditional on whether they are alive, being treated and have an appropriate</span>
<span class="sd">        injury.</span>

<span class="sd">        :param person_id: the person requesting a tetanus jab</span>
<span class="sd">        :param counts: the number of open fractures that requires a treatment</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and are haven&#39;t died due to rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">open_fracture_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">]</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="c1"># Check that they have an open fracture</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">open_fracture_codes</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;This person has requested open fracture treatment but doesn&#39;t require one&quot;</span>
            <span class="c1"># if the person is alive request the hsi</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
                <span class="c1"># schedule the treatments, say the treatments occur a day apart for now</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Open_Fracture_Treatment</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span> <span class="o">+</span> <span class="n">i</span><span class="p">),</span>
                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_ask_for_tetanus"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_ask_for_tetanus">[docs]</a>    <span class="k">def</span> <span class="nf">rti_ask_for_tetanus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called by HSI_RTI_MedicalIntervention to centralise all tetanus requests. This function schedules a</span>
<span class="sd">        tetanus event, conditional on whether they are alive, being treated and have an injury that requires a tetanus</span>
<span class="sd">        vaccine, i.e. a burn or a laceration.</span>

<span class="sd">        :param person_id: the person requesting a tetanus jab</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="c1"># Check to see whether they have been sent here from RTI_MedicalIntervention and are haven&#39;t died due to rti</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here not been through rti med int&#39;</span>
            <span class="c1"># Isolate the relevant injury information</span>
            <span class="n">codes_for_tetanus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">]</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="c1"># Check that they have a burn/laceration</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes_for_tetanus</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;This person has requested a tetanus jab but doesn&#39;t require one&quot;</span>
            <span class="c1"># if this person is alive, ask for the hsi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">HSI_RTI_Tetanus_Vaccine</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                  <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_find_injury_column"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_find_injury_column">[docs]</a>    <span class="k">def</span> <span class="nf">rti_find_injury_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is a tool to find the injury column an injury code occurs in, when calling this funtion</span>
<span class="sd">        you will need to guarentee that the person has at least one of the code you are searching for, else this</span>
<span class="sd">        function will raise an assertion error.</span>
<span class="sd">        To call this function you need to provide the person who you want to perform the search on and the injury</span>
<span class="sd">        codes which you want to find the corresponding injury column for. The function/search will return the injury</span>
<span class="sd">        code which the person has from the list of codes you supplied, and which injury column from rt_injury_1 through</span>
<span class="sd">        to rt_injury_8, the code appears in.</span>

<span class="sd">        :param person_id: The person the search is being performed for</span>
<span class="sd">        :param codes: The injury codes being searched for</span>
<span class="sd">        :return: which column out of rt_injury_1 to rt_injury_8 the injury code occurs in, and the injury code itself</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">injury_column</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">injury_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">person_injuries</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">code</span><span class="p">:</span>
                    <span class="n">injury_column</span> <span class="o">=</span> <span class="n">col</span>
                    <span class="n">injury_code</span> <span class="o">=</span> <span class="n">code</span>
                    <span class="k">break</span>
        <span class="c1"># Check that the search found the injury column</span>
        <span class="k">assert</span> <span class="n">injury_column</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">df</span>
        <span class="c1"># Return the found column for the injury code</span>
        <span class="k">return</span> <span class="n">injury_column</span><span class="p">,</span> <span class="n">injury_code</span></div>

<div class="viewcode-block" id="RTI.rti_find_all_columns_of_treated_injuries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_find_all_columns_of_treated_injuries">[docs]</a>    <span class="k">def</span> <span class="nf">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function searches for treated injuries (supplied by the parameter codes) for a specific person, finding and</span>
<span class="sd">        returning all the columns with treated injuries and all the injury codes for the treated injuries.</span>

<span class="sd">        :param person_id: The person the search is being performed on</span>
<span class="sd">        :param codes: The treated injury codes</span>
<span class="sd">        :return: All columns and codes of the successfully treated injuries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># create empty variables to return the columns and codes of the treated injuries</span>
        <span class="n">columns_to_return</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">codes_to_return</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># iterate over the codes in the list codes and also the injury columns</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># Search a sub-dataframe that is non-empty if the code is present is in that column and empty if not</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                <span class="n">columns_to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">codes_to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">columns_to_return</span><span class="p">,</span> <span class="n">codes_to_return</span></div>

<div class="viewcode-block" id="RTI.rti_assign_daly_weights"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_assign_daly_weights">[docs]</a>    <span class="k">def</span> <span class="nf">rti_assign_daly_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injured_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function assigns DALY weights associated with each injury when they happen.</span>

<span class="sd">        By default this function gives the DALY weight for each condition without treatment, this will then be swapped</span>
<span class="sd">        for the DALY weight associated with the injury with treatment when treatment occurs.</span>

<span class="sd">        The properties that this function alters are rt_disability, which is the property used to report the</span>
<span class="sd">        disability burden that this person has and rt_debugging_DALY_wt, which stores the true value of the</span>
<span class="sd">        the disability.</span>

<span class="sd">        :param injured_index: The people who have been involved in a road traffic accident for the current month and did</span>
<span class="sd">                              not die on the scene of the crash</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># ==============================================================================================================</span>
        <span class="c1"># Check that those sent here have been involved in a road traffic accident</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># Check everyone here has at least one injury to be given a daly weight to</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># Check everyone here is alive and hasn&#39;t died due to rti</span>
        <span class="n">rti_deaths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RTI_death_without_med&#39;</span><span class="p">,</span> <span class="s1">&#39;RTI_death_with_med&#39;</span><span class="p">,</span> <span class="s1">&#39;RTI_unavailable_med&#39;</span><span class="p">,</span> <span class="s1">&#39;RTI_imm_death&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;RTI_death_shock&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;cause_of_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rti_deaths</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">injured_index</span><span class="p">))</span> <span class="o">&amp;</span> \
               <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">selected_for_rti_inj</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>

        <span class="n">daly_change</span> <span class="o">=</span> <span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">daly_change</span>

        <span class="c1"># Store the true sum of DALY weights in the df</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span>
        <span class="c1"># Find who&#39;s disability burden is greater than one</span>
        <span class="n">DALYweightoverlimit</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Set the total daly weights to one in this case</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">DALYweightoverlimit</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Find who&#39;s disability burden is less than one</span>
        <span class="n">DALYweightunderlimit</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># Check that no one has a disability burden less than or equal to zero</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">DALYweightunderlimit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Someone has not been given an injury burden&#39;</span><span class="p">,</span>
                                                <span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">DALYweightunderlimit</span><span class="p">])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">DALYweightunderlimit</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injured_index</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="RTI.rti_alter_daly_post_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_alter_daly_post_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">rti_alter_daly_post_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function removes the DALY weight associated with each injury code after treatment is complete. This</span>
<span class="sd">        function is called by RTI_Recovery_event which removes asks to remove the DALY weight when the injury has</span>
<span class="sd">        healed</span>

<span class="sd">        The properties that this function alters are rt_disability, which is the property used to report the</span>
<span class="sd">        disability burden that this person has and rt_debugging_DALY_wt, which stores the true value of the</span>
<span class="sd">        the disability.</span>

<span class="sd">        :param person_id: The person who needs a daly weight removed as their injury has healed</span>
<span class="sd">        :param codes: The injury codes for the healed injury/injuries</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Check everyone here has at least one injury to be alter the daly weight to</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># check this person is injured, search they have an injury code that isn&#39;t &quot;none&quot;</span>
        <span class="n">idx</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rt_injury_1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;This person has asked for medical treatment despite not being injured&#39;</span>
        <span class="c1"># Check everyone here is alive and hasn&#39;t died on scene</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">]</span>

        <span class="c1"># ------------------------------- Remove the daly weights for treated injuries ---------------------------------</span>
        <span class="c1"># update the total values of the daly weights</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">+=</span> \
            <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">])</span>
        <span class="c1"># round off any potential floating point errors</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># if the person&#39;s true total for daly weights is greater than one, report rt_disability as one, if not</span>
        <span class="c1"># report the true disability burden.</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span>
        <span class="c1"># if the reported daly weight is below zero add make the model report the true (and always positive) daly weight</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span>
        <span class="c1"># Make sure the true disability burden is greater or equal to zero</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">person_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                               <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">])</span>
        <span class="c1"># the reported disability should satisfy 0&lt;=disability&lt;=1, check that they do</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Negative disability burden&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Too large disability burden&#39;</span>
        <span class="c1"># remover the treated injury code from the person using rti_treated_injuries</span>
        <span class="n">RTI</span><span class="o">.</span><span class="n">rti_treated_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_swap_injury_daly_upon_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_swap_injury_daly_upon_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function swaps certain DALY weight codes upon when a person receives treatment(s). Some injuries have a</span>
<span class="sd">        different daly weight associated with them for the treated and untreated injuries. If an injury is &#39;swap-able&#39;</span>
<span class="sd">        then this function removes the old daly weight for the untreated injury and gives the daly weight for the</span>
<span class="sd">        treated injury.</span>

<span class="sd">        The properties that this function alters are rt_disability, which is the property used to report the</span>
<span class="sd">        disability burden that this person has and rt_debugging_DALY_wt, which stores the true value of the</span>
<span class="sd">        the disability.</span>


<span class="sd">        :param person_id: The person who has received treatment</span>
<span class="sd">        :param codes: the &#39;swap-able&#39; injury code</span>
<span class="sd">        :return: n/a</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Check the people that are sent here have had medical treatment</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span>
        <span class="c1"># Check they have an appropriate injury code to swap</span>
        <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
        <span class="n">relevant_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">swapping_codes</span><span class="p">)</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># check this person is injured, search they have an injury code that is swappable</span>
        <span class="n">idx</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;This person has asked to swap an injury code, but it is not swap-able&#39;</span>
        <span class="c1"># If there are any permanent injuries which are due to be swapped, remove the &quot;P&quot; writted at the start of injury</span>
        <span class="c1"># code in order to access the injury dictionary</span>
        <span class="n">relevant_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">relevant_codes</span><span class="p">]</span>
        <span class="c1"># swap the relevant code&#39;s daly weight, from the daly weight associated with the injury without treatment</span>
        <span class="c1"># and the daly weight for the disability with treatment.</span>
        <span class="c1"># keep track of the changes to the daly weights</span>
        <span class="c1"># update the disability burdens</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">+=</span> \
            <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">relevant_codes</span><span class="p">])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># Check that the person&#39;s true disability burden is positive</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">person_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                               <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">])</span>
        <span class="c1"># catch rounding point errors where the disability weights should be zero but aren&#39;t</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span>
        <span class="c1"># Catch cases where the disability burden is greater than one in reality but needs to be</span>
        <span class="c1"># capped at one, if not report the true disability burden</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span>
        <span class="c1"># Check the daly weights fall within the accepted bounds</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Negative disability burden&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Too large disability burden&#39;</span></div>

<div class="viewcode-block" id="RTI.rti_determine_LOS"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_determine_LOS">[docs]</a>    <span class="k">def</span> <span class="nf">rti_determine_LOS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the length of stay a person sent to the health care system will require, based on how</span>
<span class="sd">        severe their injuries are (determined by the person&#39;s ISS score). Currently I use data from China, but once a</span>
<span class="sd">        more appropriate source of data is found I can swap this over.</span>
<span class="sd">        :param person_id: The person who needs their LOS determined</span>
<span class="sd">        :return: the inpatient days required to treat this person (Their LOS)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">def</span> <span class="nf">draw_days</span><span class="p">(</span><span class="n">_mean</span><span class="p">,</span> <span class="n">_sd</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">_mean</span><span class="p">,</span> <span class="n">_sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Create the length of stays required for each ISS score boundaries and check that they are &gt;=0</span>
        <span class="n">rt_iss_score</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rt_iss_score</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="n">draw_days</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;mean_los_ISS_less_than_4&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sd_los_ISS_less_than_4&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">4</span> <span class="o">&lt;=</span> <span class="n">rt_iss_score</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="n">draw_days</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;mean_los_ISS_4_to_8&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sd_los_ISS_4_to_8&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">9</span> <span class="o">&lt;=</span> <span class="n">rt_iss_score</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="n">draw_days</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;mean_los_ISS_9_to_15&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sd_los_ISS_9_to_15&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="n">rt_iss_score</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="n">draw_days</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;mean_los_ISS_16_to_24&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sd_los_ISS_16_to_24&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="mi">25</span> <span class="o">&lt;=</span> <span class="n">rt_iss_score</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="n">draw_days</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;mean_los_ISS_more_than_25&quot;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;sd_los_ISS_more_that_25&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Make sure inpatient days is less that max available</span>
        <span class="k">if</span> <span class="n">days_until_treatment_end</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span>
            <span class="n">days_until_treatment_end</span> <span class="o">=</span> <span class="mi">150</span>
        <span class="c1"># Return the LOS</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">days_until_treatment_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.rti_find_and_count_injuries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_find_and_count_injuries">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">persons_injury_properties</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">injury_codes</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function that searches a user given dataframe for a list of injuries (injury_codes). If the injury code is</span>
<span class="sd">        found in the dataframe, this function returns the index for who has the injury/injuries and the number of</span>
<span class="sd">        injuries found. This function works much faster if the dataframe is smaller, hence why the searched dataframe</span>
<span class="sd">        is a parameter in the function.</span>

<span class="sd">        :param persons_injury_properties: The dataframe to search for the tlo injury codes in</span>
<span class="sd">        :param injury_codes: The injury codes to search for in the data frame</span>
<span class="sd">        :return: the df index of who has the injuries and how many injuries in the search were found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">persons_injury_properties</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">injury_codes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">injury_counts</span> <span class="o">=</span> <span class="n">persons_injury_properties</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">injury_codes</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">people_with_given_injuries</span> <span class="o">=</span> <span class="n">injury_counts</span><span class="p">[</span><span class="n">injury_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">people_with_given_injuries</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">people_with_given_injuries</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>

<div class="viewcode-block" id="RTI.rti_treated_injuries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_treated_injuries">[docs]</a>    <span class="k">def</span> <span class="nf">rti_treated_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">tlo_injury_codes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function that takes a person with treated injuries and removes the injury code from the properties rt_injury_1</span>
<span class="sd">        to rt_injury_8</span>

<span class="sd">        The properties that this function alters are rt_injury_1 through rt_injury_8 and the symptoms properties</span>

<span class="sd">        :param person_id: The person who needs an injury code removed</span>
<span class="sd">        :param tlo_injury_codes: the injury code(s) to be removed</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># Isolate the relevant injury information</span>
        <span class="n">permanent_injuries</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;P133&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span> <span class="s1">&#39;P673&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674&#39;</span><span class="p">,</span> <span class="s1">&#39;P674a&#39;</span><span class="p">,</span> <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">}</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>

        <span class="c1"># only remove non-permanent injuries</span>
        <span class="n">codes_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tlo_injury_codes</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">permanent_injuries</span><span class="p">]</span>

        <span class="c1"># get injury columns for all codes to remove</span>
        <span class="n">injury_cols</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">person_injuries</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">codes_to_remove</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># if no injuries to reset, exit</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">injury_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Reset the treated injury code to &quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">injury_cols</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

        <span class="c1"># Reset symptoms so that after being treated for an injury the person won&#39;t interact with the</span>
        <span class="c1"># health system again.</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;sy_injury&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">],</span>
                <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                <span class="n">symptom_string</span><span class="o">=</span><span class="s1">&#39;injury&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;sy_severe_trauma&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
                <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">],</span>
                <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                <span class="n">symptom_string</span><span class="o">=</span><span class="s1">&#39;severe_trauma&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a person is born this function sets up the default properties for the road traffic injuries module</span>
<span class="sd">        :param mother_id: The mother</span>
<span class="sd">        :param child_id: The newborn</span>
<span class="sd">        :return: n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>  <span class="c1"># default: no one has been injured in a RTI</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_death_from_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_polytrauma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no one has a had medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_in_icu_or_hdu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_recovery_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no recovery without medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_post_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># default: no death after medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_no_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_unavailable_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># default: no disability due to RTI</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_inj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_MAIS_military_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="RTI.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called whenever there is an HSI event commissioned by one of the other disease modules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTI, being alerted about a health system interaction person %d for: %s, </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s2">&quot;</span>
                     <span class="p">)</span></div>

<div class="viewcode-block" id="RTI.report_daly_values"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.report_daly_values">[docs]</a>    <span class="k">def</span> <span class="nf">report_daly_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This must send back a pd.Series or pd.DataFrame that reports on the average daly-weights that have been</span>
        <span class="c1"># experienced by persons in the previous month. Only rows for alive-persons must be returned.</span>
        <span class="c1"># The names of the series of columns is taken to be the label of the cause of this disability.</span>
        <span class="c1"># It will be recorded by the healthburden module as &lt;ModuleName&gt;_&lt;Cause&gt;.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is RTI reporting my daly values&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">disability_series_for_alive_persons</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s2">&quot;rt_disability&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">disability_series_for_alive_persons</span></div>

<div class="viewcode-block" id="RTI.rti_assign_injuries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI.rti_assign_injuries">[docs]</a>    <span class="k">def</span> <span class="nf">rti_assign_injuries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function that can be called specifying the number of people affected by RTI injuries</span>
<span class="sd">         and provides outputs for the number of injuries each person experiences from a RTI event, the location of the</span>
<span class="sd">         injury, the TLO injury categories and the severity of the injuries. The severity of the injuries will then be</span>
<span class="sd">         used to calculate the injury severity score (ISS), which will then inform mortality and disability from road</span>
<span class="sd">         traffic injuries with treatment and the military abreviated injury score (MAIS) which will be used to predict</span>
<span class="sd">         mortality without medical intervention.</span>


<span class="sd">        :param number: The number of people who need injuries assigned to them</span>
<span class="sd">        :return: injurydescription - a dataframe for the injury/injuries summarised in the TLO injury code form along</span>
<span class="sd">                                     with data on their ISS score, used for calculating mortality and whether they have</span>
<span class="sd">                                     polytrauma or not.</span>
<span class="sd">        Todo: see if we can include the following factors for injury severity (taken from a preprint sent to me after</span>
<span class="sd">            MOH meeting):</span>
<span class="sd">            - The setting of the patient (rural/urban) as rural location was a predictor for severe injury AOR 2.41</span>
<span class="sd">            (1.49-3.90)</span>
<span class="sd">            - Seatbelt use (none compared to using AOR 4.49 (1.47-13.76))</span>
<span class="sd">            - Role of person in crash (Different risk for different type, see paper)</span>
<span class="sd">            - Alcohol use (AOR 1.74 (1.11-2.74) compared to none)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># Import the fitted distribution of injured body regions</span>
        <span class="n">number_of_injured_body_regions_distribution</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;number_of_injured_body_regions_distribution&#39;</span><span class="p">]</span>
        <span class="c1"># Get the probability distribution for the likelihood of a certain body region being injured.</span>
        <span class="n">injlocdist</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;injury_location_distribution&#39;</span><span class="p">]</span>
        <span class="c1"># create a dataframe to store the injury persons information in</span>
        <span class="n">inj_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Injury_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;AIS_scores&#39;</span><span class="p">,</span> <span class="s1">&#39;ISS&#39;</span><span class="p">,</span> <span class="s1">&#39;Polytrauma&#39;</span><span class="p">,</span> <span class="s1">&#39;MAIS&#39;</span><span class="p">,</span> <span class="s1">&#39;Number_of_injuries&#39;</span><span class="p">])</span>
        <span class="c1"># Create empty lists to store information of each person&#39;s injuries to be used in logging:</span>
        <span class="c1"># predicted injury location</span>
        <span class="n">predinjlocs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># predicted injury severity</span>
        <span class="n">predinjsev</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># predicted injury category</span>
        <span class="n">predinjcat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># create empty lists to store the qualitative description of injury severity and the number of injuries</span>
        <span class="c1"># each person has</span>
        <span class="n">severity_category</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ============================= Begin assigning injuries to people =====================================</span>
        <span class="c1"># Iterate over the total number of injured people</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
            <span class="c1"># Generate a random number which will decide how many injuries the person will have,</span>
            <span class="n">ninj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">number_of_injured_body_regions_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">p</span><span class="o">=</span><span class="n">number_of_injured_body_regions_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># create an empty list which stores the injury chosen for this person</span>
            <span class="n">injuries_chosen</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Create an empty vector which will store the severity of the injuries</span>
            <span class="n">injais</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Create an empty vector to store injury MAIS scores in</span>
            <span class="n">injmais</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># generate the locations of the injuries for this person (chosed without replacement, meaning that each</span>
            <span class="c1"># injury corresponds to a single body region)</span>
            <span class="n">injurylocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">injlocdist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ninj</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">injlocdist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># iterate over the chosen injury locations to determine the exact injuries that this person will have</span>
            <span class="k">for</span> <span class="n">injlocs</span> <span class="ow">in</span> <span class="n">injurylocation</span><span class="p">:</span>
                <span class="c1"># get a list of the injuries that occur at this location to filter the dictionary</span>
                <span class="c1"># self.ASSIGN_INJURIES_AND_DALY_CHANGES to the relevant injury information</span>
                <span class="n">injuries_at_location</span> <span class="o">=</span> <span class="p">[</span><span class="n">injury</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span>
                                        <span class="n">injury</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">injlocs</span><span class="p">))]</span>
                <span class="c1"># find the probability of each injury based on the above filter</span>
                <span class="n">prob_of_each_injury_at_location</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span>
                                                   <span class="n">injuries_at_location</span><span class="p">]</span>
                <span class="c1"># make sure there are no rounding errors (meaning all probabilities sum to one)</span>
                <span class="n">prob_of_each_injury_at_location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">prob_of_each_injury_at_location</span><span class="p">,</span>
                                                            <span class="nb">sum</span><span class="p">(</span><span class="n">prob_of_each_injury_at_location</span><span class="p">))</span>
                <span class="c1"># chose an injury to occur at this location</span>
                <span class="n">injury_chosen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">injuries_at_location</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prob_of_each_injury_at_location</span><span class="p">)</span>
                <span class="c1"># store this persons chosen injury at this location</span>
                <span class="n">injuries_chosen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">injury_chosen</span><span class="p">)</span>
                <span class="c1"># Store this person&#39;s injury location (used in logging)</span>
                <span class="n">predinjlocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury_chosen</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># store the injury category chosen (used in logging)</span>
                <span class="n">predinjcat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury_chosen</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="c1"># store the severity of the injury chosen</span>
                <span class="n">injais</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury_chosen</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="c1"># store the MAIS score</span>
                <span class="n">injmais</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury_chosen</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
            <span class="c1"># create the data needed for an additional row, the injuries chosen for this person, their corresponding</span>
            <span class="c1"># AIS scores, their ISS score (calculated as the summed square of their three most severly injured body</span>
            <span class="c1"># regions, whether or not they have polytrauma (calculated if they have two or more body regions with an ISS</span>
            <span class="c1"># score greater than 2), their MAIS score and the number of injuries they have</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Injury_codes&#39;</span><span class="p">:</span> <span class="n">injuries_chosen</span><span class="p">,</span>
                       <span class="s1">&#39;AIS_scores&#39;</span><span class="p">:</span> <span class="n">injais</span><span class="p">,</span>
                       <span class="s1">&#39;ISS&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">injais</span><span class="p">))[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]),</span>
                       <span class="s1">&#39;Polytrauma&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">injais</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="s1">&#39;MAIS&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">injmais</span><span class="p">),</span>
                       <span class="s1">&#39;Number_of_injuries&#39;</span><span class="p">:</span> <span class="n">ninj</span><span class="p">}</span>
            <span class="n">inj_df</span> <span class="o">=</span> <span class="n">inj_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># If person has an ISS score less than 15 they have a mild injury, otherwise severe</span>
            <span class="k">if</span> <span class="n">new_row</span><span class="p">[</span><span class="s1">&#39;ISS&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">severity_category</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mild&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">severity_category</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;severe&#39;</span><span class="p">)</span>
            <span class="c1"># Store this person&#39;s injury information into the lists which house each individual person&#39;s injury</span>
            <span class="c1"># information</span>
            <span class="n">predinjsev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">injais</span><span class="p">)</span>
        <span class="c1"># If there is at least one injured person, expand the returned dataframe so that each injury has it&#39;s own column</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inj_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># create a copy of the injury codes</span>
            <span class="n">listed_injuries</span> <span class="o">=</span> <span class="n">inj_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># expand the injury codes into their own columns</span>
            <span class="n">listed_injuries</span> <span class="o">=</span> <span class="n">listed_injuries</span><span class="p">[</span><span class="s1">&#39;Injury_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
            <span class="c1"># rename the columns</span>
            <span class="n">listed_injuries</span> <span class="o">=</span> <span class="n">listed_injuries</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;rt_injury_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c1"># join the expanded injuries to the injury df</span>
            <span class="n">inj_df</span> <span class="o">=</span> <span class="n">inj_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">listed_injuries</span><span class="p">)</span>
        <span class="c1"># Fill dataframe entries where a person has not had an injury assigned with &#39;none&#39;</span>
        <span class="n">inj_df</span> <span class="o">=</span> <span class="n">inj_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

        <span class="c1"># Begin logging injury information</span>
        <span class="c1"># ============================ Injury category incidence ======================================================</span>
        <span class="c1"># log the incidence of each injury category</span>
        <span class="c1"># count the number of injuries that fall in each category</span>
        <span class="n">amputationcounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;8&#39;</span><span class="p">)</span>
        <span class="n">burncounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;11&#39;</span><span class="p">)</span>
        <span class="n">fraccounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">tbicounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span>
        <span class="n">minorinjurycounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;10&#39;</span><span class="p">)</span>
        <span class="n">spinalcordinjurycounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;7&#39;</span><span class="p">)</span>
        <span class="n">other_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predinjcat</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">])</span>
        <span class="c1"># calculate the incidence of this injury in the population</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">n_alive</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">)</span>
        <span class="n">inc_amputations</span> <span class="o">=</span> <span class="n">amputationcounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">amputationcounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_burns</span> <span class="o">=</span> <span class="n">burncounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">burncounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_fractures</span> <span class="o">=</span> <span class="n">fraccounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">fraccounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_tbi</span> <span class="o">=</span> <span class="n">tbicounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">tbicounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_sci</span> <span class="o">=</span> <span class="n">spinalcordinjurycounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">spinalcordinjurycounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_minor</span> <span class="o">=</span> <span class="n">minorinjurycounts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">minorinjurycounts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">inc_other</span> <span class="o">=</span> <span class="n">other_counts</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">other_counts</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="n">tot_inc_all_inj</span> <span class="o">=</span> <span class="n">inc_amputations</span> <span class="o">+</span> <span class="n">inc_burns</span> <span class="o">+</span> <span class="n">inc_fractures</span> <span class="o">+</span> <span class="n">inc_tbi</span> <span class="o">+</span> <span class="n">inc_sci</span> <span class="o">+</span> <span class="n">inc_minor</span> <span class="o">+</span> <span class="n">inc_other</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">number_of_injuries</span> <span class="o">=</span> <span class="n">inj_df</span><span class="p">[</span><span class="s1">&#39;Number_of_injuries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_of_injuries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inc_amputations&#39;</span><span class="p">:</span> <span class="n">inc_amputations</span><span class="p">,</span>
                          <span class="s1">&#39;inc_burns&#39;</span><span class="p">:</span> <span class="n">inc_burns</span><span class="p">,</span>
                          <span class="s1">&#39;inc_fractures&#39;</span><span class="p">:</span> <span class="n">inc_fractures</span><span class="p">,</span>
                          <span class="s1">&#39;inc_tbi&#39;</span><span class="p">:</span> <span class="n">inc_tbi</span><span class="p">,</span>
                          <span class="s1">&#39;inc_sci&#39;</span><span class="p">:</span> <span class="n">inc_sci</span><span class="p">,</span>
                          <span class="s1">&#39;inc_minor&#39;</span><span class="p">:</span> <span class="n">inc_minor</span><span class="p">,</span>
                          <span class="s1">&#39;inc_other&#39;</span><span class="p">:</span> <span class="n">inc_other</span><span class="p">,</span>
                          <span class="s1">&#39;tot_inc_injuries&#39;</span><span class="p">:</span> <span class="n">tot_inc_all_inj</span><span class="p">,</span>
                          <span class="s1">&#39;number_of_injuries&#39;</span><span class="p">:</span> <span class="n">number_of_injuries</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Inj_category_incidence&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Incidence of each injury grouped as per the GBD definition&#39;</span><span class="p">)</span>
        <span class="c1"># Log injury information</span>
        <span class="c1"># Get injury severity information in an easily interpreted form to be logged.</span>
        <span class="c1"># create a list of the predicted injury severity scores</span>
        <span class="n">flattened_injury_ais</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">predinjsev</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="n">injury_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Number_of_injuries&#39;</span><span class="p">:</span> <span class="n">number_of_injuries</span><span class="p">,</span>
                       <span class="s1">&#39;Location_of_injuries&#39;</span><span class="p">:</span> <span class="n">predinjlocs</span><span class="p">,</span>
                       <span class="s1">&#39;Injury_category&#39;</span><span class="p">:</span> <span class="n">predinjcat</span><span class="p">,</span>
                       <span class="s1">&#39;Per_injury_severity&#39;</span><span class="p">:</span> <span class="n">flattened_injury_ais</span><span class="p">,</span>
                       <span class="s1">&#39;Per_person_injury_severity&#39;</span><span class="p">:</span> <span class="n">inj_df</span><span class="p">[</span><span class="s1">&#39;ISS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
                       <span class="s1">&#39;Per_person_MAIS_score&#39;</span><span class="p">:</span> <span class="n">inj_df</span><span class="p">[</span><span class="s1">&#39;MAIS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
                       <span class="s1">&#39;Per_person_severity_category&#39;</span><span class="p">:</span> <span class="n">severity_category</span>
                       <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Injury_information&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">injury_info</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Relevant information on the injuries from road traffic accidents when they are &#39;</span>
                                <span class="s1">&#39;assigned&#39;</span><span class="p">)</span>
        <span class="c1"># log the fraction of lower extremity fractions that are open</span>
        <span class="n">flattened_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">inj_df</span><span class="p">[</span><span class="s1">&#39;Injury_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">lx_frac_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">,</span> <span class="s1">&#39;813&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">]</span>
        <span class="n">lx_open_frac_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">]</span>
        <span class="n">n_lx_fracs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">inj</span> <span class="k">for</span> <span class="n">inj</span> <span class="ow">in</span> <span class="n">flattened_injuries</span> <span class="k">if</span> <span class="n">inj</span> <span class="ow">in</span> <span class="n">lx_frac_codes</span><span class="p">])</span>
        <span class="n">n_open_lx_fracs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">inj</span> <span class="k">for</span> <span class="n">inj</span> <span class="ow">in</span> <span class="n">flattened_injuries</span> <span class="k">if</span> <span class="n">inj</span> <span class="ow">in</span> <span class="n">lx_open_frac_codes</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">n_lx_fracs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">proportion_lx_fracture_open</span> <span class="o">=</span> <span class="n">n_open_lx_fracs</span> <span class="o">/</span> <span class="n">n_lx_fracs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proportion_lx_fracture_open</span> <span class="o">=</span> <span class="s1">&#39;no_lx_fractures&#39;</span>
        <span class="n">injury_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Proportion_lx_fracture_open&#39;</span><span class="p">:</span> <span class="n">proportion_lx_fracture_open</span><span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Open_fracture_information&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">injury_info</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The proportion of fractures that are open in specific body regions&#39;</span><span class="p">)</span>
        <span class="c1"># Finally return the injury description information</span>
        <span class="k">return</span> <span class="n">inj_df</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   DISEASE MODULE EVENTS</span>
<span class="c1">#</span>
<span class="c1">#   These are the events which drive the simulation of the disease. It may be a regular event that updates</span>
<span class="c1">#   the status of all the population of subsections of it at one time. There may also be a set of events</span>
<span class="c1">#   that represent disease events for particular persons.</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RTIPollingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTIPollingEvent">[docs]</a><span class="k">class</span> <span class="nc">RTIPollingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The regular RTI event which handles all the initial RTI related changes to the dataframe. It can be thought of</span>
<span class="sd">     as the actual road traffic accident occurring. Specifically the event decides who is involved in a road traffic</span>
<span class="sd">     accident every month (via the linear model helper class), whether those involved in a road traffic accident die on</span>
<span class="sd">     scene or are given injuries (via the assign_injuries function) which they will attempt to interact with the health</span>
<span class="sd">     system with for treatment.</span>

<span class="sd">     Those who don&#39;t die on scene and are injured then attempt to go to an emergency generic first appointment</span>

<span class="sd">    This event will change the rt_ properties:</span>
<span class="sd">    1) rt_road_traffic_inc - False when not involved in a collision, True when RTI_Event decides they are in a collision</span>

<span class="sd">    2) rt_date_inj - Change to current date if the person has been involved in a road traffic accident</span>

<span class="sd">    3) rt_imm_death - True if they die on the scene of the crash, false otherwise</span>

<span class="sd">    4) rt_injury_1 through to rt_injury_8 - a series of 8 properties which stores the injuries that need treating as a</span>
<span class="sd">                                            code</span>

<span class="sd">    5) rt_ISS_score - The metric used to calculate the probability of mortality from the person&#39;s injuries</span>

<span class="sd">    6) rt_MAIS_military_score - The metric used to calculate the probability of mortality without medical intervention</span>

<span class="sd">    7) rt_disability - after injuries are assigned to a person, RTI_event calls rti_assign_daly_weights to match the</span>
<span class="sd">                       person&#39;s injury codes in rt_injury_1 through 8 to their corresponding DALY weights</span>

<span class="sd">    8) rt_polytrauma - If the person&#39;s injuries fit the definition for polytrauma we keep track of this here and use it</span>
<span class="sd">                        to calculate the probability for mortality later on.</span>
<span class="sd">    9) rt_date_death_no_med - the projected date to determine mortality for those who haven&#39;t sought medical care</span>

<span class="sd">    10) rt_inj_severity - The qualitative description of the severity of this person&#39;s injuries</span>

<span class="sd">    11) the symptoms this person has</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTIPollingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTIPollingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Schedule to take place every month</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># Parameters which transition the model between states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_1m_prob_rti</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;base_rate_injrti&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;reduce_incidence&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_1m_prob_rti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_1m_prob_rti</span> <span class="o">*</span> <span class="mf">0.335</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age04</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age04&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age59</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age59&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age1017</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age1017&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age1829</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age1829&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age3039</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age3039&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age4049</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age4049&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age5059</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age5059&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age6069</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age6069&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age7079</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_age7079&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_male</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_male&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_excessalcohol</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_injrti_excessalcohol&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imm_death_proportion_rti</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;imm_death_proportion_rti&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_bleeding_leads_to_shock</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_bleeding_leads_to_shock&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rt_emergency_care_ISS_score_cut_off</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_emergency_care_ISS_score_cut_off&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RTIPollingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTIPollingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply this event to the population.</span>

<span class="sd">        :param population: the current population</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
        <span class="c1"># Reset injury properties after death, get an index of people who have died due to RTI, all causes</span>
        <span class="n">diedfromrtiidx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_death_from_shock</span> <span class="o">|</span>
                                  <span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_imm_death&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_post_med_death&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_no_med_death&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_unavailable_med_death&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_disability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_med_int&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s1">&#39;rt_in_icu_or_hdu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_diagnosed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_polytrauma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_inj_severity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_perm_disability&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_7&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s2">&quot;rt_injury_8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s1">&#39;rt_MAIS_military_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diedfromrtiidx</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># reset whether they have been selected for an injury this month</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># --------------------------------- UPDATING OF RTI OVER TIME -------------------------------------------------</span>
        <span class="c1"># Currently we have the following conditions for being able to be involved in a road traffic injury, they are</span>
        <span class="c1"># alive, they aren&#39;t currently injured, they didn&#39;t die immediately in</span>
        <span class="c1"># a road traffic injury in the last month and finally, they aren&#39;t currently being treated for a road traffic</span>
        <span class="c1"># injury.</span>
        <span class="n">rt_current_non_ind</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_med_int</span> <span class="o">&amp;</span>
                                      <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_inj_severity</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">)]</span>

        <span class="c1"># ========= Update for people currently not involved in a RTI, make some involved in a RTI event ==============</span>
        <span class="c1"># Use linear model helper class</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span><span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">base_1m_prob_rti</span><span class="p">,</span>
                         <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_male</span><span class="p">),</span>
                         <span class="n">Predictor</span><span class="p">(</span>
                             <span class="s1">&#39;age_years&#39;</span><span class="p">,</span>
                             <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span>
                         <span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(0,4)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age04</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(5,9)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age59</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(10,17)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age1017</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(18,29)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age1829</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(30,39)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age3039</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(40,49)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age4049</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(50,59)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age5059</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(60,69)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age6069</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;.between(70,79)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_age7079</span><span class="p">),</span>
                         <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_ex_alc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rr_injrti_excessalcohol</span><span class="p">)</span>
                         <span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rt_current_non_ind</span><span class="p">])</span>
        <span class="n">random_draw_in_rti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rt_current_non_ind</span><span class="p">))</span>
        <span class="n">selected_for_rti</span> <span class="o">=</span> <span class="n">rt_current_non_ind</span><span class="p">[</span><span class="n">pred</span> <span class="o">&gt;</span> <span class="n">random_draw_in_rti</span><span class="p">]</span>
        <span class="c1"># Update to say they have been involved in a rti</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti</span><span class="p">,</span> <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Set the date that people were injured to now</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti</span><span class="p">,</span> <span class="s1">&#39;rt_date_inj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>
        <span class="c1"># ========================= Take those involved in a RTI and assign some to death ==============================</span>
        <span class="c1"># This section accounts for pre-hospital mortality, where a person is so severy injured that they die before</span>
        <span class="c1"># being able to seek medical care</span>
        <span class="n">selected_to_die</span> <span class="o">=</span> <span class="n">selected_for_rti</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">imm_death_proportion_rti</span> <span class="o">&gt;</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti</span><span class="p">))]</span>
        <span class="c1"># Keep track of who experience pre-hospital mortality with the property rt_imm_death</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_to_die</span><span class="p">,</span> <span class="s1">&#39;rt_imm_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># For each person selected to experience pre-hospital mortality, schedule an InstantaneosDeath event</span>
        <span class="k">for</span> <span class="n">individual_id</span> <span class="ow">in</span> <span class="n">selected_to_die</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;RTI_imm_death&quot;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
        <span class="c1"># ============= Take those remaining people involved in a RTI and assign injuries to them ==================</span>
        <span class="c1"># Drop those who have died immediately</span>
        <span class="n">selected_for_rti_inj_idx</span> <span class="o">=</span> <span class="n">selected_for_rti</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">selected_to_die</span><span class="p">)</span>
        <span class="c1"># Check that none remain</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti_inj_idx</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">selected_to_die</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="c1"># take a copy dataframe, used to get the index of the population affected by RTI</span>
        <span class="n">selected_for_rti_inj</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj_idx</span><span class="p">]</span>
        <span class="c1"># Again make sure that those who have injuries assigned to them are alive, involved in a crash and didn&#39;t die on</span>
        <span class="c1"># scene</span>
        <span class="n">selected_for_rti_inj</span> <span class="o">=</span> <span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">]</span>
        <span class="c1"># To stop people who have died from causes outside of the RTI module progressing through the model, remove</span>
        <span class="c1"># any person with the condition &#39;cause_of_death&#39; is not null</span>
        <span class="n">died_elsewhere_index</span> <span class="o">=</span> <span class="n">selected_for_rti_inj</span><span class="p">[</span><span class="o">~</span> <span class="n">selected_for_rti_inj</span><span class="p">[</span><span class="s1">&#39;cause_of_death&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span>
        <span class="c1"># drop the died_elsewhere_index from selected_for_rti_inj</span>
        <span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">died_elsewhere_index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Create shorthand link to RTI module</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>

        <span class="c1"># if people have been chosen to be injured, assign the injuries using the assign injuries function</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_assign_injuries</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="p">))</span>
        <span class="c1"># replace the nan values with &#39;none&#39;, this is so that the injuries can be copied over from this temporarily used</span>
        <span class="c1"># pandas dataframe will fit in with the categories in the columns rt_injury_1 through rt_injury_8</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="c1"># set the index of the description dataframe, so that we can join it to the selected_for_rti_inj dataframe</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># copy over values from the assign injury dataframe to self.sim.population.props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">description</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;ISS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_MAIS_military_score&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">description</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;MAIS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># ======================== Apply the injuries to the population dataframe ======================================</span>
        <span class="c1"># Find the corresponding column names</span>
        <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">)</span>
        <span class="n">matching_columns</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">injury_columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">matching_columns</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="c1"># Run assert statements to make sure the model is behaving as it should</span>
        <span class="c1"># All those who are injured in a road traffic accident have this noted in the property &#39;rt_road_traffic_inc&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti</span><span class="p">,</span> <span class="s1">&#39;rt_road_traffic_inc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># All those who are involved in a road traffic accident have these noted in the property &#39;rt_date_inj&#39;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti</span><span class="p">,</span> <span class="s1">&#39;rt_date_inj&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># All those who are injures and do not die immediately have an ISS score &gt; 0</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> \
               <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">])</span>
        <span class="c1"># ========================== Determine who will experience shock from blood loss ==============================</span>
        <span class="n">internal_bleeding_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;461&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">,</span> <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">potential_shock_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
            <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">],</span>
                                                              <span class="n">internal_bleeding_codes</span><span class="p">)</span>
        <span class="n">rand_for_shock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">potential_shock_index</span><span class="p">))</span>
        <span class="n">shock_index</span> <span class="o">=</span> <span class="n">potential_shock_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_bleeding_leads_to_shock</span> <span class="o">&gt;</span> <span class="n">rand_for_shock</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">shock_index</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># log the percentage of those with RTIs in shock</span>
        <span class="n">percent_in_shock</span> <span class="o">=</span> \
            <span class="nb">len</span><span class="p">(</span><span class="n">shock_index</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;none_injured&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Percent_of_shock_in_rti&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Percent_of_shock_in_rti&#39;</span><span class="p">:</span> <span class="n">percent_in_shock</span><span class="p">},</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The percentage of those assigned injuries who were also assign the shock property&#39;</span><span class="p">)</span>
        <span class="c1"># ========================== Decide survival time without medical intervention ================================</span>
        <span class="c1"># todo: find better time for survival data without med int for ISS scores</span>
        <span class="c1"># Assign a date in the future for which when the simulation reaches that date, the person&#39;s mortality will be</span>
        <span class="c1"># checked if they haven&#39;t sought care</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="c1"># ============================ Injury severity classification =================================================</span>
        <span class="c1"># Find those with mild injuries and update the rt_inj_severity property so they have a mild injury</span>
        <span class="n">injured_this_month</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">mild_rti_idx</span> <span class="o">=</span> <span class="n">injured_this_month</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">injured_this_month</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">injured_this_month</span><span class="p">[</span><span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mild_rti_idx</span><span class="p">,</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mild&#39;</span>
        <span class="c1"># Find those with severe injuries and update the rt_inj_severity property so they have a severe injury</span>
        <span class="n">severe_rti_idx</span> <span class="o">=</span> <span class="n">injured_this_month</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">injured_this_month</span><span class="p">[</span><span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">severe_rti_idx</span><span class="p">,</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;severe&#39;</span>
        <span class="c1"># check that everyone who has been assigned an injury this month has an associated injury severity</span>
        <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_date_inj</span> <span class="o">==</span> <span class="n">now</span><span class="p">),</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span>
                   <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># Find those with polytrauma and update the rt_polytrauma property so they have polytrauma</span>
        <span class="n">polytrauma_idx</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">description</span><span class="o">.</span><span class="n">Polytrauma</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">polytrauma_idx</span><span class="p">,</span> <span class="s1">&#39;rt_polytrauma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Assign daly weights for each person&#39;s injuries with the function rti_assign_daly_weights</span>
        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_assign_daly_weights</span><span class="p">(</span><span class="n">selected_for_rti_inj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># =============================== Health seeking behaviour set up =======================================</span>
        <span class="c1"># Set up health seeking behaviour. Two symptoms are used in the RTI module, the generic injury symptom and an</span>
        <span class="c1"># emergency symptom &#39;severe_trauma&#39;.</span>

        <span class="c1"># The condition to be sent to the health care system: 1) They must be alive 2) They must have been involved in a</span>
        <span class="c1"># road traffic accident 3) they must have not died immediately in the accident 4) they must not have been to an</span>
        <span class="c1"># A and E department previously and been diagnosed</span>

        <span class="c1"># The symptom they are assigned depends injury severity, those with mild injuries will be assigned the generic</span>
        <span class="c1"># symptom, those with severe injuries will have the emergency injury symptom</span>

        <span class="c1"># Create the logical conditions for each symptom</span>
        <span class="n">condition_to_be_sent_to_em</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_diagnosed</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_date_inj</span> <span class="o">==</span> <span class="n">now</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_injury_1</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_ISS_score</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rt_emergency_care_ISS_score_cut_off</span><span class="p">)</span>
        <span class="n">condition_to_be_sent_to_begin_non_emergency</span> <span class="o">=</span> \
            <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_diagnosed</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_date_inj</span> <span class="o">==</span> <span class="n">now</span><span class="p">)</span> <span class="o">&amp;</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_injury_1</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_ISS_score</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rt_emergency_care_ISS_score_cut_off</span><span class="p">)</span>
        <span class="c1"># check that all those who meet the conditions to try and seek healthcare have at least one injury</span>
        <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition_to_be_sent_to_em</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">==</span> \
               <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition_to_be_sent_to_em</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition_to_be_sent_to_begin_non_emergency</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">==</span> \
               <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">condition_to_be_sent_to_begin_non_emergency</span><span class="p">])</span>
        <span class="c1"># create indexes of people to be assigned each rti symptom</span>
        <span class="n">em_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">condition_to_be_sent_to_em</span><span class="p">]</span>
        <span class="n">non_em_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">condition_to_be_sent_to_begin_non_emergency</span><span class="p">]</span>
        <span class="c1"># Assign the symptoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">em_idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
            <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">symptom_string</span><span class="o">=</span><span class="s1">&#39;severe_trauma&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;SymptomManager&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">change_symptom</span><span class="p">(</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">non_em_idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">disease_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
            <span class="n">add_or_remove</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">symptom_string</span><span class="o">=</span><span class="s1">&#39;injury&#39;</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="RTI_Check_Death_No_Med"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Check_Death_No_Med">[docs]</a><span class="k">class</span> <span class="nc">RTI_Check_Death_No_Med</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A regular event which organises whether a person who has not received medical treatment should die as a result of</span>
<span class="sd">    their injuries. This even makes use of the maximum AIS-military score, a trauma scoring system developed for</span>
<span class="sd">    injuries in a military environment, assumed here to be an indicator of the probability of mortality without</span>
<span class="sd">    access to a medical system.</span>

<span class="sd">    The properties this function changes are:</span>
<span class="sd">    1) rt_no_med_death - the boolean property tracking who dies from road traffic injuries without medical intervention</span>

<span class="sd">    2) rt_date_death_no_med - resetting the date to check the person&#39;s mortality without medical intervention if</span>
<span class="sd">                              they survive</span>
<span class="sd">    3) rt_disability - if the person survives a non-fatal injury then this injury may heal and therefore the disability</span>
<span class="sd">                       burden is changed</span>
<span class="sd">    4) rt_debugging_DALY_wt - if the person survives a non-fatal injury then this injury may heal and therefore the</span>
<span class="sd">                              disability burden is changed, this property keeping track of the true disability burden</span>
<span class="sd">    5) rt_date_to_remove_daly - In the event of recovering from a non-fatal injury without medical intervention</span>
<span class="sd">                                a recovery date will scheduled</span>

<span class="sd">    If the person is sent here and they don&#39;t die, we need to correctly model the level of disability they experience</span>
<span class="sd">    from their untreated injuries, some injuries that are left untreated will have an associated daly weight for long</span>
<span class="sd">    term disability without treatment, others don&#39;t.</span>

<span class="sd">    # todo: consult with a doctor about the likelihood of survival without medical treatment</span>

<span class="sd">    Currently I am assuming that anyone with an injury severity score of 9 or higher will seek care and have an</span>
<span class="sd">    emergency symptom, that means that I have to decide what to do with the following injuries:</span>

<span class="sd">    Lacerations - [1101, 2101, 3101, 4101, 5101, 7101, 8101]</span>
<span class="sd">    What would a laceration do without stitching? Take longer to heal most likely</span>
<span class="sd">    Fractures - [&#39;112&#39;, &#39;211&#39;, &#39;212, &#39;412&#39;, &#39;612&#39;, &#39;712&#39;, &#39;712a&#39;, &#39;712b&#39;, &#39;712c&#39;, &#39;811&#39;, &#39;812&#39;]</span>

<span class="sd">    Some fractures have an associated level of disability to them, others do not. So things like fractured radius/ulna</span>
<span class="sd">    have a code to swap, but others don&#39;t. Some are of the no treatment type, such as fractured skulls, fractured ribs</span>
<span class="sd">    or fractured vertebrae, so we can just add the same recovery time for these injuries. So &#39;112&#39;, &#39;412&#39; and &#39;612&#39; will</span>
<span class="sd">    need to have recovery events checked and recovered.</span>
<span class="sd">    Dislocations will presumably be popped back into place, the injury will feasably be able to heal but most likely</span>
<span class="sd">    with more pain and probably with more time</span>
<span class="sd">    Amputations - [&#39;782&#39;,&#39;782a&#39;, &#39;782b&#39;, &#39;782c&#39;, &#39;882&#39;]</span>
<span class="sd">    Amputations will presumably trigger emergency health seeking behaviour so they shouldn&#39;t turn up here really</span>
<span class="sd">    soft tissue injuries - [&#39;241&#39;, &#39;342&#39;, &#39;441&#39;, &#39;442&#39;]</span>
<span class="sd">    Presumably soft tissue injuries that turn up here will heal over time but with more pain</span>
<span class="sd">    Internal organ injury - [&#39;552&#39;]</span>
<span class="sd">    Injury to the gastrointestinal organs can result in complications later on, but</span>
<span class="sd">    Internal bleedings - [&#39;361&#39;, &#39;461&#39;]</span>
<span class="sd">    Surviving internal bleeding is concievably possible, these are comparitively minor bleeds</span>


<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTI_Check_Death_No_Med.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Check_Death_No_Med.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># Load parameters used by this event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS3&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS4</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS4&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS5&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS6</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS6&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_radius_ulna_fracture_short_term_with_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_radius_ulna_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_radius_ulna_fracture_long_term_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_radius_ulna_fracture_long_term_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_foot_fracture_short_term_with_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_foot_fracture_long_term_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_foot_fracture_long_term_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_hip_fracture_short_term_with_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_short_term_with_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_hip_fracture_long_term_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_hip_fracture_long_term_without_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_pelvis_fracture_short_term</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_short_term&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_pelvis_fracture_long_term</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_pelvis_fracture_long_term&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_femur_fracture_short_term</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_short_term&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_femur_fracture_long_term_without_treatment</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;daly_wt_femur_fracture_long_term_without_treatment&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RTI_Check_Death_No_Med.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Check_Death_No_Med.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
        <span class="n">probabilities_of_death</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS3</span><span class="p">,</span>
            <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS4</span><span class="p">,</span>
            <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS5</span><span class="p">,</span>
            <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS6</span>
        <span class="p">}</span>
        <span class="c1"># check if anyone is due to have their mortality without medical intervention determined today</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">now</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Get an index of those scheduled to have their mortality checked</span>
            <span class="n">due_to_die_today_without_med_int</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">now</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="c1"># iterate over those scheduled to die</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">due_to_die_today_without_med_int</span><span class="p">:</span>
                <span class="c1"># Create a random number to determine mortality</span>
                <span class="n">rand_for_death</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># create a variable to show if a person has died due to their untreated injuries</span>
                <span class="c1"># find which injuries have been untreated</span>
                <span class="n">untreated_injuries</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
                <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="p">[</span><span class="n">persons_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
                <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_empty_injuries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                        <span class="n">untreated_injuries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span>
                <span class="n">mais_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">untreated_injuries</span><span class="p">:</span>
                    <span class="n">mais_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">max_untreated_injury</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mais_scores</span><span class="p">)</span>
                <span class="n">prob_death</span> <span class="o">=</span> <span class="n">probabilities_of_death</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">max_untreated_injury</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">rand_for_death</span> <span class="o">&lt;</span> <span class="n">prob_death</span><span class="p">:</span>
                    <span class="c1"># If determined to die, schedule a death without med</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_no_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;RTI_death_without_med&quot;</span><span class="p">,</span>
                                                            <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the people do not die from their injuries despite not getting care, we have to decide when and</span>
                    <span class="c1"># to what degree their injuries will heal.</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="s1">&#39;rt_recovery_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Reset the date to check if they die</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
                    <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">]</span>
                    <span class="c1"># create a dictionary to reference changes to daly weights done here</span>
                    <span class="n">swapping_daly_weights_lookup</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;712c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_radius_ulna_fracture_short_term_with_without_treatment</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_radius_ulna_fracture_long_term_without_treatment</span><span class="p">),</span>
                        <span class="s1">&#39;811&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_foot_fracture_short_term_with_without_treatment</span> <span class="o">+</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_foot_fracture_long_term_without_treatment</span><span class="p">),</span>
                        <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_hip_fracture_short_term_with_without_treatment</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_hip_fracture_long_term_without_treatment</span><span class="p">),</span>
                        <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_pelvis_fracture_short_term</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_pelvis_fracture_long_term</span><span class="p">,</span>
                        <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_femur_fracture_short_term</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">daly_wt_femur_fracture_long_term_without_treatment</span><span class="p">),</span>
                        <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                    <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
                    <span class="c1"># If those who haven&#39;t sought health care have an injury for which we have a daly code</span>
                    <span class="c1"># associated with that injury long term without treatment, swap it</span>
                    <span class="c1"># Iterate over the person&#39;s injuries</span>
                    <span class="n">injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="c1"># Cannot iterate correctly over list like [[1,2,3]], so need to flatten</span>
                    <span class="n">flattened_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">injuries</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]:</span>
                        <span class="n">flattened_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="n">injury</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">flattened_injuries</span> <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span>
                                              <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]]</span>
                    <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">flattened_injuries</span><span class="p">:</span>
                        <span class="n">swapable_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">swapping_codes</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">swapable_code</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">swapable_code</span> <span class="o">=</span> <span class="n">swapable_code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">swapable_code</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                        <span class="c1"># check that the person has the injury code</span>
                        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">persons_injuries</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
                        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">swapping_daly_weights_lookup</span><span class="p">[</span><span class="n">swapable_code</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_debugging_DALY_wt&#39;</span><span class="p">]</span>
                        <span class="c1"># if the code is swappable, swap it</span>
                        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1"># If they don&#39;t have a swappable code, schedule the healing of the injury</span>
                        <span class="c1"># get the persons injuries</span>
                        <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
                        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="p">[</span><span class="n">persons_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
                        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">columns</span>
                        <span class="n">columns</span> <span class="o">=</span> \
                            <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># assign a recovery date</span>
                        <span class="c1"># not all injuries have an assigned duration of recovery. These are more serious injuries that</span>
                        <span class="c1"># would normally be sent directly to the health system. In the instance that a serious injury</span>
                        <span class="c1"># occurs and no treatment is recieved but the person survives assume they will be disabled for</span>
                        <span class="c1"># the duration of the simulation</span>

                        <span class="c1"># if they haven&#39;t sought care at all we don&#39;t need to specify which injuries need a recovery</span>
                        <span class="c1"># date assigned</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span>
                                        <span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
                                    <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> \
                                                                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># if they have sought medical care and it hasn&#39;t been provided, we need to make sure only</span>
                            <span class="c1"># the untreated injuries have a recovery date assigned here</span>
                            <span class="n">code_has_recovery_time</span> <span class="o">=</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                            <span class="n">code_is_left_untreated</span> <span class="o">=</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">code_has_recovery_time</span> <span class="o">&amp;</span> <span class="n">code_is_left_untreated</span><span class="p">:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span>
                                        <span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
                                    <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> \
                                                                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="c1"># remove the injury code from columns to be treated, as they have not sought care and have</span>
                        <span class="c1"># survived without treatment</span>
                        <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]:</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span></div></div>


<div class="viewcode-block" id="RTI_Recovery_Event"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Recovery_Event">[docs]</a><span class="k">class</span> <span class="nc">RTI_Recovery_Event</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A regular event which checks the recovery date determined by each injury in columns rt_injury_1 through</span>
<span class="sd">    rt_injury_8, which is being stored in rt_date_to_remove_daly, a list property with 8 entries. This event</span>
<span class="sd">    checks the dates stored in rt_date_to_remove_daly property, when the date matches one of the entries,</span>
<span class="sd">    the daly weight is removed and the injury is fully healed.</span>

<span class="sd">    The properties changed in this functions is:</span>

<span class="sd">    1) rt_date_to_remove_daly - resetting the date to remove the daly weight for each injury once the date is</span>
<span class="sd">                                reached in the sim</span>

<span class="sd">    2) rt_inj_severity - resetting the person&#39;s injury severity once and injury is healed</span>

<span class="sd">    3) rt_injuries_to_heal_with_time - resetting the list of injuries that are due to heal over time once healed</span>

<span class="sd">    4) rt_injuries_for_minor_surgery - resetting the list of injuries that are treated with minor surgery once</span>
<span class="sd">                                       healed</span>
<span class="sd">    5) rt_injuries_for_major_surgery - resetting the list of injuries that are treated with major surgery once</span>
<span class="sd">                                       healed</span>
<span class="sd">    6) rt_injuries_for_open_fracture_treatment - resetting the list of injuries that are treated with open fracture</span>
<span class="sd">                                                 treatment once healed</span>
<span class="sd">    7) rt_injuries_to_cast - resetting the list of injuries that are treated with fracture cast treatment once healed</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTI_Recovery_Event.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Recovery_Event.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span></div>

<div class="viewcode-block" id="RTI_Recovery_Event.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Recovery_Event.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
        <span class="c1"># # Isolate the relevant population</span>
        <span class="n">any_not_null</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
        <span class="n">relevant_population</span> <span class="o">=</span> <span class="n">any_not_null</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">any_not_null</span><span class="p">]</span>
        <span class="c1"># Isolate the relevant information</span>
        <span class="n">recovery_dates</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">relevant_population</span><span class="p">][</span><span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span>
        <span class="n">default_recovery</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span>
        <span class="c1"># Iterate over all the injured people who are having medical treatment</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">recovery_dates</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="c1"># Iterate over all the dates in &#39;rt_date_to_remove_daly&#39;</span>
            <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]:</span>
                <span class="c1"># check that a recovery date hasn&#39;t been assigned to the past</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="n">date</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;recovery date assigned to past&#39;</span>
                <span class="c1"># check if the recovery date is today</span>
                <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="n">now</span><span class="p">:</span>
                    <span class="c1"># find the index for the injury which the person has recovered from</span>
                    <span class="n">dateindex</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="c1"># find the injury code associated with the healed injury</span>
                    <span class="n">code_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rt_injury_</span><span class="si">{</span><span class="n">dateindex</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span>
                    <span class="c1"># Set the healed injury recovery data back to the default state</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">dateindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
                    <span class="c1"># Remove the daly weight associated with the healed injury code</span>
                    <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">INJURY_CODES</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">if</span> <span class="n">counts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_alter_daly_post_treatment</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">code_to_remove</span><span class="p">)</span>
                    <span class="c1"># Check whether all their injuries are healed so the injury properties can be reset</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">default_recovery</span><span class="p">:</span>
                        <span class="c1"># remove the injury severity as person is uninjured</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
            <span class="c1"># Check that the date to remove dalys is removed if the date to remove the daly is today</span>
            <span class="k">assert</span> <span class="n">now</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]</span>
            <span class="c1"># finally ensure the reported disability burden is an appropriate value</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person</span><span class="p">,</span> <span class="s1">&#39;rt_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   RTI SPECIFIC HEALTH SYSTEM INTERACTION EVENTS</span>
<span class="c1">#</span>
<span class="c1">#   Here are all the different Health System Interactions Events that this module will use.</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="HSI_RTI_Imaging_Event"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Imaging_Event">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Imaging_Event</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This HSI event is triggered by the generic first appointments. After first arriving into the health system at</span>
<span class="sd">    either level 0 or level 1, should the injured person require a imaging to diagnose their injuries this HSI</span>
<span class="sd">    event is caused and x-ray or ct scans are provided as needed&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Imaging_Event.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Imaging_Event.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_injury_diagnosis</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">the_appt_footprint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Imaging_Event&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Imaging_Event.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Imaging_Event.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HSI_RTI_Imaging_Event.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Imaging_Event.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Medical_Intervention"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Medical_Intervention">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Medical_Intervention</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a Health System Interaction Event.</span>
<span class="sd">    An appointment of a person who has experienced a road traffic injury, had their injuries diagnosed through A&amp;E</span>
<span class="sd">    and now needs treatment.</span>

<span class="sd">    This appointment is designed to organise the treatments needed. In the __init__ section the appointment footprint</span>
<span class="sd">    is altered to fit the requirements of the person&#39;s treatment need. In this section we count the number of</span>
<span class="sd">    minor/major surgeries required and determine how long they will be in the health system for. For some injuries,</span>
<span class="sd">    the treatment plan is not entirely set into stone and may vary, for example, some skull fractures will need surgery</span>
<span class="sd">    whilst some will not. The treatment plan in its entirety is designed here.</span>

<span class="sd">    In the apply section, we send those who need surgeries to either HSI_RTI_Major_Surgery or HSI_RTI_Minor_Surgery,</span>
<span class="sd">    those who need stitches to HSI_RTI_Suture, those who need burn treatment to HSI_RTI_Burn_Management and those who</span>
<span class="sd">    need fracture casts to HSI_RTI_Casting.</span>

<span class="sd">    Pain medication is also requested here with HSI_RTI_Acute_Pain_Management.</span>

<span class="sd">    The properties changed in this event are:</span>

<span class="sd">    rt_injuries_for_major_surgery - the injuries that are determined to be treated by major surgery are stored in</span>
<span class="sd">                                    this list property</span>
<span class="sd">    rt_injuries_for_minor_surgery - the injuries that are determined to be treated by minor surgery are stored in</span>
<span class="sd">                                    this list property</span>
<span class="sd">    rt_injuries_to_cast - the injuries that are determined to be treated with fracture casts are stored in this list</span>
<span class="sd">                          property</span>
<span class="sd">    rt_injuries_for_open_fracture_treatment - the injuries that are determined to be treated with open fractre treatment</span>
<span class="sd">                                              are stored in this list property</span>
<span class="sd">    rt_injuries_to_heal_with_time - the injuries that are determined to heal with time are stored in this list property</span>

<span class="sd">    rt_date_to_remove_daly - recovery dates for the heal with time injuries are set here</span>

<span class="sd">    rt_date_death_no_med - the date to check mortality without medical intervention is removed as this person has</span>
<span class="sd">                           sought medical care</span>
<span class="sd">    rt_med_int - the bool property that shows whether a person has sought medical care or not</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: include treatment or at least transfer between facilities, e.g. at KCH &quot;Most patients transferred from</span>
    <span class="c1">#  either a health center, 2463 (47.2%), or district hospital, 1996 (38.3%)&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Medical_Intervention.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Medical_Intervention.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="c1"># Load the parameters used in this event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_depressed_skull_fracture</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_depressed_skull_fracture&#39;</span><span class="p">]</span>  <span class="c1"># proportion of depressed skull</span>
        <span class="c1"># fractures in https://doi.org/10.1016/j.wneu.2017.09.084</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_mild_burns</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_mild_burns&#39;</span><span class="p">]</span>  <span class="c1"># proportion of burns accross SSA with TBSA &lt; 10</span>
        <span class="c1"># https://doi.org/10.1016/j.burns.2015.04.006</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_TBI_require_craniotomy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_exploratory_laparotomy&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_dislocation_requires_surgery&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_perm_disability_with_treatment_severe_TBI</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_perm_disability_with_treatment_severe_TBI&#39;</span><span class="p">]</span>
        <span class="c1"># Create an empty list for injuries that are potentially healed without further medical intervention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heal_with_time_injuries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Define the call on resources of this treatment event: Time of Officers (Appointments)</span>
        <span class="c1">#   - get an &#39;empty&#39; foot</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;AccidentsandEmerg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># ======================= Design treatment plan, appointment type =============================================</span>
        <span class="sd">&quot;&quot;&quot; Here, RTI_MedInt designs the treatment plan of the person&#39;s injuries, the following determines what the</span>
<span class="sd">        major and minor surgery requirements will be</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create variables to count how many major or minor surgeries will be required to treat this person</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_surgery_counts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Isolate the relevant injury information</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>

        <span class="c1"># todo: work out if the amputations need to be included as a swap or if they already exist</span>

        <span class="c1"># create a dictionary to store the probability of each possible treatment for applicable injuries, we are</span>
        <span class="c1"># assuming that any amputation treatment plan will just be a major surgery for now</span>
        <span class="n">treatment_plans</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Treatment plan options for skull fracture</span>
            <span class="s1">&#39;112&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_depressed_skull_fracture</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_depressed_skull_fracture</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;113&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for facial fractures</span>
            <span class="s1">&#39;211&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;212&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for rib fractures</span>
            <span class="s1">&#39;412&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for flail chest</span>
            <span class="s1">&#39;414&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for foot fractures</span>
            <span class="s1">&#39;811&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_foot_frac_require_cast&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_foot_frac_require_maj_surg&#39;</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_foot_frac_require_min_surg&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_foot_frac_require_amp&#39;</span><span class="p">]],</span>
                    <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for lower leg fractures</span>
            <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_tib_fib_frac_require_cast&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_tib_fib_frac_require_maj_surg&#39;</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_tib_fib_frac_require_min_surg&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_tib_fib_frac_require_traction&#39;</span><span class="p">],</span>
                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_tib_fib_frac_require_amp&#39;</span><span class="p">]],</span>
                    <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for femur/hip fractures</span>
            <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_major_surgery&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_minor_surgery&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_cast&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_traction&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_amputation&#39;</span><span class="p">]],</span>
                     <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for femur/hip fractures</span>
            <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_major_surgery&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_minor_surgery&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_cast&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_traction&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_femural_fracture_require_amputation&#39;</span><span class="p">]],</span>
                     <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for pelvis fractures</span>
            <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_pelvis_fracture_traction&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_pelvis_frac_major_surgery&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_pelvis_frac_minor_surgery&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_pelvis_frac_cast&#39;</span><span class="p">]],</span>
                     <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for open fractures</span>
            <span class="s1">&#39;813bo&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813co&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813do&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;813eo&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for traumatic brain injuries</span>
            <span class="s1">&#39;133a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;133d&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;134a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;134b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;135&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_TBI_require_craniotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan options for abdominal injuries</span>
            <span class="s1">&#39;552&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;553&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;554&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_exploratory_laparotomy</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for vertebrae fracture</span>
            <span class="s1">&#39;612&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for dislocations</span>
            <span class="s1">&#39;822a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_dis_hip_require_maj_surg&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_hip_dis_require_traction&#39;</span><span class="p">],</span>
                      <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_dis_hip_require_cast&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">,</span> <span class="s1">&#39;cast&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;322&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;323&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;722&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_dislocation_requires_surgery</span><span class="p">],</span>
                    <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Soft tissue injury in neck treatment plan</span>
            <span class="s1">&#39;342&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;343&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for surgical emphysema</span>
            <span class="s1">&#39;442&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for internal bleeding</span>
            <span class="s1">&#39;361&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;363&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;461&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;HWT&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for amputations</span>
            <span class="s1">&#39;782a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;782b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;782c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;783&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;882&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;883&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;884&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;major&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for eye injury</span>
            <span class="s1">&#39;291&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">]],</span>
            <span class="c1"># Treatment plan for soft tissue injury</span>
            <span class="s1">&#39;241&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;minor&#39;</span><span class="p">]],</span>
            <span class="c1"># treatment plan for simple fractures and dislocations</span>
            <span class="s1">&#39;712a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;712b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;712c&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;822b&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cast&#39;</span><span class="p">]]</span>

        <span class="p">}</span>
        <span class="c1"># store number of open fractures for use later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_fractures</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># check if they have an injury for which we need to find the treatment plan for</span>

        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">treatment_plans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">treatment_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">treatment_plans</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">treatment_plans</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">treatment_choice</span> <span class="o">==</span> <span class="s1">&#39;cast&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">treatment_choice</span> <span class="o">==</span> <span class="s1">&#39;major&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">treatment_choice</span> <span class="o">==</span> <span class="s1">&#39;minor&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minor_surgery_counts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">treatment_choice</span> <span class="o">==</span> <span class="s1">&#39;HWT&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">treatment_choice</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">open_fractures</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># -------------------------------- Spinal cord injury requirements --------------------------------------------</span>
        <span class="c1"># Check whether they have a spinal cord injury, if we allow spinal cord surgery capacilities here, ask for a</span>
        <span class="c1"># surgery, otherwise make the injury permanent</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673&#39;</span><span class="p">,</span> <span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">]</span>
        <span class="c1"># Ask if this person has a spinal cord injury</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;include_spine_surgery&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">):</span>
            <span class="c1"># if this person has a spinal cord injury and we allow surgeries, determine their exact injury</span>
            <span class="n">actual_injury</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="c1"># update the number of major surgeries</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># add the injury to the injuries to be treated by major surgery</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actual_injury</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if no surgery assume that the person will be permanently disabled</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Find the column and code where the permanent injury is stored</span>
            <span class="n">column</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">)</span>
            <span class="c1"># make the injury permanent by adding a &#39;P&#39; before the code</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="n">code</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
            <span class="c1"># find which property the injury is stored in</span>
            <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="c1"># schedule the recovery date for the permanent injury for beyond the end of the simulation (making</span>
                <span class="c1"># it permanent)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> \
                                                                                <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

        <span class="c1"># --------------------------------- Soft tissue injury in thorax/ lung injury ----------------------------------</span>
        <span class="c1"># Check whether they have any soft tissue injuries in the thorax, if so schedule surgery if required else make</span>
        <span class="c1"># the injuries heal over time without further medical care</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">]</span>
        <span class="c1"># check if they have chest traume</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;include_thoroscopy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">):</span>
            <span class="c1"># work out the exact injury they have</span>
            <span class="n">actual_injury</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="c1"># update the number of major surgeries required</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># add the injury to the injuries to be treated with major surgery so they aren&#39;t treated elsewhere</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actual_injury</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># -------------------------------- Internal bleeding -----------------------------------------------------------</span>
        <span class="c1"># check if they have internal bleeding in the thorax, and if the surgery is available, schedule a major surgery</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;463&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;include_thoroscopy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">):</span>
            <span class="c1"># update the number of major surgeries needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># add the injury to the injuries to be treated with major surgery.</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;463&#39;</span><span class="p">)</span>
        <span class="c1"># Define the necessary information for an HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_MedicalIntervention&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># ================ Determine how long the person will be in hospital based on their ISS score ==================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_determine_LOS</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="c1"># If the patient needs skeletal traction for their injuries they need to stay at minimum 6 weeks,</span>
        <span class="c1"># average length of stay for those with femur skeletal traction found from Kramer et al. 2016:</span>
        <span class="c1"># https://doi.org/10.1007/s00264-015-3081-3</span>
        <span class="c1"># todo: put in complications from femur fractures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">femur_fracture_skeletal_traction_mean_los</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;femur_fracture_skeletal_traction_mean_los&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_skeletal_traction_los</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;other_skeletal_traction_los&#39;</span><span class="p">]</span>
        <span class="n">min_los_for_traction</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">femur_fracture_skeletal_traction_mean_los</span><span class="p">,</span>
            <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_skeletal_traction_los</span><span class="p">,</span>
            <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_skeletal_traction_los</span><span class="p">,</span>
            <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_skeletal_traction_los</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">traction_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="n">injury</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span>
                             <span class="n">min_los_for_traction</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">traction_injuries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span> <span class="o">&lt;</span> <span class="n">min_los_for_traction</span><span class="p">[</span><span class="n">traction_injuries</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span> <span class="o">=</span> <span class="n">min_los_for_traction</span><span class="p">[</span><span class="n">traction_injuries</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># Specify the type of bed days needed? not sure if necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span><span class="p">})</span>
        <span class="c1"># update the expected appointment foortprint</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span><span class="p">})</span>
        <span class="c1"># ================ Determine whether the person will require ICU days =========================================</span>
        <span class="c1"># Percentage of RTIs that required ICU stay 2.7% at KCH : https://doi.org/10.1007/s00268-020-05853-z</span>
        <span class="c1"># Percentage of RTIs that require HDU stay 3.3% at KCH</span>
        <span class="c1"># Assume for now that ICU admission is entirely dependent on injury severity so that only the 2.7% of most</span>
        <span class="c1"># severe injuries get admitted to ICU and the following 3.3% of most severe injuries get admitted to HDU</span>
        <span class="c1"># NOTE: LEAVING INPATIENT DAYS IN PLACE TEMPORARILY</span>
        <span class="c1"># Seems only one level of care above normal so adjust accordingly</span>
        <span class="c1"># self.icu_cut_off_iss_score = 38</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdu_cut_off_iss_score</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;hdu_cut_off_iss_score&#39;</span><span class="p">]</span>
        <span class="c1"># Malawi ICU data: doi: 10.1177/0003134820950282</span>
        <span class="c1"># General length of stay from Malawi source, not specifically for injuries though</span>
        <span class="c1"># mean = 4.8, s.d. = 6, TBI admission mean = 8.4, s.d. = 6.4</span>
        <span class="c1"># mortality percentage = 51.2 overall, 50% for TBI admission and 49% for hemorrhage</span>
        <span class="c1"># determine the number of ICU days used to treat patient</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu_cut_off_iss_score</span><span class="p">:</span>
            <span class="n">mean_icu_days</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_icu_days&#39;</span><span class="p">]</span>
            <span class="n">sd_icu_days</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sd_icu_days&#39;</span><span class="p">]</span>
            <span class="n">mean_tbi_icu_days</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_tbi_icu_days&#39;</span><span class="p">]</span>
            <span class="n">sd_tbi_icu_days</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sd_tbi_icu_days&#39;</span><span class="p">]</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">icu_days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_tbi_icu_days</span><span class="p">,</span> <span class="n">sd_tbi_icu_days</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">icu_days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_icu_days</span><span class="p">,</span> <span class="n">sd_icu_days</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c1"># if the number of ICU days is less than zero make it zero</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icu_days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">icu_days</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># update the property showing if a person is in ICU</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_in_icu_or_hdu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># update the bed days footprint</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;high_dependency_bed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">icu_days</span><span class="p">})</span>
            <span class="c1"># store the injury information of patients in ICU</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;ICU_patients&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">person_injuries</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The injuries of ICU patients&#39;</span><span class="p">)</span>
        <span class="c1"># Check that each injury has only one treatment plan assigned to it</span>
        <span class="n">treatment_plan</span> <span class="o">=</span> \
            <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">treatment_plan</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">treatment_plan</span><span class="p">))</span></div>

        <span class="c1"># Other test admission protocol. Basing ICU admission of whether they have a TBI</span>
        <span class="c1"># 17.3% of head injury patients in KCH were admitted to ICU/HDU (7.9 and 9.4% respectively)</span>

        <span class="c1"># Injury characteristics of patients admitted to ICU in Tanzania:</span>
        <span class="c1"># 97.8% had lacerations</span>
        <span class="c1"># 32.4% had fractures</span>
        <span class="c1"># 21.5% had TBI</span>
        <span class="c1"># 13.1% had abdominal injuries</span>
        <span class="c1"># 2.9% had burns</span>
        <span class="c1"># 3.8% had &#39;other&#39; injuries</span>
        <span class="c1"># https://doi.org/10.1186/1757-7241-19-61</span>

<div class="viewcode-block" id="HSI_RTI_Medical_Intervention.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Medical_Intervention.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># Remove the scheduled death without medical intervention</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="c1"># Isolate relevant injury information</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="p">[</span><span class="n">person_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c1"># Check that those who arrive here are alive and have been through the first generic appointment, and didn&#39;t</span>
        <span class="c1"># die due to rti</span>
        <span class="k">assert</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been through A and E&#39;</span>
        <span class="c1"># Check that those who arrive here have at least one injury</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rt_injury_1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;This person has asked for medical treatment despite not being injured&#39;</span>
        <span class="c1"># log the number of injuries this person has</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;number_of_injuries_in_hospital&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number_of_injuries&#39;</span><span class="p">:</span> <span class="n">counts</span><span class="p">},</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The number of injuries of people in the healthsystem&#39;</span><span class="p">)</span>
        <span class="c1"># update the model&#39;s properties to reflect that this person has sought medical care</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># =============================== Make &#39;healed with time&#39; injuries disappear ===================================</span>
        <span class="c1"># these are the injuries actually treated in this HSI</span>
        <span class="n">heal_with_time_recovery_times_in_days</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># using estimated 6 weeks PLACEHOLDER FOR neck dislocations</span>
            <span class="s1">&#39;322&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
            <span class="s1">&#39;323&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
            <span class="c1"># using estimated 12 weeks placeholder for dislocated shoulders</span>
            <span class="s1">&#39;722&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
            <span class="c1"># using estimated 2 month placeholder for dislocated knees</span>
            <span class="s1">&#39;822a&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
            <span class="c1"># using estimated 7 weeks PLACEHOLDER FOR SKULL FRACTURE</span>
            <span class="s1">&#39;112&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
            <span class="s1">&#39;113&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
            <span class="c1"># using estimated 5 weeks PLACEHOLDER FOR rib FRACTURE</span>
            <span class="s1">&#39;412&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
            <span class="c1"># using estimated 9 weeks PLACEHOLDER FOR Vertebrae FRACTURE</span>
            <span class="s1">&#39;612&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="c1"># using estimated 9 weeks PLACEHOLDER FOR skeletal traction for tibia/fib</span>
            <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="c1"># using estimated 9 weeks PLACEHOLDER FOR skeletal traction for hip</span>
            <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="c1"># using estimated 9 weeks PLACEHOLDER FOR skeletal traction for pelvis</span>
            <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="c1"># using estimated 9 weeks PLACEHOLDER FOR skeletal traction for femur</span>
            <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="c1"># using estimated 3 month PLACEHOLDER FOR abdominal trauma</span>
            <span class="s1">&#39;552&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
            <span class="s1">&#39;553&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
            <span class="s1">&#39;554&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
            <span class="c1"># using 1 week placeholder for surgical emphysema</span>
            <span class="s1">&#39;442&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
            <span class="c1"># 2 week placeholder for chest wall bruising</span>
            <span class="s1">&#39;461&#39;</span><span class="p">:</span> <span class="mi">14</span>

        <span class="p">}</span>
        <span class="n">tbi</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># check whether the heal with time injuries include dislocations, which may have been sent to surgery</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]:</span>
                <span class="c1"># temporarily dealing with TBI heal dates seporately</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">tbi</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">heal_with_time_recovery_times_in_days</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="n">heal_with_time_codes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Check whether the heal with time injury is a skull fracture, which may have been sent to surgery</span>
            <span class="n">tbi</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">]</span>
            <span class="n">tbi_injury</span> <span class="o">=</span> <span class="p">[</span><span class="n">injury</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">tbi</span> <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tbi_injury</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">tbi_injury</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># ask if this injury will be permanent</span>
                <span class="n">perm_injury</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">perm_injury</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_perm_disability_with_treatment_severe_TBI</span><span class="p">:</span>
                    <span class="c1"># injury is permanent so find where the injury is located</span>
                    <span class="n">column</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="n">tbi_injury</span><span class="p">)</span>
                    <span class="c1"># put a P in front of the code to show it will be a perm injury</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="n">code</span>
                    <span class="c1"># store the heal with time injury in heal_with_time_codes</span>
                    <span class="n">heal_with_time_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="n">code</span><span class="p">)</span>
                    <span class="c1"># update the property &#39;rt_injuries_to_heal_with_time&#39; to contain the new code</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="n">code</span><span class="p">)</span>
                    <span class="c1"># schedule a recover date beyond this simulation&#39;s end</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heal_with_time_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tbi_injury</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># using estimated 6 months PLACEHOLDER FOR TRAUMATIC BRAIN INJURY</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="c1"># swap potentially swappable codes</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
            <span class="c1"># remove codes that will be treated elsewhere</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                    <span class="n">swapping_codes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                    <span class="n">swapping_codes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                    <span class="n">swapping_codes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                    <span class="n">swapping_codes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="c1"># drop injuries potentially treated elsewhere</span>
            <span class="n">codes_to_swap</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">heal_with_time_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">codes_to_swap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes_to_swap</span><span class="p">)</span>
            <span class="c1"># check every heal with time injury has a recovery date associated with it</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])</span>
                                                 <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]),</span> \
                    <span class="s1">&#39;no recovery date given for this injury&#39;</span> <span class="o">+</span> <span class="n">code</span>
                <span class="c1"># check injury heal time is in the future</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
                <span class="c1"># remove code from heal with time injury list</span>

            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># schedule treatments of all injuries here</span>

        <span class="c1"># ======================================= Schedule surgeries ==================================================</span>
        <span class="c1"># Schedule the surgeries by calling the functions rti_do_for_major/minor_surgeries which in turn schedules the</span>
        <span class="c1"># surgeries, people can have multiple surgeries scheduled so schedule surgeries seperate to the rest of the</span>
        <span class="c1"># treatment plans</span>
        <span class="c1"># Check they haven&#39;t died from another source</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;cause_of_death&#39;</span><span class="p">]):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># schedule major surgeries</span>
                <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">major_surgery_counts</span><span class="p">):</span>
                    <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_do_for_major_surgeries</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor_surgery_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># shedule minor surgeries</span>
                <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor_surgery_counts</span><span class="p">):</span>
                    <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_do_for_minor_surgeries</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
        <span class="c1"># Schedule all other treatments here</span>
        <span class="c1"># Fractures are sometimes treated via major/minor surgeries. Need to establish which injuries are due to be</span>
        <span class="c1"># treated via fracture cast</span>
        <span class="n">frac_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712&#39;</span><span class="p">,</span> <span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">codes_treated_elsewhere</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
        <span class="n">frac_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">frac_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codes_treated_elsewhere</span><span class="p">]</span>
        <span class="c1"># Create a lookup table for treatment methods and the injuries that they are due to treat</span>
        <span class="n">single_option_treatments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;suture&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">],</span>
            <span class="s1">&#39;burn&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">],</span>
            <span class="s1">&#39;fracture&#39;</span><span class="p">:</span> <span class="n">frac_codes</span><span class="p">,</span>
            <span class="s1">&#39;tetanus&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">,</span> <span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">],</span>
            <span class="s1">&#39;pain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">PROPERTIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rt_injury_1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
            <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># find this person&#39;s untreated injuries</span>
        <span class="n">untreated_injury_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idx_for_untreated_injuries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="n">idx_for_untreated_injuries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_for_untreated_injuries</span><span class="p">:</span>
            <span class="n">untreated_injury_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">person_untreated_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">untreated_injury_cols</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="n">single_option_treatments</span><span class="p">:</span>
            <span class="c1"># If a person has an injury that hasn&#39;t been deliberately left untreated then schedule a treatment, or if</span>
            <span class="c1"># the treatment is pain management</span>
            <span class="n">untreated_injuries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">deliberately_untreated_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_left_untreated&#39;</span><span class="p">]</span>
            <span class="n">injuries_left_to_treat</span> <span class="o">=</span> <span class="p">[</span><span class="n">injury</span> <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">untreated_injuries</span> <span class="k">if</span> <span class="n">injury</span> <span class="ow">not</span> <span class="ow">in</span>
                                      <span class="n">deliberately_untreated_injuries</span><span class="p">]</span>
            <span class="n">no_injuries_for_this_treatment</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">injuries_left_to_treat</span><span class="p">)</span> <span class="o">&amp;</span>
                                                  <span class="nb">set</span><span class="p">(</span><span class="n">single_option_treatments</span><span class="p">[</span><span class="n">treatment</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">condition_to_skip</span> <span class="o">=</span> <span class="n">no_injuries_for_this_treatment</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">treatment</span> <span class="o">!=</span> <span class="s1">&#39;pain&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">condition_to_skip</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">inj_counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_untreated_injuries</span><span class="p">,</span>
                                                                                  <span class="n">single_option_treatments</span><span class="p">[</span><span class="n">treatment</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">inj_counts</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;suture&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_ask_for_suture_kit</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;burn&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_ask_for_burn_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;fracture&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_ask_for_fracture_casts</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;tetanus&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_ask_for_tetanus</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;pain&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_acute_pain_management</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">treatment</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
                        <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_ask_for_open_fracture_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                                                  <span class="n">counts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open_fractures</span><span class="p">)</span>

        <span class="n">treatment_plan</span> <span class="o">=</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span>
        <span class="c1"># make sure injuries are treated in one place only</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">treatment_plan</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">treatment_plan</span><span class="p">))</span>
        <span class="c1"># ============================== Ask if they die even with treatment ===========================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">RTI_Medical_Intervention_Death_Event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span>
                                <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTIMedicalInterventionEvent scheduling a potential death on date &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inpatient_days</span><span class="p">)</span><span class="si">}</span><span class="s2"> (end of treatment) for person &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_RTI_Medical_Intervention.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Medical_Intervention.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;RTIMedicalInterventionEvent did not run on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> (end of treatment) for &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">injurycodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;First injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Second injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Third injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fourth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fifth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Sixth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Seventh injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Eight injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_injury_profile_of_untreated_person&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">injurycodes</span><span class="p">)</span>
        <span class="c1"># reset the treatment plan</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Shock_Treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Shock_Treatment">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Shock_Treatment</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles the process of treating hypovolemic shock, as recommended by the pediatric</span>
<span class="sd">    handbook for Malawi and (TODO: FIND ADULT REFERENCE)</span>
<span class="sd">    Currently this HSI_Event is described only and not used, as I still need to work out how to model the occurrence</span>
<span class="sd">    of shock</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Shock_Treatment.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Shock_Treatment.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="c1"># Request accident and emergency staff time</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;AccidentsandEmerg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># determine if this is a child</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_child</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_child</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Shock_Treatment&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Shock_Treatment.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Shock_Treatment.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="c1"># TODO: find a more complete list of required consumables for adults</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_child</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;shock_treatment_child&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Dextrose (glucose) 5%, 1000ml_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 20_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Blood, one unit&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Oxygen, 1000 liters, primarily with oxygen cylinders&quot;</span><span class="p">):</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;shock_treatment_child&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;shock_treatment_adult&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 20_each_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Blood, one unit&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Oxygen, 1000 liters, primarily with oxygen cylinders&quot;</span><span class="p">):</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;shock_treatment_adult&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Hypovolemic shock treatment available for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_in_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_shock_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Shock_Treatment.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Shock_Treatment.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="c1"># Assume that untreated shock leads to death for now</span>
        <span class="c1"># Schedule the death</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_death_from_shock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;RTI_death_shock&quot;</span><span class="p">,</span>
                                                <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
        <span class="c1"># Log the death</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTI_Shock_Treatment scheduling a death for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> who did not recieve &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;treatment for shock on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span>
                     <span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Fracture_Cast"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Fracture_Cast">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Fracture_Cast</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles fracture casts/giving slings for those who need it. The HSI event tests whether the injured</span>
<span class="sd">    person has an appropriate injury code, determines how many fractures the person and then requests fracture</span>
<span class="sd">    treatment as required.</span>

<span class="sd">    The injury codes dealt with in this HSI event are:</span>
<span class="sd">    &#39;712a&#39; - broken clavicle, scapula, humerus</span>
<span class="sd">    &#39;712b&#39; - broken hand/wrist</span>
<span class="sd">    &#39;712c&#39; - broken radius/ulna</span>
<span class="sd">    &#39;811&#39; - Fractured foot</span>
<span class="sd">    &#39;812&#39; - broken tibia/fibula</span>
<span class="sd">    &#39;813a&#39; - Broken hip</span>
<span class="sd">    &#39;813b&#39; - broken pelvis</span>
<span class="sd">    &#39;813c&#39; - broken femur</span>

<span class="sd">    &#39;822a&#39; - dislocated hip</span>
<span class="sd">    &#39;822b&#39; - dislocated knee</span>

<span class="sd">    The properties altered by this function are</span>
<span class="sd">    rt_date_to_remove_daly - setting recovery dates for injuries treated with fracture casts</span>
<span class="sd">    rt_injuries_to_cast - once treated the codes used to denote injuries to be treated by fracture casts are removed</span>
<span class="sd">                          from the list of injuries due to be treated with fracture casts</span>
<span class="sd">    rt_med_int - the property used to denote whether a person getting treatment for road traffic injuries</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Fracture_Cast.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Fracture_Cast.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;AccidentsandEmerg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Fracture_Cast&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Fracture_Cast.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Fracture_Cast.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="c1"># Get the population and health system</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="c1"># if the person isn&#39;t alive return a blank footprint</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="c1"># get a shorthand reference to RTI and consumables modules</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="c1"># isolate the relevant injury information</span>
        <span class="c1"># Find the untreated injuries</span>
        <span class="n">untreated_injury_cols</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">untreated_injury_cols</span><span class="p">]</span>
        <span class="c1"># check if they have a fracture that requires a cast</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">fracturecastcounts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="c1"># check if they have a fracture that requires a sling</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712a&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">slingcounts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="c1"># Check the person sent here is alive, been through the generic first appointment,</span>
        <span class="c1"># been through the RTI med intervention</span>
        <span class="k">assert</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been diagnosed&#39;</span>
        <span class="k">assert</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been treated&#39;</span>
        <span class="c1"># Check that the person sent here has an injury treated by this module</span>
        <span class="k">assert</span> <span class="n">fracturecastcounts</span> <span class="o">+</span> <span class="n">slingcounts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># Check this person has an injury intended to be treated here</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># Check this injury assigned to be treated here is actually had by the person</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">injuries</span> <span class="ow">in</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">injuries</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">])</span>
        <span class="c1"># If they have a fracture that needs a cast, ask for plaster of paris</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Plaster of Paris (POP) 10cm x 7.5cm slab_12_CMST&#39;</span><span class="p">):</span> <span class="n">fracturecastcounts</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Bandage, crepe 7.5cm x 1.4m long , when stretched&#39;</span><span class="p">):</span> <span class="n">slingcounts</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;fracture_treatment&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># if the consumables are available then the appointment can run</span>
        <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fracture casts available for person %d&#39;s </span><span class="si">{</span><span class="n">fracturecastcounts</span> <span class="o">+</span> <span class="n">slingcounts</span><span class="si">}</span><span class="s2"> fractures, &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span>
                         <span class="p">)</span>
            <span class="c1"># update the property rt_med_int to indicate they are recieving treatment</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Find the persons injuries</span>
            <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="p">[</span><span class="n">person_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
            <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Find the injury codes treated by fracture casts/slings</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">]</span>
            <span class="c1"># Some TLO codes have daly weights associated with treated and non-treated injuries, copy the list of</span>
            <span class="c1"># swapping codes</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
            <span class="c1"># find the relevant swapping codes for this treatment</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">]</span>
            <span class="c1"># remove codes that will be treated elsewhere</span>
            <span class="n">injuries_treated_elsewhere</span> <span class="o">=</span> \
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
            <span class="c1"># remove codes that are being treated elsewhere</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">injuries_treated_elsewhere</span><span class="p">]</span>
            <span class="c1"># find any potential codes this person has that are due to be swapped and then swap with</span>
            <span class="c1"># rti_swap_injury_daly_upon_treatment</span>
            <span class="n">relevant_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">swapping_codes</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">relevant_codes</span><span class="p">)</span>
            <span class="c1"># Find the injuries that have been treated and then schedule a recovery date</span>
            <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> \
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                 <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">])</span>
            <span class="c1"># check that for each injury to be treated by this event we have a corresponding column</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">])</span>
            <span class="c1"># iterate over the columns of injuries treated here and assign a recovery date</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="c1"># todo: update this with recovery times for casted broken hips/pelvis/femurs</span>
                <span class="c1"># todo: update this with recovery times for casted dislocated hip</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> \
                                                                                <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="c1"># make sure the assigned injury recovery date is in the future</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
            <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]),</span> \
                    <span class="s1">&#39;no recovery date given for this injury&#39;</span>
            <span class="c1"># remove codes from fracture cast list</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_fracture_casts</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">fracturecastcounts</span> <span class="o">+</span> <span class="n">slingcounts</span><span class="si">}</span><span class="s2"> fractures without treatment&quot;</span>
                         <span class="p">)</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Fracture_Cast.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Fracture_Cast.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fracture casts unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Open_Fracture_Treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Open_Fracture_Treatment">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Open_Fracture_Treatment</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles fracture casts/giving slings for those who need it. The HSI event tests whether the injured</span>
<span class="sd">    person has an appropriate injury code, determines how many fractures the person and then requests fracture</span>
<span class="sd">    treatment as required.</span>

<span class="sd">    The injury codes dealt with in this HSI event are:</span>
<span class="sd">    &#39;813bo&#39; - Open fracture of the pelvis</span>
<span class="sd">    &#39;813co&#39; - Open fracture of the femur</span>
<span class="sd">    &#39;813do&#39; - Open fracture of the foot</span>
<span class="sd">    &#39;813eo&#39; - Open fracture of the tibia/fibula/ankle/patella</span>

<span class="sd">    The properties altered by this function are:</span>
<span class="sd">    rt_med_int - to denote that this person is recieving treatment</span>
<span class="sd">    rt_injuries_for_open_fracture_treatment - removing codes that have been treated by open fracture treatment</span>
<span class="sd">    rt_date_to_remove_daly - to schedule recovery dates for open fractures that have recieved treatment</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Open_Fracture_Treatment.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Open_Fracture_Treatment.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MinorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># wound debridement requires minor surgery</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Open_Fracture_Treatment&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Open_Fracture_Treatment.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Open_Fracture_Treatment.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="c1"># isolate the relevant injury information</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># check if they have a fracture that requires a cast</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">open_fracture_counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">open_fracture_counts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># Check the person sent here is alive, been through the generic first appointment,</span>
        <span class="c1"># been through the RTI med intervention</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been diagnosed&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been treated&#39;</span>

        <span class="c1"># If they have an open fracture, ask for consumables to treat fracture</span>
        <span class="k">if</span> <span class="n">open_fracture_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;open_fracture_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;ceftriaxon 500 mg, powder for injection_10_IDA&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Cetrimide 15</span><span class="si">% + c</span><span class="s1">hlorhexidine 1.5</span><span class="si">% s</span><span class="s1">olution.for dilution _5_CMST&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Gauze, absorbent 90cm x 40m_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Suture pack&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># If wound is &quot;grossly contaminated&quot; administer Metronidazole</span>
            <span class="c1"># todo: parameterise the probability of wound contamination</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
            <span class="n">prob_open_fracture_contaminated</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_open_fracture_contaminated&#39;</span><span class="p">]</span>
            <span class="n">rand_for_contamination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rand_for_contamination</span> <span class="o">&lt;</span> <span class="n">prob_open_fracture_contaminated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;open_fracture_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Metronidazole, injection, 500 mg in 100 ml vial&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>
                <span class="p">)</span>
        <span class="c1"># Check that there are enough consumables to treat this person&#39;s fractures</span>
        <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;open_fracture_treatment&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Fracture casts available for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">open_fracture_counts</span><span class="si">}</span><span class="s2"> open fractures&quot;</span>
                         <span class="p">)</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
            <span class="c1"># update the dataframe to show this person is recieving treatment</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Find the persons injuries to be treated</span>
            <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
            <span class="n">columns</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span>
                <span class="n">person_id</span><span class="p">,</span> <span class="n">non_empty_injuries</span>
            <span class="p">)</span>
            <span class="c1"># Some TLO codes have daly weights associated with treated and non-treated injuries</span>
            <span class="k">if</span> <span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;813bo&#39;</span><span class="p">:</span>
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># Schedule a recovery date for the injury</span>
            <span class="c1"># estimated 6-9 months recovery times for open fractures</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span> \
                <span class="s1">&#39;no recovery date given for this injury&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="c1"># remove code from open fracture list</span>
            <span class="k">if</span> <span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_open_fracture_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&#39;s has </span><span class="si">{</span><span class="n">open_fracture_counts</span><span class="si">}</span><span class="s2"> open fractures without treatment&quot;</span><span class="p">,</span>
                         <span class="p">)</span></div>

<div class="viewcode-block" id="HSI_RTI_Open_Fracture_Treatment.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Open_Fracture_Treatment.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Open fracture treatment unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Suture"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Suture">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Suture</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles lacerations giving suture kits for those who need it. The HSI event tests whether the injured</span>
<span class="sd">    person has an appropriate injury code, determines how many lacerations the person and then requests suture kits</span>
<span class="sd">     as required.</span>


<span class="sd">    The codes dealt with are:</span>
<span class="sd">    &#39;1101&#39; - Laceration to the head</span>
<span class="sd">    &#39;2101&#39; - Laceration to the face</span>
<span class="sd">    &#39;3101&#39; - Laceration to the neck</span>
<span class="sd">    &#39;4101&#39; - Laceration to the thorax</span>
<span class="sd">    &#39;5101&#39; - Laceration to the abdomen</span>
<span class="sd">    &#39;7101&#39; - Laceration to the upper extremity</span>
<span class="sd">    &#39;8101&#39; - Laceration to the lower extremity</span>

<span class="sd">    The properties altered by this function are:</span>
<span class="sd">    rt_med_int - to denote that this person is recieving treatment</span>
<span class="sd">    rt_date_to_remove_daly - to schedule recovery dates for lacerations treated in this hsi</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Suture.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Suture.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Suture&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Suture.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Suture.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>

        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">lacerationcounts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="c1"># Check the person sent here didn&#39;t die due to rti, has been through A&amp;E, through Med int</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been through A and E&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;person sent here has not been treated&#39;</span>
        <span class="c1"># Check that the person sent here has an injury that is treated by this HSI event</span>
        <span class="k">assert</span> <span class="n">lacerationcounts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">lacerationcounts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;laceration_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Suture pack&#39;</span><span class="p">):</span> <span class="n">lacerationcounts</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Cetrimide 15</span><span class="si">% + c</span><span class="s1">hlorhexidine 1.5</span><span class="si">% s</span><span class="s1">olution.for dilution _5_CMST&#39;</span><span class="p">):</span> <span class="n">lacerationcounts</span><span class="p">,</span>

            <span class="p">}</span>
            <span class="c1"># check the number of suture kits required and request them</span>
            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;laceration_treatment&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Availability of consumables determines if the intervention is delivered...</span>
            <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has open wound treatment available which has been used for person &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span>
                             <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility treated their </span><span class="si">{</span><span class="n">lacerationcounts</span><span class="si">}</span><span class="s2"> open wounds&quot;</span><span class="p">)</span>

                <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># heal time for lacerations is roughly two weeks according to:</span>
                    <span class="c1"># https://www.facs.org/~/media/files/education/patient%20ed/wound_lacerations.ashx#:~:text=of%20</span>
                    <span class="c1"># wound%20and%20your%20general,have%20a%20weakened%20immune%20system.</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> \
                                                                                    <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_suture_kit</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s2">&quot;This facility has no treatment for open wounds available.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Suture.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Suture.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Suture kits unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Burn_Management"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Burn_Management">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Burn_Management</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles burns giving treatment for those who need it. The HSI event tests whether the injured</span>
<span class="sd">    person has an appropriate injury code, determines how many burns the person and then requests appropriate treatment</span>
<span class="sd">     as required.</span>



<span class="sd">    The codes dealt with in this HSI event are:</span>
<span class="sd">    &#39;1114&#39; - Burns to the head</span>
<span class="sd">    &#39;2114&#39; - Burns to the face</span>
<span class="sd">    &#39;3113&#39; - Burns to the neck</span>
<span class="sd">    &#39;4113&#39; - Burns to the thorax</span>
<span class="sd">    &#39;5113&#39; - Burns to the abdomen</span>
<span class="sd">    &#39;7113&#39; - Burns to the upper extremities</span>
<span class="sd">    &#39;8113&#39; - Burns to the lower extremities</span>

<span class="sd">    The properties treated by this module are:</span>
<span class="sd">    rt_med_int - to denote that this person is recieving treatment for their injuries</span>
<span class="sd">    rt_date_to_remove_daly - to schedule recovery dates for injuries treated here</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Burn_Management.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Burn_Management.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MinorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Burn_Management&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_mild_burns</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_mild_burns&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="HSI_RTI_Burn_Management.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Burn_Management.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>

        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">burncounts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="c1"># check the person sent here has an injury treated by this module</span>
        <span class="k">assert</span> <span class="n">burncounts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># check the person sent here didn&#39;t die due to rti, has been through A and E and had RTI_med_int</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;this person has not been through a and e&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;this person has not been treated&#39;</span>
        <span class="k">if</span> <span class="n">burncounts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Request materials for burn treatment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;burn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Gauze, absorbent 90cm x 40m_each_CMST&quot;</span><span class="p">):</span> <span class="n">burncounts</span><span class="p">,</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Cetrimide 15</span><span class="si">% + c</span><span class="s1">hlorhexidine 1.5</span><span class="si">% s</span><span class="s1">olution.for dilution _5_CMST&#39;</span><span class="p">):</span> <span class="n">burncounts</span><span class="p">,</span>

            <span class="p">}</span>
            <span class="n">possible_large_TBSA_burn_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">]</span>
            <span class="n">idx2</span><span class="p">,</span> <span class="n">bigburncounts</span> <span class="o">=</span> \
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">possible_large_TBSA_burn_codes</span><span class="p">)</span>
            <span class="n">random_for_severe_burn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># ======================== If burns severe enough then give IV fluid replacement ===========================</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">burncounts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">random_for_severe_burn</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_mild_burns</span><span class="p">)):</span>
                <span class="c1"># check if they have multiple burns, which implies a higher burned total body surface area (TBSA) which</span>
                <span class="c1"># will alter the treatment plan</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;burn_treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;burn_treatment&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has burn treatment available which has been used for person &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility treated their </span><span class="si">{</span><span class="n">burncounts</span><span class="si">}</span><span class="s2"> burns&quot;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
                <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">person_injuries</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># estimate burns take 4 weeks to heal</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
                <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
                <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="p">[</span><span class="n">persons_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
                <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
                <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">]</span>
                <span class="c1"># remove codes that will be treated elsewhere</span>
                <span class="n">treatment_plan</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treatment_plan</span><span class="p">]</span>
                <span class="n">relevant_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">swapping_codes</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">relevant_codes</span><span class="p">)</span>

                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> \
                    <span class="s1">&#39;recovery date assigned to past&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_burn_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="s2">&quot;This facility has no treatment for burns available.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_RTI_Burn_Management.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Burn_Management.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Burn treatment unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Tetanus_Vaccine"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Tetanus_Vaccine">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Tetanus_Vaccine</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This HSI event handles tetanus vaccine requests, the idea being that by separating these from the burn and</span>
<span class="sd">    laceration and burn treatments, those treatments can go ahead without the availability of tetanus stopping the event</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Tetanus_Vaccine.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Tetanus_Vaccine.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Tetanus_Vaccine&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Tetanus_Vaccine.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Tetanus_Vaccine.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="c1"># check the person sent here hasn&#39;t died due to rti, has been through A and E and had RTI_med_int</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through a and e&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through rti med int&#39;</span>
        <span class="c1"># check the person sent here has an injury treated by this module</span>
        <span class="n">codes_for_tetanus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">codes_for_tetanus</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># If they have a laceration/burn ask request the tetanus vaccine</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;tetanus_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Tetanus toxoid, injection&#39;</span><span class="p">):</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">is_tetanus_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;tetanus_treatment&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">is_tetanus_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tetanus vaccine requested for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> and given&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_ask_for_tetanus</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tetanus vaccine requested for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">, not given&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Tetanus_Vaccine.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Tetanus_Vaccine.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tetanus vaccine unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Acute_Pain_Management"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Acute_Pain_Management">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Acute_Pain_Management</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This HSI event handles all requests for pain management here, all injuries will pass through here and the pain</span>
<span class="sd">    medicine required will be set to manage the level of pain they are experiencing, with mild pain being managed with</span>
<span class="sd">    paracetamol/NSAIDS, moderate pain being managed with tramadol and severe pain being managed with morphine.</span>

<span class="sd">     &quot;There is a mismatch between the burden of musculoskeletal pain conditions and appropriate health policy response</span>
<span class="sd">     and planning internationally that can be addressed with an integrated research and policy agenda.&quot;</span>
<span class="sd">     SEE doi: 10.2105/AJPH.2018.304747</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Acute_Pain_Management.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Acute_Pain_Management.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>

        <span class="c1"># Define the call on resources of this treatment event: Time of Officers (Appointments)</span>
        <span class="c1">#   - get an &#39;empty&#39; footprint:</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="c1">#   - update to reflect the appointments that are required</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Under5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Define the necessary information for an HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Acute_Pain_Management&#39;</span>  <span class="c1"># This must begin with the module name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Acute_Pain_Management.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Acute_Pain_Management.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="c1"># Check that the person sent here is alive, has been through A&amp;E and RTI_Med_int</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through a and e&#39;</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through rti med int&#39;</span>
        <span class="n">person_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">pain_level</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="c1"># create a dictionary to associate the level of pain to the codes</span>
        <span class="n">pain_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;severe&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1114&#39;</span><span class="p">,</span> <span class="s1">&#39;2114&#39;</span><span class="p">,</span> <span class="s1">&#39;3113&#39;</span><span class="p">,</span> <span class="s1">&#39;4113&#39;</span><span class="p">,</span> <span class="s1">&#39;5113&#39;</span><span class="p">,</span> <span class="s1">&#39;7113&#39;</span><span class="p">,</span> <span class="s1">&#39;8113&#39;</span><span class="p">,</span>  <span class="c1"># burns</span>
                       <span class="s1">&#39;P782&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">,</span>  <span class="c1"># amputations</span>
                       <span class="s1">&#39;673&#39;</span><span class="p">,</span> <span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;P673&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674&#39;</span><span class="p">,</span> <span class="s1">&#39;P674a&#39;</span><span class="p">,</span> <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">,</span>  <span class="c1"># SCI</span>
                       <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span>  <span class="c1"># abdominal trauma</span>
                       <span class="s1">&#39;463&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span>  <span class="c1"># severe chest trauma</span>
                       <span class="p">],</span>
            <span class="s1">&#39;moderate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;113&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;412&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;612&#39;</span><span class="p">,</span> <span class="s1">&#39;712&#39;</span><span class="p">,</span> <span class="s1">&#39;712a&#39;</span><span class="p">,</span> <span class="s1">&#39;712b&#39;</span><span class="p">,</span> <span class="s1">&#39;712c&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span>  <span class="c1"># fractures</span>
                         <span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;822&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;822b&#39;</span><span class="p">,</span>  <span class="c1"># dislocations</span>
                         <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span>  <span class="c1"># neck trauma</span>
                         <span class="s1">&#39;461&#39;</span><span class="p">,</span>  <span class="c1"># chest wall bruising</span>
                         <span class="s1">&#39;813bo&#39;</span><span class="p">,</span> <span class="s1">&#39;813co&#39;</span><span class="p">,</span> <span class="s1">&#39;813do&#39;</span><span class="p">,</span> <span class="s1">&#39;813eo&#39;</span>  <span class="c1"># open fractures</span>
                         <span class="p">],</span>
            <span class="s1">&#39;mild&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">,</span> <span class="s1">&#39;2101&#39;</span><span class="p">,</span> <span class="s1">&#39;3101&#39;</span><span class="p">,</span> <span class="s1">&#39;4101&#39;</span><span class="p">,</span> <span class="s1">&#39;5101&#39;</span><span class="p">,</span> <span class="s1">&#39;7101&#39;</span><span class="p">,</span> <span class="s1">&#39;8101&#39;</span><span class="p">,</span>  <span class="c1"># lacerations</span>
                     <span class="s1">&#39;241&#39;</span><span class="p">,</span>  <span class="c1"># Minor soft tissue injuries</span>
                     <span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span>  <span class="c1"># TBI</span>
                     <span class="s1">&#39;P133&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span>  <span class="c1"># Perm TBI</span>
                     <span class="s1">&#39;291&#39;</span><span class="p">,</span>  <span class="c1"># Eye injury</span>
                     <span class="s1">&#39;442&#39;</span>
                     <span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># iterate over the dictionary to find the pain level, going from highest pain to lowest pain in a for loop,</span>
        <span class="c1"># then find the highest level of pain this person has by breaking the for loop</span>
        <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="n">pain_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">person_injuries</span><span class="p">,</span> <span class="n">pain_dict</span><span class="p">[</span><span class="n">severity</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pain_level</span> <span class="o">=</span> <span class="n">severity</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">pain_level</span> <span class="o">==</span> <span class="s2">&quot;mild&quot;</span><span class="p">:</span>
            <span class="c1"># Multiple options, some are conditional</span>
            <span class="c1"># Give paracetamol</span>
            <span class="c1"># Give NSAIDS such as aspirin (unless they are under 16) for soft tissue pain, but not if they are pregnant</span>
            <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                              <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Requested_Pain_Management&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Summary of the pain medicine requested by each person&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Paracetamol 500mg_1000_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span>
                <span class="p">}</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;diclofenac sodium 25 mg, enteric coated_1000_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span>
                <span class="p">}</span>
                <span class="n">cond1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Paracetamol 500mg_1000_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span>
                <span class="p">}</span>
                <span class="n">cond2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cond1</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cond2</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">which</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">which</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
                        <span class="n">cond</span> <span class="o">=</span> <span class="n">cond1</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested paracetamol for their pain relief&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cond</span> <span class="o">=</span> <span class="n">cond2</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested diclofenac for their pain relief&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">cond1</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cond2</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">cond</span> <span class="o">=</span> <span class="n">cond1</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested paracetamol for their pain relief&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">cond1</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cond2</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">cond</span> <span class="o">=</span> <span class="n">cond2</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested diclofenac for their pain relief&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">which</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">which</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
                        <span class="n">cond</span> <span class="o">=</span> <span class="n">cond1</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested paracetamol for their pain relief&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cond</span> <span class="o">=</span> <span class="n">cond2</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> requested diclofenac for their pain relief&quot;</span><span class="p">)</span>
            <span class="c1"># Availability of consumables determines if the intervention is delivered...</span>
            <span class="k">if</span> <span class="n">cond</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has pain management available for mild pain which has been used for &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                  <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Successful_Pain_Management&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Pain medicine successfully provided to the person&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_acute_pain_management</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has no pain management available for their mild pain, person &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pain_level</span> <span class="o">==</span> <span class="s2">&quot;moderate&quot;</span><span class="p">:</span>
            <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                              <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Requested_Pain_Management&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Summary of the pain medicine requested by each person&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;tramadol HCl 100 mg/2 ml, for injection_100_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> has requested tramadol for moderate pain relief&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has pain management available for moderate pain which has been used &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                  <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Successful_Pain_Management&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Pain medicine successfully provided to the person&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_acute_pain_management</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has no pain management available for moderate pain for person &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pain_level</span> <span class="o">==</span> <span class="s2">&quot;severe&quot;</span><span class="p">:</span>
            <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                              <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Requested_Pain_Management&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Summary of the pain medicine requested by each person&#39;</span><span class="p">)</span>
            <span class="c1"># give morphine</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;morphine sulphate 10 mg/ml, 1 ml, injection (nt)_10_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="n">is_cons_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;pain_management&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> has requested morphine for severe pain relief&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_cons_available</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has pain management available for severe pain which has been used for&quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot; person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                  <span class="s1">&#39;pain level&#39;</span><span class="p">:</span> <span class="n">pain_level</span><span class="p">}</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Successful_Pain_Management&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Pain medicine successfully provided to the person&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_acute_pain_management</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This facility has no pain management available for severe pain for person &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Acute_Pain_Management.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Acute_Pain_Management.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pain relief unavailable for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">injurycodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;First injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Second injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Third injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fourth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fifth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Sixth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Seventh injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Eight injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Injury profile of person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">injurycodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Major_Surgeries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Major_Surgeries">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Major_Surgeries</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a Health System Interaction Event.</span>
<span class="sd">        An appointment of a person who has experienced a road traffic injury, had their injuries diagnosed through</span>
<span class="sd">        A and E and requires major surgery.</span>

<span class="sd">        Major surgeries are defined here as surgeries that include extensive work such as entering a body cavity,</span>
<span class="sd">        removing an organ or altering the body’s anatomy</span>

<span class="sd">        The injuries treated in this module are as follows:</span>

<span class="sd">        FRACTURES:</span>
<span class="sd">        While district hospitals can provide some</span>
<span class="sd">        emergency trauma care and surgeries, only central hospitals</span>
<span class="sd">        are equipped to provide advanced orthopaedic surgery. - Lavy et al. 2007</span>

<span class="sd">        &#39;112&#39; - Depressed skull fracture - reported use of surgery in Eaton et al. 2017</span>
<span class="sd">        &#39;811&#39; - fractured foot - reported use of surgery in Chagomerana et al. 2017</span>
<span class="sd">        &#39;812&#39; - fracture tibia/fibula - reported use of surgery in Chagomerana et al. 2017</span>
<span class="sd">        &#39;813a&#39; - Fractured hip - reported use of surgery and Lavy et al. 2007</span>
<span class="sd">        &#39;813b&#39; - Fractured pelvis - reported use of surgery and Lavy et al. 2007</span>
<span class="sd">        &#39;813c&#39; - Fractured femur - reported use of surgery and Lavy et al. 2007</span>
<span class="sd">        &#39;414&#39; - Flail chest - https://www.sciencedirect.com/science/article/abs/pii/S0020138303002900</span>

<span class="sd">        SOFT TISSUE INJURIES:</span>
<span class="sd">        &#39;342&#39; - Soft tissue injury of the neck</span>
<span class="sd">        &#39;343&#39; - Soft tissue injury of the neck</span>

<span class="sd">        Thoroscopy treated injuries:</span>
<span class="sd">        https://www.ncbi.nlm.nih.gov/nlmcatalog/101549743</span>
<span class="sd">        Ref from pediatric handbook for Malawi</span>
<span class="sd">        &#39;441&#39; - Closed pneumothorax</span>
<span class="sd">        &#39;443&#39; - Open pneumothorax</span>
<span class="sd">        &#39;463&#39; - Haemothorax</span>
<span class="sd">        &#39;453a&#39; - Diaphragm rupture</span>
<span class="sd">        &#39;453b&#39; - Lung contusion</span>

<span class="sd">        INTERNAL BLEEDING:</span>
<span class="sd">        &#39;361&#39; - Internal bleeding in neck</span>
<span class="sd">        &#39;363&#39; - Internal bleeding in neck</span>


<span class="sd">        TRAUMATIC BRAIN INJURIES THAT REQUIRE A CRANIOTOMOY - reported use of surgery in Eaton et al 2017 and Lavy et</span>
<span class="sd">        al. 2007</span>

<span class="sd">        &#39;133a&#39; - Subarachnoid hematoma</span>
<span class="sd">        &#39;133b&#39; - Brain contusion</span>
<span class="sd">        &#39;133c&#39; - Intraventricular haemorrhage</span>
<span class="sd">        &#39;133d&#39; - Subgaleal hematoma</span>
<span class="sd">        &#39;134a&#39; - Epidural hematoma</span>
<span class="sd">        &#39;134b&#39; - Subdural hematoma</span>
<span class="sd">        &#39;135&#39; - diffuse axonal injury</span>

<span class="sd">        Laparotomy - Recorded in Lavy et al. 2007 and here: https://www.ajol.info/index.php/mmj/article/view/174378</span>

<span class="sd">        &#39;552&#39; - Injury to Intestine, stomach and colon</span>
<span class="sd">        &#39;553&#39; - Injury to Spleen, Urinary bladder, Liver, Urethra, Diaphragm</span>
<span class="sd">        &#39;554&#39; - Injury to kidney</span>


<span class="sd">        SPINAL CORD LESIONS, REQUIRING LAMINOTOMY/FORAMINOTOMY/INTERSPINOUS PROCESS SPACER</span>
<span class="sd">        Quote from Eaton et al. 2019:</span>
<span class="sd">        &quot;No patients received thoracolumbar braces or underwent spinal surgery.&quot;</span>
<span class="sd">        https://journals.sagepub.com/doi/pdf/10.1177/0049475518808969</span>
<span class="sd">        So those with spinal cord injuries are not likely to be treated here in RTI_Major_Surgeries..</span>

<span class="sd">        &#39;673a&#39; - Spinal cord lesion at neck level</span>
<span class="sd">        &#39;673b&#39; - Spinal cord lesion below neck level</span>
<span class="sd">        &#39;674a&#39; - Spinal cord lesion at neck level</span>
<span class="sd">        &#39;674b&#39; - Spinal cord lesion below neck level</span>
<span class="sd">        &#39;675a&#39; - Spinal cord lesion at neck level</span>
<span class="sd">        &#39;675b&#39; - Spinal cord lesion below neck level</span>
<span class="sd">        &#39;676&#39; - Spinal cord lesion at neck level</span>

<span class="sd">        AMPUTATIONS - Reported in Crudziak et al. 2019</span>
<span class="sd">        &#39;782a&#39; - Amputated finger</span>
<span class="sd">        &#39;782b&#39; - Unilateral arm amputation</span>
<span class="sd">        &#39;782c&#39; - Amputated thumb</span>
<span class="sd">        &#39;783&#39; - Bilateral arm amputation</span>
<span class="sd">        &#39;882&#39; - Amputated toe</span>
<span class="sd">        &#39;883&#39; - Unilateral lower limb amputation</span>
<span class="sd">        &#39;884&#39; - Bilateral lower limb amputation</span>

<span class="sd">        Dislocations - Reported in Chagomerana et al. 2017</span>
<span class="sd">        &#39;822a&#39; Hip dislocation</span>

<span class="sd">        The properties altered in this function are:</span>
<span class="sd">        rt_injury_1 through rt_injury_8 - in the incidence that despite treatment the person treated is left</span>
<span class="sd">                                          permanently disabled we need to update the injury code to inform the</span>
<span class="sd">                                          model that the disability burden associated with the permanently</span>
<span class="sd">                                          disabling injury shouldn&#39;t be removed</span>
<span class="sd">        rt_perm_disability - when a person is decided to be permanently disabled we update this property to reflect this</span>
<span class="sd">        rt_date_to_remove_daly - assign recovery dates for the injuries treated with the surgery</span>
<span class="sd">        rt_injuries_for_major_surgery - to remove codes due to be treated by major surgery when that injury recieves</span>
<span class="sd">                                        a treatment.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Major_Surgeries.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Major_Surgeries.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Major_Surgeries&#39;</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires major surgery</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Define the necessary information for an HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_perm_disability_with_treatment_severe_TBI</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_perm_disability_with_treatment_severe_TBI&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="HSI_RTI_Major_Surgeries.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Major_Surgeries.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="c1"># Request first draft of consumables used in major surgery</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;major_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># request a general anaesthetic</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Halothane (fluothane)_250ml_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># clean the site of the surgery</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Chlorhexidine 1.5</span><span class="si">% s</span><span class="s2">olution_5_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># tools to begin surgery</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Scalpel blade size 22 (individually wrapped)_100_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer an IV</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Cannula iv  (winged with injection pot) 20_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Giving set iv administration + needle 15 drops/ml_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># repair incision made</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Suture pack&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Gauze, absorbent 90cm x 40m_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer pain killer</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer antibiotic</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Ampicillin injection 500mg, PFR_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># equipment used by surgeon, gloves and facemask</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;surgical face mask, disp., with metal nose piece_50_IDA&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># request syringe</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Syringe, Autodisable SoloShot IX &quot;</span><span class="p">):</span> <span class="mi">1</span>
        <span class="p">}</span>

        <span class="n">request_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;major_surgery&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="c1"># todo: think about consequences of certain consumables not being available for major surgery and model health</span>
        <span class="c1">#  outcomes</span>
        <span class="c1"># Isolate the relevant injury information</span>
        <span class="n">surgically_treated_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;782&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">]</span>
        <span class="c1"># If we have allowed spinal cord surgeries to be treated in this simulation, include the associated injury</span>
        <span class="c1"># codes here</span>
        <span class="k">if</span> <span class="s1">&#39;include_spine_surgery&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">:</span>
            <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;P674a&#39;</span><span class="p">,</span> <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">additional_codes</span><span class="p">:</span>
                <span class="n">surgically_treated_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="c1"># If we have allowed greater access to thoroscopy, include the codes treated by thoroscopy here</span>
        <span class="k">if</span> <span class="s1">&#39;include_thoroscopy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">:</span>
            <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">additional_codes</span><span class="p">:</span>
                <span class="n">surgically_treated_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">injuries_to_be_treated</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">injuries_to_be_treated</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">surgically_treated_codes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> \
            <span class="s1">&#39;This person has asked for surgery but does not have an appropriate injury&#39;</span>
        <span class="c1"># check the people sent here have at least one injury treated by this HSI event</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">persons_injuries</span><span class="p">,</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">persons_injuries</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
        <span class="c1"># People can be sent here for multiple surgeries, but only one injury can be treated at a time. Decide which</span>
        <span class="c1"># injury is being treated in this surgery</span>
        <span class="c1"># find index for untreated injuries</span>
        <span class="n">idx_for_untreated_injuries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">]))</span>
        <span class="c1"># find untreated injury codes that are treated with major surgery</span>
        <span class="n">relevant_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">injuries_to_be_treated</span><span class="p">,</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
        <span class="c1"># check that the person sent here has an appropriate code(s)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">persons_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_for_untreated_injuries</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span>
                                         <span class="n">persons_injuries</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx_for_untreated_injuries</span><span class="p">])</span>
        <span class="c1"># choose a code at random</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_outcome</span><span class="p">:</span>
            <span class="c1"># check the people sent here hasn&#39;t died due to rti, have had their injuries diagnosed and been through</span>
            <span class="c1"># RTI_Med</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through a and e&#39;</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through rti med int&#39;</span>
            <span class="c1"># ------------------------ Track permanent disabilities with treatment -------------------------------------</span>
            <span class="c1"># --------------------------------- Perm disability from TBI -----------------------------------------------</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">]</span>

            <span class="sd">&quot;&quot;&quot; Of patients that survived, 80.1% (n 148) had a good recovery with no appreciable clinical neurologic</span>
<span class="sd">            deficits, 13.1% (n 24) had a moderate disability with deficits that still allowed the patient to live</span>
<span class="sd">            independently, 4.9% (n 9) had severe disability which will require assistance with activities of daily life,</span>
<span class="sd">            and 1.1% (n 2) were in a vegetative state</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Check whether the person having treatment for their tbi will be left permanently disabled</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                <span class="n">prob_perm_disability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prob_perm_disability</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_perm_disability_with_treatment_severe_TBI</span><span class="p">:</span>
                    <span class="c1"># Track whether they are permanently disabled</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Find the column and code where the permanent injury is stored</span>
                    <span class="n">column</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;@@@@@@@@@@ Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> had intervention for TBI on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> but &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;still disabled!!!!!!&quot;</span><span class="p">)</span>
                    <span class="c1"># Update the code to make the injury permanent, so it will not have the associated daly weight</span>
                    <span class="c1"># removed later on</span>
                    <span class="n">code_to_drop_index</span> <span class="o">=</span> <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                    <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">code_to_drop_index</span><span class="p">)</span>
                    <span class="c1"># remove the old code from rt_injuries_for_major_surgery</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                    <span class="c1"># include the new code in rt_injuries_for_major_surgery</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">injuries_to_be_treated</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">])</span>

                <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>

                <span class="c1"># schedule the recovery date for the permanent injury for beyond the end of the simulation (making</span>
                <span class="c1"># it permanent)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="c1"># ------------------------------------- Perm disability from SCI -------------------------------------------</span>
            <span class="k">if</span> <span class="s1">&#39;include_spine_surgery&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">:</span>
                <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673&#39;</span><span class="p">,</span> <span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                    <span class="c1"># Track whether they are permanently disabled</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Find the column and code where the permanent injury is stored</span>
                    <span class="n">column</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                                                <span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;@@@@@@@@@@ Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> had intervention for SCI on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> but &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;still disabled!!!!!!&quot;</span><span class="p">)</span>
                    <span class="n">code_to_drop_index</span> <span class="o">=</span> <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                    <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">code_to_drop_index</span><span class="p">)</span>
                    <span class="c1"># remove the code from &#39;rt_injuries_for_major_surgery&#39;</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                    <span class="c1"># update the code for &#39;rt_injuries_for_major_surgery&#39;</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                    <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">injuries_to_be_treated</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">injury</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">injury</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">injuries_to_be_treated</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">])</span>
                    <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>

                    <span class="c1"># schedule the recovery date for the permanent injury for beyond the end of the simulation (making</span>
                    <span class="c1"># it permanent)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># ------------------------------------- Perm disability from amputation ------------------------------------</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;782&#39;</span><span class="p">,</span> <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                <span class="c1"># Track whether they are permanently disabled</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Find the column and code where the permanent injury is stored</span>
                <span class="n">column</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                                            <span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                             <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;@@@@@@@@@@ Person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> had intervention for an amputation on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot; but still disabled!!!!!!&quot;</span><span class="p">)</span>
                <span class="c1"># Update the code to make the injury permanent, so it will not have the associated daly weight removed</span>
                <span class="c1"># later on</span>
                <span class="n">code_to_drop_index</span> <span class="o">=</span> <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                <span class="n">injuries_to_be_treated</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">code_to_drop_index</span><span class="p">)</span>
                <span class="c1"># remove the old code from rt_injuries_for_major_surgery</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                <span class="c1"># add the new code to rt_injuries_for_major_surgery</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span>
                <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">injuries_to_be_treated</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">injury</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">injury</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">injuries_to_be_treated</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">])</span>
                <span class="n">columns</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_all_columns_of_treated_injuries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>
                <span class="c1"># Schedule recovery for the end of the simulation, thereby making the injury permanent</span>

                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># ============================== Schedule the recovery dates for the non-permanent injuries ================</span>
            <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="o">.</span><span class="n">columns</span>
            <span class="n">maj_surg_recovery_time_in_days</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;112&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;552&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                <span class="s1">&#39;553&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                <span class="s1">&#39;554&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                <span class="s1">&#39;822a&#39;</span><span class="p">:</span> <span class="mi">270</span><span class="p">,</span>
                <span class="s1">&#39;811&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="mi">270</span><span class="p">,</span>
                <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
                <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
                <span class="s1">&#39;133a&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;133b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;133c&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;133d&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;134a&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;134b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;135&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;342&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;343&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;414&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>
                <span class="s1">&#39;441&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s1">&#39;443&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s1">&#39;453a&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;453b&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
                <span class="s1">&#39;361&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;363&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;463&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># find the column of the treated injury</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">maj_surg_recovery_time_in_days</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">maj_surg_recovery_time_in_days</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># some injuries have a daly weight that swaps upon treatment, get list of those codes</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
            <span class="c1"># isolate that swapping codes that will be treated here</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">surgically_treated_codes</span><span class="p">]</span>
            <span class="c1"># find the injuries this person will have treated in other forms of treatment</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
            <span class="n">treatment_plan</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># remove codes that will be treated elsewhere</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treatment_plan</span><span class="p">]</span>
            <span class="c1"># swap the daly weight for any applicable injuries</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])</span>
            <span class="c1"># Check that every injury treated has a recovery time</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]),</span> \
                <span class="s1">&#39;no recovery date given for this injury&#39;</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTI_Major_Surgeries supplying surgery for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> on date &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">!!!!!!, removing code&quot;</span><span class="p">)</span>
            <span class="c1"># remove code from major surgeries list</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">],</span> \
                <span class="p">[</span><span class="s1">&#39;Treated injury code not removed&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treated_code</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_do_for_major_surgeries</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                   <span class="n">count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Major_Surgeries.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Major_Surgeries.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Major surgery not scheduled for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">injurycodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;First injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Second injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Third injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fourth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fifth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Sixth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Seventh injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Eight injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Injury profile of person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">injurycodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_RTI_Minor_Surgeries"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Minor_Surgeries">[docs]</a><span class="k">class</span> <span class="nc">HSI_RTI_Minor_Surgeries</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a Health System Interaction Event.</span>
<span class="sd">        An appointment of a person who has experienced a road traffic injury, had their injuries diagnosed through</span>
<span class="sd">        A and E, treatment plan organised by RTI_MedInt and requires minor surgery.</span>

<span class="sd">        Minor surgeries are defined here as surgeries are generally superficial and do not require penetration of a</span>
<span class="sd">        body cavity. They do not involve assisted breathing or anesthesia and are usually performed by a single doctor.</span>

<span class="sd">        The injuries treated in this module are as follows:</span>

<span class="sd">        Evidence for all from Mkandawire et al. 2008:</span>
<span class="sd">        https://link.springer.com/article/10.1007%2Fs11999-008-0366-5</span>
<span class="sd">        &#39;211&#39; - Facial fractures</span>
<span class="sd">        &#39;212&#39; - Facial fractures</span>
<span class="sd">        &#39;291&#39; - Injury to the eye</span>
<span class="sd">        &#39;241&#39; - Soft tissue injury of the face</span>

<span class="sd">        &#39;322&#39; - Dislocation in the neck</span>
<span class="sd">        &#39;323&#39; - Dislocation in the neck</span>

<span class="sd">        &#39;722&#39; - Dislocated shoulder</span>

<span class="sd">        External fixation of fractures</span>
<span class="sd">        &#39;811&#39; - fractured foot</span>
<span class="sd">        &#39;812&#39; - fractures tibia/fibula</span>
<span class="sd">        &#39;813a&#39; - Fractured hip</span>
<span class="sd">        &#39;813b&#39; - Fractured pelvis</span>
<span class="sd">        &#39;813C&#39; - Fractured femur</span>
<span class="sd">        The properties altered in this function are:</span>
<span class="sd">        rt_med_int - update to show this person is being treated for their injuries.</span>
<span class="sd">        rt_date_to_remove_daly - assign recovery dates for the injuries treated with the surgery</span>
<span class="sd">        rt_injuries_for_minor_surgery - to remove codes due to be treated by minor surgery when that injury recieves</span>
<span class="sd">                                        a treatment.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_RTI_Minor_Surgeries.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Minor_Surgeries.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;RTI_Minor_Surgeries&#39;</span>
        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;MinorSurg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This requires major surgery</span>

        <span class="c1"># Define the necessary information for an HSI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_RTI_Minor_Surgeries.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Minor_Surgeries.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">get_item_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>
        <span class="c1"># Request first draft of consumables used in major surgery</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;minor_surgery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># request a local anaesthetic</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Halothane (fluothane)_250ml_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># clean the site of the surgery</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Chlorhexidine 1.5</span><span class="si">% s</span><span class="s2">olution_5_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># tools to begin surgery</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Scalpel blade size 22 (individually wrapped)_100_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer an IV</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Cannula iv  (winged with injection pot) 20_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Giving set iv administration + needle 15 drops/ml_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;ringer&#39;s lactate (Hartmann&#39;s solution), 1000 ml_12_IDA&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># repair incision made</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Suture pack&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Gauze, absorbent 90cm x 40m_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer pain killer</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># administer antibiotic</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Ampicillin injection 500mg, PFR_each_CMST&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># equipment used by surgeon, gloves and facemask</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;surgical face mask, disp., with metal nose piece_50_IDA&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1"># request syringe</span>
            <span class="n">get_item_code</span><span class="p">(</span><span class="s2">&quot;Syringe, Autodisable SoloShot IX &quot;</span><span class="p">):</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span>
        <span class="n">road_traffic_injuries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;RTI&#39;</span><span class="p">]</span>
        <span class="n">surgically_treated_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;322&#39;</span><span class="p">,</span> <span class="s1">&#39;211&#39;</span><span class="p">,</span> <span class="s1">&#39;212&#39;</span><span class="p">,</span> <span class="s1">&#39;323&#39;</span><span class="p">,</span> <span class="s1">&#39;722&#39;</span><span class="p">,</span> <span class="s1">&#39;291&#39;</span><span class="p">,</span> <span class="s1">&#39;241&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;813c&#39;</span><span class="p">]</span>
        <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="c1"># =========================================== Tests ============================================================</span>
        <span class="c1"># check the people sent here hasn&#39;t died due to rti, have had their injuries diagnosed and been through RTI_Med</span>
        <span class="k">assert</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_diagnosed&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through a and e&#39;</span>
        <span class="k">assert</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_med_int&#39;</span><span class="p">],</span> <span class="s1">&#39;This person has not been through rti med int&#39;</span>
        <span class="c1"># check they have at least one injury treated by minor surgery</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_and_count_injuries</span><span class="p">(</span><span class="n">persons_injuries</span><span class="p">,</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># find the injuries which will be treated here</span>
        <span class="n">relevant_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">],</span> <span class="n">surgically_treated_codes</span><span class="p">)</span>
        <span class="c1"># Check that a code has been selected to be treated</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># choose an injury to treat</span>
        <span class="n">treated_code</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">relevant_codes</span><span class="p">)</span>
        <span class="c1"># need to determine whether this person has an injury which will treated with external fixation</span>
        <span class="n">external_fixation_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">treated_code</span> <span class="ow">in</span> <span class="n">external_fixation_codes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;minor_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">get_item_code</span><span class="p">(</span><span class="s1">&#39;External fixator&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="n">request_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_for_consumables_required</span><span class="p">[</span><span class="s1">&#39;minor_surgery&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># todo: think about consequences of certain consumables not being available for minor surgery and model health</span>
        <span class="c1">#  outcomes</span>
        <span class="k">if</span> <span class="n">request_outcome</span><span class="p">:</span>
            <span class="n">injury_columns</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="o">.</span><span class="n">columns</span>
            <span class="c1"># create a dictionary to store the recovery times for each injury in days</span>
            <span class="n">minor_surg_recov_time_days</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;322&#39;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;323&#39;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;722&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
                <span class="s1">&#39;211&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
                <span class="s1">&#39;212&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
                <span class="s1">&#39;291&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;241&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;811&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;812&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;813a&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;813b&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
                <span class="s1">&#39;813c&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># assign a recovery time for the treated person from the dictionary, get the column which the injury is</span>
            <span class="c1"># stored in</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">treated_code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># assign a recovery date</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">minor_surg_recov_time_days</span><span class="p">[</span><span class="n">treated_code</span><span class="p">])</span>
            <span class="c1"># make sure the injury recovery date is in the future</span>
            <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>

            <span class="c1"># some injuries have a change in daly weight if they are treated, find all possible swappable codes</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="n">RTI</span><span class="o">.</span><span class="n">SWAPPING_CODES</span><span class="p">[:]</span>
            <span class="c1"># exclude any codes that could be swapped but are due to be treated elsewhere</span>
            <span class="n">treatment_plan</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">swapping_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">swapping_codes</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">treatment_plan</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">treated_code</span> <span class="ow">in</span> <span class="n">swapping_codes</span><span class="p">:</span>
                <span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_swap_injury_daly_upon_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">treated_code</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTI_Minor_Surgeries supplying minor surgeries for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> on date &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">!!!!!!&quot;</span><span class="p">)</span>
            <span class="c1"># update the dataframe to reflect that this person is recieving medical care</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_med_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Check if the injury has been given a recovery date</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">injury_columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">road_traffic_injuries</span><span class="o">.</span><span class="n">rti_find_injury_column</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="p">[</span><span class="n">treated_code</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="n">columns</span><span class="p">]),</span> \
                <span class="s1">&#39;no recovery date given for this injury&#39;</span>
            <span class="c1"># remove code from minor surgeries list as it has now been treated</span>
            <span class="k">if</span> <span class="n">treated_code</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">treated_code</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">treated_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">],</span> \
                <span class="p">[</span><span class="s1">&#39;Injury treated not removed&#39;</span><span class="p">,</span> <span class="n">treated_code</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rti_do_for_minor_surgeries</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_death_no_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTI_Minor_Surgeries failing to provide minor surgeries for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;on date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">!!!!!!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hs</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>

<div class="viewcode-block" id="HSI_RTI_Minor_Surgeries.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.HSI_RTI_Minor_Surgeries.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Minor surgery not scheduled for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">injurycodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;First injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Second injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Third injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fourth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Fifth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Sixth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Seventh injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;Eight injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_injury_profile_of_untreated_person&#39;</span><span class="p">,</span>
                     <span class="n">data</span><span class="o">=</span><span class="n">injurycodes</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RTI_Medical_Intervention_Death_Event"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Medical_Intervention_Death_Event">[docs]</a><span class="k">class</span> <span class="nc">RTI_Medical_Intervention_Death_Event</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the MedicalInterventionDeathEvent. It is scheduled by the MedicalInterventionEvent to occur at the end of</span>
<span class="sd">     the person&#39;s determined length of stay. The risk of mortality for the person wil medical intervention is determined</span>
<span class="sd">     by the persons ISS score and whether they have polytrauma.</span>

<span class="sd">     The properties altered by this event are:</span>
<span class="sd">     rt_post_med_death - updated to reflect when a person dies from their injuries</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTI_Medical_Intervention_Death_Event.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Medical_Intervention_Death_Event.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_less_than_9</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_iss_less_than_9&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_10_15</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_iss_10_15&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_16_24</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_iss_16_24&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_25_35</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_iss_25_35&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_35_plus</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_iss_35_plus&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RTI_Medical_Intervention_Death_Event.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Medical_Intervention_Death_Event.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">randfordeath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># ======================================== Tests ==============================================================</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_ISS_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">mortality_checked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">probabilities_of_death</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1-4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;5-9&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_less_than_9</span><span class="p">],</span>
            <span class="s1">&#39;10-15&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_10_15</span><span class="p">],</span>
            <span class="s1">&#39;16-24&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_16_24</span><span class="p">],</span>
            <span class="s1">&#39;25-35&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_25_35</span><span class="p">],</span>
            <span class="s1">&#39;35-75&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">76</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_iss_35_plus</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># Schedule death for those who died from their injuries despite medical intervention</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;cause_of_death&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">range_boundaries</span> <span class="ow">in</span> <span class="n">probabilities_of_death</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span><span class="o">.</span><span class="n">rt_ISS_score</span> <span class="ow">in</span> <span class="n">probabilities_of_death</span><span class="p">[</span><span class="n">range_boundaries</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">randfordeath</span> <span class="o">&lt;</span> <span class="n">probabilities_of_death</span><span class="p">[</span><span class="n">range_boundaries</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">mortality_checked</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_post_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span>
                                      <span class="s1">&#39;First injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_1&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Second injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_2&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Third injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_3&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Fourth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_4&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Fifth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_5&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Sixth injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_6&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Seventh injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_7&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;Eight injury&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injury_8&#39;</span><span class="p">]}</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;RTI_Death_Injury_Profile&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The injury profile of those who have died due to rtis despite medical care&#39;</span>
                                <span class="p">)</span>
                    <span class="c1"># Schedule the death</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;RTI_death_with_med&quot;</span><span class="p">,</span>
                                                            <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
                    <span class="c1"># Log the death</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                                 <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTIMedicalInterventionDeathEvent scheduling a death for person &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> who was treated for their injuries but still died on date &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mortality_checked</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">assert</span> <span class="n">mortality_checked</span><span class="p">,</span> <span class="s1">&#39;Something missing in criteria&#39;</span></div></div>


<div class="viewcode-block" id="RTI_No_Lifesaving_Medical_Intervention_Death_Event"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_No_Lifesaving_Medical_Intervention_Death_Event">[docs]</a><span class="k">class</span> <span class="nc">RTI_No_Lifesaving_Medical_Intervention_Death_Event</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the NoMedicalInterventionDeathEvent. It is scheduled by the MedicalInterventionEvent which determines the</span>
<span class="sd">    resources required to treat that person and if they aren&#39;t present, the person is sent here. This function is also</span>
<span class="sd">    called by the did not run function for rti_major_surgeries for certain injuries, implying that if life saving</span>
<span class="sd">    surgery is not available for the person, then we have to ask the probability of them dying without having this life</span>
<span class="sd">    saving surgery.</span>

<span class="sd">    some information on time to craniotomy here:</span>
<span class="sd">    https://thejns.org/focus/view/journals/neurosurg-focus/45/6/article-pE2.xml?body=pdf-10653</span>


<span class="sd">    The properties altered by this event are:</span>
<span class="sd">    rt_unavailable_med_death - to denote that this person has died due to medical interventions not being available</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RTI_No_Lifesaving_Medical_Intervention_Death_Event.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_No_Lifesaving_Medical_Intervention_Death_Event.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># load the parameteres used for this event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_TBI_SCI_no_treatment</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_TBI_SCI_no_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_fractures_no_treatment</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_fractures_no_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop_death_burns_no_treatment</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prop_death_burns_no_treatment&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS3&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS4</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS4&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS5</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS5&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS6</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;prob_death_MAIS6&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;allowed_interventions&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RTI_No_Lifesaving_Medical_Intervention_Death_Event.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_No_Lifesaving_Medical_Intervention_Death_Event.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="n">probabilities_of_death</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS3</span><span class="p">,</span>
            <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS4</span><span class="p">,</span>
            <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS5</span><span class="p">,</span>
            <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob_death_MAIS6</span>
        <span class="p">}</span>
        <span class="n">life_threatening_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">,</span>  <span class="c1"># TBI</span>
                                     <span class="s1">&#39;112&#39;</span><span class="p">,</span>  <span class="c1"># Depressed skull fracture</span>
                                     <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span> <span class="s1">&#39;P135&#39;</span><span class="p">,</span>  <span class="c1"># Perm TBI</span>
                                     <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span>  <span class="c1"># Injuries to neck</span>
                                     <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span>  <span class="c1"># Severe chest trauma</span>
                                     <span class="s1">&#39;782b&#39;</span><span class="p">,</span>  <span class="c1"># Unilateral arm amputation</span>
                                     <span class="s1">&#39;783&#39;</span><span class="p">,</span>  <span class="c1"># Bilateral arm amputation</span>
                                     <span class="s1">&#39;883&#39;</span><span class="p">,</span>  <span class="c1"># Unilateral lower limb amputation</span>
                                     <span class="s1">&#39;884&#39;</span><span class="p">,</span>  <span class="c1"># Bilateral lower limb amputation</span>
                                     <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span>  <span class="c1"># Internal organ injuries</span>
                                     <span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">untreated_injuries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">persons_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">person_id</span><span class="p">],</span> <span class="n">RTI</span><span class="o">.</span><span class="n">INJURY_COLUMNS</span><span class="p">]</span>
        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">persons_injuries</span><span class="p">[</span><span class="n">persons_injuries</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">]</span>
        <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># drop injuries that have a treatment scheduled</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">treatment_plan</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_minor_surgery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_cast&#39;</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_to_heal_with_time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">person</span><span class="p">[</span><span class="s1">&#39;rt_injuries_for_open_fracture_treatment&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">maj_surg_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;112&#39;</span><span class="p">,</span> <span class="s1">&#39;811&#39;</span><span class="p">,</span> <span class="s1">&#39;812&#39;</span><span class="p">,</span> <span class="s1">&#39;813a&#39;</span><span class="p">,</span> <span class="s1">&#39;813b&#39;</span><span class="p">,</span> <span class="s1">&#39;813c&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;135&#39;</span><span class="p">,</span> <span class="s1">&#39;552&#39;</span><span class="p">,</span> <span class="s1">&#39;553&#39;</span><span class="p">,</span> <span class="s1">&#39;554&#39;</span><span class="p">,</span> <span class="s1">&#39;342&#39;</span><span class="p">,</span> <span class="s1">&#39;343&#39;</span><span class="p">,</span> <span class="s1">&#39;414&#39;</span><span class="p">,</span> <span class="s1">&#39;361&#39;</span><span class="p">,</span> <span class="s1">&#39;363&#39;</span><span class="p">,</span> <span class="s1">&#39;782&#39;</span><span class="p">,</span> <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;822a&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">,</span> <span class="s1">&#39;P133a&#39;</span><span class="p">,</span> <span class="s1">&#39;P133b&#39;</span><span class="p">,</span> <span class="s1">&#39;P133c&#39;</span><span class="p">,</span> <span class="s1">&#39;P133d&#39;</span><span class="p">,</span> <span class="s1">&#39;P134a&#39;</span><span class="p">,</span> <span class="s1">&#39;P134b&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;P135&#39;</span><span class="p">,</span> <span class="s1">&#39;P782a&#39;</span><span class="p">,</span> <span class="s1">&#39;P782b&#39;</span><span class="p">,</span> <span class="s1">&#39;P782c&#39;</span><span class="p">,</span> <span class="s1">&#39;P783&#39;</span><span class="p">,</span> <span class="s1">&#39;P882&#39;</span><span class="p">,</span> <span class="s1">&#39;P883&#39;</span><span class="p">,</span> <span class="s1">&#39;P884&#39;</span><span class="p">]</span>
        <span class="c1"># If we have allowed spinal cord surgeries to be treated in this simulation, include the associated injury</span>
        <span class="c1"># codes here</span>
        <span class="k">if</span> <span class="s1">&#39;include_spine_surgery&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">:</span>
            <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span> <span class="s1">&#39;P673a&#39;</span><span class="p">,</span> <span class="s1">&#39;P673b&#39;</span><span class="p">,</span> <span class="s1">&#39;P674&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;P674a&#39;</span><span class="p">,</span> <span class="s1">&#39;P674b&#39;</span><span class="p">,</span> <span class="s1">&#39;P675&#39;</span><span class="p">,</span> <span class="s1">&#39;P675a&#39;</span><span class="p">,</span> <span class="s1">&#39;P675b&#39;</span><span class="p">,</span> <span class="s1">&#39;P676&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">additional_codes</span><span class="p">:</span>
                <span class="n">maj_surg_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="c1"># If we have allowed greater access to thoroscopy, include the codes treated by thoroscopy here</span>
        <span class="k">if</span> <span class="s1">&#39;include_thoroscopy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_interventions</span><span class="p">:</span>
            <span class="n">additional_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;441&#39;</span><span class="p">,</span> <span class="s1">&#39;443&#39;</span><span class="p">,</span> <span class="s1">&#39;453&#39;</span><span class="p">,</span> <span class="s1">&#39;453a&#39;</span><span class="p">,</span> <span class="s1">&#39;453b&#39;</span><span class="p">,</span> <span class="s1">&#39;463&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">additional_codes</span><span class="p">:</span>
                <span class="n">maj_surg_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_empty_injuries</span><span class="p">:</span>
            <span class="c1"># create the conditions to ignore untreated injuries</span>
            <span class="n">injury_treated_elsewhere</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">treatment_plan</span>
            <span class="n">injury_not_treated_by_major_surgery</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">maj_surg_codes</span>
            <span class="n">condition_to_remove_column</span> <span class="o">=</span> <span class="n">injury_treated_elsewhere</span> <span class="ow">or</span> <span class="n">injury_not_treated_by_major_surgery</span>
            <span class="k">if</span> <span class="n">condition_to_remove_column</span><span class="p">:</span>
                <span class="n">non_empty_injuries</span> <span class="o">=</span> <span class="n">non_empty_injuries</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">non_empty_injuries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">untreated_injuries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span>
        <span class="n">untreated_injuries</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">untreated_injuries</span> <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">life_threatening_injuries</span><span class="p">]</span>
        <span class="n">mais_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">untreated_injuries</span><span class="p">:</span>
            <span class="n">mais_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ASSIGN_INJURIES_AND_DALY_CHANGES</span><span class="p">[</span><span class="n">injury</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">max_untreated_injury</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mais_scores</span><span class="p">)</span>
        <span class="n">prob_death</span> <span class="o">=</span> <span class="n">probabilities_of_death</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">max_untreated_injury</span><span class="p">)]</span>

        <span class="n">randfordeath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">randfordeath</span> <span class="o">&lt;</span> <span class="n">prob_death</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_unavailable_med_death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Demography&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_death</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s2">&quot;RTI_unavailable_med&quot;</span><span class="p">,</span>
                                                    <span class="n">originating_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
            <span class="c1"># Log the death</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_general_message&#39;</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;This is RTINoMedicalInterventionDeathEvent scheduling a death for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2"> on&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot; date </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># person has survived their injuries despite the lack of treatment. Assign a recovery date to their injuries</span>
            <span class="c1"># If a spinal injury, amputation, TBI is untreated, assign this injury&#39;s recovery time to the end of the</span>
            <span class="c1"># simulation</span>
            <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;673&#39;</span><span class="p">,</span> <span class="s1">&#39;673a&#39;</span><span class="p">,</span> <span class="s1">&#39;673b&#39;</span><span class="p">,</span> <span class="s1">&#39;674&#39;</span><span class="p">,</span> <span class="s1">&#39;674a&#39;</span><span class="p">,</span> <span class="s1">&#39;674b&#39;</span><span class="p">,</span> <span class="s1">&#39;675&#39;</span><span class="p">,</span> <span class="s1">&#39;675a&#39;</span><span class="p">,</span> <span class="s1">&#39;675b&#39;</span><span class="p">,</span> <span class="s1">&#39;676&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;782a&#39;</span><span class="p">,</span> <span class="s1">&#39;782b&#39;</span><span class="p">,</span> <span class="s1">&#39;782c&#39;</span><span class="p">,</span> <span class="s1">&#39;783&#39;</span><span class="p">,</span> <span class="s1">&#39;882&#39;</span><span class="p">,</span> <span class="s1">&#39;883&#39;</span><span class="p">,</span> <span class="s1">&#39;884&#39;</span><span class="p">,</span> <span class="s1">&#39;133&#39;</span><span class="p">,</span> <span class="s1">&#39;133a&#39;</span><span class="p">,</span> <span class="s1">&#39;133b&#39;</span><span class="p">,</span> <span class="s1">&#39;133c&#39;</span><span class="p">,</span> <span class="s1">&#39;133d&#39;</span><span class="p">,</span> <span class="s1">&#39;134&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;134a&#39;</span><span class="p">,</span> <span class="s1">&#39;134b&#39;</span><span class="p">,</span> <span class="s1">&#39;135&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">untreated_injuries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                    <span class="c1"># Track whether they are permanently disabled</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_perm_disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Find the column and code where the permanent injury is stored</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span> <span class="o">+</span> <span class="n">injury</span>
                    <span class="c1"># schedule the recovery date for the permanent injury for beyond the end of the simulation (making</span>
                    <span class="c1"># it permanent)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span>
                    <span class="c1"># all injuries are handled by major surgery here, remove the untreated injury code</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">injury</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># check if the injury has a heal time associated with no treamtent</span>
                    <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_date_to_remove_daly&#39;</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">end_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">NO_TREATMENT_RECOVERY_TIMES_IN_DAYS</span><span class="p">[</span><span class="n">injury</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">injury</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]:</span>
                            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;rt_injuries_for_major_surgery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">injury</span><span class="p">)</span></div></div>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   LOGGING EVENTS</span>
<span class="c1">#</span>
<span class="c1">#   Put the logging events here. There should be a regular logger outputting current states of the</span>
<span class="c1">#   population. There may also be a loggig event that is driven by particular events.</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="RTI_Logging_Event"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Logging_Event">[docs]</a><span class="k">class</span> <span class="nc">RTI_Logging_Event</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>

<div class="viewcode-block" id="RTI_Logging_Event.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Logging_Event.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Produce a summary of the numbers of people with respect to the action of this module.</span>
<span class="sd">        This is a regular event that can output current states of people or cumulative events since last logging event.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># run this event every month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">RTI</span><span class="p">)</span>
        <span class="c1"># Create variables used to store simulation data in</span>
        <span class="c1"># Number of injured body region data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot1inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot2inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot3inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot4inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot5inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot6inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot7inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot8inj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Injury category data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totfracnumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totdisnumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tottbi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totsoft</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totintorg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totintbled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totsci</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totamp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toteye</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totextlac</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totburns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Injury location on body data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS3</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS4</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS5</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS6</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS7</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totAIS8</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Injury severity data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totmild</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totsevere</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># More model progression data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totinjured</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathonscene</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soughtmedcare</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathaftermed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathwithoutmed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permdis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ISSscore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">severe_pain</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moderate_pain</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mild_pain</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Create variables for averages over time in the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_inc_numerator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_in_denominator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fracdenominator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Create variables to measure where certain injuries are located on the body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fracdist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openwounddist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burndist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="RTI_Logging_Event.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.rti.html#tlo.methods.rti.RTI_Logging_Event.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="c1"># Make some summary statistics</span>
        <span class="c1"># Get the dataframe and isolate the important information</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="c1"># dump dataframe each month if population size is large (used to find the minimum viable population size)</span>
        <span class="n">time_stamped_file_name</span> <span class="o">=</span> <span class="s2">&quot;df_at_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">750000</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C:/Users/Robbie Manning Smith/Documents/Dataframe_dump/</span><span class="si">{</span><span class="n">time_stamped_file_name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
        <span class="n">thoseininjuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span><span class="p">]</span>
        <span class="c1"># ================================= Injury severity ===========================================================</span>
        <span class="n">sev</span> <span class="o">=</span> <span class="n">thoseininjuries</span><span class="p">[</span><span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span>
        <span class="n">rural_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">li_urban</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rural_injuries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent_sev_rural</span> <span class="o">=</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">rural_injuries</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rural_injuries</span><span class="p">[</span><span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">rural_injuries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percent_sev_rural</span> <span class="o">=</span> <span class="s1">&#39;none_injured&#39;</span>
        <span class="n">urban_injuries</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">li_urban</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urban_injuries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent_sev_urban</span> <span class="o">=</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">urban_injuries</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">urban_injuries</span><span class="p">[</span><span class="s1">&#39;rt_inj_severity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">urban_injuries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percent_sev_urban</span> <span class="o">=</span> <span class="s1">&#39;none_injured&#39;</span>
        <span class="n">severity</span><span class="p">,</span> <span class="n">severitycount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sev</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;mild&#39;</span> <span class="ow">in</span> <span class="n">severity</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;mild&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totmild</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;severe&#39;</span> <span class="ow">in</span> <span class="n">severity</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totsevere</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_mild_injuries&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">totmild</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span>
            <span class="s1">&#39;_severe_injuries&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">totsevere</span><span class="p">,</span>
            <span class="s1">&#39;Percent_severe_rural&#39;</span><span class="p">:</span> <span class="n">percent_sev_rural</span><span class="p">,</span>
            <span class="s1">&#39;Percent_severe_urban&#39;</span><span class="p">:</span> <span class="n">percent_sev_urban</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;injury_severity&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;severity of injuries in simulation&#39;</span><span class="p">)</span>
        <span class="c1"># ==================================== Incidence ==============================================================</span>
        <span class="c1"># How many were involved in a RTI</span>
        <span class="n">n_in_RTI</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">children_in_RTI</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">19</span><span class="p">)])</span>
        <span class="n">children_alive</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">19</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">+=</span> <span class="n">n_in_RTI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totinjured</span> <span class="o">+=</span> <span class="n">n_in_RTI</span>
        <span class="c1"># How many were disabled</span>
        <span class="n">n_perm_disabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_perm_disability</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># self.permdis += n_perm_disabled</span>
        <span class="n">n_alive</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span> <span class="o">+=</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">n_in_RTI</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">n_immediate_death</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathonscene</span> <span class="o">+=</span> <span class="n">n_immediate_death</span>
        <span class="n">diedfromrtiidx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_death_from_shock</span> <span class="o">|</span>
                                  <span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">]</span>
        <span class="n">n_sought_care</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_med_int</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soughtmedcare</span> <span class="o">+=</span> <span class="n">n_sought_care</span>
        <span class="n">n_death_post_med</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathaftermed</span> <span class="o">+=</span> <span class="n">n_death_post_med</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deathwithoutmed</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_inc_numerator</span> <span class="o">+=</span> <span class="n">n_immediate_death</span> <span class="o">+</span> <span class="n">n_death_post_med</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">death_in_denominator</span> <span class="o">+=</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_immediate_death</span> <span class="o">+</span> <span class="n">n_death_post_med</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">])</span>
                                                 <span class="p">))</span> <span class="o">*</span> \
                                     <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent_accidents_result_in_death</span> <span class="o">=</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deathonscene</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deathaftermed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deathwithoutmed</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">numerator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percent_accidents_result_in_death</span> <span class="o">=</span> <span class="s1">&#39;none injured&#39;</span>
        <span class="n">maleinrti</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">)])</span>
        <span class="n">femaleinrti</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)])</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">maleinrti</span><span class="p">,</span> <span class="n">femaleinrti</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">divider</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maleinrti</span> <span class="o">=</span> <span class="n">maleinrti</span> <span class="o">/</span> <span class="n">divider</span>
            <span class="n">femaleinrti</span> <span class="o">=</span> <span class="n">femaleinrti</span> <span class="o">/</span> <span class="n">divider</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maleinrti</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">femaleinrti</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mfratio</span> <span class="o">=</span> <span class="p">[</span><span class="n">maleinrti</span><span class="p">,</span> <span class="n">femaleinrti</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_in_RTI</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent_sought_care</span> <span class="o">=</span> <span class="n">n_sought_care</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_in_RTI</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percent_sought_care</span> <span class="o">=</span> <span class="s1">&#39;none_injured&#39;</span>

        <span class="k">if</span> <span class="n">n_sought_care</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percent_died_post_care</span> <span class="o">=</span> <span class="n">n_death_post_med</span> <span class="o">/</span> <span class="n">n_sought_care</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percent_died_post_care</span> <span class="o">=</span> <span class="s1">&#39;none_injured&#39;</span>

        <span class="k">if</span> <span class="n">n_sought_care</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percentage_admitted_to_ICU_or_HDU</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_med_int</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_in_icu_or_hdu</span><span class="p">])</span> <span class="o">/</span> <span class="n">n_sought_care</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">percentage_admitted_to_ICU_or_HDU</span> <span class="o">=</span> <span class="s1">&#39;none_injured&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">n_in_RTI</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_rti</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_in_RTI</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="n">n_in_RTI</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_rti</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">children_alive</span> <span class="o">-</span> <span class="n">children_in_RTI</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_rti_in_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">children_in_RTI</span> <span class="o">/</span> <span class="p">((</span><span class="n">children_alive</span> <span class="o">-</span> <span class="n">children_in_RTI</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_rti_in_children</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">diedfromrtiidx</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_rti_death</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diedfromrtiidx</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">diedfromrtiidx</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_rti_death</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_post_med_death</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span><span class="p">])</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_post_med_death</span><span class="p">]))</span> <span class="o">*</span>
                                                                       <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_post_med_death</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_imm_death</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">])</span> <span class="o">/</span> <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> \
                            <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_imm_death</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_death_no_med</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">])</span> <span class="o">/</span>
                                <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_death_no_med</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_death_unavailable_med</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">])</span> <span class="o">/</span>
                                         <span class="p">((</span><span class="n">n_alive</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_death_unavailable_med</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fracdenominator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frac_incidence</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totfracnumber</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fracdenominator</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frac_incidence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># calculate case fatality ratio for those injured who don&#39;t seek healthcare</span>
        <span class="n">did_not_seek_healthcare</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_med_int</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_diagnosed</span><span class="p">])</span>
        <span class="n">died_no_healthcare</span> <span class="o">=</span> \
            <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_med_int</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">rt_diagnosed</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">did_not_seek_healthcare</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cfr_no_med</span> <span class="o">=</span> <span class="n">died_no_healthcare</span> <span class="o">/</span> <span class="n">did_not_seek_healthcare</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfr_no_med</span> <span class="o">=</span> <span class="s1">&#39;all_sought_care&#39;</span>
        <span class="c1"># calculate incidence rate per 100,000 of deaths on scene</span>
        <span class="k">if</span> <span class="n">n_alive</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">inc_death_on_scene</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_imm_death</span><span class="p">])</span> <span class="o">/</span> <span class="n">n_alive</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inc_death_on_scene</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;number involved in a rti&#39;</span><span class="p">:</span> <span class="n">n_in_RTI</span><span class="p">,</span>
            <span class="s1">&#39;incidence of rti per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_rti</span><span class="p">,</span>
            <span class="s1">&#39;incidence of rti per 100,000 in children&#39;</span><span class="p">:</span> <span class="n">inc_rti_in_children</span><span class="p">,</span>
            <span class="s1">&#39;incidence of rti death per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_rti_death</span><span class="p">,</span>
            <span class="s1">&#39;incidence of death post med per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_post_med_death</span><span class="p">,</span>
            <span class="s1">&#39;incidence of prehospital death per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_imm_death</span><span class="p">,</span>
            <span class="s1">&#39;incidence of death on scene per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_death_on_scene</span><span class="p">,</span>
            <span class="s1">&#39;incidence of death without med per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_death_no_med</span><span class="p">,</span>
            <span class="s1">&#39;incidence of death due to unavailable med per 100,000&#39;</span><span class="p">:</span> <span class="n">inc_death_unavailable_med</span><span class="p">,</span>
            <span class="s1">&#39;incidence of fractures per 100,000&#39;</span><span class="p">:</span> <span class="n">frac_incidence</span><span class="p">,</span>
            <span class="s1">&#39;number alive&#39;</span><span class="p">:</span> <span class="n">n_alive</span><span class="p">,</span>
            <span class="s1">&#39;number immediate deaths&#39;</span><span class="p">:</span> <span class="n">n_immediate_death</span><span class="p">,</span>
            <span class="s1">&#39;number deaths post med&#39;</span><span class="p">:</span> <span class="n">n_death_post_med</span><span class="p">,</span>
            <span class="s1">&#39;number deaths without med&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_no_med_death</span><span class="p">]),</span>
            <span class="s1">&#39;number deaths unavailable med&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_unavailable_med_death</span><span class="p">]),</span>
            <span class="s1">&#39;number rti deaths&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">diedfromrtiidx</span><span class="p">),</span>
            <span class="s1">&#39;number permanently disabled&#39;</span><span class="p">:</span> <span class="n">n_perm_disabled</span><span class="p">,</span>
            <span class="s1">&#39;percent of crashes that are fatal&#39;</span><span class="p">:</span> <span class="n">percent_accidents_result_in_death</span><span class="p">,</span>
            <span class="s1">&#39;male:female ratio&#39;</span><span class="p">:</span> <span class="n">mfratio</span><span class="p">,</span>
            <span class="s1">&#39;percent sought healthcare&#39;</span><span class="p">:</span> <span class="n">percent_sought_care</span><span class="p">,</span>
            <span class="s1">&#39;percentage died after med&#39;</span><span class="p">:</span> <span class="n">percent_died_post_care</span><span class="p">,</span>
            <span class="s1">&#39;percent admitted to ICU or HDU&#39;</span><span class="p">:</span> <span class="n">percentage_admitted_to_ICU_or_HDU</span><span class="p">,</span>
            <span class="s1">&#39;cfr_no_med&#39;</span><span class="p">:</span> <span class="n">cfr_no_med</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;summary_1m&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Summary of the rti injuries in the last month&#39;</span><span class="p">)</span>
        <span class="c1"># =========================== Get population demographics of those with RTIs ==================================</span>
        <span class="n">columnsOfInterest</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">,</span> <span class="s1">&#39;li_ex_alc&#39;</span><span class="p">]</span>
        <span class="n">injuredDemographics</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">rt_road_traffic_inc</span><span class="p">]</span>

        <span class="n">injuredDemographics</span> <span class="o">=</span> <span class="n">injuredDemographics</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columnsOfInterest</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">percent_related_to_alcohol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">injuredDemographics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injuredDemographics</span><span class="o">.</span><span class="n">li_ex_alc</span><span class="p">])</span> <span class="o">/</span> \
                                         <span class="nb">len</span><span class="p">(</span><span class="n">injuredDemographics</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">percent_related_to_alcohol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">injured_demography_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;males_in_rti&#39;</span><span class="p">:</span> <span class="n">injuredDemographics</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span>
            <span class="s1">&#39;females_in_rti&#39;</span><span class="p">:</span> <span class="n">injuredDemographics</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="s1">&#39;F&#39;</span><span class="p">],</span>
            <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">injuredDemographics</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;male_age&#39;</span><span class="p">:</span> <span class="n">injuredDemographics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injuredDemographics</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;female_age&#39;</span><span class="p">:</span> <span class="n">injuredDemographics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">injuredDemographics</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;percent_related_to_alcohol&#39;</span><span class="p">:</span> <span class="n">percent_related_to_alcohol</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rti_demography&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">injured_demography_summary</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Demographics of those in rti&#39;</span><span class="p">)</span>

        <span class="c1"># =================================== Flows through the model ==================================================</span>
        <span class="n">dict_to_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total_injured&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">totinjured</span><span class="p">,</span>
                          <span class="s1">&#39;total_died_on_scene&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deathonscene</span><span class="p">,</span>
                          <span class="s1">&#39;total_sought_medical_care&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">soughtmedcare</span><span class="p">,</span>
                          <span class="s1">&#39;total_died_after_medical_intervention&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deathaftermed</span><span class="p">,</span>
                          <span class="s1">&#39;total_permanently_disabled&#39;</span><span class="p">:</span> <span class="n">n_perm_disabled</span><span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;model_progression&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dict_to_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Flows through the rti module&#39;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Feb 16, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>