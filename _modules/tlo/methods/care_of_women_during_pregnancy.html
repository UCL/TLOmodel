

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.methods.care_of_women_during_pregnancy &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../methods.html">tlo.methods</a> &raquo;</li>
        
      <li>tlo.methods.care_of_women_during_pregnancy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.methods.care_of_women_during_pregnancy</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="c1"># from tlo.methods.tb import HSI_TbScreening</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hiv</span> <span class="kn">import</span> <span class="n">HSI_Hiv_TestAndRefer</span>
<span class="kn">from</span> <span class="nn">tlo.methods.labour</span> <span class="kn">import</span> <span class="n">LabourOnsetEvent</span>
<span class="kn">from</span> <span class="nn">tlo.util</span> <span class="kn">import</span> <span class="n">BitsetHandler</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy">[docs]</a><span class="k">class</span> <span class="nc">CareOfWomenDuringPregnancy</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the CareOfWomenDuringPregnancy module which contains health system interaction events relevant to</span>
<span class="sd">     pregnancy and pregnancy loss including:</span>

<span class="sd">     1.) HSI_CareOfWomenDuringPregnancy_AntenatalCareContact (1-8) representing all 8 routine antenatal care contacts</span>
<span class="sd">        (ANC) recommended during pregnancy (with sequential scheduling of each event occurring within the HSI)</span>

<span class="sd">     2.) HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement representing treatment for complications following</span>
<span class="sd">         abortion (post abortion care of PAC) for women seeking care from the community</span>

<span class="sd">     3.) HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy representing treatment for ectopic pregnancy for</span>
<span class="sd">         women seeking care from the community</span>

<span class="sd">     4.) HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare which represents antenatal inpatient care for women</span>
<span class="sd">         who require admission following complications of pregnancy, detected via ANC or following care seeking from the</span>
<span class="sd">         community including treatment and/or referral for (hypertension, diabetes, antepartum haemorrhage, anaemia,</span>
<span class="sd">         premature of membranes, chorioamnionitis)</span>

<span class="sd">    Additionally the module stores a number of HSIs which represent follow up for women who are scheduled for additional</span>
<span class="sd">    testing following an admission and initiation of treatment (i.e. anaemia or gestational diabetes). Individual</span>
<span class="sd">    interventions are stored as functions within the module to prevent repetition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># This dictionary is used to track the frequency of certain events in the module which are processed by the</span>
        <span class="c1"># logging event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anc_tracker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;prob_anc_continues&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will return for a subsequent ANC appointment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_an_ip_at_facility_level_1_2_3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that antenatal inpatient care will be scheduled at facility level 1, 2 or 3&#39;</span><span class="p">),</span>
        <span class="s1">&#39;squeeze_factor_threshold_anc&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;squeeze factor threshold over which an ANC appointment cannot run&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_urine_ds&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;urine dipstick&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_bp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;blood pressure measurement&quot; given that the &#39;</span>
                        <span class="s1">&#39;HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_ifa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;iron and folic acid&quot; given that the HSI&#39;</span>
                        <span class="s1">&#39; has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_bep&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;Balance energy and protein supplements&quot; &#39;</span>
                        <span class="s1">&#39;given that the HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_depression_screen&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;depression screen&quot; &#39;</span>
                        <span class="s1">&#39;given that the HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_llitn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;Long lasting insecticide treated net&quot; &#39;</span>
                        <span class="s1">&#39;given that the HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_tb_screen&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;TB screen&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_tt&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;tetanus toxoid&quot; given that the HSI has &#39;</span>
                        <span class="s1">&#39;ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_calcium&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;urine dipstick&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_poct&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;point of care Hb testing&quot; given that the &#39;</span>
                        <span class="s1">&#39;HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_albendazole&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;albendazole&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_hepb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;Hepatitis B test&quot; given that the HSI has &#39;</span>
                        <span class="s1">&#39;ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_syph_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;Syphilis test&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_hiv_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;HIV test&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_iptp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;IPTp&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_gdm_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;GDM screening&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_bp_monitoring&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of blood pressure monitoring to detect hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_bp_monitoring&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of blood pressure monitoring to detect hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_urine_protein_1_plus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a urine dipstick test to detect proteinuria at 1+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_urine_protein_1_plus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of a urine dipstick test to detect proteinuria at 1+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_poc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a point of care Hb test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_poc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of a point of care Hb test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_fbc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a Full Blood Count test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_fbc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of a Full Blood Count test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_blood_test_glucose&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a blood test to detect raised blood glucose&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_blood_test_glucose&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;specificity of a blood test to detect raised blood glucose&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of starting iron and folic acid on resolving anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of blood transfusion for anaemia in pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_iron_replacement_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of iron replacement in resolving anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_iron_replacement_for_resolving_iron_def&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of iron replacement in resolving iron deficiency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_folate_replacement_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of folate replacement in resolving anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_folate_replacement_for_resolving_folate_def&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of folate replacement in resolving folate deficiency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_b12_replacement_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of b12 replacement in resolving anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effect_of_b12_replacement_for_resolving_b12_def&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of b12 replacement in resolving b12 deficiency&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_severe_pre_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate severe pre-eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;multiplier_spe_cfr_eclampsia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;cfr multiplier to generate cfr for eclampsia &#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_mag_sulph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness magnesium sulphate on mortality due to severe pre-eclampsia/&#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_iv_anti_htn&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness IV antihypertensives on mortality due to severe pre-eclampsia/&#39;</span>
                        <span class="s1">&#39;eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_still_birth_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a still birth following APH prior to treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_still_birth_spe_ec&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;probability of a still birth following severe pre-eclampsia/eclampsia prior to treatment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;cfr_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;case fatality rate antepartum haemorrhage&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_bt_aph&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;treatment effect of blood transfusion on antepartum haemorrhage mortality &#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_evac_procedure_pac&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probabilities that a woman will receive D&amp;C, MVA or misoprostal as treatment for abortion &#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;rolling total of antenatal visits this woman has &#39;</span>
                                                                     <span class="s1">&#39;attended during her pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Type of facility that a woman will receive ANC in for her &#39;</span>
                                                        <span class="s1">&#39;pregnancy&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;health_centre&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Date on which this woman is scheduled to return for her next &#39;</span>
                                                     <span class="s1">&#39;ANC contact&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman requires admission following an ANC visit&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily iron &amp; folic acid &#39;</span>
                                                             <span class="s1">&#39;supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily balanced energy &#39;</span>
                                                             <span class="s1">&#39;and protein supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily calcium &#39;</span>
                                                                 <span class="s1">&#39;supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Number of doses of intermittent preventative treatment in&#39;</span>
                                                         <span class="s1">&#39; pregnancy received during this pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_itn_provided&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman is provided with an insecticide treated bed net &#39;</span>
                                                <span class="s1">&#39;during the appropriate ANC visit&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_ttd_received&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;Number of doses of tetanus toxoid administered during this pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has been initiated on treatment for &#39;</span>
                                                         <span class="s1">&#39;gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Treatment this woman is receiving for gestational &#39;</span>
                                                                 <span class="s1">&#39;diabetes&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;diet_exercise&#39;</span><span class="p">,</span>
                                                                                         <span class="s1">&#39;orals&#39;</span><span class="p">,</span> <span class="s1">&#39;insulin&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received treatment for an ectopic &#39;</span>
                                                             <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_post_abortion_care_interventions&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;bitset list of interventions delivered to a woman &#39;</span>
                                                                   <span class="s1">&#39;undergoing post abortion care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received antibiotics as treatment for &#39;</span>
                                                         <span class="s1">&#39;premature rupture of membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_received_abx_for_chorioamnionitis&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received antibiotics as &#39;</span>
                                                                     <span class="s1">&#39;treatment for chorioamnionitis rupture of &#39;</span>
                                                                     <span class="s1">&#39;membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received magnesium sulphate for &#39;</span>
                                                       <span class="s1">&#39;treatment of severe pre-eclampsia/eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received intravenous antihypertensive &#39;</span>
                                                         <span class="s1">&#39;drugs for treatment of severe hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_received_blood_transfusion&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received a blood transfusion &#39;</span>
                                                              <span class="s1">&#39;antenatally&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Admission type for women needing urgent &#39;</span>
                                                                          <span class="s1">&#39;delivery in the antenatal period&#39;</span><span class="p">,</span>
                                                       <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;induction_now&#39;</span><span class="p">,</span> <span class="s1">&#39;induction_future&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;caesarean_now&#39;</span><span class="p">,</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.read_parameters"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.read_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_AntenatalCare.xlsx&#39;</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># ==================================== LINEAR MODEL EQUATIONS =================================================</span>
        <span class="c1"># All linear equations used in this module are stored within the ac_linear_equations parameter below</span>

        <span class="c1"># TODO: process of &#39;selection&#39; of important predictors in linear equations is ongoing, a linear model that</span>
        <span class="c1">#  is empty of predictors at the end of this process will be converted to a set probability</span>

        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ac_linear_equations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># This equation is used to determine if a woman will choose to attend the next ANC contact in the routine</span>
            <span class="c1"># schedule</span>
            <span class="s1">&#39;anc_continues&#39;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">(</span>
                <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_anc_continues&#39;</span><span class="p">]),</span>

        <span class="p">}</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initialise_population"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initialise_population">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_itn_provided&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_ttd_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

        <span class="c1"># This property stores the possible interventions a woman can receive during post abortion care</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pac_interventions</span> <span class="o">=</span> <span class="n">BitsetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="s1">&#39;ac_post_abortion_care_interventions&#39;</span><span class="p">,</span>
                                               <span class="p">[</span><span class="s1">&#39;mva&#39;</span><span class="p">,</span> <span class="s1">&#39;d_and_c&#39;</span><span class="p">,</span> <span class="s1">&#39;misoprostol&#39;</span><span class="p">,</span> <span class="s1">&#39;antibiotics&#39;</span><span class="p">,</span> <span class="s1">&#39;blood_products&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;injury_repair&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initialise_simulation"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initialise_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>

        <span class="c1"># We register the logging event and schedule to run each year</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">AntenatalCareLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                           <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Then populate the tracker dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anc_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total_first_anc_visits&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;cumm_ga_at_anc1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;total_anc1_first_trimester&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;anc8+&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;timely_ANC3&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;diet_supp_6_months&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># ==================================== REGISTERING DX_TESTS =================================================</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1"># Next we register the relevant dx_tests used within this module...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>

            <span class="c1"># This test represents measurement of blood pressure used in ANC screening to detect hypertension in</span>
            <span class="c1"># pregnancy</span>
            <span class="n">blood_pressure_measurement</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_bp_monitoring&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_bp_monitoring&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents a urine dipstick which is used to measuring the presence and amount of protein in a</span>
            <span class="c1"># womans urine, proteinuria being indicative of pre-eclampsia/eclampsia</span>
            <span class="n">urine_dipstick_protein</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_urine_protein_1_plus&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_urine_protein_1_plus&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents point of care haemoglobin testing used in ANC to detect anaemia (all-severity)</span>
            <span class="n">point_of_care_hb_test</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_poc_hb_test&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_poc_hb_test&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents laboratory based full blood count testing used in hospitals to determine severity of</span>
            <span class="c1"># anaemia via Hb levels</span>
            <span class="n">full_blood_count_hb</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_fbc_hb_test&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_fbc_hb_test&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents point of care glucose testing used in ANC to detect hyperglycemia, associated with</span>
            <span class="c1"># gestational diabetes</span>
            <span class="n">blood_test_glucose</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">,</span> <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uncontrolled&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_blood_test_glucose&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_blood_test_glucose&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HIV module is not registered in this simulation run and therefore HIV &#39;</span>
                                               <span class="s1">&#39;testing will not happen in antenatal care&#39;</span><span class="p">)</span></div>

    <span class="c1"># This function is used within this and other modules to reset properties from this module when a woman is no longer</span>
    <span class="c1"># pregnant to ensure in future pregnancies properties arent incorrectly set to certain values</span>
<div class="viewcode-block" id="CareOfWomenDuringPregnancy.care_of_women_in_pregnancy_property_reset"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.care_of_women_in_pregnancy_property_reset">[docs]</a>    <span class="k">def</span> <span class="nf">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind_or_df</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="k">if</span> <span class="n">ind_or_df</span> <span class="o">==</span> <span class="s1">&#39;individual&#39;</span><span class="p">:</span>
            <span class="nb">set</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">set</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span>

        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_itn_provided&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_ttd_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">set</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.on_birth"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.on_birth">[docs]</a>    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_itn_provided&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_ttd_received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.further_on_birth_care_of_women_in_pregnancy"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.further_on_birth_care_of_women_in_pregnancy">[docs]</a>    <span class="k">def</span> <span class="nf">further_on_birth_care_of_women_in_pregnancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module. This function contains additional</span>
<span class="sd">        code related to the antenatal care module that should be ran on_birth for all births - it has been parcelled</span>
<span class="sd">        into functions to ensure each modules (pregnancy,antenatal care, labour, newborn, postnatal) on_birth code is</span>
<span class="sd">        ran in the correct sequence (as this can vary depending on how modules are registered)</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1">#  run a check at birth to make sure no women exceed 8 visits</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">9</span>

        <span class="c1"># We log the total number of ANC contacts a woman has undergone at the time of birth via this data frame</span>

        <span class="n">total_anc_visit_count</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                 <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;age_years&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;date_of_delivery&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                 <span class="s1">&#39;total_anc&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_count_on_birth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">total_anc_visit_count</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A dictionary containing the number of ANC visits each woman has on birth&#39;</span><span class="p">)</span>

        <span class="c1"># We then reset all relevant variables pertaining to care received during the antenatal period to avoid</span>
        <span class="c1"># treatments remaining in place for future pregnancies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span><span class="n">ind_or_df</span><span class="o">=</span><span class="s1">&#39;individual&#39;</span><span class="p">,</span> <span class="n">id_or_index</span><span class="o">=</span><span class="n">mother_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.on_hsi_alert"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.on_hsi_alert">[docs]</a>    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is CareOfWomenDuringPregnancy, being alerted about a health system &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;interaction person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="c1">#  ================================ ADDITIONAL ANTENATAL HELPER FUNCTIONS =========================================</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.determine_gestational_age_for_next_contact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.determine_gestational_age_for_next_contact">[docs]</a>    <span class="k">def</span> <span class="nf">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by each of the ANC HSIs to determine the number of weeks before a woman is required to</span>
<span class="sd">        return for her next ANC contact in the schedule</span>
<span class="sd">        :param person_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The recommended ANC schedule (gestational age in weeks at which it is recommended women attend) is</span>
        <span class="c1"># ANC1 - 12wks, ANC2 - 20wks, ANC3 - 26wks, ANC4 - 30wks, ANC5 - 34wks, ANC6 - 36wks, ANC7 - 38wks,</span>
        <span class="c1"># ANC8 - 40 wks</span>

        <span class="c1"># Using a womans gestational age at the time of her current visit, we calculate how many weeks in the future</span>
        <span class="c1"># until she should return for her next visit in the schedule</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="k">elif</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">26</span>

        <span class="k">elif</span> <span class="mi">26</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="k">elif</span> <span class="mi">30</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">34</span>

        <span class="k">elif</span> <span class="mi">34</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">36</span>

        <span class="k">elif</span> <span class="mi">36</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">38</span>

        <span class="k">elif</span> <span class="mi">38</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="c1"># We schedule women who present very late for ANC to return in two weeks</span>
        <span class="k">elif</span> <span class="mi">42</span> <span class="o">&gt;</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">42</span>

        <span class="c1"># Return a gestation beyond the normal length of pregnancy. This wont be used for scheduling because women</span>
        <span class="c1"># arent scheduled ANC past 42 weeks (see next function)</span>
        <span class="c1"># TODO: replace with cleaner fix for next version</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="k">return</span> <span class="n">recommended_gestation_next_anc</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antenatal_care_scheduler"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antenatal_care_scheduler">[docs]</a>    <span class="k">def</span> <span class="nf">antenatal_care_scheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="p">,</span> <span class="n">recommended_gestation_next_anc</span><span class="p">,</span>
                                 <span class="n">facility_level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is responsible for scheduling a womans next ANC contact in the schedule if she chooses to seek</span>
<span class="sd">        care again.  It is called by each of the ANC HSIs.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param visit_to_be_scheduled: Number if next visit in the schedule (2-8)</span>
<span class="sd">        :param recommended_gestation_next_anc: Gestational age in weeks a woman should be for the next visit in her</span>
<span class="sd">        schedule</span>
<span class="sd">        :param facility_level: facility level that the next ANC contact in the schedule will occur at</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Prevent women returning to ANC at very late gestations- this needs to be reviewed and linked with induction</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">42</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We check that women will only be scheduled for the next ANC contact in the schedule</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">recommended_gestation_next_anc</span>

        <span class="c1"># This function houses the code that schedules the next visit, it is abstracted to prevent repetition</span>
        <span class="k">def</span> <span class="nf">set_anc_date</span><span class="p">(</span><span class="n">visit_to_be_scheduled</span><span class="p">):</span>

            <span class="c1"># We store the ANC contacts as variables prior to scheduling. Facility level of the next contact is carried</span>
            <span class="c1"># forward from a womans first ANC contact (we assume she will always seek care within the same facility</span>
            <span class="c1"># level)</span>
            <span class="k">if</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="c1"># If this woman has attended less than 4 visits, and is predicted to attend &gt; 4 (as determined via the</span>
            <span class="c1"># PregnancySupervisor module when ANC1 is scheduled) her subsequent ANC appointment is automatically</span>
            <span class="c1"># scheduled</span>
            <span class="k">if</span> <span class="n">visit_to_be_scheduled</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_will_attend_four_or_more_anc&#39;</span><span class="p">]:</span>

                    <span class="c1"># We subtract this womans current gestational age from the recommended gestational age for the next</span>
                    <span class="c1"># contact</span>
                    <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recommended_gestation_next_anc</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                      <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span>

                    <span class="c1"># And use this value as the number of weeks until she is required to return for her next ANC</span>
                    <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will seek ANC </span><span class="si">{</span><span class="n">visit_to_be_scheduled</span><span class="si">}</span><span class="s1"> &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;contact on </span><span class="si">{</span><span class="n">visit_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="c1"># We store the date of her next visit and use this date as part of a check when the ANC HSIs run</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If she is not predicted to attend 4 or more visits, we use an equation from the linear model to</span>
                    <span class="c1"># determine if she will seek care for her next contact</span>
                    <span class="n">will_anc_continue</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ac_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;anc_continues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span>
                        <span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]</span>

                    <span class="c1"># If so, the HSI is scheduled in the same way</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">will_anc_continue</span><span class="p">:</span>
                        <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recommended_gestation_next_anc</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                          <span class="s1">&#39;ps_gestational_age_in_&#39;</span>
                                                                                          <span class="s1">&#39;weeks&#39;</span><span class="p">])</span>
                        <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will seek ANC &#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">visit_to_be_scheduled</span><span class="si">}</span><span class="s1"> contact on </span><span class="si">{</span><span class="n">visit_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># If additional ANC care is not sought nothing happens</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will not seek any additional &#39;</span>
                                                         <span class="sa">f</span><span class="s1">&#39;antenatal care for this pregnancy&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">visit_to_be_scheduled</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1"># After 4 or more visits we use the linear model equation to determine if the woman will seek care for</span>
                <span class="c1"># her next contact</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> \
                  <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ac_linear_equations&#39;</span><span class="p">][</span><span class="s1">&#39;anc_continues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">individual_id</span><span class="p">]])[</span><span class="n">individual_id</span><span class="p">]:</span>
                    <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recommended_gestation_next_anc</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                      <span class="s1">&#39;ps_gestational_age_in_&#39;</span>
                                                                                      <span class="s1">&#39;weeks&#39;</span><span class="p">])</span>
                    <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will seek ANC </span><span class="si">{</span><span class="n">visit_to_be_scheduled</span><span class="si">}</span><span class="s1"> &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;contact on </span><span class="si">{</span><span class="n">visit_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will not seek any additional antenatal &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;care for this pregnancy&#39;</span><span class="p">)</span>

        <span class="c1"># We run the function to schedule the HSI</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">visit_to_be_scheduled</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">set_anc_date</span><span class="p">(</span><span class="n">visit_to_be_scheduled</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.schedule_admission"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.schedule_admission">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_admission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called within each of the ANC HSIs for women who require admission due to a complication</span>
<span class="sd">        detected during ANC</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Use a weighted random draw to determine which level of facility the woman will be admitted too</span>
        <span class="c1"># facility_level = int(self.rng.choice([1, 2, 3], p=params[&#39;prob_an_ip_at_facility_level_1_2_3&#39;]))</span>
        <span class="n">facility_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>

        <span class="c1"># Schedule the HSI</span>
        <span class="n">inpatient</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span>
            <span class="n">facility_level_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">inpatient</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                            <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                            <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> will be admitted to antenatal ward after a complication &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;was detected in routine ANC&#39;</span><span class="p">)</span>

        <span class="c1"># Reset the variable to prevent future scheduling errors</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># ================================= INTERVENTIONS DELIVERED DURING ANC ============================================</span>
    <span class="c1"># The following functions contain the interventions that are delivered as part of routine ANC contacts. Functions</span>
    <span class="c1"># are called from within the ANC HSIs. Which interventions are called depends on the mothers gestation and the</span>
    <span class="c1"># number of visits she has attended at the time each HSI runs (see ANC HSIs)</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.screening_interventions_delivered_at_every_contact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.screening_interventions_delivered_at_every_contact">[docs]</a>    <span class="k">def</span> <span class="nf">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the screening interventions which are delivered at every ANC contact regardless of the</span>
<span class="sd">        womans gestational age and include blood pressure measurement and urine dipstick testing</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Define the consumables</span>
        <span class="n">item_code_urine_dipstick</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Test strips, urine analysis&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_dipstick</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_urine_dipstick</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_dipstick</span><span class="p">)</span>

        <span class="c1"># Delivery of the intervention is conditioned on the availability of the consumable and a random draw against a</span>
        <span class="c1"># probability that the intervention would be delivered (used to calibrate to SPA data- acts as proxy for</span>
        <span class="c1"># clinical quality)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_urine_ds&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_urine_dipstick</span><span class="p">]:</span>

                <span class="c1"># If the consumables are available the test is ran. Urine testing in ANC is predominantly used to</span>
                <span class="c1"># detected protein in the urine (proteinuria) which is indicative of pre-eclampsia</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;urine_dipstick_protein&#39;</span><span class="p">,</span>
                                                                           <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                    <span class="c1"># We use a temporary variable to store if proteinuria is detected</span>
                    <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Urine dip stick testing detected proteinuria for mother &#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Urine dipstick testing was not completed in this ANC visit due to &#39;</span>
                                             <span class="s1">&#39;unavailable consumables&#39;</span><span class="p">)</span>

        <span class="c1"># The process is repeated for blood pressure monitoring- although not conditioned on consumables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_bp&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_pressure_measurement&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Blood pressure testing detected hypertension for mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="ow">and</span>\
                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;hypertension&#39;</span>
                                                                                                  <span class="s1">&#39;_onset&#39;</span><span class="p">]):</span>

                    <span class="c1"># We store date of onset to calculate dalys- only women who are aware of diagnosis experience DALYs</span>
                    <span class="c1"># (see daly weight for hypertension)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hypertension_onset&#39;</span><span class="p">)</span>

        <span class="c1"># If either high blood pressure or proteinuria are detected (or both) we assume this woman needs to be admitted</span>
        <span class="c1"># for further treatment following this ANC contact</span>

        <span class="c1"># Only women who are not on treatment OR are determined to have severe disease whilst on treatment are admitted</span>
        <span class="k">if</span> <span class="n">hypertension_diagnosed</span> <span class="ow">or</span> <span class="n">proteinuria_diagnosed</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                   <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]:</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has had hypertension or proteinuria detected in ANC &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;and will now need admission&#39;</span><span class="p">)</span>

        <span class="c1"># Here we conduct screening and initiate treatment for depression as needed</span>
        <span class="k">if</span> <span class="s1">&#39;Depression&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_depression_screen&#39;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will now be receive screening for depression during&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; ANC  and commence treatment as appropriate&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;de_ever_diagnosed_depression&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Depression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_when_suspected_depression</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.interventions_initiated_at_first_contact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.interventions_initiated_at_first_contact">[docs]</a>    <span class="k">def</span> <span class="nf">interventions_initiated_at_first_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains all the interventions that should be delivered during the initial ANC contact (contact 1)</span>
<span class="sd">        including initiation of daily iron and folic acid supplementation, daily balance energy and protein</span>
<span class="sd">        supplementation, provision of an insecticide treated bed net and screening for TB.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># We calculate an approximate number of days left of a womans pregnancy to capture the consumables required for</span>
        <span class="c1"># daily iron/folic acid tablets</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="mi">14</span>

        <span class="c1"># Iron/folic acid &amp; BEP supplements...</span>
        <span class="c1"># Define the consumables</span>
        <span class="n">item_code_iron_folic_acid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_diet_supps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Dietary supplements (country-specific)&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_anc1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_iron_folic_acid</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span><span class="p">,</span>
                          <span class="n">item_code_diet_supps</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_anc1</span><span class="p">)</span>

        <span class="c1"># As with previous interventions - condition on consumables and probability intervention is delivered</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_iron_folic_acid</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                           <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                                  <span class="s1">&#39;delivered_ifa&#39;</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been commenced on IFA supplements during ANC&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_diet_supps</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention&#39;</span>
                                                                                             <span class="s1">&#39;_delivered_bep&#39;</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been commenced on BEP supplements during ANC&#39;</span><span class="p">)</span>

        <span class="c1"># LLITN provision...</span>
        <span class="c1"># We define the required consumables</span>
        <span class="n">pkg_code_obstructed_llitn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ITN distribution to pregnant women&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_llitn</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">pkg_code_obstructed_llitn</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_llitn</span><span class="p">)</span>

        <span class="c1"># If available, women are provided with a bed net at ANC1. The effect of these nets is determined</span>
        <span class="c1"># through the malaria module - not yet coded. n.b any interventions involving non-obstetric diseases have been</span>
        <span class="c1"># discussed with Tara</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">][</span><span class="n">pkg_code_obstructed_llitn</span><span class="p">]</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_llitn&#39;</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_itn_provided&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been provided with a LLITN during ANC&#39;</span><span class="p">)</span></div>

        <span class="c1"># TODO: TB module in master is currently commented out, this is legacy code and a placeholder to ensure women</span>
        <span class="c1">#  are screened for TB</span>

        <span class="c1"># TB screening...</span>
        <span class="c1"># Currently we schedule women to the TB screening HSI in the TB module, however this may over-use resources so</span>
        <span class="c1"># possible the TB screening should also just live in this code</span>
        <span class="c1"># if &#39;tb&#39; in self.sim.modules.keys():</span>
        <span class="c1">#    if self.rng.random_sample() &lt; params[&#39;prob_intervention_delivered_tb_screen&#39;]:</span>
        <span class="c1">#        logger.debug(key=&#39;msg&#39;, data=f&#39;Mother {person_id} has been referred to the TB module for screening &#39;</span>
        <span class="c1">#                                     f&#39;during ANC&#39;)</span>

        <span class="c1">#        tb_screen = HSI_TbScreening(</span>
        <span class="c1">#            module=self.sim.modules[&#39;tb&#39;], person_id=person_id)</span>

        <span class="c1">#        self.sim.modules[&#39;HealthSystem&#39;].schedule_hsi_event(tb_screen, priority=0,</span>
        <span class="c1">#                                                            topen=self.sim.date,</span>
        <span class="c1">#                                                            tclose=self.sim.date + DateOffset(days=1))</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.tetanus_vaccination"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.tetanus_vaccination">[docs]</a>    <span class="k">def</span> <span class="nf">tetanus_vaccination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention tetanus vaccination. A booster dose of the vaccine is given to all women</span>
<span class="sd">         during ANC. Effect of vaccination is managed by the EPI module and therefore here we just capture consumables</span>
<span class="sd">         and number of doses</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Define required consumables</span>
        <span class="n">pkg_code_tet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s2">&quot;Intervention_Pkg&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Tetanus toxoid (pregnant women)&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Intervention_Pkg_Code&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">all_available</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
            <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_tet</span><span class="p">])</span>

        <span class="c1"># If the consumables are available and the HCW will deliver the vaccine, the intervention is given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_tt&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_ttd_received&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received a tetanus booster during ANC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.calcium_supplementation"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.calcium_supplementation">[docs]</a>    <span class="k">def</span> <span class="nf">calcium_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function contains the intervention calcium supplementation delivered during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]:</span>

            <span class="c1"># Define consumables</span>
            <span class="n">item_code_calcium_supp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Calcium, tablet, 600 mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Calculate the approximate dose for the remainder of pregnancy</span>
            <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>
            <span class="n">dose</span> <span class="o">=</span> <span class="n">approx_days_of_pregnancy</span> <span class="o">*</span> <span class="mi">3</span>

            <span class="n">consumables_calcium</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_calcium_supp</span><span class="p">:</span> <span class="n">dose</span><span class="p">}}</span>

            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_calcium</span><span class="p">)</span>

            <span class="c1"># If the consumables are available and the HCW will provide the tablets, the intervention is given</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_calcium_supp</span><span class="p">]</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_calcium&#39;</span><span class="p">]):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been started on calcium supplements during ANC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.point_of_care_hb_testing"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.point_of_care_hb_testing">[docs]</a>    <span class="k">def</span> <span class="nf">point_of_care_hb_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention point of care haemoglobin testing provided to women during ANC to detect</span>
<span class="sd">        anaemia during pregnancy</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="c1"># Define the required consumables</span>
        <span class="n">item_code_hb_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Haemoglobin test (HB)&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_blood_tube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_hb_test</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_hb_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_blood_tube</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="c1"># Confirm their availability</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_hb_test</span><span class="p">)</span>

        <span class="c1"># If the consumables are available and the HCW will provide the test, the test is given</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hb_test</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood_tube</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                     <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                            <span class="s1">&#39;delivered_poct&#39;</span><span class="p">]):</span>

            <span class="c1"># We run the test through the dx_manager and if a woman has anaemia and its detected she will be admitted</span>
            <span class="c1"># for further care</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;point_of_care_hb_test&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has had anaemia detected after a POC test and will &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;require admission&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.albendazole_administration"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.albendazole_administration">[docs]</a>    <span class="k">def</span> <span class="nf">albendazole_administration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention albendazole administration (de-worming) and is provided to women during</span>
<span class="sd">         ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># We run this function to store the associated consumables with albendazole administration. This intervention</span>
        <span class="c1"># has no effect in the model due to limited evidence</span>
        <span class="n">item_code_albendazole</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Albendazole 200mg_1000_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_albendazole</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_albendazole</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_albendazole</span><span class="p">)</span>

        <span class="c1"># If the consumables are available and the HCW will provide the tablets, the intervention is given</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_albendazole</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                       <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                              <span class="s1">&#39;delivered_bp&#39;</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39; Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received albendazole during ANC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.hep_b_testing"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.hep_b_testing">[docs]</a>    <span class="k">def</span> <span class="nf">hep_b_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention Hepatitis B testing and is provided to women during ANC. As Hepatitis</span>
<span class="sd">        B is not modelled currently this intervention just maps consumables used during ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># This intervention is a place holder prior to the Hepatitis B module being coded</span>
        <span class="c1"># Define the consumables</span>
        <span class="n">item_code_hep_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hepatitis B test kit-Dertemine_100 tests_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_blood_tube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_hep_b_test</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_hep_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_blood_tube</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_hep_b_test</span><span class="p">)</span>

        <span class="c1"># If the consumables are available and the HCW will provide the test, the test is delivered</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hep_test</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood_tube</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                     <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                            <span class="s1">&#39;delivered_hepb_test&#39;</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received Hep B testing during ANC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.syphilis_testing"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.syphilis_testing">[docs]</a>    <span class="k">def</span> <span class="nf">syphilis_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention Syphilis testing and is provided to women during ANC. As Syphilis is</span>
<span class="sd">        not modelled currently this intervention just maps consumables used during ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># Define the consumables</span>
        <span class="n">item_code_syphilis_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Test, Rapid plasma reagin (RPR)&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_blood_tube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_syphilis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_syphilis_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_blood_tube</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_syphilis</span><span class="p">)</span>

        <span class="c1"># If the consumables are available and the HCW will provide the test, the test is delivered</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_syphilis_test</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood_tube</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                     <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                            <span class="s1">&#39;delivered_syph_test&#39;</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has received syphilis testing during ANC&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.hiv_testing"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.hiv_testing">[docs]</a>    <span class="k">def</span> <span class="nf">hiv_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the scheduling for HIV testing and is provided to women during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_hiv_test&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                      <span class="s1">&#39;hv_diagnosed&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                   <span class="n">HSI_Hiv_TestAndRefer</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]),</span>
                   <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                   <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.iptp_administration"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.iptp_administration">[docs]</a>    <span class="k">def</span> <span class="nf">iptp_administration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention intermittent preventative treatment in pregnancy (for malaria) for women</span>
<span class="sd">        during ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;Malaria&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ma_tx&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;is_alive&quot;</span><span class="p">]:</span>

                <span class="c1"># Test to ensure only 5 doses are able to be administered</span>
                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">6</span>

                <span class="c1"># Define and check the availability of consumables</span>
                <span class="n">pkg_code_iptp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                    <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s2">&quot;Intervention_Pkg&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IPT (pregnant women)&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;Intervention_Pkg_Code&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">all_available</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
                    <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_iptp</span><span class="p">])</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_iptp&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;giving IPTp for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="c1"># IPTP is a single dose drug given at a number of time points during pregnancy. Therefore the</span>
                        <span class="c1"># number of doses received during this pregnancy are stored as an integer</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_doses_of_iptp_received&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has a dose of IPTP during pregnancy&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.gdm_screening"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.gdm_screening">[docs]</a>    <span class="k">def</span> <span class="nf">gdm_screening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function contains intervention of gestational diabetes screening during ANC. Screening is only conducted</span>
<span class="sd">         on women with pre-specified risk factors for the disease.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># We check if this women has any of the key risk factors, if so they are sent for additional blood tests</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;li_bmi&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]:</span>

            <span class="c1"># We define the required consumables for testing</span>
            <span class="n">item_code_glucose_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood glucose level test&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_blood_tube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">consumables_gdm_testing</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_glucose_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_blood_tube</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

            <span class="c1"># Then query if these consumables are available during this HSI</span>
            <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
                <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_gdm_testing</span><span class="p">)</span>

            <span class="c1"># If they are available, the test is conducted</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_glucose_test</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood_tube</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span>
                                                                                         <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_&#39;</span>
                                                                                                <span class="s1">&#39;delivered_gdm_test&#39;</span><span class="p">]):</span>

                <span class="c1"># If the test accurately detects a woman has gestational diabetes the consumables are recorded and she</span>
                <span class="c1"># is referred for treatment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_test_glucose&#39;</span><span class="p">,</span>
                                                                           <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                    <span class="c1"># We assume women with a positive GDM screen will be admitted (if they are not already receiving</span>
                    <span class="c1"># outpatient care)</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                        <span class="c1"># Store onset after diagnosis as daly weight is tied to diagnosis</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;gest_diab_onset&#39;</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has had GDM detected after a blood glucose &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;testing and will require admission&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has had GDM detected but is already receiving&#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;treatment as an outpatient so no further action has been taken&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.anc_catch_up_interventions"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.anc_catch_up_interventions">[docs]</a>    <span class="k">def</span> <span class="nf">anc_catch_up_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function contains a collection of interventions that are delivered to women who present to ANC at later</span>
<span class="sd">         gestations and have missed key interventions that should have been delivered towards the beggining of the ANC</span>
<span class="sd">         schedule</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hiv_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">albendazole_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.check_anc1_can_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.check_anc1_can_run">[docs]</a>    <span class="k">def</span> <span class="nf">check_anc1_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the first ANC contact to determine if it can run</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        :param individual_id: individual id</span>
<span class="sd">        :param squeeze_factor: squeeze_factor of the HSI calling this function</span>
<span class="sd">        :param gest_age_next_contact: gestational age, in weeks, this woman is due to return for her next ANC</span>
<span class="sd">        :returns True/False as to whether the event can run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span>

        <span class="c1"># Only women who are alive, still pregnant and not in labour can attend ANC1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                                    <span class="s1">&#39;la_currently_in_&#39;</span>
                                                                                                    <span class="s1">&#39;labour&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Here we block the event from running for previously scheduled ANC1 HSIs for women who have lost a pregnancy</span>
        <span class="c1"># and become pregnant again</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">date_difference</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has arrived at ANC1 that was scheduled in a previous &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;pregnancy and therefore the event will not run&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the woman is an inpatient when ANC1 is scheduled, she will try and return at the next appropriate</span>
        <span class="c1"># gestational age</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>
            <span class="c1"># We assume that she will return for her first appointment at the next gestation in the schedule</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is scheduled to attend ANC today but is currently an &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;inpatient- she will be scheduled to arrive at her next visit instead and&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; no interventions will be delivered here&#39;</span><span class="p">)</span>

            <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gest_age_next_contact</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span>
            <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Finally, if the squeeze factor is too high the event wont run and she will return tomorrow</span>
        <span class="k">elif</span> <span class="n">squeeze_factor</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_factor_threshold_anc&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> cannot receive ANC today as the squeeze factor is &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;too high&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.check_subsequent_anc_can_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.check_subsequent_anc_can_run">[docs]</a>    <span class="k">def</span> <span class="nf">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="n">this_visit_number</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                     <span class="n">gest_age_next_contact</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by all subsequent ANC contacts to determine if they can run</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        :param individual_id: individual id</span>
<span class="sd">        :param this_contact: HSI object of the current ANC contact that needs to be rebooked</span>
<span class="sd">        :param this_visit_number: Number of the next ANC contact in the schedule</span>
<span class="sd">        :param squeeze_factor: squeeze_factor of the HSI calling this function</span>
<span class="sd">        :param gest_age_next_contact: gestational age, in weeks, this woman is due to return for her next ANC</span>
<span class="sd">        :returns True/False as to whether the event can run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span>

        <span class="n">ga_for_anc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">40</span><span class="p">}</span>

        <span class="c1"># If women have died, are no longer pregnant, are in labour or more than a week has past since the HSI was</span>
        <span class="c1"># scheduled then it will not run</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span>\
            <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ga_for_anc_dict</span><span class="p">[</span><span class="n">this_visit_number</span><span class="p">])</span> \
           <span class="ow">or</span> <span class="p">(</span><span class="n">date_difference</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the woman is currently an inpatient then she will return at the next point in the contact schedule but</span>
        <span class="c1"># receive the care she has missed in this visit</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> was due to receive ANC today but she is an inpatient&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;- we will now determine if she will return for this visit in the future&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="n">this_visit_number</span><span class="p">,</span>
                                          <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                          <span class="n">facility_level</span><span class="o">=</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the squeeze factor is too high she will return tomorrow</span>
        <span class="k">elif</span> <span class="n">squeeze_factor</span> <span class="o">&gt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;squeeze_factor_threshold_anc&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> cannot receive ANC today as the squeeze factor is &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;too high&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">this_contact</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># =============================== INTERVENTIONS DELIVERED DURING INPATIENT CARE ===================================</span>
    <span class="c1"># The following functions contain code for the interventions which are called by antenatal HSIs (not including</span>
    <span class="c1"># routine ANC) this includes post abortion/ectopic care and antenatal inpatient care</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.full_blood_count_testing"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.full_blood_count_testing">[docs]</a>    <span class="k">def</span> <span class="nf">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function contains the intervention &#39;full blood count testing&#39; and represents blood testing requiring a</span>
<span class="sd">        laboratory. It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women admitted due to</span>
<span class="sd">        anaemia</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        :returns: result of the FBC [&#39;no_test&#39;, &#39;none&#39;, &#39;mild_mod&#39;, &#39;severe&#39;] (STR)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="c1"># Define the required consumables</span>
        <span class="n">item_code_hb_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Haemoglobin test (HB)&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_blood_tube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_hb_test</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_hb_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_blood_tube</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="c1"># Confirm their availability</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_hb_test</span><span class="p">)</span>

        <span class="c1"># Check consumables</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hb_test</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood_tube</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">]):</span>

            <span class="c1"># Run dx_test for anaemia...</span>
            <span class="c1"># If a woman is not truly anaemic but the FBC returns a result of anaemia, due to tests specificity, we</span>
            <span class="c1"># assume the reported anaemia is mild</span>

            <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;full_blood_count_hb&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">test_result</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;non_severe&#39;</span>

            <span class="c1"># If the test correctly identifies a woman&#39;s anaemia we assume it correctly identifies its severity</span>
            <span class="k">elif</span> <span class="n">test_result</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span>

            <span class="c1"># We return a none value if no anaemia was detected</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;none&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;There were inadequate consumables to conduct an FBC so mother &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> did not receive one&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;no_test&#39;</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.treatment_of_anaemia_causing_deficiencies"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.treatment_of_anaemia_causing_deficiencies">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_of_anaemia_causing_deficiencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains treatment for deficiencies that may be contributing to anaemia in pregnancy. It is called</span>
<span class="sd">         by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women admitted due to anaemia</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">pregnancy_deficiencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deficiencies_in_pregnancy</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>

        <span class="c1"># Calculate the approximate dose for the remainder of pregnancy</span>
        <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

        <span class="c1"># Check and request consumables</span>
        <span class="n">item_code_elemental_iron</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span>
                <span class="s1">&#39;ferrous sulphate 200 mg, coated (65 mg iron)_1000_IDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># n.b. folate doesnt have a specific consumable so this is a place holder</span>
        <span class="n">item_code_folate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span>
                <span class="s1">&#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">item_code_b12</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span>
                <span class="s1">&#39;vitamin B12 (cyanocobalamine) 1 mg/ml, 1 ml, inj._100_IDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># If iron or folate deficient, a woman will need to take additional daily supplements. If B12 deficient this</span>
        <span class="c1"># should occur monthly</span>
        <span class="n">consumables_ifa</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_elemental_iron</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span><span class="p">,</span>
                          <span class="n">item_code_folate</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span><span class="p">,</span>
                          <span class="n">item_code_b12</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">approx_days_of_pregnancy</span> <span class="o">/</span> <span class="mi">31</span><span class="p">)}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_ifa</span><span class="p">)</span>

        <span class="c1"># Treatment is provided dependent on deficiencies present</span>
        <span class="k">if</span> <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="c1"># If the treatment is available we assume it has two effect, first in resolving the deficiency and second in</span>
            <span class="c1"># resolving a womans current anaemia</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_elemental_iron</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_iron_replacement_for_resolving_anaemia&#39;</span><span class="p">]:</span>

                    <span class="c1"># If the woman is no longer anaemic after treatment we store a date of resolution for daly</span>
                    <span class="c1"># calculations</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                        <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                          <span class="sa">f</span><span class="s1">&#39;anaemia_resolution&#39;</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_iron_replacement_for_resolving_iron_def&#39;</span><span class="p">]:</span>
                    <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">unset</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;iron&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_folate</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_folate_replacement_for_resolving_anaemia&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                        <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                          <span class="sa">f</span><span class="s1">&#39;anaemia_resolution&#39;</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_folate_replacement_for_resolving_folate_def&#39;</span><span class="p">]:</span>
                    <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">unset</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;folate&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_b12</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_b12_replacement_for_resolving_anaemia&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                        <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                          <span class="sa">f</span><span class="s1">&#39;anaemia_resolution&#39;</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_b12_replacement_for_resolving_b12_def&#39;</span><span class="p">]:</span>
                    <span class="n">pregnancy_deficiencies</span><span class="o">.</span><span class="n">unset</span><span class="p">([</span><span class="n">individual_id</span><span class="p">],</span> <span class="s1">&#39;b12&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.start_iron_and_folic_acid"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.start_iron_and_folic_acid">[docs]</a>    <span class="k">def</span> <span class="nf">start_iron_and_folic_acid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of iron and folic acid supplementation. It is called</span>
<span class="sd">        by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women admitted due to anaemia who have not been</span>
<span class="sd">         given iron and folic acid supplements during ANC</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>

        <span class="c1"># Calculate the approximate dose for the remainder of pregnancy</span>
        <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

        <span class="c1"># Check availability of consumables</span>
        <span class="n">item_code_iron_folic_acid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span>
                <span class="s1">&#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_ifa</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_iron_folic_acid</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_ifa</span><span class="p">)</span>

        <span class="c1"># Start iron and folic acid treatment</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_iron_folic_acid</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been started on IFA supplementation after being &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;admitted for anaemia&#39;</span><span class="p">)</span>

            <span class="c1"># Women started on IFA at this stage are already anaemic, we here apply a probability that</span>
            <span class="c1"># starting on a course of IFA will correct anaemia prior to follow up</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">]:</span>

                <span class="c1"># Store date of resolution for daly calculations</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                                                  <span class="sa">f</span><span class="s1">&#39;anaemia_resolution&#39;</span><span class="p">)</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antenatal_blood_transfusion"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antenatal_blood_transfusion">[docs]</a>    <span class="k">def</span> <span class="nf">antenatal_blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention &#39;blood transfusion&#39;. It is called by either</span>
<span class="sd">        HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare or HSI_CareOfWomenDuringPregnancy_PostAbortionCase</span>
<span class="sd">        Management for women requiring blood for either haemorrhage or severe anaemia.</span>
<span class="sd">        given iron and folic acid supplements during ANC</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        :param cause: (STR) cause of woman needed transfusion [&#39;antepartum_haem&#39;, &#39;abortion&#39;, &#39;severe_anaemia&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>

        <span class="c1"># Check for consumables</span>
        <span class="n">item_code_blood</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Blood, one unit&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Lancet, blood, disposable&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Test, hemoglobin&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_giving_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;IV giving/infusion set, with needle&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_needed_bt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                                 <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_blood</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_test</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="n">item_code_giving_set</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span> <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_needed_bt</span><span class="p">)</span>

        <span class="c1"># If the consumables are available the intervention is delivered</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_blood</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_test</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_giving_set</span><span class="p">]):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is receiving an antenatal blood transfusion due &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;to </span><span class="si">{</span><span class="n">cause</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;severe_anaemia&#39;</span><span class="p">:</span>
                <span class="c1"># If the woman is receiving blood due to anaemia we apply a probability that a transfusion of 2 units</span>
                <span class="c1"># RBCs will correct this woman&#39;s severe anaemia</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                    <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;severe_anaemia_resolution&#39;</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

            <span class="c1"># If the woman has experience haemorrhage post abortion we store that the intervention has been received in</span>
            <span class="c1"># this property which reduces her risk of death</span>
            <span class="k">elif</span> <span class="n">cause</span> <span class="o">==</span> <span class="s1">&#39;abortion&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pac_interventions</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;blood_products&#39;</span><span class="p">)</span>

            <span class="c1"># If the cause is antepartum haemorrhage we use this property to reduce a womans risk of death following</span>
            <span class="c1"># treatment</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initiate_maintenance_anti_hypertensive_treatment"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initiate_maintenance_anti_hypertensive_treatment">[docs]</a>    <span class="k">def</span> <span class="nf">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of oral antihypertensive medication for women with high blood pressure. It is</span>
<span class="sd">        called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have been identified as having</span>
<span class="sd">         high blood pressure in pregnancy but are not yet receiving treatment</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># Calculate the approximate dose for the remainder of pregnancy</span>
        <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

        <span class="c1"># Define the consumables and check their availability</span>
        <span class="n">item_code_methyldopa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Methyldopa 250mg_1000_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_gest_htn_treatment</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_methyldopa</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">approx_days_of_pregnancy</span><span class="p">}}</span>

        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_gest_htn_treatment</span><span class="p">)</span>

        <span class="c1"># If they are available then the woman is started on treatment</span>
        <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_methyldopa</span><span class="p">]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been started on regular antihypertensives due to &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;her HDP&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initiate_treatment_for_severe_hypertension"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initiate_treatment_for_severe_hypertension">[docs]</a>    <span class="k">def</span> <span class="nf">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of intravenous antihypertensive medication for women with severely high blood</span>
<span class="sd">        pressure. It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have been</span>
<span class="sd">        admitted due to severely high blood pressure (severe gestational hypertension, severe pre-eclampsia or</span>
<span class="sd">        eclampsia)</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># Define the consumables and check their availability</span>
        <span class="n">item_code_hydralazine</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Hydralazine, powder for injection, 20 mg ampoule&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_wfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Water for injection, 10ml_Each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_gest_htn_treatment</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_hydralazine</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_wfi</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="c1"># Then query if these consumables are available during this HSI</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_gest_htn_treatment</span><span class="p">)</span>

        <span class="c1"># If they are available then the woman is started on treatment</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_hydralazine</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_wfi</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">]):</span>

            <span class="c1"># We assume women treated with antihypertensives would no longer be severely hypertensive- meaning they</span>
            <span class="c1"># are not at risk of death from severe gestational hypertension in the PregnancySupervisor event</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been given intravenous anti-hypertensive as &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;part of treatment regime for severe gestational hypertension&#39;</span><span class="p">)</span>

            <span class="c1"># We dont assume antihypertensives convert severe pre-eclampsia/eclampsia to a more mild version of the</span>
            <span class="c1"># disease (as the disease is multi-system and hypertension is only one contributing factor to mortality) but</span>
            <span class="c1"># instead use this property to reduce risk of acute death from this episode of disease</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                                     <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has been given intravenous anti-hypertensive as &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;part of treatment regime for severe pre-eclampsia/eclampsia&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.treatment_for_severe_pre_eclampsia_or_eclampsia"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.treatment_for_severe_pre_eclampsia_or_eclampsia">[docs]</a>    <span class="k">def</span> <span class="nf">treatment_for_severe_pre_eclampsia_or_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of intravenous magnesium sulphate medication for women with severely</span>
<span class="sd">        pre-eclampsia/eclampsia It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who</span>
<span class="sd">        have been admitted with those conditions</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># Define the consumable package code</span>
        <span class="n">pkg_code_eclampsia_and_spe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Management of eclampsia&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">all_available</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
            <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_eclampsia_and_spe</span><span class="p">])</span>

        <span class="c1"># If available deliver the treatment</span>
        <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has received magnesium sulphate during her admission &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;for severe pre-eclampsia/eclampsia&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antibiotics_for_prom"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antibiotics_for_prom">[docs]</a>    <span class="k">def</span> <span class="nf">antibiotics_for_prom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of antibiotics for women with who have been admitted following premature</span>
<span class="sd">        rupture of membranes .It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># Define consumables and check their availability</span>
        <span class="n">item_code_benpen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_wfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Water for injection, 10ml_Each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_abx_for_prom</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_benpen</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">item_code_wfi</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="c1"># Then query if these consumables are available during this HSI</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_abx_for_prom</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_benpen</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_wfi</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has received antibiotics following admission due to &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;PROM&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antibiotics_for_chorioamnionitis"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antibiotics_for_chorioamnionitis">[docs]</a>    <span class="k">def</span> <span class="nf">antibiotics_for_chorioamnionitis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of antibiotics for women with who have been admitted due to chorioamnionitis</span>
<span class="sd">        infection .It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Consumables&quot;</span><span class="p">]</span>

        <span class="c1"># Define the consumables and check their availability</span>
        <span class="n">item_code_benpen</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_genta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gentamycin, injection, 40 mg/ml in 2 ml vial&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_wfi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Water for injection, 10ml_Each_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_needle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Syringe, needle + swab&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">item_code_gloves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Gloves, exam, latex, disposable, pair&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">consumables_abx_for_chorio</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_benpen</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">item_code_genta</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_wfi</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">item_code_needle</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">item_code_gloves</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>

        <span class="c1"># Then query if these consumables are available during this HSI</span>
        <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
            <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">,</span>
            <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_abx_for_chorio</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_benpen</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_genta</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_wfi</span><span class="p">])</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_needle</span><span class="p">])</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_gloves</span><span class="p">]):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_chorioamnionitis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> has received antibiotics after being admitted for &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;chorioamnionitis&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.ectopic_pregnancy_treatment_doesnt_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.ectopic_pregnancy_treatment_doesnt_run">[docs]</a>    <span class="k">def</span> <span class="nf">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called within HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy if the event cannot</span>
<span class="sd">        run/the intervention cannot be delivered. This ensures that women with ectopic pregnancies that haven&#39;t ruptured</span>
<span class="sd">        will experience rupture and risk of death without treatment</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="n">EctopicPregnancyRuptureEvent</span>

        <span class="c1"># If this event cannot run we ensure all women will eventually experience rupture due to untreated ectopic</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyRuptureEvent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span></div>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.calculate_beddays"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.calculate_beddays">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_beddays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare to calculate the number of</span>
<span class="sd">        beddays required by a women following admission. This is determined according to the reason for her admission</span>
<span class="sd">        and her gestation</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># Women with severe pre-eclampsia/eclampsia, severe haemorrhage, moderate haemorrhage at later gestation,</span>
        <span class="c1"># premature rupture of membranes complicated by chorioamnionitis, or at later gestation can be delivered</span>
        <span class="c1"># immediately and will only require a day in the antenatal ward for treatment before being admitted for</span>
        <span class="c1"># delivery</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="n">mother</span><span class="o">.</span><span class="n">ps_placental_abruption</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">))</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">)</span> <span class="ow">and</span>
             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">))</span> <span class="ow">or</span>\
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">))</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span>
             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">34</span><span class="p">)):</span>
            <span class="n">beddays</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Otherwise women will remain as an inpatient until their gestation is greater, to improve newborn outcomes</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">)</span> <span class="ow">and</span>
              <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span>
                                                             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span>
                                                             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">)):</span>

            <span class="n">beddays</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">37</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">beddays</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">beddays</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is the  HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact which represents the first routine</span>
<span class="sd">    antenatal care contact (ANC1). It is scheduled by the PregnancySupervisor Event for women who choose to seek</span>
<span class="sd">    routine antenatal care during their pregnancy. It is recommended that this visit occur before 12 weeks gestation.</span>
<span class="sd">    This event delivers the interventions to women which are part of ANC1. Additionally interventions that should be</span>
<span class="sd">    offered in the early ANC contacts are provided to women who present to ANC1 later in their pregnancy. Scheduling</span>
<span class="sd">    the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient ward in the</span>
<span class="sd">    case of complications &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_FirstAntenatalCareContact&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;AntenatalFirst&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Calculate when this woman should return for her next visit</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># Check this visit can run</span>
        <span class="n">can_anc1_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_anc1_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc1_run</span><span class="p">:</span>
            <span class="c1"># Check only women who have not attended any ANC contacts during this pregnancy arrive at this</span>
            <span class="c1"># event</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">0</span>

            <span class="c1"># We generate the facility type that this HSI is occurring at (dependent on facility level) - we currently</span>
            <span class="c1"># assume women will present to the same facility level and type for any future ANC visits</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Assume a 50/50 chance of health centre or hospital in level 1, however this will need editing</span>
                <span class="n">facility_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;health_centre&#39;</span><span class="p">,</span> <span class="s1">&#39;hospital&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">facility_type</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">facility_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;hospital&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_facility_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hospital&#39;</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> presented for ANC1 at a &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="c1"># We add a visit to a rolling total of ANC visits in this pregnancy</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># And ensure only women whose first contact with ANC services are attending this event</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">7</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="c1"># First all women, regardless of ANC contact or gestation, undergo urine and blood pressure measurement</span>
            <span class="c1"># and depression screening</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Then, the appropriate interventions are delivered according gestational age. It is assumed that women who</span>
            <span class="c1"># present late to ANC1 are &#39;caught up&#39; with the interventions they missed from previous visits</span>
            <span class="c1"># (as per malawi guidelines)</span>

            <span class="c1"># If this woman is presenting prior to the suggested gestation for ANC2 (visit at 20 weeks), she receives</span>
            <span class="c1"># only the interventions for ANC1</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="c1"># These are the interventions delivered at ANC1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_initiated_at_first_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hiv_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># If she presents after 20 weeks she is provided interventions delivered at the first catch up and then</span>
            <span class="c1"># the appropriate catch up interventions</span>
            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_initiated_at_first_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_catch_up_interventions</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Any women presenting for ANC1 after 26 week are also required to have a GDM screen</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">26</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Then we determine if this woman will return for her next ANC visit</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="c1"># If the woman has had any complications detected during ANC she is admitted for treatment to be initiated</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareVisit: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareVisit: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact which represents the second routine</span>
<span class="sd">    antenatal care contact (ANC2). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 20</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC2. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_SecondAntenatalCareContact&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="o">=</span><span class="n">this_contact</span><span class="p">,</span>
                                                               <span class="n">this_visit_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="o">=</span><span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 2 at a &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">19</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="c1"># First we administer the administer the interventions all women will receive at this contact regardless of</span>
            <span class="c1"># gestational age</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># And we schedule the next ANC appointment</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="c1"># Then we administer interventions that are due to be delivered at this womans gestational age, which may be</span>
            <span class="c1"># in addition to intervention delivered in ANC2</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">albendazole_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareVisit: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareVisit: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact which represents the third routine</span>
<span class="sd">    antenatal care contact (ANC3). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 26</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC3. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_ThirdAntenatalCareContact&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 3 at a &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">25</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact which represents the fourth routine</span>
<span class="sd">    antenatal care contact (ANC4). It is scheduled by the HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 30</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC4. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_FourthAntenatalCareContact&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 4 at a &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">29</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact which represents the fifth routine</span>
<span class="sd">    antenatal care contact (ANC5). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 34</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC5. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_FifthAntenatalCareContact&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 5 at a &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">33</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">4</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact which represents the sixth routine</span>
<span class="sd">    antenatal care contact (ANC6). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC6. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_SixthAntenatalCareContact&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 6 at a &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">5</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">35</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact: cannot not run with&#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact which represents the seventh routine</span>
<span class="sd">    antenatal care contact (ANC7). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC7. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_SeventhAntenatalCareContact&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 7 at a &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">6</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">37</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">,</span>
                                                     <span class="n">facility_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact which represents the eighth routine</span>
<span class="sd">    antenatal care contact (ANC8). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC8. Additionally interventions</span>
<span class="sd">    that should be delivered according to a womans gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_EighthAntenatalCareContact&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_of_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Here we define variables used within the function that checks in this ANC visit can run</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">this_contact</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_of_this_hsi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span><span class="p">)</span>

        <span class="c1"># Run the check</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">this_contact</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_facility_type&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1">presented for ANC 7 at a&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_facility_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> at gestation &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ps_gestational_age_in_weeks&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_total_anc_visits_current_pregnancy</span> <span class="o">==</span> <span class="mi">7</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
            <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">39</span>

            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;anc8+&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="n">actual_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span>
        <span class="k">return</span> <span class="n">actual_appt_footprint</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour. It is schedule by the PregnancySupervisor Event</span>
<span class="sd">    for women who present to the health system for induction as their labour has progressed longer than expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># If the woman is no longer alive, pregnant is in labour or is an inpatient already then the event doesnt run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># We set this admission property to show shes being admitted for induction of labour and hand her over to the</span>
        <span class="c1"># labour events</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will move to labour ward for &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_admitted_for_immediate_delivery&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> today&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment. It is schedule by the PregnancySupervisor Event</span>
<span class="sd">    for women who choose to seek care for emergency treatment in pregnancy (due to severe pre-eclampsia/eclampsia,</span>
<span class="sd">    antepartum haemorrhage, premature rupture of membranes or chorioamnionitis). It is assumed women present to this</span>
<span class="sd">    event as their first point of contact for an emergency in pregnancy, and therefore circumnavigate regular A&amp;E.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_MaternalEmergencyAssessment&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># TODO: remove and schedule through ED</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has presented at HSI_CareOfWomenDuringPregnancy_Maternal&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;EmergencyAssessment to seek care for a complication &#39;</span><span class="p">)</span>

            <span class="n">facility_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>

            <span class="n">admission</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                <span class="n">facility_level_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare. This HSI can be scheduled by any of the ANC HSIs</span>
<span class="sd">    for women who have been identified as having complications or by HSI_CareOfWomenDuringPregnancy_</span>
<span class="sd">    MaternalEmergencyAssessment or HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientFollowUp.This HSI represents the</span>
<span class="sd">    antenatal ward which would deliver care to women experiencing complications associated with their pregnancy</span>
<span class="sd">    including anaemia, hypertension, gestational diabetes, antepartum haemorrhage, premature rupture of membranes or</span>
<span class="sd">    chorioamnionitis. For women whom delivery is indicated as part of treatment for a complications they are scheduled</span>
<span class="sd">    to the LabourOnset Event</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">facility_level_this_hsi</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_AntenatalWardInpatientCare&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="n">facility_level_this_hsi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">beddays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calculate_beddays</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="n">beddays</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Bed-days allocated to this event:&#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bed_days_allocated_to_this_event</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been admitted for treatment of a complication of &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;her pregnancy &#39;</span><span class="p">)</span>

            <span class="c1"># The event represents inpatient care delivered within the antenatal ward at a health facility. Therefore</span>
            <span class="c1"># it is assumed that women with a number of different complications could be sent to this HSI for treatment.</span>

            <span class="c1"># ================================= INITIATE TREATMENT FOR ANAEMIA ========================================</span>
            <span class="c1"># Women who are referred from ANC or an outpatient appointment following point of care Hb which detected</span>
            <span class="c1"># anaemia first have a full blood count test to determine the severity of their anaemia</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_anaemia_in_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                <span class="c1"># This test returns one of a number of possible outcomes as seen below...</span>
                <span class="n">fbc_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;no_test&#39;</span> <span class="ow">or</span> <span class="s1">&#39;none&#39;</span> <span class="ow">or</span> <span class="s1">&#39;mild&#39;</span> <span class="ow">or</span> <span class="s1">&#39;moderate&#39;</span> <span class="ow">or</span> <span class="s1">&#39;severe&#39;</span>

                <span class="c1"># If the test is not carried out, no treatment is provided and the woman is discharged</span>
                <span class="k">if</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;no_test&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;No FBC given due to resource constraints&#39;</span><span class="p">)</span>

                <span class="c1"># If the result returns none, anaemia has not been detected via an FBC and the woman is discharged</span>
                <span class="c1"># without treatment</span>
                <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had anaemia detected via an FBC and &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;will be discharged&#39;</span><span class="p">)</span>

                <span class="c1"># If the FBC detected non severe anaemia (Hb &gt;7) she is treated</span>
                <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;mild&#39;</span> <span class="ow">or</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;moderate&#39;</span><span class="p">:</span>

                    <span class="c1"># Women are started on daily iron and folic acid supplementation (if they are not already receiving</span>
                    <span class="c1"># supplements) as treatment for mild/moderate anaemia</span>
                    <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">start_iron_and_folic_acid</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                    <span class="c1"># Some anaemia causing deficiencies (folate, B12)  are detected via a FBC, and therefore can be</span>
                    <span class="c1"># these deficiencies can be treated via this function</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">treatment_of_anaemia_causing_deficiencies</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                    <span class="c1"># In the case of severe anaemia (Hb &lt;7) then, in addition to the above treatments, this woman</span>
                    <span class="c1"># should receive a blood transfusion to correct her anaemia</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_blood_transfusion</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;severe_anaemia&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">treatment_of_anaemia_causing_deficiencies</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">start_iron_and_folic_acid</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;mild&#39;</span> <span class="ow">or</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;moderate&#39;</span> <span class="ow">or</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                    <span class="c1"># Women treated for anaemia will need follow up to ensure the treatment has been effective. Clinical</span>
                    <span class="c1"># guidelines suggest follow up one month after treatment</span>

                    <span class="c1"># To avoid issues with scheduling of events we assume women who are not scheduled to return to</span>
                    <span class="c1"># routine ANC OR their next ANC appointment is more than a month away will be asked to routine for</span>
                    <span class="c1"># follow up</span>
                    <span class="n">follow_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_date_next_contact</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_date_next_contact</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&gt;</span>
                                                                  <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)):</span>

                        <span class="n">outpatient_checkup</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="n">follow_up_date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="n">follow_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

            <span class="c1"># ======================== INITIATE TREATMENT FOR GESTATIONAL DIABETES (case management) ==================</span>
            <span class="c1"># Women admitted with gestational diabetes are given dietary and exercise advice as first line treatment</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;diet_exercise&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

                <span class="c1"># We then schedule GestationalDiabetesGlycaemicControlEvent which determines if this treatment will be</span>
                <span class="c1"># effective in controlling this womans blood sugar prior to her next check up</span>
                <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                <span class="c1"># We then schedule this woman to return for blood sugar testing to evaluate the effectiveness of her</span>
                <span class="c1"># treatment and potentially move to second line treatment</span>
                <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

                <span class="n">outpatient_checkup</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

            <span class="c1"># =============================== INITIATE TREATMENT FOR HYPERTENSION =====================================</span>
            <span class="c1"># Treatment delivered to mothers with hypertension is dependent on severity. Women admitted due to more mild</span>
            <span class="c1"># hypertension are started on regular oral antihypertensives therapy (reducing risk of progression to more</span>
            <span class="c1"># severe hypertension)</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;gest_htn&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">))</span> <span class="ow">and</span> \
               <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Women with severe gestational hypertension are also started on routine oral antihypertensives (if not</span>
            <span class="c1"># already receiving- this will prevent progression once this episode of severe hypertension has been</span>
            <span class="c1"># rectified)</span>
            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c1"># In addition, women with more severe disease are given intravenous anti hypertensives to reduce risk</span>
                <span class="c1"># of death</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Treatment guidelines dictate that women with severe forms of pre-eclampsia should be admitted for delivery</span>
            <span class="c1"># to reduce risk of death and pregnancy loss</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>

                <span class="c1"># This property stores what type of delivery this woman is being admitted for</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for induction due to &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># Women are started on oral antihypertensives also</span>
                <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c1"># And are given intravenous magnesium sulfate which reduces risk of death from eclampsia and reduces a</span>
                <span class="c1"># womans risk of progressing from severe pre-eclampsia to eclampsia during the intrapartum period</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">treatment_for_severe_pre_eclampsia_or_eclampsia</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                            <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="c1"># Finally intravenous antihypertensives are also given</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># ========================= INITIATE TREATMENT FOR ANTEPARTUM HAEMORRHAGE =================================</span>
            <span class="c1"># Treatment delivered to mothers due to haemorrhage in the antepartum period is dependent on the underlying</span>
            <span class="c1"># etiology of the bleeding (in this model, whether a woman is experiencing a placental abruption or</span>
            <span class="c1"># placenta praevia)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="c1"># ---------------------- APH SECONDARY TO PLACENTAL ABRUPTION -----------------------------------------</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_placental_abruption</span><span class="p">:</span>
                    <span class="c1"># Women experiencing placenta abruption at are admitted for immediate</span>
                    <span class="c1"># caesarean delivery due to high risk of mortality/morbidity</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_now&#39;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for caesarean due to APH&#39;</span><span class="p">)</span>

                <span class="c1"># ---------------------- APH SECONDARY TO PLACENTA PRAEVIA -----------------------------------------</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span><span class="p">:</span>
                    <span class="c1"># The treatment plan for a woman with placenta praevia is dependent on both the severity of the</span>
                    <span class="c1"># bleed and her current gestation at the time of bleeding</span>

                    <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                        <span class="c1"># Women experiencing severe bleeding are admitted immediately for caesarean section</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_now&#39;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for caesarean due to APH&#39;</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">):</span>
                        <span class="c1"># Women experiencing mild or moderate bleeding but who are around term gestation are admitted</span>
                        <span class="c1"># for caesarean</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_now&#39;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for caesarean due to APH&#39;</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">):</span>
                        <span class="c1"># Women with more mild bleeding remain as inpatients until their gestation has increased and</span>
                        <span class="c1"># then will be delivered by caesarean - (no risk of death associated with mild/moderate bleeds)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_future&#39;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for caesarean when her gestation &#39;</span>
                                                     <span class="sa">f</span><span class="s1">&#39;has increased due to APH&#39;</span><span class="p">)</span>

                        <span class="c1"># self.module.antenatal_blood_transfusion(person_id, self, cause=&#39;antepartum_haem&#39;)</span>

                <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>

            <span class="c1"># ===================================== INITIATE TREATMENT FOR PROM =======================================</span>
            <span class="c1"># Treatment for women with premature rupture of membranes is dependent upon a womans gestational age and if</span>
            <span class="c1"># she also has an infection of membrane surrounding the foetus (the chorion)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">or</span>
                                                             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;histological&#39;</span><span class="p">)):</span>
                <span class="c1"># If the woman has PROM but no infection, she is given prophylactic antibiotics which will reduce</span>
                <span class="c1"># the risk of neonatal infection</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antibiotics_for_prom</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c1"># Guidelines suggest women over 34 weeks of gestation should be admitted for induction to to</span>
                <span class="c1"># increased risk of morbidity and mortality</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">34</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for induction due to prom/chorio&#39;</span><span class="p">)</span>

                <span class="c1"># Otherwise they may stay as an inpatient until their gestation as increased prior to delivery</span>
                <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_future&#39;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for induction when her gestation&#39;</span>
                                                 <span class="sa">f</span><span class="s1">&#39; has increase due prom/chorio&#39;</span><span class="p">)</span>

            <span class="c1"># ============================== INITIATE TREATMENT FOR CHORIOAMNIONITIS ==================================</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span> <span class="o">==</span> <span class="s1">&#39;clinical&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antibiotics_for_chorioamnionitis</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will be admitted for induction due to prom/chorio&#39;</span><span class="p">)</span>

            <span class="c1"># ======================== ADMISSION FOR DELIVERY (INDUCTION) ========================================</span>
            <span class="c1"># Women for whom immediate delivery is indicated are schedule to move straight to the labour model where</span>
            <span class="c1"># they will have the appropriate properties set and facility delivery at a hospital scheduled (mode of</span>
            <span class="c1"># delivery will match the recommended mode here)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;induction_now&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                     <span class="s1">&#39;ac_admitted_&#39;</span>
                                                                                                     <span class="s1">&#39;for_immediate_&#39;</span>
                                                                                                     <span class="s1">&#39;delivery&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                                               <span class="s1">&#39;caesarean_now&#39;</span><span class="p">):</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will move to labour ward for &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_admitted_for_immediate_delivery&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> today&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

            <span class="c1"># Women who require delivery BUT are not in immediate risk of morbidity/mortality will remain as</span>
            <span class="c1"># inpatients until they can move to the labour model. Currently it is possible for women to go into</span>
            <span class="c1"># labour whilst as an inpatient - it is assumed they are delivered via the mode recommended here</span>
            <span class="c1"># (i.e induction/caesarean)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                                          <span class="s1">&#39;ac_admitted_&#39;</span>
                                                                                                          <span class="s1">&#39;for_&#39;</span>
                                                                                                          <span class="s1">&#39;immediate_&#39;</span>
                                                                                                          <span class="s1">&#39;delivery&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                                                    <span class="s1">&#39;induction_future&#39;</span><span class="p">):</span>

                <span class="c1"># Here we calculate how many days this woman needs to remain on the antenatal ward before she can go</span>
                <span class="c1"># for delivery (assuming delivery is indicated to occur at 37 weeks)</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">:</span>
                    <span class="n">days_until_safe_for_cs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">37</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">days_until_safe_for_cs</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># We schedule the LabourOnset event for this woman will be able to progress for delivery</span>
                <span class="n">admission_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_safe_for_cs</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will move to labour ward for &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s2">&quot;ac_admitted_for_immediate_delivery&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">admission_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span>
                                        <span class="n">admission_date</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HSI_CareOfWomenDuringPregnancy_AntenatalManagementOfAnaemia. It is scheduled by HSI_CareOfWomenDuringPregnancy_</span>
<span class="sd">    AntenatalWardInpatientCare for women who have developed anaemia during pregnancy. This event manages repeat blood</span>
<span class="sd">    testing for women who were found to be anaemic and treated. If the woman remains anaemic she is readmitted to the</span>
<span class="sd">    inpatient ward for further care.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We only run the event if the woman is not already in labour or already admitted due to something else</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span><span class="p">:</span>

            <span class="c1"># Health care worker performs a full blood count</span>
            <span class="n">fbc_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># If the consumables are not available the test isn&#39;t given</span>
            <span class="k">if</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;no_test&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;No FBC given due to resource constraints&#39;</span><span class="p">)</span>

            <span class="c1"># If the test determines the woman is no longer anaemia then no further action is taken at this time</span>
            <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has not had anaemia detected via an FBC&#39;</span><span class="p">)</span>

            <span class="c1"># If she is determined to still be anaemic she is admitted for additional treatment via the inpatient event</span>
            <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;mild&#39;</span> <span class="ow">or</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;moderate&#39;</span> <span class="ow">or</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>

                <span class="n">facility_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]))</span>

                <span class="n">admission</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                    <span class="n">facility_level_this_hsi</span><span class="o">=</span><span class="n">facility_level</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia: did &#39;</span>
                                         <span class="s1">&#39;not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia: &#39;</span>
                                         <span class="s1">&#39;cannot not run with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span>
                                                                                        <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This is HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes. It is scheduled by</span>
<span class="sd">     HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have developed gestational diabetes during</span>
<span class="sd">     pregnancy. This event manages repeat blood testing for women who were found to have GDM and treated. If the woman</span>
<span class="sd">     remains hyperglycaemic she is moved to the next line treatment and scheduled to return for follow up.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_AntenatalOutpatientFollowUp&#39;</span>

        <span class="n">the_appt_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>
        <span class="n">the_appt_footprint</span><span class="p">[</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="n">the_appt_footprint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="n">GestationalDiabetesGlycaemicControlEvent</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="o">~</span><span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="ow">and</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span> \
                <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">21</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has presented for review of her GDM&#39;</span><span class="p">)</span>

            <span class="c1"># Nothing happens to women who arrive at follow up with well controlled GDM (treatment is effective). We now</span>
            <span class="c1"># assume that the treatment they are on (started in AntenatalWardInpatientCare) remains effective for the</span>
            <span class="c1"># length of their pregnancy</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;controlled&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has well controlled GDM on current treatment and &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;doesnt need a further check up at present&#39;</span><span class="p">)</span>

            <span class="c1"># If the treatment a woman was started on has not controlled her hyperglycemia she will be started on the</span>
            <span class="c1"># next treatment</span>
            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">:</span>

                <span class="c1"># Women for whom diet and exercise was not effective in controlling hyperglycemia are started on oral</span>
                <span class="c1"># meds</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;diet_exercise&#39;</span><span class="p">:</span>

                    <span class="c1"># Currently we assume women are given enough tablets to last the length of their pregnancy</span>
                    <span class="n">approx_days_of_pregnancy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

                    <span class="n">item_code_oral_antidiabetics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                        <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Glibenclamide 5mg_1000_CMST&#39;</span><span class="p">,</span> <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">consumables_anti_diabs</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_oral_antidiabetics</span><span class="p">:</span> <span class="n">approx_days_of_pregnancy</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}}</span>  <span class="c1"># dose 5mg BD</span>

                    <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                        <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_anti_diabs</span><span class="p">)</span>

                    <span class="c1"># If the meds are available women are started on that treatment</span>
                    <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_oral_antidiabetics</span><span class="p">]:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;orals&#39;</span>

                        <span class="c1"># Assume new treatment is effective in controlling blood glucose on initiation</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

                        <span class="c1"># Schedule GestationalDiabetesGlycaemicControlEvent which determines if this new treatment will</span>
                        <span class="c1"># effectively control blood glucose prior to next follow up</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                        <span class="c1"># Schedule follow-up</span>
                        <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

                        <span class="n">outpatient_checkup</span> <span class="o">=</span> \
                            <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

                <span class="c1"># This process is repeated for mothers for whom oral medication is not effectively controlling their</span>
                <span class="c1"># blood sugar- they are started on insulin</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;orals&#39;</span><span class="p">:</span>

                    <span class="n">item_code_oral_insulin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                        <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Insulin soluble 100 IU/ml, 10ml_each_CMST&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;Item_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">consumables_insulin</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Intervention_Package_Code&#39;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s1">&#39;Item_Code&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">item_code_oral_insulin</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}</span>

                    <span class="n">outcome_of_request_for_consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">request_consumables</span><span class="p">(</span>
                        <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">cons_req_as_footprint</span><span class="o">=</span><span class="n">consumables_insulin</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">outcome_of_request_for_consumables</span><span class="p">[</span><span class="s1">&#39;Item_Code&#39;</span><span class="p">][</span><span class="n">item_code_oral_insulin</span><span class="p">]:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;insulin&#39;</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                        <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

                        <span class="n">outpatient_checkup</span> <span class="o">=</span> \
                            <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                            <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                            <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;insulin&#39;</span><span class="p">:</span>
                    <span class="c1"># As insulin is the &#39;highest&#39; level management we assume women with poorly controlled blood sugars</span>
                    <span class="c1"># on insulin have a dose amendment and therefore no additional consumables are given</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                    <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

                    <span class="n">outpatient_checkup</span> <span class="o">=</span> \
                        <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestational&#39;</span>
                                         <span class="s1">&#39;Diabetes: did &#39;</span>
                                         <span class="s1">&#39;not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestational&#39;</span>
                                         <span class="s1">&#39;Diabetes: cannot not run with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement. It is scheduled by</span>
<span class="sd">    HSI_GenericEmergencyFirstApptAtFacilityLevel1 for women who have presented to hospital due to the complications of</span>
<span class="sd">    either induced or spontaneous abortion. This event manages interventions delivered for women who are experiencing</span>
<span class="sd">    either sepsis, haemorrhage or injury post-abortion.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_PostAbortionCaseManagement&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;InpatientDays&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># any hospital?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span>
        <span class="n">abortion_complications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abortion_complications</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We check only women with complications post abortion are sent to this event</span>
        <span class="k">assert</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check the availability of consumables</span>
        <span class="n">pkg_code_infection</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Post-abortion case management&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
            <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">pkg_code_infection</span><span class="p">])</span>

        <span class="c1"># If consumables are available then individual interventions can be delivered</span>
        <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
            <span class="n">evac_procedures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;d_and_c&#39;</span><span class="p">,</span> <span class="s1">&#39;mva&#39;</span><span class="p">,</span> <span class="s1">&#39;misoprostol&#39;</span><span class="p">]</span>
            <span class="n">probability_of_evac_procedure</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_evac_procedure_pac&#39;</span><span class="p">]</span>
            <span class="n">random_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">evac_procedures</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probability_of_evac_procedure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pac_interventions</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">random_draw</span><span class="p">)</span>

        <span class="c1"># Women who are septic following their abortion are given antibiotics</span>
        <span class="k">if</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pac_interventions</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;antibiotics&#39;</span><span class="p">)</span>

        <span class="c1"># Minor injuries following induced abortion are treated</span>
        <span class="k">if</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">pac_interventions</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;injury_repair&#39;</span><span class="p">)</span>

        <span class="c1"># And women who experience haemorrhage are provided with blood</span>
        <span class="k">if</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_blood_transfusion</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;abortion&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement: did not run&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy">[docs]</a><span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy. It is scheduled by</span>
<span class="sd">    HSI_GenericEmergencyFirstApptAtFacilityLevel1 for women who have presented to hospital due to ectopic pregnancy.</span>
<span class="sd">    This event manages interventions delivered as part of the case management of ectopic pregnancy</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;general_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">consumables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Consumables&#39;</span><span class="p">]</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Check only the correct women are sent to this event</span>
        <span class="k">assert</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy, &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> has been diagnosed with ectopic pregnancy after &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;presenting and will now undergo treatment&#39;</span><span class="p">)</span>

        <span class="c1"># We define the required consumables and check their availability</span>
        <span class="n">ectopic_pkg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">consumables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">consumables</span><span class="p">[</span><span class="s1">&#39;Intervention_Pkg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Ectopic case management&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;Intervention_Pkg_Code&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">all_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_consumables</span><span class="p">(</span>
            <span class="n">pkg_codes</span><span class="o">=</span><span class="p">[</span><span class="n">ectopic_pkg</span><span class="p">])</span>

        <span class="c1"># If they are available then treatment can go ahead</span>
        <span class="k">if</span> <span class="n">all_available</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will now undergo surgery due to ectopic pregnancy as &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;consumables are available&#39;</span><span class="p">)</span>

            <span class="c1"># For women who have sought care after they have experienced rupture we use this treatment variable to</span>
            <span class="c1"># reduce risk of death (women who present prior to rupture do not pass through the death event as we assume</span>
            <span class="c1"># rupture is on the causal pathway to death - hence no treatment property)</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;ruptured&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># However if treatment cant be delivered for women who have not yet experienced rupture (due to lack of</span>
            <span class="c1"># consumables) we schedule these women to arrive at the rupture event as they have not received treatment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> could not receive treatment due to insufficient &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;consumables&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.did_not_run"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.did_not_run">[docs]</a>    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy: did not run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.not_available"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.not_available">[docs]</a>    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="AntenatalCareLoggingEvent"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.AntenatalCareLoggingEvent">[docs]</a><span class="k">class</span> <span class="nc">AntenatalCareLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<div class="viewcode-block" id="AntenatalCareLoggingEvent.__init__"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.AntenatalCareLoggingEvent.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>

<div class="viewcode-block" id="AntenatalCareLoggingEvent.apply"><a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.AntenatalCareLoggingEvent.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">one_year_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span>

        <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&gt;</span> <span class="n">one_year_prior</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">total_births_last_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_births_last_year</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">total_anc1_visits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;total_first_anc_visits&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">total_anc1_visits</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total_anc1_visits</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">anc1_in_first_trimester</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;total_anc1_first_trimester&#39;</span><span class="p">]</span>
        <span class="n">cumm_gestation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;cumm_ga_at_anc1&#39;</span><span class="p">]</span>
        <span class="n">early_anc3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;timely_ANC3&#39;</span><span class="p">]</span>
        <span class="n">diet_sup_6_months</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="s1">&#39;diet_supp_6_months&#39;</span><span class="p">]</span>

        <span class="c1"># ra_lower_limit = 14</span>
        <span class="c1"># ra_upper_limit = 50</span>
        <span class="c1"># women_reproductive_age = df.index[(df.is_alive &amp; (df.sex == &#39;F&#39;) &amp; (df.age_years &gt; ra_lower_limit) &amp;</span>
        <span class="c1">#                                   (df.age_years &lt; ra_upper_limit))]</span>
        <span class="c1"># total_women_reproductive_age = len(women_reproductive_age)</span>

        <span class="n">dict_for_output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean_ga_first_anc&#39;</span><span class="p">:</span> <span class="n">cumm_gestation</span> <span class="o">/</span> <span class="n">total_anc1_visits</span><span class="p">,</span>
                           <span class="s1">&#39;proportion_anc1_first_trimester&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">anc1_in_first_trimester</span> <span class="o">/</span> <span class="n">total_anc1_visits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;early_anc3_proportion_of_births&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">early_anc3</span> <span class="o">/</span> <span class="n">total_births_last_year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="s1">&#39;early_anc3&#39;</span><span class="p">:</span> <span class="n">early_anc3</span><span class="p">,</span>
                           <span class="s1">&#39;diet_supps_6_months&#39;</span><span class="p">:</span> <span class="n">diet_sup_6_months</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_summary_statistics&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">dict_for_output</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Yearly summary statistics output from the antenatal care module&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_tracker</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, The TLOmodel Team.
      <span class="lastupdated">
        Last updated on May 25, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>