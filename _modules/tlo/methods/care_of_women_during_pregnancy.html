<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tlo.methods.care_of_women_during_pregnancy &mdash; TLOmodel 0.1.dev2373+g8473a31 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=6ea10ece" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=812bb691"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TLOmodel
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/index.html">Resource files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../methods.html">tlo.methods</a></li>
      <li class="breadcrumb-item active">tlo.methods.care_of_women_during_pregnancy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tlo.methods.care_of_women_during_pregnancy</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">pregnancy_helper_functions</span>
<span class="kn">from</span> <span class="nn">tlo.methods.dxmanager</span> <span class="kn">import</span> <span class="n">DxTest</span>
<span class="kn">from</span> <span class="nn">tlo.methods.epi</span> <span class="kn">import</span> <span class="n">HSI_TdVaccine</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.labour</span> <span class="kn">import</span> <span class="n">LabourOnsetEvent</span>
<span class="kn">from</span> <span class="nn">tlo.methods.malaria</span> <span class="kn">import</span> <span class="n">HSI_MalariaIPTp</span>
<span class="kn">from</span> <span class="nn">tlo.methods.tb</span> <span class="kn">import</span> <span class="n">HSI_Tb_ScreeningAndRefer</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy">[docs]</a>
<span class="k">class</span> <span class="nc">CareOfWomenDuringPregnancy</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the CareOfWomenDuringPregnancy module which contains health system interaction events relevant to</span>
<span class="sd">     pregnancy and pregnancy loss including:</span>

<span class="sd">     1.) HSI_CareOfWomenDuringPregnancy_AntenatalCareContact (1-8) representing all 8 routine antenatal care contacts</span>
<span class="sd">        (ANC) recommended during pregnancy (with sequential scheduling of each event occurring within the HSI)</span>

<span class="sd">     2.) HSI_CareOfWomenDuringPregnancy_FocusedANCVisit which replicates the pre 2016 structure of ANC (focused ANC)</span>
<span class="sd">         used in some analysis scripts</span>

<span class="sd">     3.) HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement representing treatment for complications following</span>
<span class="sd">         abortion (post abortion care of PAC) for women seeking care from the community</span>

<span class="sd">     4.) HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy representing treatment for ectopic pregnancy for</span>
<span class="sd">         women seeking care from the community</span>

<span class="sd">     5.) HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare which represents antenatal inpatient care for women</span>
<span class="sd">         who require admission following complications of pregnancy, detected via ANC or following care seeking from the</span>
<span class="sd">         community including treatment and/or referral for (hypertension, diabetes, antepartum haemorrhage, anaemia,</span>
<span class="sd">         premature of membranes, chorioamnionitis)</span>

<span class="sd">    Additionally, the module stores a number of HSIs which represent follow up for women who are scheduled for</span>
<span class="sd">    additional testing following an admission and initiation of treatment (i.e. anaemia or gestational diabetes).</span>
<span class="sd">    Individual interventions are stored as functions within the module to prevent repetition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>

        <span class="c1"># First we define dictionaries which will store the current parameters of interest (to allow parameters to</span>
        <span class="c1"># change between 2010 and 2020)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># and then define a dictionary which will hold the required consumables for each intervention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Finally set up a counter for ANC visits.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anc_counter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></div>


    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">,</span> <span class="s1">&#39;HealthSystem&#39;</span><span class="p">,</span> <span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">}</span>

    <span class="n">ADDITIONAL_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Contraception&#39;</span><span class="p">,</span> <span class="s1">&#39;Labour&#39;</span><span class="p">,</span> <span class="s1">&#39;Lifestyle&#39;</span><span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>

        <span class="c1"># n.b. Parameters are stored as LIST variables due to containing values to match both 2010 and 2015 data.</span>

        <span class="c1"># CARE SEEKING...</span>
        <span class="s1">&#39;prob_seek_anc2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is not predicted to attended four or more ANC visits will attend &#39;</span>
                        <span class="s1">&#39;ANC2&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_anc3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is not predicted to attended four or more ANC visits will attend &#39;</span>
                        <span class="s1">&#39;ANC3&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_anc5&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is predicted to attend four or more ANC visits will attend ANC5&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_anc6&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is predicted to attend four or more ANC visits will attend ANC6&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_anc7&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is predicted to attend four or more ANC visits will attend ANC7&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_seek_anc8&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Probability a woman who is predicted to attend four or more ANC visits will attend ANC8&#39;</span><span class="p">),</span>

        <span class="c1"># TREATMENT EFFECTS...</span>
        <span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of starting iron and folic acid on resolving anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;treatment effectiveness of blood transfusion for anaemia in pregnancy&#39;</span><span class="p">),</span>

        <span class="c1"># INTERVENTION PROBABILITIES...</span>
        <span class="s1">&#39;prob_intervention_delivered_urine_ds&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;urine dipstick&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_bp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;blood pressure measurement&quot; given that the &#39;</span>
                        <span class="s1">&#39;HSI has ran and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_adherent_ifa&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman who is given iron and folic acid will adhere to the treatment for their&#39;</span>
                        <span class="s1">&#39; pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_syph_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;Syphilis test&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_intervention_delivered_gdm_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probability a woman will receive the intervention &quot;GDM screening&quot; given that the HSI has ran &#39;</span>
                        <span class="s1">&#39;and the consumables are available (proxy for clinical quality)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_delivery_modes_ec&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman admitted with eclampsia will deliver normally, via caesarean or &#39;</span>
                        <span class="s1">&#39;via assisted vaginal delivery&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prob_delivery_modes_spe&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;probabilities that a woman admitted with severe pre-eclampsia will deliver normally, via &#39;</span>
                        <span class="s1">&#39;caesarean or via assisted vaginal delivery&#39;</span><span class="p">),</span>

        <span class="c1"># ASSESSMENT SENSITIVITIES/SPECIFICITIES...</span>
        <span class="s1">&#39;sensitivity_bp_monitoring&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of blood pressure monitoring to detect hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_bp_monitoring&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of blood pressure monitoring to detect hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_urine_protein_1_plus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a urine dipstick test to detect proteinuria at 1+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_urine_protein_1_plus&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of a urine dipstick test to detect proteinuria at 1+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_poc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a point of care Hb test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_poc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of a point of care Hb test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_fbc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a Full Blood Count test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_fbc_hb_test&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of a Full Blood Count test to detect anaemia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_blood_test_glucose&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a blood test to detect raised blood glucose&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_blood_test_glucose&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of a blood test to detect raised blood glucose&#39;</span><span class="p">),</span>
        <span class="s1">&#39;sensitivity_blood_test_syphilis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;sensitivity of a blood test to detect syphilis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;specificity_blood_test_syphilis&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;specificity of a blood test to detect syphilis&#39;</span><span class="p">),</span>

    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;rolling total of antenatal visits this woman has &#39;</span>
                                                                     <span class="s1">&#39;attended during her pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">DATE</span><span class="p">,</span> <span class="s1">&#39;Date on which this woman is scheduled to return for her next &#39;</span>
                                                     <span class="s1">&#39;ANC contact&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman requires admission following an ANC visit&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily iron &amp; folic acid &#39;</span>
                                                             <span class="s1">&#39;supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily balanced energy &#39;</span>
                                                             <span class="s1">&#39;and protein supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;whether this woman is receiving daily calcium &#39;</span>
                                                                 <span class="s1">&#39;supplementation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has been initiated on treatment for &#39;</span>
                                                         <span class="s1">&#39;gestational hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Treatment this woman is receiving for gestational &#39;</span>
                                                                 <span class="s1">&#39;diabetes&#39;</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;diet_exercise&#39;</span><span class="p">,</span>
                                                                                         <span class="s1">&#39;orals&#39;</span><span class="p">,</span> <span class="s1">&#39;insulin&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received treatment for an ectopic &#39;</span>
                                                             <span class="s1">&#39;pregnancy&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;bitset list of interventions delivered to a woman &#39;</span>
                                                               <span class="s1">&#39;undergoing post abortion care&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received antibiotics as treatment for &#39;</span>
                                                         <span class="s1">&#39;premature rupture of membranes&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received magnesium sulphate for &#39;</span>
                                                       <span class="s1">&#39;treatment of severe pre-eclampsia/eclampsia&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;Whether this woman has received intravenous antihypertensive &#39;</span>
                                                         <span class="s1">&#39;drugs for treatment of severe hypertension&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;Admission type for women needing urgent &#39;</span>
                                                                          <span class="s1">&#39;delivery in the antenatal period&#39;</span><span class="p">,</span>
                                                       <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;induction_now&#39;</span><span class="p">,</span> <span class="s1">&#39;induction_future&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;caesarean_now&#39;</span><span class="p">,</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">,</span> <span class="s1">&#39;avd_now&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="n">parameter_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_AntenatalCare.xlsx&#39;</span><span class="p">,</span>
                                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;parameter_values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span><span class="n">parameter_dataframe</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.get_and_store_pregnancy_item_codes">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.get_and_store_pregnancy_item_codes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_and_store_pregnancy_item_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function defines the required consumables for each intervention delivered during this module and stores</span>
<span class="sd">        them in a module level dictionary called within HSIs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_list_of_items</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">get_list_of_items</span>

        <span class="c1"># ---------------------------------- BLOOD TEST EQUIPMENT ---------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------- IV DRUG ADMIN EQUIPMENT  -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">])</span>

        <span class="c1"># -------------------------------------------- ECTOPIC PREGNANCY ---------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;ectopic_pregnancy_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Halothane (fluothane)_250ml_CMST&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;ectopic_pregnancy_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Scalpel blade size 22 (individually wrapped)_100_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Suture pack&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Gauze, absorbent 90cm x 40m_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span>
                                     <span class="p">])</span>

        <span class="c1"># ------------------------------------------- POST ABORTION CARE - GENERAL  -----------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Misoprostol, tablet, 200 mcg&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Paracetamol, tablet, 500 mg&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Pethidine, 50 mg/ml, 2 ml ampoule&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span>
                                     <span class="p">])</span>

        <span class="c1"># ------------------------------------------- POST ABORTION CARE - SEPSIS -------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_sepsis_core&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Benzylpenicillin 3g (5MU), PFR_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Gentamycin, injection, 40 mg/ml in 2 ml vial&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_sepsis_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------- POST ABORTION CARE - SHOCK -------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_shock&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;post_abortion_care_shock_optional&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------- URINE DIPSTICK ----------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;urine_dipstick&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Urine analysis&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------- IRON AND FOLIC ACID ------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Ferrous Salt + Folic Acid, tablet, 200 + 0.25 mg&#39;</span><span class="p">])</span>

        <span class="c1"># --------------------------------- BALANCED ENERGY AND PROTEIN ----------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;balanced_energy_protein&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Dietary supplements (country-specific)&#39;</span><span class="p">])</span>

        <span class="c1"># --------------------------------- INSECTICIDE TREATED NETS ------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;itn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Insecticide-treated net&#39;</span><span class="p">])</span>

        <span class="c1"># --------------------------------- CALCIUM SUPPLEMENTS -----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;calcium&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Calcium, tablet, 600 mg&#39;</span><span class="p">])</span>

        <span class="c1"># -------------------------------- HAEMOGLOBIN TESTING -------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;hb_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Haemoglobin test (HB)&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------- ALBENDAZOLE -----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;albendazole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Albendazole 200mg_1000_CMST&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------- HEP B TESTING ---------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;hep_b_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Hepatitis B test kit-Dertemine_100 tests_CMST&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------- SYPHILIS TESTING ------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;syphilis_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Test, Rapid plasma reagin (RPR)&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------- SYPHILIS TREATMENT ----------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;syphilis_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------------------- IPTP --------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;iptp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Sulfamethoxazole + trimethropin, tablet 400 mg + 80 mg&#39;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------------------- GDM TEST ----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;gdm_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Blood glucose level test&#39;</span><span class="p">])</span>

        <span class="c1"># ------------------------------------------ FULL BLOOD COUNT -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;full_blood_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Complete blood count&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------------- BLOOD TRANSFUSION -------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;blood_transfusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Blood, one unit&#39;</span><span class="p">])</span>

        <span class="c1"># --------------------------------------- ORAL ANTIHYPERTENSIVES ---------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;oral_antihypertensives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Methyldopa 250mg_1000_CMST&#39;</span><span class="p">])</span>

        <span class="c1"># -------------------------------------  INTRAVENOUS ANTIHYPERTENSIVES ---------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;iv_antihypertensives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Hydralazine, powder for injection, 20 mg ampoule&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------------- MAGNESIUM SULPHATE ------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;magnesium_sulfate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Magnesium sulfate, injection, 500 mg/ml in 10-ml ampoule&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------------- MANAGEMENT OF ECLAMPSIA --------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;eclampsia_management_optional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Misoprostol, tablet, 200 mcg&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Oxytocin, injection, 10 IU in 1 ml ampoule&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Sodium chloride, injectable solution, 0,9 %, 500 ml&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Cannula iv  (winged with injection pot) 18_each_CMST&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Giving set iv administration + needle 15 drops/ml_each_CMST&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Disposables gloves, powder free, 100 pieces per box&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Oxygen, 1000 liters, primarily with oxygen cylinders&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Complete blood count&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Blood collecting tube, 5 ml&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Foley catheter&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Bag, urine, collecting, 2000 ml&#39;</span><span class="p">])</span>

        <span class="c1"># -------------------------------------- ANTIBIOTICS FOR PROM ------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Benzathine benzylpenicillin, powder for injection, 2.4 million IU&#39;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------- ORAL DIABETIC MANAGEMENT -----------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;oral_diabetic_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Glibenclamide 5mg_1000_CMST&#39;</span><span class="p">])</span>

        <span class="c1"># ---------------------------------------- INSULIN ----------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;insulin_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_list_of_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Insulin soluble 100 IU/ml, 10ml_each_CMST&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>

        <span class="c1"># We call the following function to store the required consumables for the simulation run within the appropriate</span>
        <span class="c1"># dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_and_store_pregnancy_item_codes</span><span class="p">()</span>

        <span class="c1"># set up anc counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anc_counter</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># Schedule logging event</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">CareOfWomenDuringPregnancyLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">364</span><span class="p">))</span>

        <span class="c1"># For the first period (2010-2015) we use the first value in each list as a parameter</span>
        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">update_current_parameter_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ==================================== REGISTERING DX_TESTS =================================================</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Next we register the relevant dx_tests used within this module...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">register_dx_test</span><span class="p">(</span>

            <span class="c1"># This test represents measurement of blood pressure used in ANC screening to detect hypertension in</span>
            <span class="c1"># pregnancy</span>
            <span class="n">blood_pressure_measurement</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_bp_monitoring&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_bp_monitoring&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents a urine dipstick which is used to measuring the presence and amount of protein in a</span>
            <span class="c1"># woman&#39;s urine, proteinuria being indicative of pre-eclampsia/eclampsia</span>
            <span class="n">urine_dipstick_protein</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_urine_protein_1_plus&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_urine_protein_1_plus&#39;</span><span class="p">]),</span>


            <span class="c1"># This test represents point of care haemoglobin testing used in ANC to detect anaemia (all-severity)</span>
            <span class="n">point_of_care_hb_test</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_poc_hb_test&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_poc_hb_test&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents laboratory based full blood count testing used in hospitals to determine severity of</span>
            <span class="c1"># anaemia via Hb levels</span>
            <span class="n">full_blood_count_hb</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_fbc_hb_test&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_fbc_hb_test&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents point of care glucose testing used in ANC to detect hyperglycemia, associated with</span>
            <span class="c1"># gestational diabetes</span>
            <span class="n">blood_test_glucose</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">,</span>
                <span class="n">target_categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uncontrolled&#39;</span><span class="p">],</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_blood_test_glucose&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_blood_test_glucose&#39;</span><span class="p">]),</span>

            <span class="c1"># This test represents point of care testing for syphilis</span>
            <span class="n">blood_test_syphilis</span><span class="o">=</span><span class="n">DxTest</span><span class="p">(</span>
                <span class="nb">property</span><span class="o">=</span><span class="s1">&#39;ps_syphilis&#39;</span><span class="p">,</span>
                <span class="n">sensitivity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sensitivity_blood_test_syphilis&#39;</span><span class="p">],</span>
                <span class="n">specificity</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;specificity_blood_test_syphilis&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HIV module is not registered in this simulation run and therefore HIV &#39;</span>
                                             <span class="s1">&#39;testing will not happen in antenatal care&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.care_of_women_in_pregnancy_property_reset">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.care_of_women_in_pregnancy_property_reset">[docs]</a>
    <span class="k">def</span> <span class="nf">care_of_women_in_pregnancy_property_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_or_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called following birth/pregnancy loss to reset the variables stored in this module. This</span>
<span class="sd">        prevents women experiencing the effects of these properties in future pregnancies</span>
<span class="sd">        :param id_or_index: individual id OR set of indexes to change the properties</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">id_or_index</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.further_on_birth_care_of_women_in_pregnancy">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.further_on_birth_care_of_women_in_pregnancy">[docs]</a>
    <span class="k">def</span> <span class="nf">further_on_birth_care_of_women_in_pregnancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the on_birth function of NewbornOutcomes module following a live birth or the Labour</span>
<span class="sd">         module following an intrapartum stillbirth . This function contains additional code related to the antenatal</span>
<span class="sd">         care module that should be ran following all births/late stillbirths - this is to ensure each modules</span>
<span class="sd">         (pregnancy,antenatal care, labour, newborn, postnatal) on_birth code is ran in the correct sequence</span>
<span class="sd">        :param mother_id: mothers individual id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]:</span>

            <span class="c1">#  run a check at birth to make sure no women exceed 8 visits</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">mother_id</span><span class="si">}</span><span class="s1"> attended &gt;8 ANC visits during her pregnancy&#39;</span><span class="p">)</span>

            <span class="c1"># We log the total number of ANC contacts a woman has undergone at the time of birth via this dictionary</span>
            <span class="k">if</span> <span class="s1">&#39;ga_anc_one&#39;</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">]:</span>
                <span class="n">ga_anc_one</span> <span class="o">=</span> <span class="n">mni</span><span class="p">[</span><span class="n">mother_id</span><span class="p">][</span><span class="s1">&#39;ga_anc_one&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ga_anc_one</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">total_anc_visit_count</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;person_id&#39;</span><span class="p">:</span> <span class="n">mother_id</span><span class="p">,</span>
                                     <span class="s1">&#39;total_anc&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">mother_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">],</span>
                                     <span class="s1">&#39;ga_anc_one&#39;</span><span class="p">:</span> <span class="n">ga_anc_one</span><span class="p">}</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_count_on_birth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">total_anc_visit_count</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A dictionary containing the number of ANC visits each woman has on birth&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.on_hsi_alert">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.on_hsi_alert">[docs]</a>
    <span class="k">def</span> <span class="nf">on_hsi_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">treatment_id</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;This is CareOfWomenDuringPregnancy, being alerted about a health system &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;interaction person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> for: </span><span class="si">{</span><span class="n">treatment_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


    <span class="c1">#  ================================ ADDITIONAL ANTENATAL HELPER FUNCTIONS =========================================</span>
<div class="viewcode-block" id="CareOfWomenDuringPregnancy.get_approx_days_of_pregnancy">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.get_approx_days_of_pregnancy">[docs]</a>
    <span class="k">def</span> <span class="nf">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the approximate number of days remaining in a woman&#39;s pregnancy - assuming all</span>
<span class="sd">         pregnancies go to full term (40 weeks gestational age)</span>
<span class="sd">        :param person_id: Mothers individual id</span>
<span class="sd">        :return: Approximate number of days left in a term pregnancy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">approx_days</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">7</span>

        <span class="c1"># Ensure only a positive number of days is returned</span>
        <span class="k">if</span> <span class="n">approx_days</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">approx_days</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">approx_days</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.determine_gestational_age_for_next_contact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.determine_gestational_age_for_next_contact">[docs]</a>
    <span class="k">def</span> <span class="nf">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by each of the ANC HSIs to determine the number of weeks before a woman is required to</span>
<span class="sd">        return for her next ANC contact in the schedule</span>
<span class="sd">        :param person_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># The recommended ANC schedule (gestational age in weeks at which it is recommended women attend) is</span>
        <span class="c1"># ANC1 - 12wks, ANC2 - 20wks, ANC3 - 26wks, ANC4 - 30wks, ANC5 - 34wks, ANC6 - 36wks, ANC7 - 38wks,</span>
        <span class="c1"># ANC8 - 40 wks</span>

        <span class="c1"># Using a woman&#39;s gestational age at the time of her current visit, we calculate how many weeks in the future</span>
        <span class="c1"># until she should return for her next visit in the schedule</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="k">elif</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">26</span>

        <span class="k">elif</span> <span class="mi">26</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="k">elif</span> <span class="mi">30</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">34</span>

        <span class="k">elif</span> <span class="mi">34</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">36</span>

        <span class="k">elif</span> <span class="mi">36</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">38</span>

        <span class="k">elif</span> <span class="mi">38</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="c1"># We schedule women who present very late for ANC to return in two weeks</span>
        <span class="k">elif</span> <span class="mi">42</span> <span class="o">&gt;</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">42</span>

        <span class="c1"># Return a gestation beyond the normal length of pregnancy. This wont be used for scheduling because women</span>
        <span class="c1"># arent scheduled ANC past 42 weeks (see next function)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="k">return</span> <span class="n">recommended_gestation_next_anc</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antenatal_care_scheduler">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antenatal_care_scheduler">[docs]</a>
    <span class="k">def</span> <span class="nf">antenatal_care_scheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="p">,</span> <span class="n">recommended_gestation_next_anc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is responsible for scheduling a woman&#39;s next ANC contact in the schedule if she chooses to seek</span>
<span class="sd">        care again.  It is called by each of the ANC HSIs.</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param visit_to_be_scheduled: Number if next visit in the schedule (2-8)</span>
<span class="sd">        :param recommended_gestation_next_anc: Gestational age in weeks a woman should be for the next visit in her</span>
<span class="sd">        schedule</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>

        <span class="c1"># Prevent women returning to ANC at very late gestational age</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">42</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We check that women will only be scheduled for the next ANC contact in the schedule</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">recommended_gestation_next_anc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Attempted to schedule an ANC visit for mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> at a&#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39; gestation lower than her current gestation&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Define possible ANC HSIs</span>
        <span class="n">visit_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">3</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">4</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">5</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">6</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">7</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">),</span>
                      <span class="mi">8</span><span class="p">:</span> <span class="n">HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">current_parameters</span><span class="p">[</span><span class="s1">&#39;anc_service_structure&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">visit_dict</span><span class="p">[</span><span class="n">visit_to_be_scheduled</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FocusedANCVisit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">,</span>
                                                                   <span class="n">visit_number</span><span class="o">=</span><span class="n">visit_to_be_scheduled</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calculate_visit_date_and_schedule_visit</span><span class="p">(</span><span class="n">visit</span><span class="p">):</span>
            <span class="c1"># We subtract this woman&#39;s current gestational age from the recommended gestational age for the next</span>
            <span class="c1"># contact</span>
            <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recommended_gestation_next_anc</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                              <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span>

            <span class="c1"># And use this value as the number of weeks until she is required to return for her next ANC</span>
            <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span>
                                                                <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

            <span class="c1"># We store the date of her next visit and use this date as part of a check when the ANC HSIs run</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>

        <span class="c1"># If this woman has attended less than 4 visits, and is predicted to attend &gt; 4 (as determined via the</span>
        <span class="c1"># PregnancySupervisor module when ANC1 is scheduled) her subsequent ANC appointment is automatically</span>
        <span class="c1"># scheduled</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">visit_to_be_scheduled</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">]:</span>
            <span class="n">calculate_visit_date_and_schedule_visit</span><span class="p">(</span><span class="n">visit</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">((</span><span class="n">visit_to_be_scheduled</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anc4&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">visit_to_be_scheduled</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prob_seek_anc</span><span class="si">{</span><span class="n">visit_to_be_scheduled</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]:</span>
                <span class="n">calculate_visit_date_and_schedule_visit</span><span class="p">(</span><span class="n">visit</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.schedule_admission">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.schedule_admission">[docs]</a>
    <span class="k">def</span> <span class="nf">schedule_admission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called within each of the ANC HSIs for women who require admission due to a complication</span>
<span class="sd">        detected during ANC</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Check correct women have been sent for admission</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> was scheduled for admission despite not requiring&#39;</span>
                                          <span class="sa">f</span><span class="s1">&#39; it&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;admission&#39;</span><span class="p">})</span>

        <span class="c1"># Schedule the appropriate event</span>
        <span class="n">inpatient</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">inpatient</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                            <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                            <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Reset the variable to prevent future scheduling errors</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.call_if_maternal_emergency_assessment_cant_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.call_if_maternal_emergency_assessment_cant_run">[docs]</a>
    <span class="k">def</span> <span class="nf">call_if_maternal_emergency_assessment_cant_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called if HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment is unable to run to ensure</span>
<span class="sd">         women still experience risk of death associated with the complication they had sought treatment for (as risk of</span>
<span class="sd">        death is applied following treatment within the HSI)</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_MaternalEmergencyAssessment: did not&#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39; run for person </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply_risk_of_death_from_monthly_complications</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span></div>


    <span class="c1"># ================================= INTERVENTIONS DELIVERED DURING ANC ============================================</span>
    <span class="c1"># The following functions contain the interventions that are delivered as part of routine ANC contacts. Functions</span>
    <span class="c1"># are called from within the ANC HSIs. Which interventions are called depends on the mothers gestation and the</span>
    <span class="c1"># number of visits she has attended at the time each HSI runs (see ANC HSIs)</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.check_intervention_should_run_and_update_mni">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.check_intervention_should_run_and_update_mni">[docs]</a>
    <span class="k">def</span> <span class="nf">check_intervention_should_run_and_update_mni</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">int_1</span><span class="p">,</span> <span class="n">int2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called to check if specific interventions within the ANC matrix should run for an individual.</span>
<span class="sd">        If the individual has received the intervention the appropriate amount of times per pregnancy then the</span>
<span class="sd">        intervention wont run again</span>
<span class="sd">        :param person_id: individual id</span>
<span class="sd">        :param int_1: first intervention (i.e. first tetanus vaccine)</span>
<span class="sd">        :param int2: second intervention (i.e. second tetanus vaccine)</span>
<span class="sd">        :return BOOL (should the intervention be delivered)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># If both of the interventions have been delivered, return false to prevent the intervention being delivered</span>
        <span class="c1"># again</span>
        <span class="k">if</span> <span class="n">int_1</span> <span class="ow">and</span> <span class="n">int2</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the first intervention hasn&#39;t already been given, store within the mni, return True so the intervention is</span>
        <span class="c1"># delivered</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">int_1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">int2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]):</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">int_1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If the second intervention hasn&#39;t already been given, store within the mni, return True so the intervention is</span>
        <span class="c1"># delivered</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">int_1</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">int2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]:</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">int2</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no conditions are met return true to prevent interventions not running</span>
            <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.screening_interventions_delivered_at_every_contact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.screening_interventions_delivered_at_every_contact">[docs]</a>
    <span class="k">def</span> <span class="nf">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the screening interventions which are delivered at every ANC contact regardless of the</span>
<span class="sd">        woman&#39;s gestational age and include blood pressure measurement and urine dipstick testing</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Delivery of the intervention is conditioned on a random draw against a probability that the intervention</span>
        <span class="c1"># would be delivered (used to calibrate to SPA data - acts as proxy for clinical quality)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_urine_ds&#39;</span><span class="p">]:</span>

            <span class="c1"># check consumables</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;urine_dipstick&#39;</span><span class="p">)</span>

            <span class="c1"># If the intervention will be delivered the dx_manager runs, returning True if the consumables are</span>
            <span class="c1"># available and the test detects protein in the urine</span>
            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                         <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;urine_dipstick_protein&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                <span class="c1"># We use a temporary variable to store if proteinuria is detected</span>
                <span class="n">proteinuria_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;dipstick&#39;</span><span class="p">})</span>

        <span class="c1"># The process is repeated for blood pressure monitoring</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_bp&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_pressure_measurement&#39;</span><span class="p">,</span>
                                                                       <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
                <span class="n">hypertension_diagnosed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;bp_measurement&#39;</span><span class="p">})</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="ow">and</span>\
                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;hypertension&#39;</span>
                                                                                                  <span class="s1">&#39;_onset&#39;</span><span class="p">]):</span>

                    <span class="c1"># We store date of onset to calculate dalys- only women who are aware of diagnosis experience DALYs</span>
                    <span class="c1"># (see daly weight for hypertension)</span>
                    <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;hypertension_onset&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># If either high blood pressure or proteinuria are detected (or both) we assume this woman needs to be admitted</span>
        <span class="c1"># for further treatment following this ANC contact</span>

        <span class="c1"># Only women who are not on treatment OR are determined to have severe disease whilst on treatment are admitted</span>
        <span class="k">if</span> <span class="n">hypertension_diagnosed</span> <span class="ow">or</span> <span class="n">proteinuria_diagnosed</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span>\
                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]:</span>

                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Here we conduct screening and initiate treatment for depression as needed</span>
        <span class="k">if</span> <span class="s1">&#39;Depression&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;depression_screen&#39;</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Depression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">do_on_presentation_to_care</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                                      <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.iron_and_folic_acid_supplementation">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.iron_and_folic_acid_supplementation">[docs]</a>
    <span class="k">def</span> <span class="nf">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains the intervention iron and folic acid supplementation delivered during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]:</span>

            <span class="c1"># check consumable availability - dose is total days of pregnancy x 2 tablets</span>
            <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">days</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;iron_folic_acid&#39;</span><span class="p">})</span>

                <span class="c1"># Importantly, only women who will be adherent to iron will experience the benefits of the</span>
                <span class="c1"># treatment effect</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_adherent_ifa&#39;</span><span class="p">]:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_iron_folic_acid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># Women started on IFA at this stage may already be anaemic, we here apply a probability that</span>
                    <span class="c1"># starting on a course of IFA will correct anaemia prior to follow up</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;effect_of_ifa_for_resolving_anaemia&#39;</span><span class="p">]:</span>

                        <span class="c1"># Store date of resolution for daly calculations</span>
                        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span>
                            <span class="n">person_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ps_anaemia_in_pregnancy&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_anaemia_resolution&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.balance_energy_and_protein_supplementation">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.balance_energy_and_protein_supplementation">[docs]</a>
    <span class="k">def</span> <span class="nf">balance_energy_and_protein_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains the intervention balance energy and protein supplementation delivered during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># Check the woman is not already receiving the supplements</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]:</span>

            <span class="c1"># If the consumables are available...</span>
            <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;balanced_energy_protein&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

            <span class="c1"># And she is deemed to be at risk (i.e. BMI &lt; 18) she is started on supplements</span>
            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;li_bmi&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_bep_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;b_e_p&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.insecticide_treated_bed_net">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.insecticide_treated_bed_net">[docs]</a>
    <span class="k">def</span> <span class="nf">insecticide_treated_bed_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function simply logs a consumable request for insecticide treated bed nets. Coverage of ITN and its</span>
<span class="sd">        effect is managed through the malaria module&#39;s calculation of malaria incidence.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;itn&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.tb_screening">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.tb_screening">[docs]</a>
    <span class="k">def</span> <span class="nf">tb_screening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function schedules HSI_TbScreening which represents screening for TB. Screening is only scheduled if</span>
<span class="sd">        if the TB module is registered.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Currently we schedule women to the TB screening HSI in the TB module</span>
        <span class="k">if</span> <span class="s1">&#39;Tb&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="n">tb_screen</span> <span class="o">=</span> <span class="n">HSI_Tb_ScreeningAndRefer</span><span class="p">(</span>
                <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">tb_screen</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.tetanus_vaccination">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.tetanus_vaccination">[docs]</a>
    <span class="k">def</span> <span class="nf">tetanus_vaccination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention tetanus vaccination. A booster dose of the vaccine is given to all women</span>
<span class="sd">         during ANC. Effect of vaccination is managed by the EPI module and therefore here we just capture consumables</span>
<span class="sd">         and number of doses</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="k">if</span> <span class="s1">&#39;Epi&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>

            <span class="c1"># Define the HSI in which the vaccine is delivered</span>
            <span class="n">vaccine_hsi</span> <span class="o">=</span> <span class="n">HSI_TdVaccine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Epi&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                        <span class="n">suppress_footprint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">vaccine_hsi</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.calcium_supplementation">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.calcium_supplementation">[docs]</a>
    <span class="k">def</span> <span class="nf">calcium_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains the intervention calcium supplementation delivered during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># If the woman is not already receiving supplements AND has been designated as high risk for pre-eclampsia</span>
        <span class="c1"># (as defined by ANC guidelines) then she will receive the interventions, conditional on consumables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                                                                         <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_parity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)):</span>

            <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;calcium&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_receiving_calcium_supplements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;calcium&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.point_of_care_hb_testing">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.point_of_care_hb_testing">[docs]</a>
    <span class="k">def</span> <span class="nf">point_of_care_hb_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention point of care haemoglobin testing provided to women during ANC1/ANC6</span>
<span class="sd">        to detect anaemia during pregnancy</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># If this woman has already had her Hb checked twice during pregnancy she will not receive another Hb test</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_intervention_should_run_and_update_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hb_1&#39;</span><span class="p">,</span> <span class="s1">&#39;hb_2&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;hb_screen&#39;</span><span class="p">})</span>

        <span class="c1"># Run check against probability of testing being delivered</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;hb_test&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">)</span>

        <span class="c1"># We run the test through the dx_manager and if a woman has anaemia and its detected she will be admitted</span>
        <span class="c1"># for further care</span>
        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span><span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;point_of_care_hb_test&#39;</span><span class="p">,</span>
                                                                             <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.albendazole_administration">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.albendazole_administration">[docs]</a>
    <span class="k">def</span> <span class="nf">albendazole_administration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention albendazole administration (de-worming) and is provided to women during</span>
<span class="sd">         ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># If this woman has already had deworming the intervention is not delivered again</span>
        <span class="k">if</span> <span class="s1">&#39;albend&#39;</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;albend&#39;</span><span class="p">)</span>

        <span class="c1"># We run this function to store the associated consumables with albendazole administration. This</span>
        <span class="c1"># intervention has no effect in the model due to limited evidence</span>

        <span class="c1"># If the consumables are available and the HCW will provide the tablets, the intervention is given</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;albendazole&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;albendazole&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.hep_b_testing">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.hep_b_testing">[docs]</a>
    <span class="k">def</span> <span class="nf">hep_b_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention Hepatitis B testing and is provided to women during ANC. As Hepatitis</span>
<span class="sd">        B is not modelled currently this intervention just maps consumables used during ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span>

        <span class="c1"># If this woman has already been tested for hep b twice in her pregnancy the intervention will not run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_intervention_should_run_and_update_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hep_b_1&#39;</span><span class="p">,</span> <span class="s1">&#39;hep_b_2&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># This intervention is a place holder prior to the Hepatitis B module being coded</span>
        <span class="c1"># Define the consumables</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="n">cons</span><span class="p">[</span><span class="s1">&#39;hep_b_test&#39;</span><span class="p">],</span>
                                          <span class="n">optional_item_codes</span><span class="o">=</span><span class="n">cons</span><span class="p">[</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">])</span>

        <span class="c1"># We log all the consumables required above but we only condition the event test happening on the</span>
        <span class="c1"># availability of the test itself</span>
        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;hep_b&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.syphilis_screening_and_treatment">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.syphilis_screening_and_treatment">[docs]</a>
    <span class="k">def</span> <span class="nf">syphilis_screening_and_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention Syphilis testing and is provided to women during ANC. As Syphilis is</span>
<span class="sd">        not modelled currently this intervention just maps consumables used during ANC</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># If this woman has already been screened twice for syphilis then the intervention will not run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_intervention_should_run_and_update_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;syph_1&#39;</span><span class="p">,</span> <span class="s1">&#39;syph_2&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># See if she will receive testing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_syph_test&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;syphilis_test&#39;</span><span class="p">})</span>

            <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;syphilis_test&#39;</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">)</span>

            <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                         <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_test_syphilis&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># If the testing occurs and detects syphilis she will get treatment (if consumables are available)</span>
            <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">test</span><span class="p">:</span>

                <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;syphilis_treatment&#39;</span><span class="p">,</span>
                    <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                    <span class="c1"># We assume that treatment is 100% effective at curing infection</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_syphilis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;syphilis_treat&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.hiv_testing">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.hiv_testing">[docs]</a>
    <span class="k">def</span> <span class="nf">hiv_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the scheduling for HIV testing and is provided to women during ANC.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># If she has already been tested for HIV she will not be tested again during ANC</span>
        <span class="k">if</span> <span class="s1">&#39;hiv&#39;</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;Hiv&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="c1"># The decision of whether the woman gets a test is determined by the Hiv module</span>
            <span class="n">test_scheduled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Hiv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decide_whether_hiv_test_for_mother</span><span class="p">(</span>
                <span class="n">person_id</span><span class="p">,</span> <span class="n">referred_from</span><span class="o">=</span><span class="s2">&quot;care_of_women_during_pregnancy&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">test_scheduled</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hiv&#39;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;hiv_screen&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.iptp_administration">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.iptp_administration">[docs]</a>
    <span class="k">def</span> <span class="nf">iptp_administration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function schedules HSI_MalariaIPTp for women who should receive IPTp during pregnancy (if the malaria</span>
<span class="sd">        module is registered)</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># If the Malaria module is registered women are scheduled to receive IPTp via this HSI event</span>
        <span class="k">if</span> <span class="s1">&#39;Malaria&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">HSI_MalariaIPTp</span><span class="p">(</span><span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Malaria&#39;</span><span class="p">]),</span> <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">tclose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.gdm_screening">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.gdm_screening">[docs]</a>
    <span class="k">def</span> <span class="nf">gdm_screening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains intervention of gestational diabetes screening during ANC. Screening is only conducted</span>
<span class="sd">         on women with pre-specified risk factors for the disease.</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Women already screened will not be screened again</span>
        <span class="k">if</span> <span class="s1">&#39;gdm_screen&#39;</span> <span class="ow">in</span> <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># We check if this woman has any of the key risk factors, if so they are sent for additional blood tests</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;li_bmi&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_prev_gest_diab&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;ps_prev_stillbirth&#39;</span><span class="p">]:</span>

            <span class="c1"># If they are available, the test is conducted</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_intervention_delivered_gdm_test&#39;</span><span class="p">]:</span>

                <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;gdm_test&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">)</span>

                <span class="c1"># If the test accurately detects a woman has gestational diabetes the consumables are recorded and</span>
                <span class="c1"># she is referred for treatment</span>
                <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                             <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;blood_test_glucose&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">):</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_interventions&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mother&#39;</span><span class="p">:</span> <span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;intervention&#39;</span><span class="p">:</span> <span class="s1">&#39;gdm_screen&#39;</span><span class="p">})</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;anc_ints&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;gdm_screen&#39;</span><span class="p">)</span>

                    <span class="c1"># We assume women with a positive GDM screen will be admitted (if they are not already receiving</span>
                    <span class="c1"># outpatient care)</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

                        <span class="c1"># Store onset after diagnosis as daly weight is tied to diagnosis</span>
                        <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;gest_diab_onset&#39;</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.interventions_delivered_each_visit_from_anc2">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.interventions_delivered_each_visit_from_anc2">[docs]</a>
    <span class="k">def</span> <span class="nf">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains a collection of interventions that are delivered to women every time they attend ANC</span>
<span class="sd">        from ANC visit 2</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance_energy_and_protein_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.check_anc1_can_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.check_anc1_can_run">[docs]</a>
    <span class="k">def</span> <span class="nf">check_anc1_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the first ANC contact and runs a series of checks to determine if the HSI should run</span>
<span class="sd">        on the date it has been scheduled for</span>
<span class="sd">        :param individual_id: individual id</span>
<span class="sd">        :param gest_age_next_contact: gestational age, in weeks, this woman is due to return for her next ANC</span>
<span class="sd">        :returns True/False as to whether the event can run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="n">visit</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span>
            <span class="n">person_id</span><span class="o">=</span><span class="n">individual_id</span><span class="p">)</span>

        <span class="c1"># Calculate the difference between the current date and when anc1 was scheduled for this woman at the start of</span>
        <span class="c1"># pregnancy</span>
        <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span>

        <span class="c1"># Only women who are alive, still pregnant and not in labour can attend ANC1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">or</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Here we block the event from running for previously scheduled ANC1 HSIs for women who have lost a pregnancy</span>
        <span class="c1"># and become pregnant again</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">date_difference</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">)</span>
             <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the woman is an inpatient when ANC1 is scheduled, she will try and return at the next appropriate</span>
        <span class="c1"># gestational age</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>

            <span class="c1"># We assume that she will return for her first appointment at the next gestation in the schedule</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;mother </span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1"> is scheduled to attend ANC today but is &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;currently an inpatient- she will be scheduled to arrive at her next &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;visit instead no interventions will be delivered here&#39;</span><span class="p">)</span>

            <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gest_age_next_contact</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span>
            <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">visit</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.check_subsequent_anc_can_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.check_subsequent_anc_can_run">[docs]</a>
    <span class="k">def</span> <span class="nf">check_subsequent_anc_can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">this_visit_number</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by the subsequent ANC contacts and runs a series of checks to determine if the HSI</span>
<span class="sd">        should run on the date it has been scheduled for</span>
<span class="sd">        :param individual_id: individual id</span>
<span class="sd">        :param this_visit_number: Number of the next ANC contact in the schedule</span>
<span class="sd">        :param gest_age_next_contact: gestational age, in weeks, this woman is due to return for her next ANC</span>
<span class="sd">        :returns True/False as to whether the event can run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span>

        <span class="n">ga_for_anc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">40</span><span class="p">}</span>

        <span class="c1"># If women have died, are no longer pregnant, are in labour, are postnatal, are pregnant but with a gestational</span>
        <span class="c1"># age lower than required for this anc visit or are &#39;late&#39; to attend this visit (usually for visits scheduled in</span>
        <span class="c1"># one pregnancy but running in a subsequent one) it will not run</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;la_is_postpartum&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ga_for_anc_dict</span><span class="p">[</span><span class="n">this_visit_number</span><span class="p">])</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">date_difference</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="ow">or</span>
             <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">this_visit_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If the woman is currently an inpatient then she will return at the next point in the contact schedule but</span>
        <span class="c1"># receive the care she has missed in this visit</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="n">this_visit_number</span><span class="p">,</span>
                                          <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="c1"># =============================== INTERVENTIONS DELIVERED DURING INPATIENT CARE ===================================</span>
    <span class="c1"># The following functions contain code for the interventions which are called by antenatal HSIs (not including</span>
    <span class="c1"># routine ANC) this includes post abortion/ectopic care and antenatal inpatient care</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancy.full_blood_count_testing">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.full_blood_count_testing">[docs]</a>
    <span class="k">def</span> <span class="nf">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function contains the intervention &#39;full blood count testing&#39; and represents blood testing requiring a</span>
<span class="sd">        laboratory. It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women admitted due to</span>
<span class="sd">        anaemia</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        :returns: result of the FBC [&#39;none&#39;, &#39;mild_mod&#39;, &#39;severe&#39;] (STR)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>

        <span class="c1"># Run dx_test for anaemia...</span>
        <span class="c1"># If a woman is not truly anaemic but the FBC returns a result of anaemia, due to tests specificity, we</span>
        <span class="c1"># assume the reported anaemia is mild</span>
        <span class="n">hsi_event</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">[</span><span class="s1">&#39;blood_test_equipment&#39;</span><span class="p">])</span>

        <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dx_manager</span><span class="o">.</span><span class="n">run_dx_test</span><span class="p">(</span>
                <span class="n">dx_tests_to_run</span><span class="o">=</span><span class="s1">&#39;full_blood_count_hb&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">test_result</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;non_severe&#39;</span>

        <span class="c1"># If the test correctly identifies a woman&#39;s anaemia we assume it correctly identifies its severity</span>
        <span class="k">if</span> <span class="n">test_result</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span>

        <span class="c1"># We return a none value if no anaemia was detected</span>
        <span class="k">return</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antenatal_blood_transfusion">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antenatal_blood_transfusion">[docs]</a>
    <span class="k">def</span> <span class="nf">antenatal_blood_transfusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains the intervention &#39;blood transfusion&#39;. It is called by either</span>
<span class="sd">        HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare or HSI_CareOfWomenDuringPregnancy_PostAbortionCase</span>
<span class="sd">        Management for women requiring blood for either haemorrhage or severe anaemia.</span>
<span class="sd">        given iron and folic acid supplements during ANC</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">store_dalys_in_mni</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">store_dalys_in_mni</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Check for consumables</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;blood_transfusion&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">)</span>

        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span>
                                                                                   <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;blood_tran&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="c1"># If the blood is available we assume the intervention can be delivered</span>
        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;blood_tran&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># If the woman is receiving blood due to anaemia we apply a probability that a transfusion of 2 units</span>
            <span class="c1"># RBCs will correct this woman&#39;s severe anaemia</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;treatment_effect_blood_transfusion_anaemia&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">store_dalys_in_mni</span><span class="p">(</span><span class="n">individual_id</span><span class="p">,</span> <span class="n">mni</span><span class="p">,</span> <span class="s1">&#39;severe_anaemia_resolution&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_anaemia_in_pregnancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initiate_maintenance_anti_hypertensive_treatment">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initiate_maintenance_anti_hypertensive_treatment">[docs]</a>
    <span class="k">def</span> <span class="nf">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of oral antihypertensive medication for women with high blood pressure. It is</span>
<span class="sd">        called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have been identified as having</span>
<span class="sd">         high blood pressure in pregnancy but are not yet receiving treatment</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Calculate the approximate dose for the remainder of pregnancy and check availability</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;oral_antihypertensives&#39;</span><span class="p">,</span>
            <span class="n">number</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># If the consumables are available then the woman is started on treatment</span>
        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_htn_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.initiate_treatment_for_severe_hypertension">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.initiate_treatment_for_severe_hypertension">[docs]</a>
    <span class="k">def</span> <span class="nf">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of intravenous antihypertensive medication for women with severely high blood</span>
<span class="sd">        pressure. It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have been</span>
<span class="sd">        admitted due to severely high blood pressure (severe gestational hypertension, severe pre-eclampsia or</span>
<span class="sd">        eclampsia)</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Define the consumables and check their availability</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;iv_antihypertensives&#39;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">)</span>

        <span class="c1"># If they are available then the woman is started on treatment</span>
        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;iv_htns&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span>

            <span class="c1"># We assume women treated with antihypertensives would no longer be severely hypertensive- meaning they</span>
            <span class="c1"># are not at risk of death from severe gestational hypertension in the PregnancySupervisor event</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gest_htn&#39;</span>

            <span class="c1"># We dont assume antihypertensives convert severe pre-eclampsia/eclampsia to a more mild version of the</span>
            <span class="c1"># disease (as the disease is multi-system and hypertension is only one contributing factor to mortality) but</span>
            <span class="c1"># instead use this property to reduce risk of acute death from this episode of disease</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;ps_htn_disorders&#39;</span><span class="p">]</span> <span class="o">==</span>
                                                                                     <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_iv_anti_htn_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.treatment_for_severe_pre_eclampsia_or_eclampsia">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.treatment_for_severe_pre_eclampsia_or_eclampsia">[docs]</a>
    <span class="k">def</span> <span class="nf">treatment_for_severe_pre_eclampsia_or_eclampsia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of intravenous magnesium sulphate medication for women with severely</span>
<span class="sd">        pre-eclampsia/eclampsia It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who</span>
<span class="sd">        have been admitted with those conditions</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;magnesium_sulfate&#39;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;eclampsia_management_optional&#39;</span><span class="p">)</span>

        <span class="c1"># check HCW will deliver intervention</span>
        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span>
                                                                                   <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;anticonvulsant&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="c1"># If available deliver the treatment</span>
        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_mag_sulph_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mag_sulph&#39;</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">)</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.antibiotics_for_prom">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.antibiotics_for_prom">[docs]</a>
    <span class="k">def</span> <span class="nf">antibiotics_for_prom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function contains initiation of antibiotics for women with who have been admitted following premature</span>
<span class="sd">        rupture of membranes .It is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># check consumables and whether HCW are available to deliver the intervention</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;abx_for_prom&#39;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">)</span>

        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span>
                                                                                   <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;iv_abx&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="n">hsi_event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">avail</span> <span class="ow">and</span> <span class="n">sf_check</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_abx_for_prom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.ectopic_pregnancy_treatment_doesnt_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.ectopic_pregnancy_treatment_doesnt_run">[docs]</a>
    <span class="k">def</span> <span class="nf">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsi_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called within HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy if the event cannot</span>
<span class="sd">        run/the intervention cannot be delivered. This ensures that women with ectopic pregnancies that haven&#39;t ruptured</span>
<span class="sd">        will experience rupture and risk of death without treatment</span>
<span class="sd">        :param hsi_event: HSI event in which the function has been called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">hsi_event</span><span class="o">.</span><span class="n">target</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy: did not run&#39;</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="n">EctopicPregnancyRuptureEvent</span>

        <span class="c1"># If this event cannot run we ensure all women will eventually experience rupture due to untreated ectopic</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">individual_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">EctopicPregnancyRuptureEvent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">individual_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancy.calculate_beddays">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancy.calculate_beddays">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_beddays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called by HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare to calculate the number of</span>
<span class="sd">        beddays required by a women following admission. This is determined according to the reason for her admission</span>
<span class="sd">        and her gestation</span>
<span class="sd">        :param individual_id: individual_id</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span>

        <span class="c1"># Women with abruption, praevia or chorioamnionitis prior to 28 weeks will not be delivered until they have</span>
        <span class="c1"># reached that gestation</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placental_abruption</span> <span class="ow">or</span>
            <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">))</span> <span class="ow">or</span>
             <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">):</span>
            <span class="n">beddays</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>

        <span class="c1"># Similarly more mild bleeding or PROM without infection occuring prior to 37 weeks will not be delivered until</span>
        <span class="c1"># they have reached that gestation</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;mild_moderate&#39;</span><span class="p">))</span> <span class="ow">or</span>
              <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span><span class="p">))</span> <span class="ow">and</span> \
             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">):</span>
            <span class="n">beddays</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">37</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">beddays</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">beddays</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This is the  HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact which represents the first routine</span>
<span class="sd">    antenatal care contact (ANC1). It is scheduled by the PregnancySupervisor Event for women who choose to seek</span>
<span class="sd">    routine antenatal care during their pregnancy. It is recommended that this visit occur before 12 weeks gestation.</span>
<span class="sd">    This event delivers the interventions to women which are part of ANC1. Additionally interventions that should be</span>
<span class="sd">    offered in the early ANC contacts are provided to women who present to ANC1 later in their pregnancy. Scheduling</span>
<span class="sd">    the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient ward in the</span>
<span class="sd">    case of complications &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;AntenatalFirst&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># Calculate when this woman should return for her next visit</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

        <span class="c1"># Check this visit can run</span>
        <span class="n">can_anc1_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_anc1_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc1_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># store GA at first visit</span>
            <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;ga_anc_one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span>

            <span class="c1"># We add a visit to a rolling total of ANC visits in this pregnancy</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="c1"># First all women, regardless of ANC contact or gestation, undergo urine and blood pressure measurement</span>
            <span class="c1"># and depression screening</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Next, all women attending their first ANC receive the following interventions, regardless of gestational</span>
            <span class="c1"># age at presentation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">balance_energy_and_protein_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">insecticide_treated_bed_net</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tb_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hiv_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># If the woman presents after 20 weeks she is provided interventions she has missed by presenting late</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">19</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">albendazole_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calcium_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Any women presenting for ANC1 after 26 week are also required to have a GDM screen</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">26</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Then we determine if this woman will return for her next ANC visit</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="c1"># If the woman has had any complications detected during ANC she is admitted for treatment to be initiated</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareVisit: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareVisit: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact which represents the second routine</span>
<span class="sd">    antenatal care contact (ANC2). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FirstAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 20</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC2. Additionally interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                               <span class="n">this_visit_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                                               <span class="n">gest_age_next_contact</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="c1"># First we administer the administer the interventions all women will receive at this contact regardless of</span>
            <span class="c1"># gestational age</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># And we schedule the next ANC appointment</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="c1"># Then we administer interventions that are due to be delivered at this woman&#39;s gestational age, which may</span>
            <span class="c1"># be in addition to intervention delivered in ANC2</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">albendazole_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareVisit: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareVisit: cannot not run with &#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact which represents the third routine</span>
<span class="sd">    antenatal care contact (ANC3). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SecondAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 26</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC3. Additionally interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">gdm_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact which represents the fourth routine</span>
<span class="sd">    antenatal care contact (ANC4). It is scheduled by the HSI_CareOfWomenDuringPregnancy_ThirdAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 30</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC4. Additionally interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact which represents the fifth routine</span>
<span class="sd">    antenatal care contact (ANC5). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FourthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 34</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC5. Additionally, interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hep_b_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact which represents the sixth routine</span>
<span class="sd">    antenatal care contact (ANC6). It is scheduled by the HSI_CareOfWomenDuringPregnancy_FifthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC6. Additionally, interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact: cannot not run with&#39;</span>
                                         <span class="s1">&#39;this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact which represents the seventh routine</span>
<span class="sd">    antenatal care contact (ANC7). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SixthAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC7. Additionally, interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#  =================================== INTERVENTIONS ====================================================</span>
            <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">gest_age_next_contact</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the  HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact which represents the eighth routine</span>
<span class="sd">    antenatal care contact (ANC8). It is scheduled by the HSI_CareOfWomenDuringPregnancy_SeventhAntenatalCareContact for</span>
<span class="sd">    women who choose to seek additional ANC after their previous visit. It is recommended that this visit occur at 36</span>
<span class="sd">    weeks gestation. This event delivers the interventions to women which are part of ANC8. Additionally, interventions</span>
<span class="sd">    that should be delivered according to a woman&#39;s gestational age and position in her ANC schedule are delivered.</span>
<span class="sd">    Finally scheduling the next ANC contact in the occurs during this HSI along with admission to antenatal inpatient</span>
<span class="sd">    ward in the case of complications.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># Run the check</span>
        <span class="n">gest_age_next_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">determine_gestational_age_for_next_contact</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="n">can_anc_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">check_subsequent_anc_can_run</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">gest_age_next_contact</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">can_anc_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">interventions_delivered_each_visit_from_anc2</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>

            <span class="k">return</span>  <span class="c1"># return nothing implies that the footprint used matches the EXPECTED_APPT_FOOTPRINT</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return a blank footprint as the appointment could not run as intended</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact: did not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_EighthAntenatalCareContact: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FocusedANCVisit">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FocusedANCVisit">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_FocusedANCVisit</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This is HSI_CareOfWomenDuringPregnancy_FocusedANCVisit which is scheduled by the PregnancySupervisor if the</span>
<span class="sd">     parameter &#39;anc_service_structure&#39; == 4. This HSI replicates the ANC service structured used within Malawi prior</span>
<span class="sd">     to 2016. We use this HSI to replicate the Focused ANC service structure (4 visits at approx 16, 22, 30, 36 weeks)</span>
<span class="sd">     within some analyses as the scheduled of interventions per visit is different from the ANC8 structure. This event</span>
<span class="sd">     represents all four ANC visits.</span>
<span class="sd">     &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FocusedANCVisit.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FocusedANCVisit.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">visit_number</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">=</span> <span class="n">visit_number</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Outpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({(</span><span class="s1">&#39;AntenatalFirst&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                                                                  <span class="k">else</span> <span class="s1">&#39;ANCSubsequent&#39;</span><span class="p">):</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_FocusedANCVisit.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_FocusedANCVisit.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="c1"># First we determine at what point in this woman&#39;s pregnancy should she return for another visit</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">22</span>
        <span class="k">elif</span> <span class="mi">22</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">elif</span> <span class="mi">30</span> <span class="o">&lt;=</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">36</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recommended_gestation_next_anc</span> <span class="o">=</span> <span class="mi">50</span>

        <span class="c1"># We calculate the difference between today&#39;s date and the date this event should run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span>

        <span class="c1"># Only women who are alive, still pregnant, not in labour, less than a week &#39;over due&#39; for the event, have</span>
        <span class="c1"># attended less than four visits and are greater than 7 weeks pregnant will undergo the HSI</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">date_difference</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">!=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># return blank footprint as the appointment did not run as intended.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>

        <span class="c1"># Women who are inpatients at the time the HSI should run will return at the next recommended point in</span>
        <span class="c1"># pregnancy</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">):</span>
            <span class="n">weeks_due_next_visit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recommended_gestation_next_anc</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">])</span>
            <span class="n">visit_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">weeks_due_next_visit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">visit_date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">visit_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_date_of_anc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_date_next_contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_date</span>

            <span class="c1"># return blank footprint as the appointment did not run as intended.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;HealthSystem&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_blank_appt_footprint</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># updated mni with GA at first visit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;ga_anc_one&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gestational_age_in_weeks&#39;</span><span class="p">]</span>

            <span class="c1"># We add a visit to a rolling total of ANC visits in this pregnancy used for logging</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_total_anc_visits_current_pregnancy&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Next interventions are delivered according to gestational age and visit number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">screening_interventions_delivered_at_every_contact</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iptp_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tb_screening</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">hiv_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">syphilis_screening_and_treatment</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">albendazole_administration</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">tetanus_vaccination</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">point_of_care_hb_testing</span><span class="p">(</span><span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Following this the woman&#39;s next visit is scheduled (if she hasn&#39;t already attended 4 visits)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>

                <span class="c1"># update the visit number for the event scheduling</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># schedule the next event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_care_scheduler</span><span class="p">(</span><span class="n">individual_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">,</span>
                                                     <span class="n">visit_to_be_scheduled</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">visit_number</span><span class="p">,</span>
                                                     <span class="n">recommended_gestation_next_anc</span><span class="o">=</span><span class="n">recommended_gestation_next_anc</span><span class="p">)</span>

            <span class="c1"># If the woman has had any complications detected during ANC she is admitted for treatment to be initiated</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_to_be_admitted&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">schedule_admission</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour. It is schedule by the PregnancySupervisor Event</span>
<span class="sd">    for women who present to the health system for induction as their labour has progressed longer than expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Inpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PresentsForInductionOfLabour.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="c1"># If the woman is no longer alive, pregnant is in labour or is an inpatient already then the event doesnt run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_alive&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;is_pregnant&#39;</span><span class="p">]</span> <span class="ow">or</span> \
           <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;la_currently_in_labour&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;hs_is_inpatient&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="c1"># We set this admission property to show shes being admitted for induction of labour and hand her over to the</span>
        <span class="c1"># labour events</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will move to labour ward for &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ac_admitted_for_immediate_delivery&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> today&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare. This HSI can be scheduled by any of the ANC HSIs</span>
<span class="sd">    for women who have been identified as having complications or by HSI_CareOfWomenDuringPregnancy_</span>
<span class="sd">    MaternalEmergencyAssessment or HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientFollowUp.This HSI represents the</span>
<span class="sd">    antenatal ward which would deliver care to women experiencing complications associated with their pregnancy</span>
<span class="sd">    including anaemia, hypertension, gestational diabetes, antepartum haemorrhage, premature rupture of membranes or</span>
<span class="sd">    chorioamnionitis. For women whom delivery is indicated as part of treatment for a complications they are scheduled</span>
<span class="sd">    to the LabourOnset Event</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_Inpatient&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>

        <span class="n">beddays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">calculate_beddays</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="n">beddays</span><span class="p">})</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">current_parameters</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">mni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># store the GA at which CS will most likely be scheduled for in those for which it is indicated</span>
        <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">37</span>

        <span class="c1"># The event represents inpatient care delivered within the antenatal ward at a health facility. Therefore</span>
        <span class="c1"># it is assumed that women with a number of different complications could be sent to this HSI for treatment.</span>

        <span class="c1"># ================================= INITIATE TREATMENT FOR ANAEMIA ========================================</span>
        <span class="c1"># Women who are referred from ANC or an outpatient appointment following point of care Hb which detected</span>
        <span class="c1"># anaemia first have a full blood count test to determine the severity of their anaemia</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_anaemia_in_pregnancy</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>

            <span class="c1"># This test returns one of a number of possible outcomes as seen below...</span>
            <span class="n">fbc_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fbc_result</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;FBC result error&#39;</span><span class="p">)</span>

            <span class="c1"># If the FBC detected non severe anaemia (Hb &gt;7) she is treated</span>
            <span class="k">if</span> <span class="n">fbc_result</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">):</span>

                <span class="c1"># Women are started on daily iron and folic acid supplementation (if they are not already receiving</span>
                <span class="c1"># supplements) as treatment for mild/moderate anaemia</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">fbc_result</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">:</span>
                <span class="c1"># In the case of severe anaemia (Hb &lt;7) then, in addition to the above treatments, this woman</span>
                <span class="c1"># should receive a blood transfusion to correct her anaemia</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antenatal_blood_transfusion</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_receiving_iron_folic_acid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">iron_and_folic_acid_supplementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fbc_result</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">):</span>
                <span class="c1"># Women treated for anaemia will need follow up to ensure the treatment has been effective. Clinical</span>
                <span class="c1"># guidelines suggest follow up one month after treatment</span>

                <span class="c1"># To avoid issues with scheduling of events we assume women who are not scheduled to return to</span>
                <span class="c1"># routine ANC OR their next ANC appointment is more than a month away will be asked to routine for</span>
                <span class="c1"># follow up</span>
                <span class="n">follow_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_date_next_contact</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_date_next_contact</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&gt;</span>
                                                              <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)):</span>

                    <span class="n">outpatient_checkup</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">topen</span><span class="o">=</span><span class="n">follow_up_date</span><span class="p">,</span>
                                                                        <span class="n">tclose</span><span class="o">=</span><span class="n">follow_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

        <span class="c1"># ======================== INITIATE TREATMENT FOR GESTATIONAL DIABETES (case management) ==================</span>
        <span class="c1"># Women admitted with gestational diabetes are given dietary and exercise advice as first line treatment</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;diet_exercise&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

            <span class="c1"># We then schedule GestationalDiabetesGlycaemicControlEvent which determines if this treatment will be</span>
            <span class="c1"># effective in controlling this woman&#39;s blood sugar prior to her next check up</span>
            <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="n">GestationalDiabetesGlycaemicControlEvent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

            <span class="c1"># We then schedule this woman to return for blood sugar testing to evaluate the effectiveness of her</span>
            <span class="c1"># treatment and potentially move to second line treatment</span>
            <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

            <span class="n">outpatient_checkup</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

        <span class="c1"># =============================== INITIATE TREATMENT FOR HYPERTENSION =====================================</span>
        <span class="c1"># Treatment delivered to mothers with hypertension is dependent on severity. Women admitted due to more mild</span>
        <span class="c1"># hypertension are started on regular oral antihypertensives therapy (reducing risk of progression to more</span>
        <span class="c1"># severe hypertension)</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;gest_htn&#39;</span><span class="p">,</span> <span class="s1">&#39;mild_pre_eclamp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Women with severe gestational hypertension are also started on routine oral antihypertensives (if not</span>
        <span class="c1"># already receiving- this will prevent progression once this episode of severe hypertension has been</span>
        <span class="c1"># rectified)</span>
        <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_gest_htn&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># In addition, women with more severe disease are given intravenous anti hypertensives to reduce risk</span>
            <span class="c1"># of death</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Treatment guidelines dictate that women with severe forms of pre-eclampsia should be admitted for delivery</span>
        <span class="c1"># to reduce risk of death and pregnancy loss</span>
        <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">):</span>

            <span class="c1"># Women are started on oral antihypertensives</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_htn_on_treatment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_maintenance_anti_hypertensive_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># And are given intravenous magnesium sulfate which reduces risk of death from eclampsia and reduces a</span>
            <span class="c1"># woman&#39;s risk of progressing from severe pre-eclampsia to eclampsia during the intrapartum period</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">treatment_for_severe_pre_eclampsia_or_eclampsia</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span>
                                                                        <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># intravenous antihypertensives are also given</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">initiate_treatment_for_severe_hypertension</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Finally This property stores what type of delivery this woman is being admitted for</span>
            <span class="n">delivery_mode</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;induction_now&#39;</span><span class="p">,</span> <span class="s1">&#39;avd_now&#39;</span><span class="p">,</span> <span class="s1">&#39;caesarean_now&#39;</span><span class="p">]</span>

            <span class="c1"># Mode of delivery is dependent on individual case severity. We use a probability weighted random draw</span>
            <span class="c1"># to determine mode of delivery here</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;eclampsia&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                    <span class="n">delivery_mode</span><span class="p">,</span>  <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_delivery_modes_ec&#39;</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_htn_disorders</span> <span class="o">==</span> <span class="s1">&#39;severe_pre_eclamp&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
                    <span class="n">delivery_mode</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;prob_delivery_modes_spe&#39;</span><span class="p">])</span>

            <span class="c1"># Log the indication for any caesarean deliveries</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;caesarean_now&#39;</span><span class="p">,</span> <span class="s1">&#39;caesarean_future&#39;</span><span class="p">):</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spe_ec&#39;</span>

        <span class="c1"># ========================= INITIATE TREATMENT FOR ANTEPARTUM HAEMORRHAGE =================================</span>
        <span class="c1"># Treatment delivered to mothers due to haemorrhage in the antepartum period is dependent on the underlying</span>
        <span class="c1"># etiology of the bleeding (in this model, whether a woman is experiencing a placental abruption or</span>
        <span class="c1"># placenta praevia)</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="c1"># ---------------------- APH SECONDARY TO PLACENTAL ABRUPTION -----------------------------------------</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_placental_abruption</span> <span class="ow">and</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">:</span>
                <span class="c1"># Women experiencing placenta abruption at are admitted for immediate</span>
                <span class="c1"># caesarean delivery due to high risk of mortality/morbidity</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_now&#39;</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;an_aph_pa&#39;</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_placental_abruption</span> <span class="ow">and</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_future&#39;</span>
                <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;an_aph_pa&#39;</span>
                <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">28</span>

            <span class="c1"># ---------------------- APH SECONDARY TO PLACENTA PRAEVIA -----------------------------------------</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_placenta_praevia</span><span class="p">:</span>
                <span class="c1"># The treatment plan for a woman with placenta praevia is dependent on both the severity of the</span>
                <span class="c1"># bleed and her current gestation at the time of bleeding</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">)</span> <span class="ow">or</span> \
                   <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">):</span>
                    <span class="c1"># Women experiencing severe bleeding are admitted immediately for caesarean section</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_now&#39;</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;an_aph_pp&#39;</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">==</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;=</span> <span class="mi">28</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_future&#39;</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;an_aph_pp&#39;</span>
                    <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">28</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_antepartum_haemorrhage</span> <span class="o">!=</span> <span class="s1">&#39;severe&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;caesarean_future&#39;</span>
                    <span class="n">mni</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;cs_indication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;an_aph_pp&#39;</span>
                    <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">37</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> was not admitted for delivery following APH&#39;</span><span class="p">)</span>

        <span class="c1"># ===================================== INITIATE TREATMENT FOR PROM =======================================</span>
        <span class="c1"># Treatment for women with premature rupture of membranes is dependent upon a woman&#39;s gestational age and if</span>
        <span class="c1"># she also has an infection of membrane surrounding the foetus (the chorion)</span>

        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_premature_rupture_of_membranes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span><span class="p">:</span>
            <span class="c1"># If the woman has PROM but no infection, she is given prophylactic antibiotics which will reduce</span>
            <span class="c1"># the risk of maternal and neonatal infection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">antibiotics_for_prom</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Guidelines suggest women over 34 weeks of gestation should be admitted for induction to to</span>
            <span class="c1"># increased risk of morbidity and mortality</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">37</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>

            <span class="c1"># Otherwise they may stay as an inpatient until their gestation as increased prior to delivery</span>
            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_future&#39;</span>
                <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">37</span>

        <span class="c1"># ============================== INITIATE TREATMENT FOR CHORIOAMNIONITIS ==================================</span>
        <span class="c1"># Women with chorioamnionitis are admitted for delivery (and will receive antibiotics in the labour module)</span>
        <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_chorioamnionitis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_now&#39;</span>

            <span class="k">elif</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;=</span> <span class="mi">28</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;induction_future&#39;</span>
                <span class="n">assumed_weeks_till_delivery</span> <span class="o">=</span> <span class="mi">28</span>

        <span class="c1"># ======================== ADMISSION FOR DELIVERY (INDUCTION) ========================================</span>
        <span class="c1"># Women for whom immediate delivery is indicated are schedule to move straight to the labour model where</span>
        <span class="c1"># they will have the appropriate properties set and facility delivery at a hospital scheduled (mode of</span>
        <span class="c1"># delivery will match the recommended mode here)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;induction_now&#39;</span><span class="p">,</span> <span class="s1">&#39;caesarean_now&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Women who require delivery BUT are not in immediate risk of morbidity/mortality will remain as</span>
        <span class="c1"># inpatients until they can move to the labour model. Currently it is possible for women to go into</span>
        <span class="c1"># labour whilst as an inpatient - it is assumed they are delivered via the mode recommended here</span>
        <span class="c1"># (i.e induction/caesarean)</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_admitted_for_immediate_delivery&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;caesarean_future&#39;</span><span class="p">,</span> <span class="s1">&#39;induction_future&#39;</span><span class="p">):</span>

            <span class="c1"># Here we calculate how many days this woman needs to remain on the antenatal ward before she can go</span>
            <span class="c1"># for delivery (assuming delivery is indicated to occur at 37 weeks)</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&lt;</span> <span class="n">assumed_weeks_till_delivery</span><span class="p">:</span>
                <span class="n">days_until_safe_for_cs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">assumed_weeks_till_delivery</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-</span>
                                             <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">days_until_safe_for_cs</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># We schedule the LabourOnset event for this woman will be able to progress for delivery</span>
            <span class="n">admission_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_until_safe_for_cs</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mother </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s1"> will move to labour ward for &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ac_admitted_for_immediate_delivery&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> on &#39;</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">admission_date</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">LabourOnsetEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span>
                                    <span class="n">admission_date</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare: did not run&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare: cannot not run&#39;</span>
                                         <span class="s1">&#39; with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HSI_CareOfWomenDuringPregnancy_AntenatalManagementOfAnaemia. It is scheduled by HSI_CareOfWomenDuringPregnancy_</span>
<span class="sd">    AntenatalWardInpatientCare for women who have developed anaemia during pregnancy. This event manages repeat blood</span>
<span class="sd">    testing for women who were found to be anaemic and treated. If the woman remains anaemic she is readmitted to the</span>
<span class="sd">    inpatient ward for further care.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_FollowUp&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We only run the event if the woman is not already in labour or already admitted due to something else</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span><span class="p">:</span>

            <span class="c1"># Health care worker performs a full blood count</span>
            <span class="n">fbc_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">full_blood_count_testing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># If she is determined to still be anaemic she is admitted for additional treatment via the inpatient event</span>
            <span class="k">if</span> <span class="n">fbc_result</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;mild&#39;</span><span class="p">,</span> <span class="s1">&#39;moderate&#39;</span><span class="p">,</span> <span class="s1">&#39;severe&#39;</span><span class="p">):</span>

                <span class="n">admission</span> <span class="o">=</span> <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">admission</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia: did &#39;</span>
                                         <span class="s1">&#39;not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfAnaemia: &#39;</span>
                                         <span class="s1">&#39;cannot not run with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span>
                                                                                        <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This is HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes. It is scheduled by</span>
<span class="sd">     HSI_CareOfWomenDuringPregnancy_AntenatalWardInpatientCare for women who have developed gestational diabetes during</span>
<span class="sd">     pregnancy. This event manages repeat blood testing for women who were found to have GDM and treated. If the woman</span>
<span class="sd">     remains hyperglycaemic she is moved to the next line treatment and scheduled to return for follow up.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_FollowUp&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;Over5OPD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ALERT_OTHER_DISEASES</span> <span class="o">=</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="kn">from</span> <span class="nn">tlo.methods.pregnancy_supervisor</span> <span class="kn">import</span> <span class="n">GestationalDiabetesGlycaemicControlEvent</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_pregnant</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">la_currently_in_labour</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">hs_is_inpatient</span> <span class="ow">and</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span> \
                <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_gestational_age_in_weeks</span> <span class="o">&gt;</span> <span class="mi">21</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">schedule_gdm_event_and_checkup</span><span class="p">():</span>
                <span class="c1"># Schedule GestationalDiabetesGlycaemicControlEvent which determines if this new treatment will</span>
                <span class="c1"># effectively control blood glucose prior to next follow up</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">GestationalDiabetesGlycaemicControlEvent</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>

                <span class="c1"># Schedule follow-up</span>
                <span class="n">check_up_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>

                <span class="n">outpatient_checkup</span> <span class="o">=</span> \
                    <span class="n">HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;CareOfWomenDuringPregnancy&#39;</span><span class="p">],</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span><span class="n">outpatient_checkup</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="n">topen</span><span class="o">=</span><span class="n">check_up_date</span><span class="p">,</span>
                                                                    <span class="n">tclose</span><span class="o">=</span><span class="n">check_up_date</span> <span class="o">+</span> <span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

            <span class="c1"># If the treatment a woman was started on has not controlled her hyperglycemia she will be started on the</span>
            <span class="c1"># next treatment</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_gest_diab</span> <span class="o">==</span> <span class="s1">&#39;uncontrolled&#39;</span><span class="p">:</span>

                <span class="c1"># Women for whom diet and exercise was not effective in controlling hyperglycemia are started on oral</span>
                <span class="c1"># meds</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;diet_exercise&#39;</span><span class="p">:</span>

                    <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;oral_diabetic_treatment&#39;</span><span class="p">,</span>
                        <span class="n">number</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">get_approx_days_of_pregnancy</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>

                    <span class="c1"># If the meds are available women are started on that treatment</span>
                    <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;orals&#39;</span>

                        <span class="c1"># Assume new treatment is effective in controlling blood glucose on initiation</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span>

                        <span class="c1"># schedule followup</span>
                        <span class="n">schedule_gdm_event_and_checkup</span><span class="p">()</span>

                <span class="c1"># This process is repeated for mothers for whom oral medication is not effectively controlling their</span>
                <span class="c1"># blood sugar- they are started on insulin</span>
                <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ac_gest_diab_on_treatment</span> <span class="o">==</span> <span class="s1">&#39;orals&#39;</span><span class="p">:</span>

                    <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;insulin_treatment&#39;</span><span class="p">,</span>
                        <span class="n">number</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_gest_diab_on_treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;insulin&#39;</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_gest_diab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;controlled&#39;</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestational&#39;</span>
                                         <span class="s1">&#39;Diabetes: did &#39;</span>
                                         <span class="s1">&#39;not run&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestationalDiabetes.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_AntenatalOutpatientManagementOfGestational&#39;</span>
                                         <span class="s1">&#39;Diabetes: cannot not run with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement. It is scheduled by</span>
<span class="sd">    HSI_GenericEmergencyFirstApptAtFacilityLevel1 for women who have presented to hospital due to the complications of</span>
<span class="sd">    either induced or spontaneous abortion. This event manages interventions delivered for women who are experiencing</span>
<span class="sd">    either sepsis, haemorrhage or injury post-abortion.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_PostAbortion&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>  <span class="c1"># any hospital?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>  <span class="c1"># todo: check with TC</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>
        <span class="n">abortion_complications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abortion_complications</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span>
                                                                     <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Request baseline PAC consumables</span>
        <span class="n">baseline_cons</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_core&#39;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_optional&#39;</span><span class="p">)</span>

        <span class="c1"># Check HCW availability to deliver surgical removal of retained products</span>
        <span class="n">sf_check</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">check_emonc_signal_function_will_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;Labour&#39;</span><span class="p">],</span>
                                                                                   <span class="n">sf</span><span class="o">=</span><span class="s1">&#39;retained_prod&#39;</span><span class="p">,</span>
                                                                                   <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Then we determine if a woman gets treatment for her complication depending on availability of the baseline</span>
        <span class="c1"># consumables (misoprostol) or a HCW who can conduct MVA/DC (we dont model equipment) and additional</span>
        <span class="c1"># consumables for management of her specific complication</span>
        <span class="k">if</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;sepsis&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="n">cons_for_sepsis_pac</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_sepsis_core&#39;</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_sepsis_optional&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cons_for_sepsis_pac</span> <span class="ow">and</span> <span class="p">(</span><span class="n">baseline_cons</span> <span class="ow">or</span> <span class="n">sf_check</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;haemorrhage&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="n">cons_for_haemorrhage</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;blood_transfusion&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;iv_drug_equipment&#39;</span><span class="p">)</span>

            <span class="n">cons_for_shock</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_shock&#39;</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_shock_optional&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cons_for_haemorrhage</span> <span class="ow">and</span> <span class="n">cons_for_shock</span> <span class="ow">and</span> <span class="p">(</span><span class="n">baseline_cons</span> <span class="ow">or</span> <span class="n">sf_check</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;injury&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">cons_for_shock</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_shock&#39;</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;post_abortion_care_shock_optional&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cons_for_shock</span> <span class="ow">and</span> <span class="p">(</span><span class="n">baseline_cons</span> <span class="ow">or</span> <span class="n">sf_check</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">abortion_complications</span><span class="o">.</span><span class="n">has_any</span><span class="p">([</span><span class="n">person_id</span><span class="p">],</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">baseline_cons</span> <span class="ow">or</span> <span class="n">sf_check</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_received_post_abortion_care&#39;</span><span class="p">]:</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;pac&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement: did not run&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;HSI_CareOfWomenDuringPregnancy_PostAbortionCaseManagement: cannot not run &#39;</span>
                                         <span class="s1">&#39;with this configuration&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy. It is scheduled by</span>
<span class="sd">    HSI_GenericEmergencyFirstApptAtFacilityLevel1 for women who have presented to hospital due to ectopic pregnancy.</span>
<span class="sd">    This event manages interventions delivered as part of the case management of ectopic pregnancy</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">CareOfWomenDuringPregnancy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;AntenatalCare_PostEctopicPregnancy&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;MajorSurg&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1b&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BEDDAYS_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_beddays_footprint</span><span class="p">({</span><span class="s1">&#39;maternity_bed&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>  <span class="c1"># todo: check with TC</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">mother</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mother</span><span class="o">.</span><span class="n">is_alive</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># We define the required consumables and check their availability</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">return_cons_avail</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">item_codes_preg_consumables</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="s1">&#39;ectopic_pregnancy_core&#39;</span><span class="p">,</span>
            <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;ectopic_pregnancy_optional&#39;</span><span class="p">)</span>

        <span class="c1"># If they are available then treatment can go ahead</span>
        <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;PregnancySupervisor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mother_and_newborn_info</span><span class="p">[</span><span class="n">person_id</span><span class="p">][</span><span class="s1">&#39;delete_mni&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">pregnancy_helper_functions</span><span class="o">.</span><span class="n">log_met_need</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;ep_case_mang&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># For women who have sought care after they have experienced rupture we use this treatment variable to</span>
            <span class="c1"># reduce risk of death (women who present prior to rupture do not pass through the death event as we assume</span>
            <span class="c1"># rupture is on the causal pathway to death - hence no treatment property)</span>
            <span class="k">if</span> <span class="n">mother</span><span class="o">.</span><span class="n">ps_ectopic_pregnancy</span> <span class="o">==</span> <span class="s1">&#39;ruptured&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ac_ectopic_pregnancy_treated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># However if treatment cant be delivered for women who have not yet experienced rupture (due to lack of</span>
            <span class="c1"># consumables) we schedule these women to arrive at the rupture event as they have not received treatment</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">person_id</span><span class="p">,</span> <span class="s1">&#39;ps_ectopic_pregnancy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not_ruptured&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.never_ran">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.never_ran">[docs]</a>
    <span class="k">def</span> <span class="nf">never_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.did_not_run">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.did_not_run">[docs]</a>
    <span class="k">def</span> <span class="nf">did_not_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.not_available">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.HSI_CareOfWomenDuringPregnancy_TreatmentForEctopicPregnancy.not_available">[docs]</a>
    <span class="k">def</span> <span class="nf">not_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">ectopic_pregnancy_treatment_doesnt_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CareOfWomenDuringPregnancyLoggingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancyLoggingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">CareOfWomenDuringPregnancyLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is CareOfWomenDuringPregnancyLoggingEvent. It runs yearly to capture the number of ANC visits which</span>
<span class="sd">    have ran (and interventions are delivered) for women during pregnancy.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CareOfWomenDuringPregnancyLoggingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancyLoggingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">))</span></div>


<div class="viewcode-block" id="CareOfWomenDuringPregnancyLoggingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.care_of_women_during_pregnancy.html#tlo.methods.care_of_women_during_pregnancy.CareOfWomenDuringPregnancyLoggingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>

        <span class="n">yearly_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;anc_visits_which_ran&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">yearly_counts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">anc_counter</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Feb 24, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>