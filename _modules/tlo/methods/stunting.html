<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tlo.methods.stunting &mdash; TLOmodel 0.1.dev2392+g4a55807 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=6ea10ece" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=2acae80b"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TLOmodel
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/index.html">Resource files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../learning.html">Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TLOmodel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../methods.html">tlo.methods</a></li>
      <li class="breadcrumb-item active">tlo.methods.stunting</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tlo.methods.stunting</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Stunting Module</span>

<span class="sd">Overview</span>
<span class="sd">--------</span>
<span class="sd">The Stunting module determines the prevalence of stunting for children under 5 years old. A polling event runs</span>
<span class="sd">every month and determines the risk of onset of non-severe stunting, progression to severe stunting or natural</span>
<span class="sd">recovery. The Generic HSI calls do_at_generic_first_appt for any HSI with a child under 5 years old:</span>
<span class="sd">if they have any stunting they are provided with an intervention - `HSI_Stunting_ComplementaryFeeding`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">DAYS_IN_YEAR</span><span class="p">,</span> <span class="n">DateOffset</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Types</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">tlo.core</span> <span class="kn">import</span> <span class="n">IndividualPropertyUpdates</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">IndividualScopeEventMixin</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">,</span> <span class="n">RegularEvent</span>
<span class="kn">from</span> <span class="nn">tlo.lm</span> <span class="kn">import</span> <span class="n">LinearModel</span><span class="p">,</span> <span class="n">LinearModelType</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">tlo.methods</span> <span class="kn">import</span> <span class="n">Metadata</span>
<span class="kn">from</span> <span class="nn">tlo.methods.hsi_event</span> <span class="kn">import</span> <span class="n">HSI_Event</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tlo.population</span> <span class="kn">import</span> <span class="n">PatientDetails</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   MODULE DEFINITION</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Stunting">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting">[docs]</a>
<span class="k">class</span> <span class="nc">Stunting</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the disease module for Stunting&quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">,</span> <span class="s1">&#39;Wasting&#39;</span><span class="p">,</span> <span class="s1">&#39;NewbornOutcomes&#39;</span><span class="p">,</span> <span class="s1">&#39;Diarrhoea&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiv&#39;</span><span class="p">}</span>

    <span class="n">METADATA</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">DISEASE_MODULE</span><span class="p">,</span>
        <span class="n">Metadata</span><span class="o">.</span><span class="n">USES_HEALTHSYSTEM</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Prevalence of stunting by age group at initiation</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_0_5mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among less than 6 months of age in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_6_11mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among 6 months and 1 year of age in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_12_23mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among 1 year olds in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_24_35mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among 2 year olds in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_36_47mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among 3 year olds in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prev_HAZ_distribution_age_48_59mo&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span> <span class="s1">&#39;Distribution of HAZ among 4 year olds  in 2015 (mean, standard deviation)&#39;</span><span class="p">),</span>

        <span class="c1"># Risk factors for stunting prevalence at initiation</span>
        <span class="s1">&#39;or_stunting_male&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if male gender&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_preterm_and_AGA&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if born preterm and adequate for gestational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_SGA_and_term&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if born term and small for geatational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_SGA_and_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if born preterm and small for gestational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_hhwealth_Q5&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if household wealth is poorest Q5, ref group Q1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_hhwealth_Q4&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if household wealth is poorer Q4, ref group Q1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_hhwealth_Q3&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if household wealth is middle Q3, ref group Q1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;or_stunting_hhwealth_Q2&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Odds ratio of stunting if household wealth is richer Q2, ref group Q1&#39;</span><span class="p">),</span>

        <span class="c1"># The incidence of stunting</span>
        <span class="s1">&#39;base_inc_rate_stunting_by_agegp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;Baseline incidence rate per year of stunting by age group (1-5, 6-11, 12-23, 24-35, 36-47, 48-59mo&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_preterm_and_AGA&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting if born preterm and adequate for gestational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_SGA_and_term&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting if born term and small for gestational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_SGA_and_preterm&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting if born preterm and small for gestational age&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_prior_wasting&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting if prior wasting in the last 3 months&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_untreated_HIV&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting for untreated HIV+&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_wealth_level&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting if wealth-level is greater than 1 compared 1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_no_exclusive_breastfeeding&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting for not exclusively breastfed babies &lt; 6 months&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_no_continued_breastfeeding&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting for not continued breastfed infants 6-24 months&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_stunting_per_diarrhoeal_episode&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of stunting for recent diarrhoea episode&#39;</span><span class="p">),</span>

        <span class="c1"># Progression to severe stunting</span>
        <span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span>
            <span class="s1">&#39;Rates per year of progression to severe stunting by age group (1-5, 6-11, 12-23, 24-35, 36-47, 48-59mo&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_progress_severe_stunting_if_prior_wasting&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of severe stunting if previously wasted&#39;</span><span class="p">),</span>
        <span class="s1">&#39;rr_progress_severe_stunting_untreated_HIV&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span> <span class="s1">&#39;Relative risk of severe stunting for untreated HIV+&#39;</span><span class="p">),</span>

        <span class="c1"># Natural recovery from stunting</span>
        <span class="s1">&#39;mean_years_to_1stdev_natural_improvement_in_stunting&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Mean time (in years) to a one standard deviation improvement in stunting without any treatment.&#39;</span><span class="p">),</span>

        <span class="c1"># The effect of treatment</span>
        <span class="s1">&#39;effectiveness_of_complementary_feeding_education_in_stunting_reduction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability of stunting being reduced by one standard deviation (category) by education about &#39;</span>
            <span class="s1">&#39;supplementary feeding (but not supplying supplementary feeding consmables).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;effectiveness_of_food_supplementation_in_stunting_reduction&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability of stunting being reduced by one standard deviation (category) by supplementary feeding.&#39;</span><span class="p">),</span>

        <span class="c1"># The probability of a (severe) stunting person being checked and correctly diagnosed</span>
        <span class="s1">&#39;prob_stunting_diagnosed_at_generic_appt&#39;</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">Types</span><span class="o">.</span><span class="n">REAL</span><span class="p">,</span>
            <span class="s1">&#39;Probability of a stunted or severely stunted person being checked and correctly diagnosed&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
                                    <span class="s1">&#39;Indicator of current stunting status - the height-for-age z-score category:&#39;</span>
                                    <span class="s1">&#39;&quot;HAZ&gt;=-2&quot; == No Stunting (within 2 standard deviations of mean); &#39;</span>
                                    <span class="s1">&#39;&quot;-3&lt;=HAZ&lt;-2&quot; == Non-Severe Stunting (2-3 standard deviations from mean); &#39;</span>
                                    <span class="s1">&#39;&quot;HAZ&lt;-3 == Severe Stunting (more than 3 standard deviations from mean)&#39;</span><span class="p">,</span>
                                    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">,</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Stunting.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resourcefilepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span> <span class="o">=</span> <span class="n">resourcefilepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># (Will store the models used in the module)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># (Will store consumable item codes)</span></div>


<div class="viewcode-block" id="Stunting.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters_from_dataframe</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resourcefilepath</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;ResourceFile_Stunting.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Parameter_values&#39;</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Stunting.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set initial prevalence of stunting according to distributions provided in parameters&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># Set default for property</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span>

        <span class="k">def</span> <span class="nf">get_probs_stunting</span><span class="p">(</span><span class="n">_agegp</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;For the a given HAZ distribution (specified in the parameters by age-group), find the odds of</span>
<span class="sd">            a value &lt;-2 (= &#39;stunted&#39;) and the odds of a value &lt;-3 given a value &lt;-2 (= &#39;severely stunted&#39;).&quot;&quot;&quot;</span>

            <span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;prev_HAZ_distribution_age_</span><span class="si">{</span><span class="n">_agegp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">_agegp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">mo&#39;</span><span class="p">]</span>
            <span class="n">haz_distribution</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">stdev</span><span class="p">)</span>

            <span class="c1"># Compute proportion &quot;stunted&quot; (HAZ &lt;-2)</span>
            <span class="n">p_stunted</span> <span class="o">=</span> <span class="n">haz_distribution</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>

            <span class="c1"># Compute proportion &quot;severely stunted&quot; given &quot;stunted&quot; (HAZ &lt;-3 given HAZ &lt;-2)</span>
            <span class="n">p_severely_stunted_given_stunted</span> <span class="o">=</span> <span class="n">haz_distribution</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">haz_distribution</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>

            <span class="c1"># Return results needed as named tuple:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;probs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;prob_stunting&#39;</span><span class="p">,</span> <span class="s1">&#39;prob_severe_given_stunting&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">(</span>
                <span class="n">p_stunted</span><span class="p">,</span>
                <span class="n">p_severely_stunted_given_stunted</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">make_scaled_linear_model_stunting</span><span class="p">(</span><span class="n">target_prob</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">make_linear_model_stunting</span><span class="p">(</span><span class="n">intercept</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">LinearModel</span><span class="p">(</span>
                    <span class="n">LinearModelType</span><span class="o">.</span><span class="n">LOGISTIC</span><span class="p">,</span>
                    <span class="n">intercept</span><span class="p">,</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_male&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_wealth&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_hhwealth_Q2&#39;</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_hhwealth_Q3&#39;</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_hhwealth_Q4&#39;</span><span class="p">])</span>
                                          <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_hhwealth_Q5&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;small_for_gestational_age&quot;) &#39;</span>
                                     <span class="s1">&#39;&amp; (nb_late_preterm == False) &amp; (nb_early_preterm == False)&#39;</span><span class="p">,</span>
                                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_SGA_and_term&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;small_for_gestational_age&quot;) &#39;</span>
                                     <span class="s1">&#39;&amp; ((nb_late_preterm == True) | (nb_early_preterm == True))&#39;</span><span class="p">,</span>
                                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_SGA_and_preterm&#39;</span><span class="p">]),</span>
                    <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;average_for_gestational_age&quot;) &#39;</span>
                                     <span class="s1">&#39;&amp; ((nb_late_preterm == True) | (nb_early_preterm == True))&#39;</span><span class="p">,</span>
                                     <span class="n">p</span><span class="p">[</span><span class="s1">&#39;or_stunting_preterm_and_AGA&#39;</span><span class="p">])</span>
                <span class="p">)</span>

            <span class="n">unscaled_lm</span> <span class="o">=</span> <span class="n">make_linear_model_stunting</span><span class="p">()</span>

            <span class="n">actual_prob</span> <span class="o">=</span> <span class="n">unscaled_lm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">actual_odds</span> <span class="o">=</span> <span class="n">actual_prob</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">actual_prob</span><span class="p">)</span>
            <span class="n">target_odds</span> <span class="o">=</span> <span class="n">target_prob</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">target_prob</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">make_linear_model_stunting</span><span class="p">(</span>
                <span class="n">intercept</span><span class="o">=</span><span class="n">target_odds</span> <span class="o">/</span> <span class="n">actual_odds</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">actual_prob</span><span class="p">)</span> <span class="k">else</span> <span class="n">target_odds</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">agegp</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">59</span><span class="p">)]:</span>  <span class="c1"># in months</span>
            <span class="n">p_stunting</span> <span class="o">=</span> <span class="n">get_probs_stunting</span><span class="p">(</span><span class="n">agegp</span><span class="p">)</span>

            <span class="n">low_bound_age_in_years</span> <span class="o">=</span> <span class="n">agegp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">12.0</span>
            <span class="n">high_bound_age_in_years</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">agegp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">12.0</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">is_alive</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&gt;=</span> <span class="n">low_bound_age_in_years</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="n">high_bound_age_in_years</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">stunted</span> <span class="o">=</span> <span class="n">make_scaled_linear_model_stunting</span><span class="p">(</span><span class="n">target_prob</span><span class="o">=</span><span class="n">p_stunting</span><span class="o">.</span><span class="n">prob_stunting</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">squeeze_single_row_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">severely_stunted_idx</span> <span class="o">=</span> <span class="n">stunted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">stunted</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stunted</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">p_stunting</span><span class="o">.</span><span class="n">prob_severe_given_stunting</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">stunted_but_not_severe_idx</span> <span class="o">=</span> <span class="n">stunted</span><span class="p">[</span><span class="n">stunted</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">severely_stunted_idx</span><span class="p">)</span>

            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stunted_but_not_severe_idx</span><span class="p">,</span> <span class="s2">&quot;un_HAZ_category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">severely_stunted_idx</span><span class="p">,</span> <span class="s2">&quot;un_HAZ_category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&lt;-3&#39;</span></div>


<div class="viewcode-block" id="Stunting.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare for simulation to start&quot;&quot;&quot;</span>
        <span class="c1"># Establish the models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Schedule the main polling event to begin on the first day of the simulation</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">StuntingPollingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Schedule the logging event to begin on the first day of the simulation</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">schedule_event</span><span class="p">(</span><span class="n">StuntingLoggingEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Look-up consumable item codes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">look_up_consumable_item_codes</span><span class="p">()</span></div>


<div class="viewcode-block" id="Stunting.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother_id</span><span class="p">,</span> <span class="n">child_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set that on birth there is no stunting&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">child_id</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span></div>


<div class="viewcode-block" id="Stunting.look_up_consumable_item_codes">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.look_up_consumable_item_codes">[docs]</a>
    <span class="k">def</span> <span class="nf">look_up_consumable_item_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up the item codes that used in the HSI in the module&quot;&quot;&quot;</span>
        <span class="n">get_item_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_item_code_from_item_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;supplementary_feeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes</span><span class="p">(</span><span class="s1">&#39;Supplementary spread, sachet 92g/CAR-150&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;education_for_supplementary_feeding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_item_codes</span><span class="p">(</span>
            <span class="s1">&#39;Complementary feeding--education only drugs/supplies to service a client&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stunting.do_onset">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.do_onset">[docs]</a>
    <span class="k">def</span> <span class="nf">do_onset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represent the onset of stunting for the person_id given in `idx`&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span></div>


<div class="viewcode-block" id="Stunting.do_progression">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.do_progression">[docs]</a>
    <span class="k">def</span> <span class="nf">do_progression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represent the progression to severe stunting for the person_id given in `idx`&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HAZ&lt;-3&#39;</span></div>


<div class="viewcode-block" id="Stunting.do_recovery">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.do_recovery">[docs]</a>
    <span class="k">def</span> <span class="nf">do_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represent the recovery from stunting for the person_id given in `idx`. Recovery causes the person to move</span>
<span class="sd">        &#39;up&#39; one level: i.e. &#39;HAZ&lt;-3&#39; --&gt; &#39;-3&lt;=HAZ&lt;-2&#39; or &#39;-3&lt;=HAZ&lt;-2&#39; --&gt; &#39;HAZ&gt;=-2&#39;&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
            <span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">:</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">:</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="Stunting.do_treatment">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.do_treatment">[docs]</a>
    <span class="k">def</span> <span class="nf">do_treatment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">prob_success</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Represent the treatment with supplementary feeding. If treatment is successful, effect the recovery</span>
<span class="sd">        of the person immediately.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prob_success</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_recovery</span><span class="p">([</span><span class="n">person_id</span><span class="p">])</span></div>


<div class="viewcode-block" id="Stunting.do_at_generic_first_appt">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.Stunting.do_at_generic_first_appt">[docs]</a>
    <span class="k">def</span> <span class="nf">do_at_generic_first_appt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patient_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">patient_details</span><span class="p">:</span> <span class="n">PatientDetails</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndividualPropertyUpdates</span><span class="p">:</span>
        <span class="c1"># This is called by the a generic HSI event for every child aged</span>
        <span class="c1"># less than 5 years.</span>
        <span class="c1"># It assesses stunting and schedules an HSI as needed.</span>
        <span class="n">is_stunted</span> <span class="o">=</span> <span class="n">patient_details</span><span class="o">.</span><span class="n">un_HAZ_category</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">)</span>
        <span class="n">p_stunting_diagnosed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;prob_stunting_diagnosed_at_generic_appt&#39;</span><span class="p">]</span>

        <span class="c1"># Schedule the HSI for provision of treatment based on the</span>
        <span class="c1"># probability of stunting diagnosis, provided the necessary</span>
        <span class="c1"># symptoms are there.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">patient_details</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">is_stunted</span>
        <span class="p">):</span>
            <span class="c1"># Schedule the HSI for provision of treatment based on the</span>
            <span class="c1"># probability of stunting diagnosis</span>
            <span class="k">if</span> <span class="n">p_stunting_diagnosed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">():</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">HSI_Stunting_ComplementaryFeeding</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">patient_id</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">healthsystem</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                    <span class="n">event</span><span class="p">,</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># &lt;-- lower priority that for wasting and most other HSI</span>
                    <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="p">)</span></div>
</div>


<span class="k">class</span> <span class="nc">Models</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">parameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lm_prob_becomes_stunted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_lm_prob_becomes_stunted</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lm_prob_progression_to_severe_stunting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_lm_prob_progression_to_severe_stunting</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lm_prob_natural_recovery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_lm_prob_natural_recovery</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">make_lm_prob_becomes_stunted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns LinearModel for the probability per year of becoming stunted.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="k">return</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">multiplicative</span><span class="p">(</span>
            <span class="n">Predictor</span><span class="p">(</span>
                <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;age_exact_years &lt; 0.5&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;0.5 &lt;= age_exact_years &lt; 1&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;1 &lt;= age_exact_years &lt; 2&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;2 &lt;= age_exact_years &lt; 3&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;3 &lt;= age_exact_years &lt; 4&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;4 &lt;= age_exact_years &lt; 5&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;base_inc_rate_stunting_by_agegp&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s2">&quot;age_exact_years &gt;= 5&quot;</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="p">),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;li_wealth&#39;</span><span class="p">,</span>
                      <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                                                             <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_wealth_level&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_per_diarrhoeal_episode&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">x</span><span class="p">),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;un_ever_wasted&#39;</span><span class="p">,</span>
                      <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_prior_wasting&#39;</span><span class="p">])</span>
                                                             <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;small_for_gestational_age&quot;) &#39;</span>
                             <span class="s1">&#39;&amp; (nb_late_preterm == False) &amp; (nb_early_preterm == False)&#39;</span><span class="p">,</span>
                             <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_SGA_and_term&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;small_for_gestational_age&quot;) &#39;</span>
                             <span class="s1">&#39;&amp; ((nb_late_preterm == True) | (nb_early_preterm == True))&#39;</span><span class="p">,</span>
                             <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_SGA_and_preterm&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(nb_size_for_gestational_age == &quot;average_for_gestational_age&quot;) &#39;</span>
                             <span class="s1">&#39;&amp; ((nb_late_preterm == True) | (nb_early_preterm == True))&#39;</span><span class="p">,</span>
                             <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_preterm_and_AGA&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(hv_inf == True) &amp; (hv_art == &quot;not&quot;)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_untreated_HIV&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;((nb_breastfeeding_status == &quot;non_exclusive&quot;) | &#39;</span>
                             <span class="s1">&#39;(nb_breastfeeding_status == &quot;none&quot;)) &amp; (age_exact_years &lt; 0.5)&#39;</span><span class="p">,</span>
                             <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_no_exclusive_breastfeeding&#39;</span><span class="p">]),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;(nb_breastfeeding_status == &quot;none&quot;) &amp; (0.5 &lt;= age_exact_years &lt; 2.0)&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_no_continued_breastfeeding&#39;</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_lm_prob_progression_to_severe_stunting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return LinearModel for the probability per year of progressing from a state of being Stunted (but not severe)</span>
<span class="sd">        (-3 &lt; HAZ &lt;= -2) to a state of Severe Stunting (HAZ &lt;= -3)&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="k">return</span> <span class="n">LinearModel</span><span class="o">.</span><span class="n">multiplicative</span><span class="p">(</span>
            <span class="n">Predictor</span><span class="p">(</span>
                <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;age_exact_years &lt; 0.5&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;0.5 &lt;= age_exact_years &lt; 1.0&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;1.0 &lt;= age_exact_years &lt; 2.0&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;2.0 &lt;= age_exact_years &lt; 3.0&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;3.0 &lt;= age_exact_years &lt; 4.0&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;4.0 &lt;= age_exact_years &lt; 5.0&#39;</span><span class="p">,</span>
                <span class="n">p</span><span class="p">[</span><span class="s1">&#39;r_progression_severe_stunting_by_agegp&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="s1">&#39;age_exact_years &gt;= 5.0&#39;</span><span class="p">,</span> <span class="mf">1.0</span>
            <span class="p">),</span>
            <span class="n">Predictor</span><span class="p">(</span><span class="s1">&#39;un_ever_wasted&#39;</span><span class="p">,</span>
                      <span class="n">conditions_are_exhaustive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">conditions_are_mutually_exclusive</span><span class="o">=</span><span class="kc">True</span>
                      <span class="p">)</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_progress_severe_stunting_if_prior_wasting&#39;</span><span class="p">])</span>
                       <span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">Predictor</span><span class="p">()</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="s1">&#39;(hv_inf == True) &amp; (hv_art == &quot;not&quot;)&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rr_stunting_untreated_HIV&#39;</span><span class="p">]),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_lm_prob_natural_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return LinearModel for the probability per year of improving by one category (one HAZ standard deviation)</span>
<span class="sd">        i.e. from being severely stunted (HAZ&lt;-3) to non-severely stunted (-3&lt;HAZ&lt;=-2); and from being non-severely</span>
<span class="sd">        stunted to not Stunted (HAZ&gt;-2).&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="n">mean_years</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;mean_years_to_1stdev_natural_improvement_in_stunting&#39;</span><span class="p">]</span>
        <span class="n">prob_recovery_per_year</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mean_years</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LinearModel</span><span class="p">(</span>
            <span class="n">LinearModelType</span><span class="o">.</span><span class="n">MULTIPLICATIVE</span><span class="p">,</span>
            <span class="n">intercept</span><span class="o">=</span><span class="n">prob_recovery_per_year</span>
        <span class="p">)</span>


<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   NATURAL HISTORY EVENTS</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="StuntingPollingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPollingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">StuntingPollingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Regular event that controls the onset of stunting, progression to severe stunting and natural recovery.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StuntingPollingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPollingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Stunting</span><span class="p">)</span></div>


<div class="viewcode-block" id="StuntingPollingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPollingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        * Determine who will be onset for stunting (among those not stunted) and effect that change;</span>
<span class="sd">        * Determine who will be onset for recovery (among those stunted) and effect that change.</span>
<span class="sd">        * Determine who will be onset for progression (among those stunted but not severely) and effect that change;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">models</span>
        <span class="n">days_until_next_polling_event</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

        <span class="c1"># Onset of Stunting</span>
        <span class="n">eligible_for_stunting</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span>
                                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">&amp;</span>
                                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">un_HAZ_category</span> <span class="o">==</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span><span class="p">))</span>
        <span class="n">idx_will_be_stunted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_model</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">lm_prob_becomes_stunted</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">eligible_for_stunting</span><span class="p">,</span>
            <span class="n">days_exposed_to_risk</span><span class="o">=</span><span class="n">days_until_next_polling_event</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_onset</span><span class="p">(</span><span class="n">idx_will_be_stunted</span><span class="p">)</span>

        <span class="c1"># Recovery from Stunting</span>
        <span class="n">eligible_for_recovery</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span>
                                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">&amp;</span>
                                 <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">un_HAZ_category</span> <span class="o">!=</span> <span class="s1">&#39;HAZ&gt;=-2&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                                 <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">idx_will_be_stunted</span><span class="p">))</span>
        <span class="n">idx_will_recover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_model</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">lm_prob_natural_recovery</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">eligible_for_recovery</span><span class="p">,</span>
            <span class="n">days_exposed_to_risk</span><span class="o">=</span><span class="n">days_until_next_polling_event</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_recovery</span><span class="p">(</span><span class="n">idx_will_recover</span><span class="p">)</span>

        <span class="c1"># Progression to Severe Stunting</span>
        <span class="n">eligible_for_progression</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_exact_years</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">un_HAZ_category</span> <span class="o">==</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">idx_will_be_stunted</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">idx_will_recover</span><span class="p">))</span>
        <span class="n">idx_will_progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_model</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">lm_prob_progression_to_severe_stunting</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">eligible_for_progression</span><span class="p">,</span>
            <span class="n">days_exposed_to_risk</span><span class="o">=</span><span class="n">days_until_next_polling_event</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_progression</span><span class="p">(</span><span class="n">idx_will_progress</span><span class="p">)</span></div>


<div class="viewcode-block" id="StuntingPollingEvent.apply_model">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPollingEvent.apply_model">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">days_exposed_to_risk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the person_ids selected for an event of occur to in a given period (in days), as specified by a</span>
<span class="sd">        LinearModel that provides the annual risk of the event.</span>
<span class="sd">        * Looks-up annual probability of the event using a linear model supplied in `model` to a population masked with</span>
<span class="sd">         `mask`</span>
<span class="sd">        * Converts the annual probability to a probability of the event occurring during the number of</span>
<span class="sd">        `days_exposed_to_risk`</span>
<span class="sd">        * Randomly selects which individuals will have the events</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rng</span>

        <span class="n">annual_prob</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">cum_prob_over_days_exposed</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">annual_prob</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">days_exposed_to_risk</span> <span class="o">/</span> <span class="n">DAYS_IN_YEAR</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">cum_prob_over_days_exposed</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">cum_prob_over_days_exposed</span> <span class="o">&gt;</span> <span class="n">rng</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   Logging</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="StuntingLoggingEvent">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingLoggingEvent">[docs]</a>
<span class="k">class</span> <span class="nc">StuntingLoggingEvent</span><span class="p">(</span><span class="n">RegularEvent</span><span class="p">,</span> <span class="n">PopulationScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logging event occurring every year&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StuntingLoggingEvent.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingLoggingEvent.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Stunting</span><span class="p">)</span></div>


<div class="viewcode-block" id="StuntingLoggingEvent.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingLoggingEvent.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log the current distribution of stunting classification by age&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>

        <span class="n">d_to_log</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age_years&#39;</span><span class="p">,</span> <span class="s1">&#39;un_HAZ_category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">convert_keys_to_string</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;prevalence&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">convert_keys_to_string</span><span class="p">(</span><span class="n">d_to_log</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Current number of children in each stunting category by single year of age.&#39;</span>
        <span class="p">)</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   HSI</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HSI_Stunting_ComplementaryFeeding">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.HSI_Stunting_ComplementaryFeeding">[docs]</a>
<span class="k">class</span> <span class="nc">HSI_Stunting_ComplementaryFeeding</span><span class="p">(</span><span class="n">HSI_Event</span><span class="p">,</span> <span class="n">IndividualScopeEventMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HSI for complementary feeding, either with the provision of supplementary foods or with education only.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="HSI_Stunting_ComplementaryFeeding.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.HSI_Stunting_ComplementaryFeeding.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">person_id</span><span class="o">=</span><span class="n">person_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TREATMENT_ID</span> <span class="o">=</span> <span class="s1">&#39;Undernutrition_Feeding&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXPECTED_APPT_FOOTPRINT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_appt_footprint</span><span class="p">({</span><span class="s1">&#39;U5Malnutr&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ACCEPTED_FACILITY_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;1a&#39;</span></div>


<div class="viewcode-block" id="HSI_Stunting_ComplementaryFeeding.apply">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.HSI_Stunting_ComplementaryFeeding.apply">[docs]</a>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">,</span> <span class="n">squeeze_factor</span><span class="p">):</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">person</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Only do anything if child is under 5 and remains stunted</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">age_years</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">un_HAZ_category</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HAZ&lt;-3&#39;</span><span class="p">,</span> <span class="s1">&#39;-3&lt;=HAZ&lt;-2&#39;</span><span class="p">]):</span>

            <span class="c1"># Provide supplementary feeding if consumable available, otherwise provide &#39;education only&#39; (which has a</span>
            <span class="c1"># different probability of success).</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span><span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;supplementary_feeding&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">prob_success</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span>
                    <span class="s1">&#39;effectiveness_of_food_supplementation_in_stunting_reduction&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Request consumables for provision of education for supplementary feeding, but do not let</span>
                <span class="c1"># non-availability prevent provision of the intervention.</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumables</span><span class="p">(</span>
                    <span class="n">item_codes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">cons_item_codes</span><span class="p">[</span><span class="s1">&#39;education_for_supplementary_feeding&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">do_treatment</span><span class="p">(</span><span class="n">person_id</span><span class="p">,</span> <span class="n">prob_success</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span>
                    <span class="s1">&#39;effectiveness_of_complementary_feeding_education_in_stunting_reduction&#39;</span><span class="p">])</span>

            <span class="c1"># Schedule a further instance of this HSI for monitoring and resupply of consumables.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;HealthSystem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schedule_hsi_event</span><span class="p">(</span>
                <span class="n">hsi_event</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># &lt;-- lower priority that for wasting and most other HSI</span>
                <span class="n">topen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="p">)</span></div>
</div>



<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>
<span class="c1">#   ACCESSORIES FOR TESTING</span>
<span class="c1"># ---------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="StuntingPropertiesOfOtherModules">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules">[docs]</a>
<span class="k">class</span> <span class="nc">StuntingPropertiesOfOtherModules</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For the purpose of the testing, this module generates the properties upon which the Stunting module relies&quot;&quot;&quot;</span>

    <span class="n">INIT_DEPENDENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demography&#39;</span><span class="p">}</span>

    <span class="c1"># Though this module provides some properties from NewbornOutcomes we do not list</span>
    <span class="c1"># NewbornOutcomes in the ALTERNATIVE_TO set to allow using in conjunction with</span>
    <span class="c1"># SimplifiedBirths which can also be used as an alternative to NewbornOutcomes</span>
    <span class="n">ALTERNATIVE_TO</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Hiv&#39;</span><span class="p">,</span> <span class="s1">&#39;Wasting&#39;</span><span class="p">,</span> <span class="s1">&#39;Diarrhoea&#39;</span><span class="p">}</span>

    <span class="n">PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;hv_inf&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;hv_art&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                           <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;on_VL_suppressed&#39;</span><span class="p">,</span> <span class="s1">&#39;on_not_VL_suppressed&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                               <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;extremely_low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;very_low_birth_weight&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;low_birth_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;normal_birth_weight&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                                <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;small_for_gestational_age&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;average_for_gestational_age&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>

        <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">,</span>
                                            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;non_exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;un_ever_wasted&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">BOOL</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">),</span>
        <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="n">Types</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span> <span class="s1">&#39;temporary property&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="StuntingPropertiesOfOtherModules.__init__">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="StuntingPropertiesOfOtherModules.read_parameters">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules.read_parameters">[docs]</a>
    <span class="k">def</span> <span class="nf">read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_folder</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="StuntingPropertiesOfOtherModules.initialise_population">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules.initialise_population">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;un_ever_wasted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">is_alive</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="StuntingPropertiesOfOtherModules.initialise_simulation">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules.initialise_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="StuntingPropertiesOfOtherModules.on_birth">
<a class="viewcode-back" href="../../../reference/tlo.methods.stunting.html#tlo.methods.stunting.StuntingPropertiesOfOtherModules.on_birth">[docs]</a>
    <span class="k">def</span> <span class="nf">on_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mother</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">props</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_inf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;hv_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_low_birth_weight_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;normal_birth_weight&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_size_for_gestational_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;average_for_gestational_age&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_late_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_early_preterm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;nb_breastfeeding_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;exclusive&#39;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;un_ever_wasted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;gi_number_of_episodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">Last updated on Apr 23, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>