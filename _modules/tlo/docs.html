

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>tlo.docs &mdash; TLOmodel 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> TLOmodel
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aims.html">Aims &amp; Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writeups.html">Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../azure_batch.html">Using Azure Batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TLOmodel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>tlo.docs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tlo.docs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The functions used by tlo_methods_rst.py.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span><span class="p">,</span> <span class="n">iscode</span><span class="p">,</span> <span class="n">isframe</span><span class="p">,</span> <span class="n">isfunction</span><span class="p">,</span> <span class="n">ismethod</span><span class="p">,</span> <span class="n">ismodule</span><span class="p">,</span> <span class="n">istraceback</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">walk</span>

<span class="kn">from</span> <span class="nn">tlo</span> <span class="kn">import</span> <span class="n">Module</span>
<span class="kn">from</span> <span class="nn">tlo.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">tlo.methods.healthsystem</span> <span class="kn">import</span> <span class="n">HSI_Event</span>


<div class="viewcode-block" id="get_package_name"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_package_name">[docs]</a><span class="k">def</span> <span class="nf">get_package_name</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a file path to a TLO package, return the name in dot form.</span>

<span class="sd">    :param dirpath: the path to the package,</span>
<span class="sd">           e.g. (1) &quot;./src/tlo/logging/sublog&quot; or (2) &quot;./src/tlo&quot;</span>
<span class="sd">    :return: string of package name in dot form,</span>
<span class="sd">           e.g. (1) &quot;tlo.logging.sublog&quot; or (2) &quot;tlo&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TLO</span> <span class="o">=</span> <span class="s2">&quot;/tlo/&quot;</span>
    <span class="k">if</span> <span class="n">TLO</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirpath</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorry, </span><span class="si">{</span><span class="n">TLO</span><span class="si">}</span><span class="s2"> isn&#39;t in dirpath (</span><span class="si">{</span><span class="n">dirpath</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">dirpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">TLO</span><span class="p">)</span>
    <span class="c1"># print(f&quot;parts = {parts}&quot;)</span>
    <span class="n">runt</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># e.g. &quot;logging/sublog&quot;</span>
    <span class="n">runt</span> <span class="o">=</span> <span class="n">runt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>  <span class="c1"># e.g. logging.sublog</span>
    <span class="c1"># print(f&quot;now runt is {runt}&quot;)</span>
    <span class="k">if</span> <span class="n">runt</span><span class="p">:</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tlo.</span><span class="si">{</span><span class="n">runt</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="s2">&quot;tlo&quot;</span>
    <span class="k">return</span> <span class="n">package_name</span></div>


<div class="viewcode-block" id="generate_module_dict"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.generate_module_dict">[docs]</a><span class="k">def</span> <span class="nf">generate_module_dict</span><span class="p">(</span><span class="n">topdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a root directory topdir, iterates recursively</span>
<span class="sd">    over top dir and the files and subdirectories within it.</span>
<span class="sd">    Returns a dictionary with each key = path to a directory</span>
<span class="sd">    (i.e. to topdir or one of its nested subdirectories), and</span>
<span class="sd">    value = list of Python .py files in that directory.</span>

<span class="sd">    :param topdir: root directory to traverse downwards from, iteratively.</span>
<span class="sd">    :returns: dict with key = a directory,</span>
<span class="sd">              value = list of Python files in dir `key`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># key = path to dir, value = list of .py files</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span><span class="p">)</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="n">topdir</span><span class="p">):</span>
        <span class="c1"># print(f&quot;**path:{dirpath}, dirnames:{dirnames}, files:{filenames}\n&quot;)</span>
        <span class="k">if</span> <span class="s2">&quot;__pycache__&quot;</span> <span class="ow">in</span> <span class="n">dirpath</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">dirpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">dirpath</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="c1"># We can do this as compound-if statements are evaluated</span>
            <span class="c1"># left-to-right in Python:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.pyc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;.py&quot;</span><span class="p">):</span>
                <span class="c1"># print(f&quot;skipping {f}&quot;)</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">dirpath</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="get_classes_in_module"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_classes_in_module">[docs]</a><span class="k">def</span> <span class="nf">get_classes_in_module</span><span class="p">(</span><span class="n">fqn</span><span class="p">,</span> <span class="n">module_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a list of lists of the classes *defined* in</span>
<span class="sd">    the required module (file), in the order in which they</span>
<span class="sd">    appear in the module file. Note that this excludes</span>
<span class="sd">    any other classes in the module, such as those brought</span>
<span class="sd">    in by inheritance, or imported.</span>

<span class="sd">    Each entry in the list returned is itself a list of:</span>
<span class="sd">    [class name, class object, line number]</span>

<span class="sd">    :param fqn: Fully-qualified name of the module,</span>
<span class="sd">                e.g. &quot;tlo.methods.mockitis&quot;</span>
<span class="sd">    :param module_obj: an object representing this module</span>
<span class="sd">    :param return: list of entries, each of the form:</span>
<span class="sd">                [class name, class object, line number]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">module_info</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">module_obj</span><span class="p">)</span>  <span class="c1"># Gets everything</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">module_info</span><span class="p">:</span>

        <span class="c1"># Pick out only the classes defined in this module:</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fqn</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="c1"># only generate documentation for tlo subclasses (considers other classes internal implementation detail)</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="c1"># skip this filtering if we&#39;re working with classes for testing</span>
            <span class="k">if</span> <span class="n">fqn</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;test_docs_data&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Module</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">HSI_Event</span><span class="p">]):</span>
                <span class="c1"># print(name)  # e.g. MockitisEvent</span>
                <span class="c1"># print(obj)  # e.g. &lt;class &#39;tlo.methods.mockitis.MockitisEvent&#39;&gt;</span>
                <span class="n">source</span><span class="p">,</span> <span class="n">start_line</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">start_line</span><span class="p">])</span>
                <span class="c1"># print(f&quot;\n\nIn module {name} we find the following:&quot;)</span>
                <span class="c1"># morestuff = inspect.getmembers(obj)</span>
                <span class="c1"># print(morestuff)  # e.g. functions, PARAMETERS dict,...</span>

    <span class="c1"># print(f&quot;before sorting, {classes}&quot;)</span>
    <span class="c1"># https://stackoverflow.com/questions/3169014/inspect-getmembers-in-order</span>
    <span class="c1"># Based on answer by Andrew - sort them into order in which they are</span>
    <span class="c1"># defined in the module file.</span>
    <span class="n">classes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># print(f&quot;after sorting, {classes}&quot;)</span>
    <span class="k">return</span> <span class="n">classes</span></div>


<div class="viewcode-block" id="get_fully_qualified_name"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_fully_qualified_name">[docs]</a><span class="k">def</span> <span class="nf">get_fully_qualified_name</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a file name and a context</span>
<span class="sd">    return the fully-qualified name of the *module*</span>

<span class="sd">    e.g. tlo.methods.mockitis</span>
<span class="sd">    This gets used in doc page title.</span>

<span class="sd">    :param filename: name of file, e.g. &quot;mockitis.py&quot;</span>
<span class="sd">    :param context: &quot;location&quot; of module, e.g. &quot;tlo.methods&quot;</span>
<span class="sd">    :return: a string, e.g. &quot;tlo.methods.mockitis&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="c1"># print(f&quot;getfqn: {filename}, {context}&quot;)</span>
    <span class="k">if</span> <span class="n">context</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fqname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">fqname</span></div>


<div class="viewcode-block" id="write_rst_file"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.write_rst_file">[docs]</a><span class="k">def</span> <span class="nf">write_rst_file</span><span class="p">(</span><span class="n">rst_dir</span><span class="p">,</span> <span class="n">fqn</span><span class="p">,</span> <span class="n">mobj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We want to write one .rst file per module in ./src/tlo/methods</span>

<span class="sd">    :param rst_dir: directory in which to write the new .rst file</span>
<span class="sd">    :param fqn: fully-qualified module name, e.g. &quot;tlo.methods.mockitis&quot;</span>
<span class="sd">    :param mobj: the module object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rst_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fqn</span><span class="si">}</span><span class="s2">.rst&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>

        <span class="c1"># Header</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fqn</span><span class="si">}</span><span class="s2"> module&quot;</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.. automodule:: </span><span class="si">{</span><span class="n">fqn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># NB This gets the classes, but not any docstring e.g. at the top</span>
        <span class="c1"># of the module, outside any classes. It also doesn&#39;t include</span>
        <span class="c1"># any module-level functions. But those items seem to get added in</span>
        <span class="c1"># anyway.</span>
        <span class="c1"># NB classes_in_module may be empty:</span>
        <span class="n">classes_in_module</span> <span class="o">=</span> <span class="n">get_classes_in_module</span><span class="p">(</span><span class="n">fqn</span><span class="p">,</span> <span class="n">mobj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">classes_in_module</span><span class="p">:</span>
            <span class="c1"># c is [class name, class object, line number]</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="n">get_class_output_string</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mystr</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
        <span class="c1"># Example of use in .rst file:</span>
        <span class="c1"># out.write(&quot;.. class:: Noodle\n\n&quot;)</span>
        <span class="c1"># out.write(&quot;   Noodle&#39;s docstring.\n&quot;)</span>


<div class="viewcode-block" id="get_class_output_string"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_class_output_string">[docs]</a><span class="k">def</span> <span class="nf">get_class_output_string</span><span class="p">(</span><span class="n">classinfo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate output string for a single class to be written to an rst file.</span>

<span class="sd">    :param classinfo: a list with [class name, class object, line number]</span>
<span class="sd">    :return: the string to output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">class_name</span><span class="p">,</span> <span class="n">class_obj</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">classinfo</span>
    <span class="c1"># mystr = f&quot;\n\n\n&quot; \</span>
    <span class="c1">#        f&quot;.. autoclass:: {class_name}\n&quot; \</span>
    <span class="c1">#        f&quot;   :members:\n\n&quot; \</span>
    <span class="c1">#        f&quot;   ..automethod:: __init__\n\n&quot;</span>
    <span class="n">mystr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">.. autoclass:: </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="c1"># This is needed to keep information neatly aligned</span>
    <span class="c1"># with each class.</span>
    <span class="n">numspaces</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">spacer</span> <span class="o">=</span> <span class="n">numspaces</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>

    <span class="c1"># Now we want to add base classes, class members, comments and methods</span>
    <span class="c1"># Presumably in source file order.</span>

    <span class="p">(</span><span class="n">base_str</span><span class="p">,</span> <span class="n">base_objects</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_bases</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">class_obj</span><span class="p">,</span> <span class="n">spacer</span><span class="p">)</span>
    <span class="n">mystr</span> <span class="o">+=</span> <span class="n">base_str</span>
    <span class="n">mystr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="c1"># if class_name == &#39;Matt&#39;:  #Mockitis&#39; or class_name == &quot;Matt&quot;:</span>
    <span class="c1">#     import pdb; pdb.set_trace()</span>
    <span class="c1"># class_obj.__dict__ is</span>
    <span class="c1"># mappingproxy({&#39;__module__&#39;: &#39;tlo.methods.mockitis&#39;,</span>
    <span class="c1">#   &#39;another_random_boolean&#39;: False, &#39;__doc__&#39;: None})</span>

    <span class="c1"># Asif says we should probably not exclude __init__ in the following,</span>
    <span class="c1"># because some disease classes have custom arguments:</span>
    <span class="c1"># general_exclusions = [&quot;__class__&quot;, &quot;__dict__&quot;, &quot;__module__&quot;,</span>
    <span class="c1">#                      &quot;__slots__&quot;, &quot;__weakref__&quot;, ]</span>

    <span class="c1"># inherited_exclusions = [&quot;initialise_population&quot;, &quot;initialise_simulation&quot;,</span>
    <span class="c1">#                        &quot;on_birth&quot;, &quot;read_parameters&quot;, &quot;apply&quot;,</span>
    <span class="c1">#                        &quot;post_apply_hook&quot;, &quot;on_hsi_alert&quot;,</span>
    <span class="c1">#                        &quot;report_daly_values&quot;, &quot;run&quot;, &quot;did_not_run&quot;,</span>
    <span class="c1">#                        &quot;SYMPTOMS&quot;, ]</span>

    <span class="c1"># Return all the members of an object in a list of (name, value) pairs</span>
    <span class="c1"># sorted by name:</span>
    <span class="n">classdat</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">class_obj</span><span class="p">)</span>  <span class="c1"># Gets everything</span>

    <span class="c1"># if class_name == &#39;Matt&#39;:  #Mockitis&#39; or class_name == &quot;Matt&quot;:</span>
    <span class="c1">#    import pdb; pdb.set_trace()</span>

    <span class="c1"># We want to sort classdat by line number, so that functions</span>
    <span class="c1"># defined in, or overridden in, this class will be</span>
    <span class="c1"># documented in source file order.</span>

    <span class="c1"># 25/11 This is the order Asif would like:</span>
    <span class="c1"># For subclasses of Module, PARAMETERS &amp; PROPERTIES first as tables</span>
    <span class="c1"># (in that order). Then for each of the subclass classes (Module, Event,</span>
    <span class="c1"># HSI_Event) attributes of the class (in source-code order if possible,</span>
    <span class="c1"># otherwise default) and then functions of the class</span>
    <span class="c1"># (in source-code order).</span>
    <span class="c1"># Like we did for functions, for attributes, if we can have the same logic</span>
    <span class="c1"># (i.e. only show if defined in the subclass), that&#39;d be great. This might</span>
    <span class="c1"># be useful: https://stackoverflow.com/a/5253424</span>

    <span class="c1"># TODO we only want to do this for descendants of classes</span>
    <span class="c1"># Module, Event, and HSI_Event:</span>
    <span class="n">func_objects_to_document</span> <span class="o">=</span> <span class="n">which_functions_to_print</span><span class="p">(</span><span class="n">class_obj</span><span class="p">)</span>
    <span class="c1"># attributes_to_document = which_attributes_to_print(class_obj)</span>

    <span class="n">name_func_lines</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of tuples to sort later</span>

    <span class="n">my_attributes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># (name, value) pairs of class attributes.</span>

    <span class="n">ignored_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">]</span>

    <span class="n">misc</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">classdat</span><span class="p">:</span>
        <span class="c1"># First loop. Get PARAMETERS and PROPERTIES dictionary objects only.</span>
        <span class="c1"># These are in subclasses of Module only.</span>
        <span class="c1"># We want nice tables for PARAMETERS and PROPERTIES.</span>
        <span class="c1"># In this case, obj is a dictionary.</span>
        <span class="c1"># We want to display PARAMETERS before PROPERTIES. We should get that</span>
        <span class="c1"># for free as inspect.getmembers() returns results sorted by name.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;PARAMETERS&quot;</span><span class="p">,</span> <span class="s2">&quot;PROPERTIES&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">name</span> <span class="ow">in</span> <span class="n">class_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="c1"># (only included if defined/overridden in this class)</span>
            <span class="n">table_list</span> <span class="o">=</span> <span class="n">create_table</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">table_list</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="k">continue</span>
            <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">**</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:**</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_list</span><span class="p">:</span>
                <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}{</span><span class="n">t</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">mystr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="c1"># Get source-code line numbering where possible.</span>
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">func_objects_to_document</span> \
                <span class="ow">and</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">func_objects_to_document</span> <span class="ow">and</span> \
                <span class="n">name</span> <span class="ow">in</span> <span class="n">class_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">start_line_num</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">name_func_lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">start_line_num</span><span class="p">))</span>

        <span class="c1"># Get source-code line numbering where possible.</span>
        <span class="c1"># inspect.getsourcelines() only works for module, class, method,</span>
        <span class="c1"># function, traceback, frame, or code objects</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ismodule</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ismethod</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">istraceback</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isframe</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iscode</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> \
                <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">class_obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">):</span>
            <span class="c1"># pass  # _, start_line_num = inspect.getsourcelines(obj)</span>
            <span class="n">misc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">start_line_num</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">:</span>  <span class="c1"># Skip over mappingproxy dict.</span>
            <span class="k">continue</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We want class attributes but we can&#39;t get source code order</span>
            <span class="c1"># We want only those which are defined or overridden in this class</span>
            <span class="c1"># continue  #attributes.append()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">class_obj</span><span class="o">.</span><span class="vm">__dict__</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignored_attributes</span><span class="p">:</span>
                <span class="n">my_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>

    <span class="c1"># Output attributes other than functions</span>
    <span class="c1"># for name, obj in classdat:</span>
    <span class="c1">#    pass</span>
    <span class="k">if</span> <span class="n">my_attributes</span><span class="p">:</span>
        <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">**Class attributes:**</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">my_attributes</span><span class="p">:</span>
            <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}{</span><span class="n">att</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">att</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="c1"># Sort miscellaneous items:</span>
    <span class="k">if</span> <span class="n">misc</span><span class="p">:</span>
        <span class="n">misc</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">**Miscellaneous:**</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">misc</span><span class="p">:</span>
            <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}{</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="c1"># Sort the functions we wish to document into source-file order:</span>
    <span class="n">name_func_lines</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># if class_name == &quot;Mockitis&quot;:</span>
    <span class="c1">#     import pdb; pdb.set_trace()</span>

    <span class="c1"># New or overridden functions only.</span>
    <span class="k">if</span> <span class="n">func_objects_to_document</span><span class="p">:</span>
        <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">**Functions (defined or overridden in &quot;</span> \
                 <span class="sa">f</span><span class="s2">&quot;class </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">):**</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">name_func_lines</span><span class="p">:</span>  <span class="c1"># Now in source code order</span>

            <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">func_objects_to_document</span><span class="p">:</span>  <span class="c1"># Should be always True!</span>
                <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">.. automethod:: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># print(f&quot;**DEBUG: no func_objects_to_document in class {class_name}&quot;)</span>
        <span class="k">pass</span>

    <span class="c1"># Anything else?</span>
    <span class="c1"># mystr += f&quot;{name} : {obj}\n\n&quot;</span>
    <span class="c1"># print(f&quot;DEBUG: something else... {name}, {obj}&quot;)</span>

    <span class="c1"># getdoc, getcomments,</span>

    <span class="n">mystr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">mystr</span></div>


<div class="viewcode-block" id="which_functions_to_print"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.which_functions_to_print">[docs]</a><span class="k">def</span> <span class="nf">which_functions_to_print</span><span class="p">(</span><span class="n">clazz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Which functions do we want to print?</span>

<span class="sd">    :param clazz: class object under consideration</span>
<span class="sd">    :return: returns a list of function objects we want to print</span>

<span class="sd">    Written by Asif</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get all the functions in this class</span>
    <span class="n">class_functions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span>
                                              <span class="n">predicate</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">))</span>

    <span class="n">ok_to_print</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># for each function in this class</span>
    <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func_obj</span> <span class="ow">in</span> <span class="n">class_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># for func in func_list:</span>
        <span class="c1"># func_name, func_obj, _ = func</span>
        <span class="c1"># import pdb; pdb.set_trace()</span>
        <span class="n">should_i_print</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># for each base class of this class</span>
        <span class="k">for</span> <span class="n">baseclass</span> <span class="ow">in</span> <span class="n">clazz</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="c1"># skip over the class we&#39;re checking</span>
            <span class="k">if</span> <span class="n">baseclass</span> <span class="o">!=</span> <span class="n">clazz</span><span class="p">:</span>
                <span class="c1"># get the functions of the base class</span>
                <span class="n">functions_base_class</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">baseclass</span><span class="p">,</span>
                                       <span class="n">predicate</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">))</span>

                <span class="c1"># if there is a function with the same name as base class</span>
                <span class="k">if</span> <span class="n">func_name</span> <span class="ow">in</span> <span class="n">functions_base_class</span><span class="p">:</span>
                    <span class="c1"># if the function object is the same</span>
                    <span class="c1"># as one defined in a base class</span>
                    <span class="k">if</span> <span class="n">func_obj</span> <span class="o">==</span> <span class="n">functions_base_class</span><span class="p">[</span><span class="n">func_name</span><span class="p">]:</span>
                        <span class="c1"># print(f&#39;{func_name} in subclass is same as function in&#39;</span>
                        <span class="c1">#       f&#39;{baseclass.__name__} (not overridden)&#39;)</span>
                        <span class="n">should_i_print</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># print(f&#39;{func_name} in subclass is not the same &#39;</span>
                        <span class="c1">#       f&#39;as one in baseclass {baseclass.__name__}&#39;)</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># print(f&#39;{func_name} is not in &#39;</span>
                    <span class="c1">#       f&#39;baseclass {baseclass.__name__}&#39;)</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">should_i_print</span><span class="p">:</span>
            <span class="c1"># print(f&#39;\t✓✓✓ {func_name} is implemented in the subclass - print &#39;)</span>
            <span class="n">ok_to_print</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(f&#39;\txxx {func_name} has been inherited from a subclass&#39;</span>
            <span class="c1">#       f&#39;- do not print&#39;)</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">ok_to_print</span></div>


<div class="viewcode-block" id="extract_bases"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.extract_bases">[docs]</a><span class="k">def</span> <span class="nf">extract_bases</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">class_obj</span><span class="p">,</span> <span class="n">spacer</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Document which classes this class inherits from,</span>
<span class="sd">    except for the object class or this class itself.</span>

<span class="sd">    :param class_name: name of the class (e.g. Mockitis) for which we want the</span>
<span class="sd">                       bases</span>
<span class="sd">    :param class_obj: object with information about this class</span>
<span class="sd">    :param spacer: string to use as whitespace padding.</span>
<span class="sd">    :return: Tuple with (1) string of base(s) for this class (if any), with</span>
<span class="sd">             links to their docs. (2) the list of base class objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This next line gets the base classes including &quot;object&quot; class,</span>
    <span class="c1"># and also the class_name class itself:</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="n">class_obj</span><span class="p">)</span>
    <span class="c1"># Typical example of &quot;bases&quot;:</span>
    <span class="c1"># (&lt;class &#39;tlo.methods.mockitis.Mockitis&#39;&gt;,</span>
    <span class="c1"># &lt;class &#39;tlo.core.Module&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
    <span class="c1"># print(f&quot;bases for {class_name}: {bases}&quot;)</span>
    <span class="c1"># classtree = inspect.getclasstree(bases)</span>
    <span class="c1"># print(f&quot;classtree = {classtree}&quot;)</span>

    <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">relevant_bases</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
        <span class="c1"># Example of this_base_string:</span>
        <span class="c1"># `tlo.core.Module &lt;./tlo.core.html#tlo.core.Module&gt;`</span>
        <span class="n">this_base_string</span> <span class="o">=</span> <span class="n">get_base_string</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">class_obj</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_base_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_base_string</span><span class="p">)</span>

        <span class="c1"># We don&#39;t want to include the name of the child class.</span>
        <span class="c1"># Or the &quot;object&quot; class, which all objects will</span>
        <span class="c1"># ultimately inherit from.</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;object&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="n">class_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
            <span class="n">relevant_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">Bases: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># print(f&quot;DEBUG: extract_bases: mystr = {mystr}&quot;)</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">relevant_bases</span></div>


<div class="viewcode-block" id="get_base_string"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_base_string">[docs]</a><span class="k">def</span> <span class="nf">get_base_string</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">class_obj</span><span class="p">,</span> <span class="n">base_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For this object, representing a base class,</span>
<span class="sd">    extract its name and add a hyperlink to it.</span>
<span class="sd">    Unless it is the root &#39;object&#39; class, or the name of the class itself.</span>

<span class="sd">    :param class_name: the name of the class (e.g. &quot;Mockitis&quot;)</span>
<span class="sd">                       for which obj is a base,</span>
<span class="sd">    :param class_obj: object representing the class</span>
<span class="sd">    :param base_obj: the object representation of the *base* class,</span>
<span class="sd">                     e.g. &lt;class &#39;tlo.core.Module&#39;&gt; or &lt;class &#39;object&#39;&gt;</span>
<span class="sd">                     or &lt;class &#39;tlo.methods.mockitis.Mockitis&#39;&gt;</span>
<span class="sd">    :return: string as hyperlink</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract fully-qualified name of base (e.g. &quot;tlo.core.Module&quot;)</span>
    <span class="c1"># from its object representation (e.g. &quot;&lt;class &#39;tlo.core.Module&#39;&gt;&quot;)</span>
    <span class="c1"># print (f&quot;DEBUG: before = {class_name}, {base_obj}&quot;)</span>
    <span class="n">fqn</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base_obj</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;class &#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># print(f&quot;DEBUG: after = {class_name}, {fqn}&quot;)</span>
    <span class="c1"># The next line&#39;s getsourcefile() call will raise a TypeError</span>
    <span class="c1"># if the object is a built-in module, class, or function:</span>
    <span class="c1"># print(f&quot;and filename: {inspect.getsourcefile(base_obj)},</span>
    <span class="c1">#  module: {inspect.getmodule(base_obj)}&quot;)</span>
    <span class="c1"># module like: &lt;module &#39;tlo.methods.mockitis&#39; from ...</span>

    <span class="c1"># fqn will now be something like &quot;tlo.methods.mockitis.Mockitis&quot;</span>
    <span class="c1"># or &quot;tlo.core.Module&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">fqn</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">fqn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># e.g. Mockitis or Module</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">fqn</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">class_name</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># link = get_link(fqn, base_obj)</span>

    <span class="c1"># We want the final HTML to be like:</span>
    <span class="c1"># Bases: &lt;a class=&quot;reference internal&quot; href=&quot;tlo.core.html#tlo.core.Module&quot;</span>
    <span class="c1">#     title=&quot;tlo.core.Module&quot;&gt;</span>
    <span class="c1">#     &lt;code class=&quot;xref py py-class docutils literal notranslate&quot;&gt;</span>
    <span class="c1">#     &lt;span class=&quot;pre&quot;&gt;tlo.core.Module&lt;/span&gt;&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;</span>
    <span class="c1"># So we need to write the right stuff to the .rst file.</span>
    <span class="c1"># We want to return a string with the name of the base class, plus</span>
    <span class="c1"># the link to its documentation.</span>
    <span class="c1"># e.g. the string might be:</span>
    <span class="c1"># &quot;tlo.core.Module &lt;./tlo.core.html#tlo.core.Module&gt;_&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># 3rd November 2020 - Asif suggests it should be more like:</span>
    <span class="c1"># :class: `tlo.events.Event`</span>
    <span class="c1"># or :py:class: `tlo.events.Event`</span>
    <span class="c1"># to fix the &quot;broken&quot; link issue on Travis (#204)</span>
    <span class="c1"># was: mystr = &quot;`&quot; + fqn + &quot; &quot; + link + &quot;`_&quot;</span>
    <span class="n">mystr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:class:`</span><span class="si">{</span><span class="n">fqn</span><span class="si">}</span><span class="s2">`&quot;</span>
    <span class="c1"># print(f&quot;DEBUG: get_base_string(): {mystr}&quot;)</span>
    <span class="k">return</span> <span class="n">mystr</span></div>


<div class="viewcode-block" id="get_link"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.get_link">[docs]</a><span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="n">base_fqn</span><span class="p">,</span> <span class="n">base_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a name like Mockitis and a base_string like</span>
<span class="sd">    tlo.core.Module, create a link to the latter&#39;s doc page.</span>

<span class="sd">    :param base_fqn: fully-qualified name of the base class,</span>
<span class="sd">                     e.g. tlo.core.Module</span>
<span class="sd">    :param base_obj: the object representing the base class</span>
<span class="sd">    :return: a string with the link to the base class&#39;s place in the generated</span>
<span class="sd">             documentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Example of module_defining_class: &lt;module &#39;tlo.core&#39; from &#39;/Users/...</span>
    <span class="n">module_defining_class</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">base_obj</span><span class="p">))</span>
    <span class="n">module_pieces</span> <span class="o">=</span> <span class="n">module_defining_class</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">module_pieces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">module_pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># e.g. &#39;tlo.core&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="n">module_defining_class</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Remove single speech marks</span>
    <span class="c1"># print(f&quot;My lovely module is {module_name}&quot;)  # e.g. tlo.core</span>

    <span class="c1"># Need name of base&#39;s file + fqn of base</span>
    <span class="c1"># We want a link string like: &lt;./tlo.core.html#tlo.core.Module&gt;</span>
    <span class="c1"># i.e. &lt;base&#39;s file name#base&#39;s fqn&gt;</span>

    <span class="c1"># Example link to a base class (from a class in reference directory):</span>
    <span class="c1"># http://0.0.0.0:8000/reference/tlo.core.html#tlo.core.Module</span>
    <span class="c1"># In this code the link would be &lt;./tlo.core.html#tlo.core.Module&gt;</span>
    <span class="n">link_to_base</span> <span class="o">=</span> <span class="s2">&quot;&lt;./&quot;</span> <span class="o">+</span> <span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="n">base_fqn</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
    <span class="c1"># print(f&quot;link_to_base = {link_to_base}&quot;)</span>
    <span class="k">return</span> <span class="n">link_to_base</span></div>


<div class="viewcode-block" id="create_table"><a class="viewcode-back" href="../../reference/tlo.docs.html#tlo.docs.create_table">[docs]</a><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">mydict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamically create a table of arbitrary length</span>
<span class="sd">    from a PROPERTIES or PARAMETERS dictionary.</span>

<span class="sd">    :param mydict: the dictionary object.</span>
<span class="sd">    :return: A list of strings, used for output.</span>

<span class="sd">    NB Do not change the positioning of items in the</span>
<span class="sd">    f-strings below, or things will break!</span>

<span class="sd">    The table is returned as a list of strings.</span>
<span class="sd">    If there is no data, an empty list is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">examplestr</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">.. list-table::</span>
<span class="s1">   :widths: 25 25 50</span>
<span class="s1">   :header-rows: 1</span>

<span class="s1">   * - Item</span>
<span class="s1">     - Type</span>
<span class="s1">     - Description</span>
<span class="s1">&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mydict</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">description</span>
            <span class="n">mytype</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">type_</span>  <span class="c1"># e.g. &lt;Types.REAL: 4&gt;</span>
            <span class="n">the_type</span> <span class="o">=</span> <span class="n">mytype</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># e.g. &#39;REAL&#39;</span>

            <span class="k">if</span> <span class="n">the_type</span> <span class="o">==</span> <span class="s1">&#39;CATEGORICAL&#39;</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;.  Possible values are: [&quot;</span>
                <span class="n">mylist</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">categories</span>
                <span class="k">for</span> <span class="n">mything</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
                    <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mything</span><span class="si">}</span><span class="s1">, &#39;</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>

            <span class="n">row</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;   * - </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"></span>
<span class="s1">     - </span><span class="si">{</span><span class="n">the_type</span><span class="si">}</span><span class="s1"></span>
<span class="s1">     - </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1"></span>
<span class="s1">&#39;&#39;&#39;</span>
            <span class="n">examplestr</span> <span class="o">+=</span> <span class="n">row</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="n">examplestr</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mylist</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 06, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>